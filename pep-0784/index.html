
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 784 – Adding Zstandard to the standard library | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0784/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://peps.python.org/peps.rss">
    <meta property="og:title" content='PEP 784 – Adding Zstandard to the standard library | peps.python.org'>
    <meta property="og:description" content="Zstandard is a widely adopted, mature, and highly efficient compression standard. This PEP proposes adding a new module to the Python standard library containing a Python wrapper around Meta’s zstd library, the default implementation. Additionally, to a...">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://peps.python.org/pep-0784/">
    <meta property="og:site_name" content="Python Enhancement Proposals (PEPs)">
    <meta property="og:image" content="https://peps.python.org/_static/og-image.png">
    <meta property="og:image:alt" content="Python PEPs">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta name="description" content="Zstandard is a widely adopted, mature, and highly efficient compression standard. This PEP proposes adding a new module to the Python standard library containing a Python wrapper around Meta’s zstd library, the default implementation. Additionally, to a...">
    <meta name="theme-color" content="#3776ab">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1 data-pagefind-ignore>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 784</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        
        <div id="mobile-search" class="mobile-search-container"></div>
        
        <article data-pagefind-body>
            
            <span data-pagefind-meta="title:PEP 784 – Adding Zstandard to the standard library" data-pagefind-weight="10" class="visually-hidden">PEP 784 – Adding Zstandard to the standard library</span>
            <section id="pep-content">
<h1 class="page-title">PEP 784 – Adding Zstandard to the standard library</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Emma Harper Smith &lt;emma&#32;&#97;t&#32;python.org&gt;</dd>
<dt class="field-even">Sponsor<span class="colon">:</span></dt>
<dd class="field-even">Gregory P. Smith &lt;greg&#32;&#97;t&#32;krypto.org&gt;</dd>
<dt class="field-odd">Discussions-To<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="https://discuss.python.org/t/87377">Discourse thread</a></dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><abbr title="Accepted and implementation complete, or no longer active">Final</abbr></dd>
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><abbr title="Normative PEP with a new feature for Python, implementation change for CPython or interoperability standard for the ecosystem">Standards Track</abbr></dd>
<dt class="field-even">Created<span class="colon">:</span></dt>
<dd class="field-even">06-Apr-2025</dd>
<dt class="field-odd">Python-Version<span class="colon">:</span></dt>
<dd class="field-odd">3.14</dd>
<dt class="field-even">Post-History<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="https://discuss.python.org/t/87377" title="Discourse thread">07-Apr-2025</a></dd>
<dt class="field-odd">Resolution<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="https://discuss.python.org/t/87377/138">25-Apr-2025</a></dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a><ul>
<li><a class="reference internal" href="#introduction-of-a-compression-package">Introduction of a <code class="docutils literal notranslate"><span class="pre">compression</span></code> package</a></li>
<li><a class="reference internal" href="#implementation-based-on-pyzstd">Implementation based on <code class="docutils literal notranslate"><span class="pre">pyzstd</span></code></a></li>
<li><a class="reference internal" href="#minimum-supported-zstandard-version">Minimum supported Zstandard version</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#the-compression-namespace">The <code class="docutils literal notranslate"><span class="pre">compression</span></code> namespace</a></li>
<li><a class="reference internal" href="#the-compression-zstd-module">The <code class="docutils literal notranslate"><span class="pre">compression.zstd</span></code> module</a></li>
<li><a class="reference internal" href="#libzstd-optional-dependency"><code class="docutils literal notranslate"><span class="pre">libzstd</span></code> optional dependency</a></li>
<li><a class="reference internal" href="#other-compression-modules">Other compression modules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#name-the-module-zstdlib-and-do-not-make-a-new-compression-namespace">Name the module <code class="docutils literal notranslate"><span class="pre">zstdlib</span></code> and do not make a new <code class="docutils literal notranslate"><span class="pre">compression</span></code> namespace</a></li>
<li><a class="reference internal" href="#introduce-an-experimental-zstd-package-in-python-3-14">Introduce an experimental <code class="docutils literal notranslate"><span class="pre">_zstd</span></code> package in Python 3.14</a></li>
<li><a class="reference internal" href="#introduce-a-standard-library-namespace-instead-of-compression">Introduce a standard library namespace instead of <code class="docutils literal notranslate"><span class="pre">compression</span></code></a></li>
<li><a class="reference internal" href="#include-zipfile-and-tarfile-in-compression">Include <code class="docutils literal notranslate"><span class="pre">zipfile</span></code> and <code class="docutils literal notranslate"><span class="pre">tarfile</span></code> in <code class="docutils literal notranslate"><span class="pre">compression</span></code></a></li>
<li><a class="reference internal" href="#do-not-include-gzip-under-compression">Do not include <code class="docutils literal notranslate"><span class="pre">gzip</span></code> under <code class="docutils literal notranslate"><span class="pre">compression</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<div class="pep-banner canonical-doc sticky-banner admonition important">
<p class="admonition-title">Important</p>
<p>This PEP is a historical document. The up-to-date, canonical documentation can now be found at <a class="reference external" href="https://docs.python.org/3/library/compression.zstd.html#module-compression.zstd" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compression.zstd</span></code></a>.</p>
<p class="close-button">×</p>
<p>See <a class="pep reference internal" href="../pep-0001/" title="PEP 1 – PEP Purpose and Guidelines">PEP 1</a> for how to propose changes.</p>
</div>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p><a class="reference external" href="https://facebook.github.io/zstd/">Zstandard</a> is a widely adopted, mature, and highly efficient compression
standard. This PEP proposes adding a new module to the Python standard library
containing a Python wrapper around Meta’s <code class="docutils literal notranslate"><span class="pre">zstd</span></code> library, the default
implementation. Additionally, to avoid name collisions with packages on PyPI
and to present a unified interface to Python users, compression modules in the
standard library will be moved under a <code class="docutils literal notranslate"><span class="pre">compression.*</span></code> package.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation" role="doc-backlink">Motivation</a></h2>
<p>CPython has modules for several different compression formats, such as
<a class="reference external" href="https://docs.python.org/3/library/zlib.html#module-zlib" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">zlib</span> <span class="pre">(DEFLATE)</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/gzip.html#module-gzip" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">gzip</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/bz2.html#module-bz2" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bzip2</span></code></a>, and
<a class="reference external" href="https://docs.python.org/3/library/lzma.html#module-lzma" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">lzma</span></code></a>, each widely used. Including popular compression algorithms
matches Python’s “batteries included” philosophy of incorporating widely useful
standards and utilities. <code class="xref py py-mod docutils literal notranslate"><span class="pre">lzma</span></code> is the most recent such module, added in
Python 3.3.</p>
<p>Since then, Zstandard has become the modern <em>de facto</em> preferred compression
library for both high performance compression and decompression attaining high
compression ratios at reasonable CPU and memory cost. Zstandard achieves a much
higher compression ratio than bzip2 or zlib (DEFLATE) while decompressing
significantly faster than LZMA.</p>
<p>Zstandard has seen <a class="reference external" href="https://facebook.github.io/zstd/#references">widespread adoption</a> in many different areas of computing.
The numerous hardware implementations demonstrate long-term commitment to
Zstandard and an expectation that Zstandard will stay the <em>de facto</em> choice for
compression for years to come. This is further evidenced by Zstandard’s IETF
standardization in <span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc8478.html"><strong>RFC 8478</strong></a>. Zstandard compression is also implemented in
both the <a class="reference external" href="https://en.wikipedia.org/wiki/ZFS">ZFS</a> and <a class="reference external" href="https://btrfs.readthedocs.io/">Btrfs</a> filesystems.</p>
<p>Zstandard’s highly efficient compression has supplanted other modern
compression formats, such as <a class="reference external" href="https://brotli.org/">brotli</a>, <a class="reference external" href="https://www.oberhumer.com/opensource/lzo/">lzo</a>, and <a class="reference external" href="https://www.oberhumer.com/opensource/ucl/">ucl</a> due to its highly
efficient compression. While <a class="reference external" href="https://lz4.org/">LZ4</a> is still used in very high throughput
scenarios, Zstandard can also be used in some of these contexts.
While inclusion of LZ4 is out of scope, it would be a compelling future
addition to the <code class="docutils literal notranslate"><span class="pre">compression</span></code> namespace introduced by this PEP.</p>
<p>There are several bindings to Zstandard for Python available on PyPI, each with
different APIs and choices of how to bind the <code class="docutils literal notranslate"><span class="pre">zstd</span></code> library. One goal with
introducing an official module in the standard library is to reduce confusion
for Python users who want simple compression/decompression APIs for Zstandard.
The existing packages can continue providing extended APIs or integrate
features from newer Zstandard versions.</p>
<p>Another reason to add Zstandard support to the standard library is to resolve
a long standing open issue (<a class="reference external" href="https://github.com/python/cpython/issues/81276">python/cpython#81276</a>) requesting Zstandard
support in the <a class="reference external" href="https://docs.python.org/3/library/tarfile.html#module-tarfile" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tarfile</span></code></a> module. This issue has the 5th most “thumbs up”
of open issues on the CPython tracker, and has garnered a significant amount of
discussion and interest. Additionally, the ZIP format standardizes a
<a class="reference external" href="https://pkwaredownloads.blob.core.windows.net/pkware-general/Documentation/APPNOTE-6.3.8.TXT">Zstandard compression format ID</a>, and integration with the <a class="reference external" href="https://docs.python.org/3/library/zipfile.html#module-zipfile" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">zipfile</span></code></a>
module would allow opening ZIP archives using Zstandard compression. The
reference implementation for this PEP contains integration with the
<code class="xref py py-mod docutils literal notranslate"><span class="pre">zipfile</span></code>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">tarfile</span></code>, and <a class="reference external" href="https://docs.python.org/3/library/shutil.html#module-shutil" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">shutil</span></code></a> modules.</p>
<p>Zstandard compression could also be used to make Python wheel packages smaller
and significantly faster to install. Anaconda found a sizeable speedup when
adopting Zstandard for the conda package format:</p>
<blockquote class="epigraph">
<div>Conda’s download sizes are reduced ~30-40%, and extraction is dramatically faster.
[…]
We see approximately a 2.5x overall speedup, almost all thanks to the dramatically faster extraction speed of the zstd compression used in the new file format.<p class="attribution">—<a class="reference external" href="https://www.anaconda.com/blog/how-we-made-conda-faster-4-7">Anaconda blog on Zstandard adoption</a></p>
</div></blockquote>
<p>Zstandard has a significantly higher compression ratio compared to wheel’s
existing zlib-based compression, <a class="reference external" href="https://github.com/inikep/lzbench#benchmarks">according to lzbench</a>, a comprehensive
benchmark of many different compression libraries and formats.
While this PEP does <em>not</em> prescribe any changes to the wheel format or other
packaging standards, having Zstandard bindings in the standard library would
enable a future PEP to improve the user experience for Python wheel packages.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale" role="doc-backlink">Rationale</a></h2>
<section id="introduction-of-a-compression-package">
<h3><a class="toc-backref" href="#introduction-of-a-compression-package" role="doc-backlink">Introduction of a <code class="docutils literal notranslate"><span class="pre">compression</span></code> package</a></h3>
<p>Both the <code class="docutils literal notranslate"><span class="pre">zstd</span></code> and <code class="docutils literal notranslate"><span class="pre">zstandard</span></code> import names are claimed by projects on
PyPI. To avoid breaking users of one of the existing bindings, this PEP
proposes introducing a new namespace for compression libraries,
<code class="docutils literal notranslate"><span class="pre">compression</span></code>. This name is already reserved on PyPI for use in the
standard library. The new Zstandard module will be named <code class="docutils literal notranslate"><span class="pre">compression.zstd</span></code>.
Other compression modules will be re-exported in the new <code class="docutils literal notranslate"><span class="pre">compression</span></code> package.</p>
<p>Providing a common namespace for compression modules has several advantages.
First, it reduces user confusion about where to find compression modules.
Second, the top level <code class="docutils literal notranslate"><span class="pre">compression</span></code> module could provide information on which
compression formats are available, similar to <code class="docutils literal notranslate"><span class="pre">hashlib</span></code>’s
<code class="docutils literal notranslate"><span class="pre">algorithms_available</span></code>. If <a class="pep reference internal" href="../pep-0775/" title="PEP 775 – Make zlib required to build CPython">PEP 775</a> is accepted, a
<code class="docutils literal notranslate"><span class="pre">compression.algorithms_guaranteed</span></code> could be provided as well, listing
<code class="docutils literal notranslate"><span class="pre">zlib</span></code>. Finally, a <code class="docutils literal notranslate"><span class="pre">compression</span></code> namespace prevents future issues with
merging other compression formats into the standard library. New compression
formats will likely be published to PyPI prior to integration into
CPython. Therefore, any new compression format import name will likely already
be claimed by the time a module would be considered for inclusion in CPython.
Putting compression modules under a package prefix prevents issues with
potential future name clashes.</p>
<p>Code that would like to remain compatible across Python versions may use the
following pattern to ensure compatibility:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">compression.lzma</span><span class="w"> </span><span class="kn">import</span> <span class="n">LZMAFile</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">lzma</span><span class="w"> </span><span class="kn">import</span> <span class="n">LZMAFile</span>
</pre></div>
</div>
<p>This will use the newer import name when available and fall back to the old
name otherwise.</p>
</section>
<section id="implementation-based-on-pyzstd">
<h3><a class="toc-backref" href="#implementation-based-on-pyzstd" role="doc-backlink">Implementation based on <code class="docutils literal notranslate"><span class="pre">pyzstd</span></code></a></h3>
<p>The implementation for this PEP is based on the <a class="reference external" href="https://github.com/Rogdham/pyzstd">pyzstd project</a>.
This project was chosen as the code was <a class="reference external" href="https://github.com/python/cpython/issues/81276#issuecomment-1093824963">originally written to be upstreamed</a>
to CPython by Ma Lin, who also wrote the <a class="reference external" href="https://github.com/python/cpython/commit/f9bedb630e8a0b7d94e1c7e609b20dfaa2b22231">output buffer implementation</a> used in
the standard library today.
The project has since been taken over by Rogdham and is published to PyPI. The
APIs in <code class="docutils literal notranslate"><span class="pre">pyzstd</span></code> are similar to the APIs for other compression modules in the
standard library such as <code class="xref py py-mod docutils literal notranslate"><span class="pre">bz2</span></code> and <code class="xref py py-mod docutils literal notranslate"><span class="pre">lzma</span></code>.</p>
</section>
<section id="minimum-supported-zstandard-version">
<h3><a class="toc-backref" href="#minimum-supported-zstandard-version" role="doc-backlink">Minimum supported Zstandard version</a></h3>
<p>The minimum supported Zstandard was chosen as v1.4.5, released in May of 2020.
This version was chosen as a minimum based on reviewing the versions of
Zstandard available in a number of Linux distribution package repositories,
including LTS releases. This version choice is rather conservative to maximize
compatibility with existing LTS Linux distributions, but a newer Zstandard
version could likely be chosen given that newer Python releases are generally
packaged as part of newer distribution releases.</p>
</section>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification" role="doc-backlink">Specification</a></h2>
<section id="the-compression-namespace">
<h3><a class="toc-backref" href="#the-compression-namespace" role="doc-backlink">The <code class="docutils literal notranslate"><span class="pre">compression</span></code> namespace</a></h3>
<p>A new namespace for compression modules will be introduced named
<code class="docutils literal notranslate"><span class="pre">compression</span></code>. The top-level module for this package will be empty to begin
with, but a standard API for interacting with compression routines may be
added in the future to the toplevel.</p>
</section>
<section id="the-compression-zstd-module">
<h3><a class="toc-backref" href="#the-compression-zstd-module" role="doc-backlink">The <code class="docutils literal notranslate"><span class="pre">compression.zstd</span></code> module</a></h3>
<p>A new module, <code class="docutils literal notranslate"><span class="pre">compression.zstd</span></code> will be introduced with Zstandard
compression APIs that match other compression modules in the standard library,
namely</p>
<ul class="simple">
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">compress()</span></code> / <code class="xref py py-func docutils literal notranslate"><span class="pre">decompress()</span></code> - APIs for one-shot compression
or decompression</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">ZstdFile</span></code> / <code class="xref py py-func docutils literal notranslate"><span class="pre">open()</span></code> - APIs for interacting with streams
and file-like objects</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">ZstdCompressor</span></code> / <code class="xref py py-class docutils literal notranslate"><span class="pre">ZstdDecompressor</span></code> - APIs for incremental
compression or decompression</li>
</ul>
<p>It will also contain some Zstandard-specific functionality:</p>
<ul class="simple">
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">ZstdDict</span></code> / <code class="xref py py-func docutils literal notranslate"><span class="pre">train_dict()</span></code> / <code class="xref py py-func docutils literal notranslate"><span class="pre">finalize_dict()</span></code> - APIs for
interacting with Zstandard dictionaries, which are useful for compressing
many small chunks of similar data</li>
</ul>
</section>
<section id="libzstd-optional-dependency">
<h3><a class="toc-backref" href="#libzstd-optional-dependency" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">libzstd</span></code> optional dependency</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">libzstd</span></code> library will become an optional dependency of CPython. If the
library is not available, the <code class="docutils literal notranslate"><span class="pre">compression.zstd</span></code> module will be unavailable.
This is handled automatically on Unix platforms as part of the normal build
environment detection.</p>
<p>On Windows, <code class="docutils literal notranslate"><span class="pre">libzstd</span></code> will be added to
<a class="reference external" href="https://github.com/python/cpython-source-deps">the source dependencies</a>
used to build libraries CPython depends on for Windows.</p>
</section>
<section id="other-compression-modules">
<h3><a class="toc-backref" href="#other-compression-modules" role="doc-backlink">Other compression modules</a></h3>
<p>New import names <code class="docutils literal notranslate"><span class="pre">compression.lzma</span></code>, <code class="docutils literal notranslate"><span class="pre">compression.bz2</span></code>,
<code class="docutils literal notranslate"><span class="pre">compression.gzip</span></code> and <code class="docutils literal notranslate"><span class="pre">compression.zlib</span></code> will be introduced in Python 3.14
re-exporting the contents of the existing <code class="docutils literal notranslate"><span class="pre">lzma</span></code>, <code class="docutils literal notranslate"><span class="pre">bz2</span></code>, <code class="docutils literal notranslate"><span class="pre">gzip</span></code> and
<code class="docutils literal notranslate"><span class="pre">zlib</span></code> modules respectively. The <code class="docutils literal notranslate"><span class="pre">compression</span></code> sub-modules will become
the canonical import names going forward. The use of the new compression names
will be promoted over the original top level module names in the Python
documentation when the minimum supported Python version requirements make
that feasible.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">_compression</span></code> module, given that it is marked private, will be
immediately renamed to <code class="docutils literal notranslate"><span class="pre">compression._common._streams</span></code>. The new name was
selected due to the current contents of the module being I/O related helpers
for stream APIs (e.g. <code class="docutils literal notranslate"><span class="pre">LZMAFile</span></code>) in standard library compression modules.</p>
</section>
</section>
<section id="backwards-compatibility">
<h2><a class="toc-backref" href="#backwards-compatibility" role="doc-backlink">Backwards Compatibility</a></h2>
<p>This PEP introduces no backwards incompatible changes. There are currently no
plans to deprecate or remove the existing compression modules. Any deprecation
or removal of the existing modules is left to a future decision but will occur
no sooner than 5 years from the acceptance of this PEP.</p>
</section>
<section id="security-implications">
<h2><a class="toc-backref" href="#security-implications" role="doc-backlink">Security Implications</a></h2>
<p>As with any new C code, especially code operating on potentially untrusted user
input, there are risks of memory safety issues. The author plans on
contributing integration with libfuzzer to enable fuzzing the <code class="docutils literal notranslate"><span class="pre">_zstd</span></code> code
and ensure it is robust. Furthermore, there are a number of tests that exercise
the compression and decompression routines. These tests pass without error when
compiled with AddressSanitizer.</p>
<p>Taking on a new dependency also always has security risks, but the <code class="docutils literal notranslate"><span class="pre">zstd</span></code>
library is mature, fuzzed on each commit, and <a class="reference external" href="https://github.com/facebook/zstd/blob/dev/SECURITY.md">participates in Meta’s bug bounty
program</a>.</p>
</section>
<section id="how-to-teach-this">
<h2><a class="toc-backref" href="#how-to-teach-this" role="doc-backlink">How to Teach This</a></h2>
<p>Documentation for the new module is in the reference implementation branch. The
documentation for existing modules will be updated to reference the new names
as well.</p>
</section>
<section id="reference-implementation">
<h2><a class="toc-backref" href="#reference-implementation" role="doc-backlink">Reference Implementation</a></h2>
<p>The <a class="reference external" href="https://github.com/emmatyping/cpython/tree/zstd">reference implementation</a>
contains the <code class="docutils literal notranslate"><span class="pre">_zstd</span></code> C code, the <code class="docutils literal notranslate"><span class="pre">compression.zstd</span></code> code, modifications to
<code class="docutils literal notranslate"><span class="pre">tarfile</span></code>, <code class="docutils literal notranslate"><span class="pre">shutil</span></code>, and <code class="docutils literal notranslate"><span class="pre">zipfile</span></code>, and tests for each new API and
integration added. It also contains the re-exports of other compression
modules.</p>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#rejected-ideas" role="doc-backlink">Rejected Ideas</a></h2>
<section id="name-the-module-zstdlib-and-do-not-make-a-new-compression-namespace">
<h3><a class="toc-backref" href="#name-the-module-zstdlib-and-do-not-make-a-new-compression-namespace" role="doc-backlink">Name the module <code class="docutils literal notranslate"><span class="pre">zstdlib</span></code> and do not make a new <code class="docutils literal notranslate"><span class="pre">compression</span></code> namespace</a></h3>
<p>One option instead of making a new <code class="docutils literal notranslate"><span class="pre">compression</span></code> namespace would be to find
a different name, such as <code class="docutils literal notranslate"><span class="pre">zstdlib</span></code>, as the import name. Several other names,
such as <code class="docutils literal notranslate"><span class="pre">zst</span></code>, <code class="docutils literal notranslate"><span class="pre">libzstd</span></code>, and <code class="docutils literal notranslate"><span class="pre">zstdcomp</span></code> were proposed as well. In
discussion, the names were found to either be too easy to typo, or unintuitive.
Furthermore, the issue of existing import names is likely to persist for future
compression formats added to the standard library. LZ4, a common high speed
compression format, has <a class="reference external" href="https://pypi.org/project/lz4/">a package on PyPI</a>,
<code class="docutils literal notranslate"><span class="pre">lz4</span></code>, with the import name <code class="docutils literal notranslate"><span class="pre">lz4</span></code>. Instead of solving this issue for each
compression format, it is better to solve it once and for all by using the
already-claimed <code class="docutils literal notranslate"><span class="pre">compression</span></code> namespace.</p>
</section>
<section id="introduce-an-experimental-zstd-package-in-python-3-14">
<h3><a class="toc-backref" href="#introduce-an-experimental-zstd-package-in-python-3-14" role="doc-backlink">Introduce an experimental <code class="docutils literal notranslate"><span class="pre">_zstd</span></code> package in Python 3.14</a></h3>
<p>Since this PEP was published close to the beta cutoff for new features for
Python 3.14, one proposal was to name the package a private module <code class="docutils literal notranslate"><span class="pre">_zstd</span></code>
so that packaging tools could use it sooner, but not deciding on a name. This
would allow more time for discussion of the final module name during the 3.15
development window. However, introducing a private module was not popular. The
expectations and contract for external usage of a private module in the
standard library are unclear.</p>
</section>
<section id="introduce-a-standard-library-namespace-instead-of-compression">
<h3><a class="toc-backref" href="#introduce-a-standard-library-namespace-instead-of-compression" role="doc-backlink">Introduce a standard library namespace instead of <code class="docutils literal notranslate"><span class="pre">compression</span></code></a></h3>
<p>One alternative to a <code class="docutils literal notranslate"><span class="pre">compression</span></code> namespace would be to introduce a
<code class="docutils literal notranslate"><span class="pre">std</span></code> namespace for the entire standard library. However, this was seen as
too significant a change for 3.14, with no agreed upon semantics, migration
path, or name for the package. Furthermore, a future PEP introducing a <code class="docutils literal notranslate"><span class="pre">std</span></code>
namespace could always define that the <code class="docutils literal notranslate"><span class="pre">compression</span></code> sub-modules be flattened
into the <code class="docutils literal notranslate"><span class="pre">std</span></code> namespace.</p>
</section>
<section id="include-zipfile-and-tarfile-in-compression">
<h3><a class="toc-backref" href="#include-zipfile-and-tarfile-in-compression" role="doc-backlink">Include <code class="docutils literal notranslate"><span class="pre">zipfile</span></code> and <code class="docutils literal notranslate"><span class="pre">tarfile</span></code> in <code class="docutils literal notranslate"><span class="pre">compression</span></code></a></h3>
<p>Compression is often used with archiving tools, so putting both <a class="reference external" href="https://docs.python.org/3/library/zipfile.html#module-zipfile" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">zipfile</span></code></a>
and <a class="reference external" href="https://docs.python.org/3/library/tarfile.html#module-tarfile" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tarfile</span></code></a> under the <code class="docutils literal notranslate"><span class="pre">compression</span></code> namespace is appealing. However,
compression can be used beyond just archiving tools. For example, network
requests can be gzip compressed. Furthermore, formats like tar do not include
compression themselves, instead relying on external compression. Therefore,
this PEP does not propose moving <code class="xref py py-mod docutils literal notranslate"><span class="pre">zipfile</span></code> or <code class="xref py py-mod docutils literal notranslate"><span class="pre">tarfile</span></code> under
<code class="docutils literal notranslate"><span class="pre">compression</span></code>.</p>
</section>
<section id="do-not-include-gzip-under-compression">
<h3><a class="toc-backref" href="#do-not-include-gzip-under-compression" role="doc-backlink">Do not include <code class="docutils literal notranslate"><span class="pre">gzip</span></code> under <code class="docutils literal notranslate"><span class="pre">compression</span></code></a></h3>
<p>The <span class="target" id="index-1"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1952.html"><strong>GZip format RFC</strong></a> defines a format which can include multiple
blocks and metadata about its contents. In this way GZip is rather similar to
archive formats like ZIP and tar. Despite that, in usage GZip is often treated
as a compression format rather than an archive format. Looking at how different
languages classify GZip, the prevailing trend is to classify it as a
compression format and not an archiving format.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Language</th>
<th class="head">Compression or Archive</th>
<th class="head">Documentation Link</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td>Golang</td>
<td>Compression</td>
<td><a class="reference external" href="https://pkg.go.dev/compress/gzip">https://pkg.go.dev/compress/gzip</a></td>
</tr>
<tr class="row-odd"><td>Ruby</td>
<td>Compression</td>
<td><a class="reference external" href="https://docs.ruby-lang.org/en/master/Zlib/GzipFile.html">https://docs.ruby-lang.org/en/master/Zlib/GzipFile.html</a></td>
</tr>
<tr class="row-even"><td>Rust</td>
<td>Compression</td>
<td><a class="reference external" href="https://github.com/rust-lang/flate2-rs">https://github.com/rust-lang/flate2-rs</a></td>
</tr>
<tr class="row-odd"><td>Haskell</td>
<td>Compression</td>
<td><a class="reference external" href="https://hackage.haskell.org/package/zlib">https://hackage.haskell.org/package/zlib</a></td>
</tr>
<tr class="row-even"><td>C#</td>
<td>Compression</td>
<td><a class="reference external" href="https://learn.microsoft.com/en-us/dotnet/api/system.io.compression.gzipstream">https://learn.microsoft.com/en-us/dotnet/api/system.io.compression.gzipstream</a></td>
</tr>
<tr class="row-odd"><td>Java</td>
<td>Archive</td>
<td><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/zip/package-summary.html">https://docs.oracle.com/javase/8/docs/api/java/util/zip/package-summary.html</a></td>
</tr>
<tr class="row-even"><td>NodeJS</td>
<td>Compression</td>
<td><a class="reference external" href="https://nodejs.org/api/zlib.html">https://nodejs.org/api/zlib.html</a></td>
</tr>
<tr class="row-odd"><td>Web APIs</td>
<td>Compression</td>
<td><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Compression_Streams_API">https://developer.mozilla.org/en-US/docs/Web/API/Compression_Streams_API</a></td>
</tr>
<tr class="row-even"><td>PHP</td>
<td>Compression</td>
<td><a class="reference external" href="https://www.php.net/manual/en/function.gzcompress.php">https://www.php.net/manual/en/function.gzcompress.php</a></td>
</tr>
<tr class="row-odd"><td>Perl</td>
<td>Compression</td>
<td><a class="reference external" href="https://perldoc.perl.org/IO::Compress::Gzip">https://perldoc.perl.org/IO::Compress::Gzip</a></td>
</tr>
</tbody>
</table>
<p>In addition, the <code class="xref py py-mod docutils literal notranslate"><span class="pre">gzip</span></code> module in Python mostly focuses on single block
content and has an API similar to other compression modules, making it a good
fit for the <code class="docutils literal notranslate"><span class="pre">compression</span></code> namespace.</p>
</section>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document is placed in the public domain or under the
CC0-1.0-Universal license, whichever is more permissive.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/peps/pep-0784.rst">https://github.com/python/peps/blob/main/peps/pep-0784.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/peps/pep-0784.rst">2025-05-24 04:38:02 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <div id="search"></div>
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a><ul>
<li><a class="reference internal" href="#introduction-of-a-compression-package">Introduction of a <code class="docutils literal notranslate"><span class="pre">compression</span></code> package</a></li>
<li><a class="reference internal" href="#implementation-based-on-pyzstd">Implementation based on <code class="docutils literal notranslate"><span class="pre">pyzstd</span></code></a></li>
<li><a class="reference internal" href="#minimum-supported-zstandard-version">Minimum supported Zstandard version</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#the-compression-namespace">The <code class="docutils literal notranslate"><span class="pre">compression</span></code> namespace</a></li>
<li><a class="reference internal" href="#the-compression-zstd-module">The <code class="docutils literal notranslate"><span class="pre">compression.zstd</span></code> module</a></li>
<li><a class="reference internal" href="#libzstd-optional-dependency"><code class="docutils literal notranslate"><span class="pre">libzstd</span></code> optional dependency</a></li>
<li><a class="reference internal" href="#other-compression-modules">Other compression modules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#name-the-module-zstdlib-and-do-not-make-a-new-compression-namespace">Name the module <code class="docutils literal notranslate"><span class="pre">zstdlib</span></code> and do not make a new <code class="docutils literal notranslate"><span class="pre">compression</span></code> namespace</a></li>
<li><a class="reference internal" href="#introduce-an-experimental-zstd-package-in-python-3-14">Introduce an experimental <code class="docutils literal notranslate"><span class="pre">_zstd</span></code> package in Python 3.14</a></li>
<li><a class="reference internal" href="#introduce-a-standard-library-namespace-instead-of-compression">Introduce a standard library namespace instead of <code class="docutils literal notranslate"><span class="pre">compression</span></code></a></li>
<li><a class="reference internal" href="#include-zipfile-and-tarfile-in-compression">Include <code class="docutils literal notranslate"><span class="pre">zipfile</span></code> and <code class="docutils literal notranslate"><span class="pre">tarfile</span></code> in <code class="docutils literal notranslate"><span class="pre">compression</span></code></a></li>
<li><a class="reference internal" href="#do-not-include-gzip-under-compression">Do not include <code class="docutils literal notranslate"><span class="pre">gzip</span></code> under <code class="docutils literal notranslate"><span class="pre">compression</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/peps/pep-0784.rst?plain=1">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
    <script src="../_static/sticky_banner.js"></script>
    <script src="https://analytics.python.org/js/script.outbound-links.js"
            data-domain="peps.python.org" defer></script>
    <script src="/pagefind/pagefind-ui.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            // Ranking configuration to boost exact title matches
            const searchOptions = {
                ranking: {
                    termSimilarity: 9.0, // Higher values favor exact matches
                    termFrequency: 0.5, // Lower values reduce penalty for low term frequency
                    pageLength: 0.2, // Lower values reduce the impact of page length
                }
            };

            // Initialize pagefind for either mobile or desktop, not both
            if (window.innerWidth <= 640) {
                new PagefindUI({ element: "#mobile-search", ...searchOptions, showSubResults: false });
            } else {
                new PagefindUI({ element: "#search", ...searchOptions, showSubResults: true });
            }
        });
    </script>
</body>
</html>