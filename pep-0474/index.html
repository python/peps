
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 474 – Creating forge.python.org | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0474/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://peps.python.org/peps.rss">
    <meta property="og:title" content='PEP 474 – Creating forge.python.org | peps.python.org'>
    <meta property="og:description" content="This PEP proposes setting up a new PSF provided resource, forge.python.org, as a location for maintaining various supporting repositories (such as the repository for Python Enhancement Proposals) in a way that is more accessible to new contributors, and...">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://peps.python.org/pep-0474/">
    <meta property="og:site_name" content="Python Enhancement Proposals (PEPs)">
    <meta property="og:image" content="https://peps.python.org/_static/og-image.png">
    <meta property="og:image:alt" content="Python PEPs">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta name="description" content="This PEP proposes setting up a new PSF provided resource, forge.python.org, as a location for maintaining various supporting repositories (such as the repository for Python Enhancement Proposals) in a way that is more accessible to new contributors, and...">
    <meta name="theme-color" content="#3776ab">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 474</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 474 – Creating forge.python.org</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Alyssa Coghlan &lt;ncoghlan&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><abbr title="Removed from consideration by sponsor or authors">Withdrawn</abbr></dd>
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><abbr title="Normative PEP describing or proposing a change to a Python community process, workflow or governance">Process</abbr></dd>
<dt class="field-even">Created<span class="colon">:</span></dt>
<dd class="field-even">19-Jul-2014</dd>
<dt class="field-odd">Post-History<span class="colon">:</span></dt>
<dd class="field-odd">19-Jul-2014, 08-Jan-2015, 01-Feb-2015</dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#pep-withdrawal">PEP Withdrawal</a></li>
<li><a class="reference internal" href="#proposal">Proposal</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#intended-benefits">Intended Benefits</a></li>
<li><a class="reference internal" href="#sustaining-engineering-considerations">Sustaining Engineering Considerations</a></li>
<li><a class="reference internal" href="#personal-motivation">Personal Motivation</a></li>
<li><a class="reference internal" href="#technical-concerns-and-challenges">Technical Concerns and Challenges</a><ul>
<li><a class="reference internal" href="#service-hosting">Service hosting</a></li>
<li><a class="reference internal" href="#ongoing-infrastructure-maintenance">Ongoing infrastructure maintenance</a></li>
<li><a class="reference internal" href="#user-account-management">User account management</a></li>
<li><a class="reference internal" href="#breaking-existing-ssh-access-and-links-for-mercurial-repositories">Breaking existing SSH access and links for Mercurial repositories</a></li>
<li><a class="reference internal" href="#integration-with-roundup">Integration with Roundup</a></li>
<li><a class="reference internal" href="#accepting-pull-requests-on-github-and-bitbucket">Accepting pull requests on GitHub and BitBucket</a></li>
<li><a class="reference internal" href="#transparent-git-and-mercurial-interoperability">Transparent Git and Mercurial interoperability</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pilot-objectives-and-timeline">Pilot Objectives and Timeline</a></li>
<li><a class="reference internal" href="#future-implications-for-cpython-core-development">Future Implications for CPython Core Development</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p>This PEP proposes setting up a new PSF provided resource, forge.python.org,
as a location for maintaining various supporting repositories
(such as the repository for Python Enhancement Proposals) in a way that is
more accessible to new contributors, and easier to manage for core
developers.</p>
<p>This PEP does <em>not</em> propose any changes to the core development workflow
for CPython itself (see <a class="pep reference internal" href="../pep-0462/" title="PEP 462 – Core development workflow automation for CPython">PEP 462</a> in relation to that).</p>
</section>
<section id="pep-withdrawal">
<h2><a class="toc-backref" href="#pep-withdrawal" role="doc-backlink">PEP Withdrawal</a></h2>
<p>This PEP has been <a class="reference external" href="https://mail.python.org/pipermail/core-workflow/2015-October/000227.html">withdrawn by the author</a>
in favour of the GitLab based proposal in <a class="pep reference internal" href="../pep-0507/" title="PEP 507 – Migrate CPython to Git and GitLab">PEP 507</a>.</p>
<p>If anyone else would like to take over championing this PEP, contact the
<a class="reference external" href="https://mail.python.org/mailman/listinfo/core-workflow">core-workflow mailing list</a></p>
</section>
<section id="proposal">
<h2><a class="toc-backref" href="#proposal" role="doc-backlink">Proposal</a></h2>
<p>This PEP proposes that an instance of the self-hosted Kallithea code
repository management system be deployed as “forge.python.org”.</p>
<p>Individual repositories (such as the developer guide or the PEPs repository)
may then be migrated from the existing hg.python.org infrastructure to the
new forge.python.org infrastructure on a case-by-case basis. Each migration
will need to decide whether to retain a read-only mirror on hg.python.org,
or whether to just migrate wholesale to the new location.</p>
<p>In addition to supporting read-only mirrors on hg.python.org,
forge.python.org will also aim to support hosting mirrors on popular
proprietary hosting sites like GitHub and BitBucket. The aim will be to
allow users familiar with these sites to submit and discuss pull requests
using their preferred workflow, with forge.python.org automatically bringing
those contributions over to the master repository.</p>
<p>Given the availability and popularity of commercially backed “free for open
source projects” repository hosting services, this would not be a general
purpose hosting site for arbitrary Python projects. The initial focus will be
specifically on CPython and other repositories currently hosted on
hg.python.org. In the future, this could potentially be expanded to
consolidating other PSF managed repositories that are currently externally
hosted to gain access to a pull request based workflow, such as the
repository for the python.org Django application. As with the initial
migrations, any such future migrations would be considered on a case-by-case
basis, taking into account the preferences of the primary users of each
repository.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale" role="doc-backlink">Rationale</a></h2>
<p>Currently, hg.python.org hosts more than just the core CPython repository,
it also hosts other repositories such as those for the CPython developer
guide and for Python Enhancement Proposals, along with various “sandbox”
repositories for core developer experimentation.</p>
<p>While the simple “pull request” style workflow made popular by code hosting
sites like GitHub and BitBucket isn’t adequate for the complex branching
model needed for parallel maintenance and development of the various
CPython releases, it’s a good fit for several of the ancillary projects
that surround CPython that we don’t wish to move to a proprietary hosting
site.</p>
<p>The key requirements proposed for a PSF provided software forge are:</p>
<ul class="simple">
<li>MUST support simple “pull request” style workflows</li>
<li>MUST support online editing for simple changes</li>
<li>MUST be backed by an active development organisation (community or
commercial)</li>
<li>MUST support self-hosting of the master repository on PSF infrastructure
without ongoing fees</li>
</ul>
<p>Additional recommended requirements that are satisfied by this proposal,
but may be negotiable if a sufficiently compelling alternative is presented:</p>
<ul class="simple">
<li>SHOULD be a fully open source application written in Python</li>
<li>SHOULD support Mercurial (for consistency with existing tooling)</li>
<li>SHOULD support Git (to provide that option to users that prefer it)</li>
<li>SHOULD allow users of git and Mercurial clients to transparently
collaborate on the same repository</li>
<li>SHOULD allow users of GitHub and BitBucket to submit proposed changes using
the standard pull request workflows offered by those tools</li>
<li>SHOULD be open to customisation to meet the needs of CPython core
development, including providing a potential path forward for the
proposed migration to a core reviewer model in <a class="pep reference internal" href="../pep-0462/" title="PEP 462 – Core development workflow automation for CPython">PEP 462</a></li>
</ul>
<p>The preference for self-hosting without ongoing fees rules out the
free-as-in-beer providers like GitHub and BitBucket, in addition to the
various proprietary source code management offerings.</p>
<p>The preference for Mercurial support not only rules out GitHub, but also
other Git-only solutions like GitLab and Gitorious.</p>
<p>The hard requirement for online editing support rules out the Apache
Allura/HgForge combination.</p>
<p>The preference for a fully open source solution rules out RhodeCode.</p>
<p>Of the various options considered by the author of this proposal, that
leaves <a class="reference external" href="https://kallithea-scm.org/">Kallithea SCM</a> as the proposed
foundation for a forge.python.org service.</p>
<p>Kallithea is a full GPLv3 application (derived from the clearly
and unambiguously GPLv3 licensed components of RhodeCode) that is being
developed under the auspices of the <a class="reference external" href="http://sfconservancy.org/news/2014/jul/04/kallithea-joins/">Software Freedom Conservancy</a>. The
Conservancy has <a class="reference external" href="http://sfconservancy.org/blog/2014/jul/15/why-kallithea/">affirmed</a> that the
Kallithea codebase is completely and validly licensed under GPLv3. In
addition to their role in building the initial Kallithea community, the
Conservancy is also the legal home of both the Mercurial and Git projects.
Other SFC member projects that may be familiar to Python users include
Twisted, Gevent, BuildBot and PyPy.</p>
</section>
<section id="intended-benefits">
<h2><a class="toc-backref" href="#intended-benefits" role="doc-backlink">Intended Benefits</a></h2>
<p>The primary benefit of deploying Kallithea as forge.python.org is that
supporting repositories such as the developer guide and the PEP repo could
potentially be managed using pull requests and online editing. This would be
much simpler than the current workflow which requires PEP editors and
other core developers to act as intermediaries to apply updates suggested
by other users.</p>
<p>The richer administrative functionality would also make it substantially
easier to grant users access to particular repositories for collaboration
purposes, without having to grant them general access to the entire
installation. This helps lower barriers to entry, as trust can more
readily be granted and earned incrementally, rather than being an
all-or-nothing decision around granting core developer access.</p>
</section>
<section id="sustaining-engineering-considerations">
<h2><a class="toc-backref" href="#sustaining-engineering-considerations" role="doc-backlink">Sustaining Engineering Considerations</a></h2>
<p>Even with its current workflow, CPython itself remains one of the largest
open source projects in the world (in the
<a class="reference external" href="https://www.openhub.net/p/python/factoids#FactoidTeamSizeVeryLarge">top 2%</a>
of projects tracked on OpenHub). Unfortunately, we have been significantly
less effective at encouraging contributions to the projects that make up
CPython’s workflow infrastructure, including ensuring that our installations
track upstream, and that wherever feasible, our own customisations are
contributed back to the original project.</p>
<p>As such, a core component of this proposal is to actively engage with the
upstream Kallithea community to lower the barriers to working with and on
the Kallithea SCM, as well as with the PSF Infrastructure team to ensure
the forge.python.org service integrates cleanly with the PSF’s infrastructure
automation.</p>
<p>This approach aims to provide a number of key benefits:</p>
<ul class="simple">
<li>allowing those of us contributing to maintenance of this service to be
as productive as possible in the time we have available</li>
<li>offering a compelling professional development opportunity to those
volunteers that choose to participate in maintenance of this service</li>
<li>making the Kallithea project itself more attractive to other potential
users by making it as easy as possible to adopt, deploy and manage</li>
<li>as a result of the above benefits, attracting sufficient contributors both
in the upstream Kallithea community, and within the CPython infrastructure
community, to allow the forge.python.org service to evolve effectively to
meet changing developer expectations</li>
</ul>
<p>Some initial steps have already been taken to address these sustaining
engineering concerns:</p>
<ul class="simple">
<li>Tymoteusz Jankowski has been working with Donald Stufft to work out <a class="reference external" href="https://github.com/xliiv/psf-salt/tree/kallithea">what
would be involved</a>
in deploying Kallithea using the PSF’s Salt based infrastructure automation.</li>
<li>Graham Dumpleton and I have been working on
<a class="reference external" href="http://www.curiousefficiency.org/posts/2014/12/kallithea-on-openshift.html">making it easy</a>
to deploy demonstration Kallithea instances to the free tier of Red Hat’s open
source hosting service, OpenShift Online. (See the comments on that post, or
the <a class="reference external" href="https://github.com/ncoghlan/openshift-kallithea/issues/">quickstart issue tracker</a> for links to
Graham’s follow on work)</li>
</ul>
<p>The next major step to be undertaken is to come up with a local development
workflow that allows contributors on Windows, Mac OS X and Linux to run
the Kallithea tests locally, without interfering with the operation of
their own system. The currently planned approach for this is to focus on
Vagrant, which is a popular automated virtual machine management system
specifically aimed at developers running local VMs for testing purposes.
The <a class="reference external" href="http://www.openshift.org/documentation/oo_deployment_guide_vagrant.html">Vagrant based development guidelines</a>
for OpenShift Origin provide an extended example of the kind of workflow this
approach enables. It’s also worth noting that Vagrant is one of the options
for working with a local build of the <a class="reference external" href="https://github.com/python/pythondotorg#using-vagrant">main python.org website</a>.</p>
<p>If these workflow proposals end up working well for Kallithea, they may also
be worth proposing for use by the upstream projects backing other PSF and
CPython infrastructure services, including Roundup, BuildBot, and the main
python.org web site.</p>
</section>
<section id="personal-motivation">
<h2><a class="toc-backref" href="#personal-motivation" role="doc-backlink">Personal Motivation</a></h2>
<p>As of July 2015, I now work for Red Hat as a software development workflow
designer and process architect, focusing on the upstream developer experience
in Fedora. Two of the key pieces of that experience will be familiar to many
web service developers: Docker for local container management, and Vagrant for
cross-platform local development VM management. Spending time applying these
technologies in multiple upstream contexts helps provide additional insight
into what works well and what still needs further improvement to provide a good
software development experience that is well integrated on Fedora, but also
readily available on other Linux distributions, Windows, Mac OS X.</p>
<p>In relation to code review workflows in particular, the primary code review
workflow management tools I’ve used in my career are
Gerrit (for multi-step code review with fine-grained access control), GitHub
and BitBucket (for basic pull request based workflows), and Rietveld (for
CPython’s optional pre-commit reviews).</p>
<p>Kallithea is interesting as a base project to build, as it’s currently a
combined repo hosting and code review management platform, but doesn’t
directly integrate the two by offering online merges. This creates the
opportunity to blend the low barrier to entry benefits of the GitHub/BitBucket
pull request model with the mentoring and task hand-off benefits of Gerrit
in defining an online code merging model for Kallithea in collaboration with
the upstream Kallithea developers.</p>
</section>
<section id="technical-concerns-and-challenges">
<h2><a class="toc-backref" href="#technical-concerns-and-challenges" role="doc-backlink">Technical Concerns and Challenges</a></h2>
<p>Introducing a new service into the CPython infrastructure presents a number
of interesting technical concerns and challenges. This section covers several
of the most significant ones.</p>
<section id="service-hosting">
<h3><a class="toc-backref" href="#service-hosting" role="doc-backlink">Service hosting</a></h3>
<p>The default position of this PEP is that the new forge.python.org service
will be integrated into the existing PSF Salt infrastructure and hosted on
the PSF’s Rackspace cloud infrastructure.</p>
<p>However, other hosting options will also be considered, in particular,
possible deployment as a <a class="reference external" href="http://kubernetes.io/">Kubernetes</a> hosted web
service on either
<a class="reference external" href="https://cloud.google.com/container-engine/">Google Container Engine</a> or
the next generation of Red Hat’s
<a class="reference external" href="http://www.openshift.org/">OpenShift Online</a> service, by using either
GCEPersistentDisk or the open source
<a class="reference external" href="http://www.emergingafrican.com/2015/02/configuring-kubernetes-to-use.html">GlusterFS distributed filesystem</a>
to hold the source code repositories.</p>
</section>
<section id="ongoing-infrastructure-maintenance">
<h3><a class="toc-backref" href="#ongoing-infrastructure-maintenance" role="doc-backlink">Ongoing infrastructure maintenance</a></h3>
<p>Ongoing infrastructure maintenance is an area of concern within the PSF,
as we currently lack a system administrator mentorship program equivalent to
the <a class="reference external" href="https://fedoraproject.org/wiki/Infrastructure/GettingStarted">Fedora Infrastructure Apprentice</a> or
<a class="reference external" href="https://wiki.gnome.org/Sysadmin/Apprentices">GNOME Infrastructure Apprentice</a>
programs.</p>
<p>Instead, systems tend to be maintained largely by developers as a part-time
activity on top of their development related contributions, rather than
seeking to recruit folks that are more interested in operations (i.e.
keeping existing systems running well) than they are in development (i.e.
making changes to the services to provide new features or a better user
experience, or to address existing issues).</p>
<p>While I’d personally like to see the PSF operating such a program at some
point in the future, I don’t consider setting one up to be a
feasible near term goal. However, I do consider it feasible to continue
laying the groundwork for such a program by extending the PSF’s existing
usage of modern infrastructure technologies like OpenStack and Salt to
cover more services, as well as starting to explore the potential benefits of
containers and container platforms when it comes to maintaining and enhancing
PSF provided services.</p>
<p>I also plan to look into the question of whether or not an open source cloud
management platform like <a class="reference external" href="http://manageiq.org/">ManageIQ</a> may help us
bring our emerging “cloud sprawl” problem across Rackspace, Google, Amazon
and other services more under control.</p>
</section>
<section id="user-account-management">
<h3><a class="toc-backref" href="#user-account-management" role="doc-backlink">User account management</a></h3>
<p>Ideally we’d like to be able to offer a single account that spans all
python.org services, including Kallithea, Roundup/Rietveld, PyPI and the
back end for the new python.org site, but actually implementing that would
be a distinct infrastructure project, independent of this PEP. (It’s also
worth noting that the fine-grained control of ACLs offered by such a
capability is a prerequisite for setting up an
<a class="reference external" href="https://www.dragonsreach.it/2015/01/28/the-gnome-infrastructure-apprentice-program/">effective system administrator mentorship program</a>)</p>
<p>For the initial rollout of forge.python.org, we will likely create yet another
identity silo within the PSF infrastructure. A potentially superior
alternative would be to add support for <a class="reference external" href="https://python-social-auth.readthedocs.org">python-social-auth</a> to Kallithea, but actually
doing so would not be a requirement for the initial rollout of the service
(the main technical concern there is that Kallithea is a Pylons application
that has not yet been ported to Pyramid, so integration will require either
adding a Pylons backend to python-social-auth, or else embarking on the
Pyramid migration in Kallithea).</p>
</section>
<section id="breaking-existing-ssh-access-and-links-for-mercurial-repositories">
<h3><a class="toc-backref" href="#breaking-existing-ssh-access-and-links-for-mercurial-repositories" role="doc-backlink">Breaking existing SSH access and links for Mercurial repositories</a></h3>
<p>This PEP proposes leaving the existing hg.python.org installation alone,
and setting up Kallithea on a new host. This approach minimises the risk
of interfering with the development of CPython itself (and any other
projects that don’t migrate to the new software forge), but does make any
migrations of existing repos more disruptive (since existing checkouts will
break).</p>
</section>
<section id="integration-with-roundup">
<h3><a class="toc-backref" href="#integration-with-roundup" role="doc-backlink">Integration with Roundup</a></h3>
<p>Kallithea provides configurable issue tracker integration. This will need
to be set up appropriately to integrate with the Roundup issue tracker at
bugs.python.org before the initial rollout of the forge.python.org service.</p>
</section>
<section id="accepting-pull-requests-on-github-and-bitbucket">
<h3><a class="toc-backref" href="#accepting-pull-requests-on-github-and-bitbucket" role="doc-backlink">Accepting pull requests on GitHub and BitBucket</a></h3>
<p>The initial rollout of forge.python.org would support publication of read-only
mirrors, both on hg.python.org and other services, as that is a relatively
straightforward operation that can be implemented in a commit hook.</p>
<p>While a highly desirable feature, accepting pull requests on external
services, and mirroring them as submissions to the master repositories on
forge.python.org is a more complex problem, and would likely not be included
as part of the initial rollout of the forge.python.org service.</p>
</section>
<section id="transparent-git-and-mercurial-interoperability">
<h3><a class="toc-backref" href="#transparent-git-and-mercurial-interoperability" role="doc-backlink">Transparent Git and Mercurial interoperability</a></h3>
<p>Kallithea’s native support for both Git and Mercurial offers an opportunity
to make it relatively straightforward for developers to use the client
of their choice to interact with repositories hosted on forge.python.org.</p>
<p>This transparent interoperability does <em>not</em> exist yet, but running our own
multi-VCS repository hosting service provides the opportunity to make this
capability a reality, rather than passively waiting for a proprietary
provider to deign to provide a feature that likely isn’t in their commercial
interest. There’s a significant misalignment of incentives between open
source communities and commercial providers in this particular area, as even
though offering VCS client choice can significantly reduce community friction
by eliminating the need for projects to make autocratic decisions that force
particular tooling choices on potential contributors, top down enforcement
of tool selection (regardless of developer preference) is currently still
the norm in the corporate and other organisational environments that produce
GitHub and Atlassian’s paying customers.</p>
<p>Prior to acceptance, in the absence of transparent interoperability, this PEP
should propose specific recommendations for inclusion in the CPython
developer’s guide section for
<a class="reference external" href="https://docs.python.org/devguide/gitdevs.html">git users</a> for creating
pull requests against forge.python.org hosted Mercurial repositories.</p>
</section>
</section>
<section id="pilot-objectives-and-timeline">
<h2><a class="toc-backref" href="#pilot-objectives-and-timeline" role="doc-backlink">Pilot Objectives and Timeline</a></h2>
<p>[TODO: Update this section for Brett’s revised timeline, which aims to have
a CPython demo repository online by October 31st, to get a better indication
of <em>future</em> capabilities once CPython itself migrates over to the new
system, rather than just the support repos]</p>
<p>This proposal is part of Brett Cannon’s <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2014-December/137472.html">current evaluation</a>
of improvement proposals for various aspects of the CPython development
workflow. Key dates in that timeline are:</p>
<ul class="simple">
<li>Feb 1: Draft proposal published (for Kallithea, this PEP)</li>
<li>Apr 8: Discussion of final proposals at Python Language Summit</li>
<li>May 1: Brett’s decision on which proposal to accept</li>
<li>Sep 13: Python 3.5 released, adopting new workflows for Python 3.6</li>
</ul>
<p>If this proposal is selected for further development, it is proposed to start
with the rollout of the following pilot deployment:</p>
<ul class="simple">
<li>a reference implementation operational at kallithea-pilot.python.org,
containing at least the developer guide and PEP repositories. This will
be a “throwaway” instance, allowing core developers and other contributors
to experiment freely without worrying about the long term consequences for
the repository history.</li>
<li>read-only live mirrors of the Kallithea hosted repositories on GitHub and
BitBucket. As with the pilot service itself, these would be temporary repos,
to be discarded after the pilot period ends.</li>
<li>clear documentation on using those mirrors to create pull requests against
Kallithea hosted Mercurial repositories (for the pilot, this will likely
<em>not</em> include using the native pull request workflows of those hosted
services)</li>
<li>automatic linking of issue references in code review comments and commit
messages to the corresponding issues on bugs.python.org</li>
<li>draft updates to <a class="pep reference internal" href="../pep-0001/" title="PEP 1 – PEP Purpose and Guidelines">PEP 1</a> explaining the Kallithea-based PEP editing and
submission workflow</li>
</ul>
<p>The following items would be needed for a production migration, but there
doesn’t appear to be an obvious way to trial an updated implementation as
part of the pilot:</p>
<ul class="simple">
<li>adjusting the PEP publication process and the developer guide publication
process to be based on the relocated Mercurial repos</li>
</ul>
<p>The following items would be objectives of the overall workflow improvement
process, but are considered “desirable, but not essential” for the initial
adoption of the new service in September (if this proposal is the one
selected and the proposed pilot deployment is successful):</p>
<ul class="simple">
<li>allowing the use of python-social-auth to authenticate against the PSF
hosted Kallithea instance</li>
<li>allowing the use of the GitHub and BitBucket pull request workflows to
submit pull requests to the main Kallithea repo</li>
<li>allowing easy triggering of forced BuildBot runs based on Kallithea hosted
repos and pull requests (prior to the implementation of <a class="pep reference internal" href="../pep-0462/" title="PEP 462 – Core development workflow automation for CPython">PEP 462</a>, this
would be intended for use with sandbox repos rather than the main CPython
repo)</li>
</ul>
</section>
<section id="future-implications-for-cpython-core-development">
<h2><a class="toc-backref" href="#future-implications-for-cpython-core-development" role="doc-backlink">Future Implications for CPython Core Development</a></h2>
<p>The workflow requirements for the main CPython development repository are
significantly more complex than those for the repositories being discussed
in this PEP. These concerns are covered in more detail in <a class="pep reference internal" href="../pep-0462/" title="PEP 462 – Core development workflow automation for CPython">PEP 462</a>.</p>
<p>Given Guido’s recommendation to replace Rietveld with a more actively
maintained code review system, my current plan is to rewrite that PEP to
use Kallithea as the proposed glue layer, with enhanced Kallithea pull
requests eventually replacing the current practice of uploading patche files
directly to the issue tracker.</p>
<p>I’ve also started working with Pierre Yves-David on a <a class="reference external" href="https://bitbucket.org/ncoghlan/cpydev/src/default/cpyhg.py?at=default">custom Mercurial
extension</a>
that automates some aspects of the CPython core development workflow.</p>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document has been placed in the public domain.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/peps/pep-0474.rst">https://github.com/python/peps/blob/main/peps/pep-0474.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/peps/pep-0474.rst">2025-02-01 08:59:27 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#pep-withdrawal">PEP Withdrawal</a></li>
<li><a class="reference internal" href="#proposal">Proposal</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#intended-benefits">Intended Benefits</a></li>
<li><a class="reference internal" href="#sustaining-engineering-considerations">Sustaining Engineering Considerations</a></li>
<li><a class="reference internal" href="#personal-motivation">Personal Motivation</a></li>
<li><a class="reference internal" href="#technical-concerns-and-challenges">Technical Concerns and Challenges</a><ul>
<li><a class="reference internal" href="#service-hosting">Service hosting</a></li>
<li><a class="reference internal" href="#ongoing-infrastructure-maintenance">Ongoing infrastructure maintenance</a></li>
<li><a class="reference internal" href="#user-account-management">User account management</a></li>
<li><a class="reference internal" href="#breaking-existing-ssh-access-and-links-for-mercurial-repositories">Breaking existing SSH access and links for Mercurial repositories</a></li>
<li><a class="reference internal" href="#integration-with-roundup">Integration with Roundup</a></li>
<li><a class="reference internal" href="#accepting-pull-requests-on-github-and-bitbucket">Accepting pull requests on GitHub and BitBucket</a></li>
<li><a class="reference internal" href="#transparent-git-and-mercurial-interoperability">Transparent Git and Mercurial interoperability</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pilot-objectives-and-timeline">Pilot Objectives and Timeline</a></li>
<li><a class="reference internal" href="#future-implications-for-cpython-core-development">Future Implications for CPython Core Development</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/peps/pep-0474.rst?plain=1">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
    <script src="../_static/sticky_banner.js"></script>
    <script src="https://analytics.python.org/js/script.outbound-links.js"
            data-domain="peps.python.org" defer></script>
</body>
</html>