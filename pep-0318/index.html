
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 318 – Decorators for Functions and Methods | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0318/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://peps.python.org/peps.rss">
    <meta property="og:title" content='PEP 318 – Decorators for Functions and Methods | peps.python.org'>
    <meta property="og:description" content="The current method for transforming functions and methods (for instance, declaring them as a class or static method) is awkward and can lead to code that is difficult to understand.  Ideally, these transformations should be made at the same point in the...">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://peps.python.org/pep-0318/">
    <meta property="og:site_name" content="Python Enhancement Proposals (PEPs)">
    <meta property="og:image" content="https://peps.python.org/_static/og-image.png">
    <meta property="og:image:alt" content="Python PEPs">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta name="description" content="The current method for transforming functions and methods (for instance, declaring them as a class or static method) is awkward and can lead to code that is difficult to understand.  Ideally, these transformations should be made at the same point in the...">
    <meta name="theme-color" content="#3776ab">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 318</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 318 – Decorators for Functions and Methods</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Kevin D. Smith &lt;Kevin.Smith&#32;&#97;t&#32;theMorgue.org&gt;, Jim J. Jewett, Skip Montanaro, Anthony Baxter</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><abbr title="Accepted and implementation complete, or no longer active">Final</abbr></dd>
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><abbr title="Normative PEP with a new feature for Python, implementation change for CPython or interoperability standard for the ecosystem">Standards Track</abbr></dd>
<dt class="field-even">Created<span class="colon">:</span></dt>
<dd class="field-even">05-Jun-2003</dd>
<dt class="field-odd">Python-Version<span class="colon">:</span></dt>
<dd class="field-odd">2.4</dd>
<dt class="field-even">Post-History<span class="colon">:</span></dt>
<dd class="field-even">09-Jun-2003, 10-Jun-2003, 27-Feb-2004, 23-Mar-2004, 30-Aug-2004,
02-Sep-2004</dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#warningwarningwarning">WarningWarningWarning</a></li>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a><ul>
<li><a class="reference internal" href="#why-is-this-so-hard">Why Is This So Hard?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#on-the-name-decorator">On the name ‘Decorator’</a></li>
<li><a class="reference internal" href="#design-goals">Design Goals</a></li>
<li><a class="reference internal" href="#current-syntax">Current Syntax</a></li>
<li><a class="reference internal" href="#syntax-alternatives">Syntax Alternatives</a><ul>
<li><a class="reference internal" href="#decorator-location">Decorator Location</a></li>
<li><a class="reference internal" href="#syntax-forms">Syntax forms</a></li>
<li><a class="reference internal" href="#why">Why &#64;?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#current-implementation-history">Current Implementation, History</a><ul>
<li><a class="reference internal" href="#community-consensus">Community Consensus</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#no-longer-open-issues">(No longer) Open Issues</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="warningwarningwarning">
<h2><a class="toc-backref" href="#warningwarningwarning" role="doc-backlink">WarningWarningWarning</a></h2>
<p>This document is meant to describe the decorator syntax and the
process that resulted in the decisions that were made.  It does not
attempt to cover the huge number of potential alternative syntaxes,
nor is it an attempt to exhaustively list all the positives and
negatives of each form.</p>
</section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p>The current method for transforming functions and methods (for instance,
declaring them as a class or static method) is awkward and can lead to
code that is difficult to understand.  Ideally, these transformations
should be made at the same point in the code where the declaration
itself is made.  This PEP introduces new syntax for transformations of a
function or method declaration.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation" role="doc-backlink">Motivation</a></h2>
<p>The current method of applying a transformation to a function or method
places the actual transformation after the function body.  For large
functions this separates a key component of the function’s behavior from
the definition of the rest of the function’s external interface.  For
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">perform</span> <span class="n">method</span> <span class="n">operation</span>
<span class="n">foo</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
</pre></div>
</div>
<p>This becomes less readable with longer methods.  It also seems less
than pythonic to name the function three times for what is conceptually
a single declaration.  A solution to this problem is to move the
transformation of the method closer to the method’s own declaration.
The intent of the new syntax is to replace</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="n">foo</span> <span class="o">=</span> <span class="n">synchronized</span><span class="p">(</span><span class="n">lock</span><span class="p">)(</span><span class="n">foo</span><span class="p">)</span>
<span class="n">foo</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
</pre></div>
</div>
<p>with an alternative that places the decoration in the function’s
declaration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
<span class="nd">@synchronized</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Modifying classes in this fashion is also possible, though the benefits
are not as immediately apparent.  Almost certainly, anything which could
be done with class decorators could be done using metaclasses, but
using metaclasses is sufficiently obscure that there is some attraction
to having an easier way to make simple modifications to classes.  For
Python 2.4, only function/method decorators are being added.</p>
<p><a class="pep reference internal" href="../pep-3129/" title="PEP 3129 – Class Decorators">PEP 3129</a> proposes to add class decorators as of Python 2.6.</p>
<section id="why-is-this-so-hard">
<h3><a class="toc-backref" href="#why-is-this-so-hard" role="doc-backlink">Why Is This So Hard?</a></h3>
<p>Two decorators (<code class="docutils literal notranslate"><span class="pre">classmethod()</span></code> and <code class="docutils literal notranslate"><span class="pre">staticmethod()</span></code>) have been
available in Python since version 2.2.  It’s been assumed since
approximately that time that some syntactic support for them would
eventually be added to the language.  Given this assumption, one might
wonder why it’s been so difficult to arrive at a consensus.  Discussions
have raged off-and-on at times in both comp.lang.python and the
python-dev mailing list about how best to implement function decorators.
There is no one clear reason why this should be so, but a few problems
seem to be most divisive.</p>
<ul class="simple">
<li>Disagreement about where the “declaration of intent” belongs.
Almost everyone agrees that decorating/transforming a function at the
end of its definition is suboptimal.  Beyond that there seems to be no
clear consensus where to place this information.</li>
<li>Syntactic constraints.  Python is a syntactically simple language
with fairly strong constraints on what can and can’t be done without
“messing things up” (both visually and with regards to the language
parser).  There’s no obvious way to structure this information so
that people new to the concept will think, “Oh yeah, I know what
you’re doing.”  The best that seems possible is to keep new users from
creating a wildly incorrect mental model of what the syntax means.</li>
<li>Overall unfamiliarity with the concept.  For people who have a
passing acquaintance with algebra (or even basic arithmetic) or have
used at least one other programming language, much of Python is
intuitive.  Very few people will have had any experience with the
decorator concept before encountering it in Python.  There’s just no
strong preexisting meme that captures the concept.</li>
<li>Syntax discussions in general appear to cause more contention than
almost anything else. Readers are pointed to the ternary operator
discussions that were associated with <a class="pep reference internal" href="../pep-0308/" title="PEP 308 – Conditional Expressions">PEP 308</a> for another example of
this.</li>
</ul>
</section>
</section>
<section id="background">
<h2><a class="toc-backref" href="#background" role="doc-backlink">Background</a></h2>
<p>There is general agreement that syntactic support is desirable to
the current state of affairs.  Guido mentioned <a class="reference external" href="http://www.python.org/doc/essays/ppt/python10/py10keynote.pdf">syntactic support
for decorators</a> in his DevDay keynote presentation at the <a class="reference external" href="http://www.python.org/workshops/2002-02/">10th
Python Conference</a>, though <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2002-February/020017.html">he later said</a> it was only one of
several extensions he proposed there “semi-jokingly”.  <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2002-February/020005.html">Michael Hudson
raised the topic</a> on <code class="docutils literal notranslate"><span class="pre">python-dev</span></code> shortly after the conference,
attributing the initial bracketed syntax to an earlier proposal on
<code class="docutils literal notranslate"><span class="pre">comp.lang.python</span></code> by <a class="reference external" href="http://groups.google.com/groups?hl=en&amp;lr=&amp;ie=UTF-8&amp;oe=UTF-8&amp;selm=slrna40k88.2h9o.Gareth.McCaughan%40g.local">Gareth McCaughan</a>.</p>
<p>Class decorations seem like an obvious next step because class
definition and function definition are syntactically similar,
however Guido remains unconvinced, and class decorators will almost
certainly not be in Python 2.4.</p>
<p>The discussion continued on and off on python-dev from February
2002 through July 2004.  Hundreds and hundreds of posts were made,
with people proposing many possible syntax variations.  Guido took
a list of proposals to <a class="reference external" href="http://www.python.org/doc/essays/ppt/euro2004/euro2004.pdf">EuroPython 2004</a>, where a discussion took
place.  Subsequent to this, he decided that we’d have the <a class="reference external" href="http://java.sun.com/j2se/1.5.0/docs/guide/language/annotations.html">Java-style</a>
&#64;decorator syntax, and this appeared for the first time in 2.4a2.
Barry Warsaw named this the ‘pie-decorator’ syntax, in honor of the
Pie-thon Parrot shootout which occurred around the same time as
the decorator syntax, and because the &#64; looks a little like a pie.
Guido <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-August/author.html">outlined his case</a> on Python-dev, including <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-August/046672.html">this piece</a>
on some of the (many) rejected forms.</p>
</section>
<section id="on-the-name-decorator">
<h2><a class="toc-backref" href="#on-the-name-decorator" role="doc-backlink">On the name ‘Decorator’</a></h2>
<p>There’s been a number of complaints about the choice of the name
‘decorator’ for this feature.  The major one is that the name is not
consistent with its use in the <a class="reference external" href="https://web.archive.org/web/20031204182047/http://patterndigest.com/patterns/Decorator.html">GoF book</a>.  The name ‘decorator’
probably owes more to its use in the compiler area – a syntax tree is
walked and annotated.  It’s quite possible that a better name may turn
up.</p>
</section>
<section id="design-goals">
<h2><a class="toc-backref" href="#design-goals" role="doc-backlink">Design Goals</a></h2>
<p>The new syntax should</p>
<ul class="simple">
<li>work for arbitrary wrappers, including user-defined callables and
the existing builtins <code class="docutils literal notranslate"><span class="pre">classmethod()</span></code> and <code class="docutils literal notranslate"><span class="pre">staticmethod()</span></code>.  This
requirement also means that a decorator syntax must support passing
arguments to the wrapper constructor</li>
<li>work with multiple wrappers per definition</li>
<li>make it obvious what is happening; at the very least it should be
obvious that new users can safely ignore it when writing their own
code</li>
<li>be a syntax “that … [is] easy to remember once explained”</li>
<li>not make future extensions more difficult</li>
<li>be easy to type; programs that use it are expected to use it very
frequently</li>
<li>not make it more difficult to scan through code quickly.  It should
still be easy to search for all definitions, a particular definition,
or the arguments that a function accepts</li>
<li>not needlessly complicate secondary support tools such as
language-sensitive editors and other “<a class="reference external" href="http://groups.google.com/groups?hl=en&amp;lr=&amp;ie=UTF-8&amp;oe=UTF-8&amp;selm=mailman.1010809396.32158.python-list%40python.org">toy parser tools out
there</a>”</li>
<li>allow future compilers to optimize for decorators.  With the hope of
a JIT compiler for Python coming into existence at some point this
tends to require the syntax for decorators to come before the function
definition</li>
<li>move from the end of the function, where it’s currently hidden, to
the front where it is more <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-August/047112.html">in your face</a></li>
</ul>
<p>Andrew Kuchling has links to a bunch of the discussions about
motivations and use cases <a class="reference external" href="http://www.amk.ca/diary/archives/cat_python.html#003255">in his blog</a>.  Particularly notable is <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-April/044132.html">Jim
Huginin’s list of use cases</a>.</p>
</section>
<section id="current-syntax">
<h2><a class="toc-backref" href="#current-syntax" role="doc-backlink">Current Syntax</a></h2>
<p>The current syntax for function decorators as implemented in Python
2.4a2 is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@dec2</span>
<span class="nd">@dec1</span>
<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>This is equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="n">func</span> <span class="o">=</span> <span class="n">dec2</span><span class="p">(</span><span class="n">dec1</span><span class="p">(</span><span class="n">func</span><span class="p">))</span>
</pre></div>
</div>
<p>without the intermediate assignment to the variable <code class="docutils literal notranslate"><span class="pre">func</span></code>.  The
decorators are near the function declaration.  The &#64; sign makes it clear
that something new is going on here.</p>
<p>The rationale for the <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-September/048874.html">order of application</a> (bottom to top) is that it
matches the usual order for function-application.  In mathematics,
composition of functions (g o f)(x) translates to g(f(x)).  In Python,
<code class="docutils literal notranslate"><span class="pre">&#64;g</span> <span class="pre">&#64;f</span> <span class="pre">def</span> <span class="pre">foo()</span></code> translates to <code class="docutils literal notranslate"><span class="pre">foo=g(f(foo)</span></code>.</p>
<p>The decorator statement is limited in what it can accept – arbitrary
expressions will not work.  Guido preferred this because of a <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-August/046711.html">gut
feeling</a>.</p>
<p>The current syntax also allows decorator declarations to call a
function that returns a decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@decomaker</span><span class="p">(</span><span class="n">argA</span><span class="p">,</span> <span class="n">argB</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>This is equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="o">=</span> <span class="n">decomaker</span><span class="p">(</span><span class="n">argA</span><span class="p">,</span> <span class="n">argB</span><span class="p">,</span> <span class="o">...</span><span class="p">)(</span><span class="n">func</span><span class="p">)</span>
</pre></div>
</div>
<p>The rationale for having a function that returns a decorator is that
the part after the &#64; sign can be considered to be an expression
(though syntactically restricted to just a function), and whatever
that expression returns is called.  See <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-September/048874.html">declaration arguments</a>.</p>
</section>
<section id="syntax-alternatives">
<h2><a class="toc-backref" href="#syntax-alternatives" role="doc-backlink">Syntax Alternatives</a></h2>
<p>There have been <a class="reference external" href="http://www.python.org/moin/PythonDecorators">a large number</a> of different syntaxes proposed –
rather than attempting to work through these individual syntaxes, it’s
worthwhile to break the syntax discussion down into a number of areas.
Attempting to discuss <a class="reference external" href="http://ucsu.colorado.edu/~bethard/py/decorators-output.py">each possible syntax</a> individually would be an
act of madness, and produce a completely unwieldy PEP.</p>
<section id="decorator-location">
<h3><a class="toc-backref" href="#decorator-location" role="doc-backlink">Decorator Location</a></h3>
<p>The first syntax point is the location of the decorators.  For the
following examples, we use the &#64;syntax used in 2.4a2.</p>
<p>Decorators before the def statement are the first alternative, and the
syntax used in 2.4a2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@accepts</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>
<span class="nd">@returns</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="n">low</span><span class="p">,</span><span class="n">high</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>There have been a number of objections raised to this location – the
primary one is that it’s the first real Python case where a line of code
has an effect on a following line.  The syntax available in 2.4a3
requires one decorator per line (in a2, multiple decorators could be
specified on the same line), and the final decision for 2.4 final stayed
one decorator per line.</p>
<p>People also complained that the syntax quickly got unwieldy when
multiple decorators were used.  The point was made, though, that the
chances of a large number of decorators being used on a single function
were small and thus this was not a large worry.</p>
<p>Some of the advantages of this form are that the decorators live outside
the method body – they are obviously executed at the time the function
is defined.</p>
<p>Another advantage is that a prefix to the function definition fits
the idea of knowing about a change to the semantics of the code before
the code itself, thus you know how to interpret the code’s semantics
properly without having to go back and change your initial perceptions
if the syntax did not come before the function definition.</p>
<p>Guido decided <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-March/043756.html">he preferred</a> having the decorators on the line before
the ‘def’, because it was felt that a long argument list would mean that
the decorators would be ‘hidden’</p>
<p>The second form is the decorators between the def and the function name,
or the function name and the argument list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nd">@classmethod</span> <span class="n">foo</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nd">@accepts</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">),</span><span class="nd">@returns</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="n">bar</span><span class="p">(</span><span class="n">low</span><span class="p">,</span><span class="n">high</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">foo</span> <span class="nd">@classmethod</span> <span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">bar</span> <span class="nd">@accepts</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">),</span><span class="nd">@returns</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="p">(</span><span class="n">low</span><span class="p">,</span><span class="n">high</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>There are a couple of objections to this form.  The first is that it
breaks easily ‘greppability’ of the source – you can no longer search
for ‘def foo(’ and find the definition of the function.  The second,
more serious, objection is that in the case of multiple decorators, the
syntax would be extremely unwieldy.</p>
<p>The next form, which has had a number of strong proponents, is to have
the decorators between the argument list and the trailing <code class="docutils literal notranslate"><span class="pre">:</span></code> in the
‘def’ line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">)</span> <span class="nd">@classmethod</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="n">low</span><span class="p">,</span><span class="n">high</span><span class="p">)</span> <span class="nd">@accepts</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">),</span><span class="nd">@returns</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Guido <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-August/047112.html">summarized the arguments</a> against this form (many of which also
apply to the previous form) as:</p>
<ul class="simple">
<li>it hides crucial information (e.g. that it is a static method)
after the signature, where it is easily missed</li>
<li>it’s easy to miss the transition between a long argument list and a
long decorator list</li>
<li>it’s cumbersome to cut and paste a decorator list for reuse, because
it starts and ends in the middle of a line</li>
</ul>
<p>The next form is that the decorator syntax goes inside the method body at
the start, in the same place that docstrings currently live:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="n">low</span><span class="p">,</span><span class="n">high</span><span class="p">):</span>
    <span class="nd">@accepts</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>
    <span class="nd">@returns</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>The primary objection to this form is that it requires “peeking inside”
the method body to determine the decorators.  In addition, even though
the code is inside the method body, it is not executed when the method
is run.  Guido felt that docstrings were not a good counter-example, and
that it was quite possible that a ‘docstring’ decorator could help move
the docstring to outside the function body.</p>
<p>The final form is a new block that encloses the method’s code.  For this
example, we’ll use a ‘decorate’ keyword, as it makes no sense with the
&#64;syntax.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">decorate</span><span class="p">:</span>
    <span class="nb">classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="n">decorate</span><span class="p">:</span>
    <span class="n">accepts</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">returns</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="n">low</span><span class="p">,</span><span class="n">high</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>This form would result in inconsistent indentation for decorated and
undecorated methods.  In addition, a decorated method’s body would start
three indent levels in.</p>
</section>
<section id="syntax-forms">
<h3><a class="toc-backref" href="#syntax-forms" role="doc-backlink">Syntax forms</a></h3>
<ul>
<li><code class="docutils literal notranslate"><span class="pre">&#64;decorator</span></code>:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@accepts</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>
<span class="nd">@returns</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="n">low</span><span class="p">,</span><span class="n">high</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>The major objections against this syntax are that the &#64; symbol is
not currently used in Python (and is used in both IPython and Leo),
and that the &#64; symbol is not meaningful. Another objection is that
this “wastes” a currently unused character (from a limited set) on
something that is not perceived as a major use.</p>
</li>
<li><code class="docutils literal notranslate"><span class="pre">|decorator</span></code>:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span><span class="nb">classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="o">|</span><span class="n">accepts</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>
<span class="o">|</span><span class="n">returns</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="n">low</span><span class="p">,</span><span class="n">high</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>This is a variant on the &#64;decorator syntax – it has the advantage
that it does not break IPython and Leo.  Its major disadvantage
compared to the &#64;syntax is that the | symbol looks like both a capital
I and a lowercase l.</p>
</li>
<li>list syntax:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nb">classmethod</span><span class="p">]</span>
<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="p">[</span><span class="n">accepts</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">),</span> <span class="n">returns</span><span class="p">(</span><span class="nb">float</span><span class="p">)]</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="n">low</span><span class="p">,</span><span class="n">high</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>The major objection to the list syntax is that it’s currently
meaningful (when used in the form before the method).  It’s also
lacking any indication that the expression is a decorator.</p>
</li>
<li>list syntax using other brackets (<code class="docutils literal notranslate"><span class="pre">&lt;...&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">[[...]]</span></code>, …):<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">classmethod</span><span class="o">&gt;</span>
<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="o">&lt;</span><span class="n">accepts</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">),</span> <span class="n">returns</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">&gt;</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="n">low</span><span class="p">,</span><span class="n">high</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>None of these alternatives gained much traction. The alternatives
which involve square brackets only serve to make it obvious that the
decorator construct is not a list. They do nothing to make parsing any
easier. The ‘&lt;…&gt;’ alternative presents parsing problems because ‘&lt;’
and ‘&gt;’ already parse as un-paired. They present a further parsing
ambiguity because a right angle bracket might be a greater than symbol
instead of a closer for the decorators.</p>
</li>
<li><code class="docutils literal notranslate"><span class="pre">decorate()</span></code><p>The <code class="docutils literal notranslate"><span class="pre">decorate()</span></code> proposal was that no new syntax be implemented
– instead a magic function that used introspection to manipulate
the following function.  Both Jp Calderone and Philip Eby produced
implementations of functions that did this.  Guido was pretty firmly
against this – with no new syntax, the magicness of a function like
this is extremely high:</p>
<blockquote>
<div>Using functions with “action-at-a-distance” through sys.settraceback
may be okay for an obscure feature that can’t be had any other
way yet doesn’t merit changes to the language, but that’s not
the situation for decorators.  The widely held view here is that
decorators need to be added as a syntactic feature to avoid the
problems with the postfix notation used in 2.2 and 2.3.  Decorators
are slated to be an important new language feature and their
design needs to be forward-looking, not constrained by what can be
implemented in 2.3.</div></blockquote>
</li>
<li><span class="target" id="new-keyword-and-block">new keyword (and block)</span><p>This idea was the consensus alternate from comp.lang.python (more
on this in <a class="reference internal" href="#community-consensus">Community Consensus</a> below.)  Robert Brewer wrote up a
detailed <a class="reference external" href="http://www.aminus.org/rbre/python/pydec.html">J2 proposal</a> document outlining the arguments in favor of
this form.  The initial issues with this form are:</p>
<ul class="simple">
<li>It requires a new keyword, and therefore a <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span>
<span class="pre">import</span> <span class="pre">decorators</span></code> statement.</li>
<li>The choice of keyword is contentious.  However <code class="docutils literal notranslate"><span class="pre">using</span></code> emerged
as the consensus choice, and is used in the proposal and
implementation.</li>
<li>The keyword/block form produces something that looks like a normal
code block, but isn’t.  Attempts to use statements in this block
will cause a syntax error, which may confuse users.</li>
</ul>
<p>A few days later, Guido <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-September/048518.html">rejected the proposal</a> on two main grounds,
firstly:</p>
<blockquote>
<div>… the syntactic form of an indented block strongly
suggests that its contents should be a sequence of statements, but
in fact it is not – only expressions are allowed, and there is an
implicit “collecting” of these expressions going on until they can
be applied to the subsequent function definition. …</div></blockquote>
<p>and secondly:</p>
<blockquote>
<div>… the keyword starting the line that heads a block
draws a lot of attention to it. This is true for “if”, “while”,
“for”, “try”, “def” and “class”. But the “using” keyword (or any
other keyword in its place) doesn’t deserve that attention; the
emphasis should be on the decorator or decorators inside the suite,
since those are the important modifiers to the function definition
that follows. …</div></blockquote>
<p>Readers are invited to read <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-September/048518.html">the full response</a>.</p>
</li>
<li>Other forms<p>There are plenty of other variants and proposals on <a class="reference external" href="https://wiki.python.org/moin/PythonDecoratorProposals">the wiki page</a>.</p>
</li>
</ul>
</section>
<section id="why">
<h3><a class="toc-backref" href="#why" role="doc-backlink">Why &#64;?</a></h3>
<p>There is some history in Java using &#64; initially as a marker in <a class="reference external" href="http://java.sun.com/j2se/javadoc/writingdoccomments/">Javadoc
comments</a> and later in Java 1.5 for <a class="reference external" href="http://java.sun.com/j2se/1.5.0/docs/guide/language/annotations.html">annotations</a>, which are similar
to Python decorators.  The fact that &#64; was previously unused as a token
in Python also means it’s clear there is no possibility of such code
being parsed by an earlier version of Python, leading to possibly subtle
semantic bugs.  It also means that ambiguity of what is a decorator
and what isn’t is removed.  That said, &#64; is still a fairly arbitrary
choice.  Some have suggested using | instead.</p>
<p>For syntax options which use a list-like syntax (no matter where it
appears) to specify the decorators a few alternatives were proposed:
<code class="docutils literal notranslate"><span class="pre">[|...|]</span></code>, <code class="docutils literal notranslate"><span class="pre">*[...]*</span></code>, and <code class="docutils literal notranslate"><span class="pre">&lt;...&gt;</span></code>.</p>
</section>
</section>
<section id="current-implementation-history">
<h2><a class="toc-backref" href="#current-implementation-history" role="doc-backlink">Current Implementation, History</a></h2>
<p>Guido asked for a volunteer to implement his preferred syntax, and Mark
Russell stepped up and posted a <a class="reference external" href="https://bugs.python.org/issue979728">patch</a> to SF.  This new syntax was
available in 2.4a2.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@dec2</span>
<span class="nd">@dec1</span>
<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>This is equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="n">func</span> <span class="o">=</span> <span class="n">dec2</span><span class="p">(</span><span class="n">dec1</span><span class="p">(</span><span class="n">func</span><span class="p">))</span>
</pre></div>
</div>
<p>though without the intermediate creation of a variable named <code class="docutils literal notranslate"><span class="pre">func</span></code>.</p>
<p>The version implemented in 2.4a2 allowed multiple <code class="docutils literal notranslate"><span class="pre">&#64;decorator</span></code> clauses
on a single line. In 2.4a3, this was tightened up to only allowing one
decorator per line.</p>
<p>A <a class="reference external" href="http://starship.python.net/crew/mwh/hacks/meth-syntax-sugar-3.diff">previous patch</a> from Michael Hudson which implements the
list-after-def syntax is also still kicking around.</p>
<p>After 2.4a2 was released, in response to community reaction, Guido
stated that he’d re-examine a community proposal, if the community
could come up with a community consensus, a decent proposal, and an
implementation.  After an amazing number of posts, collecting a vast
number of alternatives in the <a class="reference external" href="http://wiki.python.org/moin/PythonDecorators">Python wiki</a>, a community consensus
emerged (below).  Guido <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-September/048518.html">subsequently rejected</a> this alternate form,
but added:</p>
<blockquote>
<div>In Python 2.4a3 (to be released this Thursday), everything remains
as currently in CVS.  For 2.4b1, I will consider a change of &#64; to
some other single character, even though I think that &#64; has the
advantage of being the same character used by a similar feature
in Java.  It’s been argued that it’s not quite the same, since &#64;
in Java is used for attributes that don’t change semantics.  But
Python’s dynamic nature makes that its syntactic elements never mean
quite the same thing as similar constructs in other languages, and
there is definitely significant overlap.  Regarding the impact on
3rd party tools: IPython’s author doesn’t think there’s going to be
much impact; Leo’s author has said that Leo will survive (although
it will cause him and his users some transitional pain).  I actually
expect that picking a character that’s already used elsewhere in
Python’s syntax might be harder for external tools to adapt to,
since parsing will have to be more subtle in that case.  But I’m
frankly undecided, so there’s some wiggle room here.  I don’t want
to consider further syntactic alternatives at this point: the buck
has to stop at some point, everyone has had their say, and the show
must go on.</div></blockquote>
<section id="community-consensus">
<h3><a class="toc-backref" href="#community-consensus" role="doc-backlink">Community Consensus</a></h3>
<p>This section documents the rejected J2 syntax, and is included for
historical completeness.</p>
<p>The consensus that emerged on comp.lang.python was the proposed J2
syntax (the “J2” was how it was referenced on the PythonDecorators wiki
page): the new keyword <code class="docutils literal notranslate"><span class="pre">using</span></code> prefixing a block of decorators before
the <code class="docutils literal notranslate"><span class="pre">def</span></code> statement.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">using</span><span class="p">:</span>
    <span class="nb">classmethod</span>
    <span class="n">synchronized</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>The main arguments for this syntax fall under the “readability counts”
doctrine.  In brief, they are:</p>
<ul class="simple">
<li>A suite is better than multiple &#64;lines.  The <code class="docutils literal notranslate"><span class="pre">using</span></code> keyword and
block transforms the single-block <code class="docutils literal notranslate"><span class="pre">def</span></code> statement into a
multiple-block compound construct, akin to try/finally and others.</li>
<li>A keyword is better than punctuation for a new token.  A keyword
matches the existing use of tokens.  No new token category is
necessary.  A keyword distinguishes Python decorators from Java
annotations and .Net attributes, which are significantly different
beasts.</li>
</ul>
<p>Robert Brewer wrote a <a class="reference external" href="http://www.aminus.org/rbre/python/pydec.html">detailed proposal</a> for this form, and Michael
Sparks produced <a class="reference external" href="https://bugs.python.org/issue1013835">a patch</a>.</p>
<p>As noted previously, Guido rejected this form, outlining his problems
with it in <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-September/048518.html">a message</a> to python-dev and comp.lang.python.</p>
</section>
</section>
<section id="examples">
<h2><a class="toc-backref" href="#examples" role="doc-backlink">Examples</a></h2>
<p>Much of the discussion on <code class="docutils literal notranslate"><span class="pre">comp.lang.python</span></code> and the <code class="docutils literal notranslate"><span class="pre">python-dev</span></code>
mailing list focuses on the use of decorators as a cleaner way to use
the <code class="docutils literal notranslate"><span class="pre">staticmethod()</span></code> and <code class="docutils literal notranslate"><span class="pre">classmethod()</span></code> builtins.  This capability
is much more powerful than that.  This section presents some examples of
use.</p>
<ol class="arabic">
<li>Define a function to be executed at exit.  Note that the function
isn’t actually “wrapped” in the usual sense.<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">onexit</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">atexit</span>
    <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span>

<span class="nd">@onexit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Note that this example is probably not suitable for real usage, but
is for example purposes only.</p>
</li>
<li>Define a class with a singleton instance.  Note that once the class
disappears enterprising programmers would have to be more creative to
create more instances.  (From Shane Hathaway on <code class="docutils literal notranslate"><span class="pre">python-dev</span></code>.)<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">singleton</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="n">instances</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">getinstance</span><span class="p">():</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
            <span class="n">instances</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">instances</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">getinstance</span>

<span class="nd">@singleton</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
<li>Add attributes to a function.  (Based on an example posted by
Anders Munch on <code class="docutils literal notranslate"><span class="pre">python-dev</span></code>.)<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">attrs</span><span class="p">(</span><span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">decorate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">kwds</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">return</span> <span class="n">decorate</span>

<span class="nd">@attrs</span><span class="p">(</span><span class="n">versionadded</span><span class="o">=</span><span class="s2">&quot;2.2&quot;</span><span class="p">,</span>
       <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Guido van Rossum&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mymethod</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
<li>Enforce function argument and return types.  Note that this
copies the func_name attribute from the old to the new function.
func_name was made writable in Python 2.4a3:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">accepts</span><span class="p">(</span><span class="o">*</span><span class="n">types</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_accepts</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">==</span> <span class="n">f</span><span class="o">.</span><span class="n">func_code</span><span class="o">.</span><span class="n">co_argcount</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">new_f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> \
                       <span class="s2">&quot;arg </span><span class="si">%r</span><span class="s2"> does not match </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="n">new_f</span><span class="o">.</span><span class="n">func_name</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">func_name</span>
        <span class="k">return</span> <span class="n">new_f</span>
    <span class="k">return</span> <span class="n">check_accepts</span>

<span class="k">def</span><span class="w"> </span><span class="nf">returns</span><span class="p">(</span><span class="n">rtype</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_returns</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">new_f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">rtype</span><span class="p">),</span> \
                   <span class="s2">&quot;return value </span><span class="si">%r</span><span class="s2"> does not match </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">rtype</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="n">new_f</span><span class="o">.</span><span class="n">func_name</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">func_name</span>
        <span class="k">return</span> <span class="n">new_f</span>
    <span class="k">return</span> <span class="n">check_returns</span>

<span class="nd">@accepts</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span>
<span class="nd">@returns</span><span class="p">((</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">arg1</span> <span class="o">*</span> <span class="n">arg2</span>
</pre></div>
</div>
</li>
<li>Declare that a class implements a particular (set of) interface(s).
This is from a posting by Bob Ippolito on <code class="docutils literal notranslate"><span class="pre">python-dev</span></code> based on
experience with <a class="reference external" href="http://peak.telecommunity.com/PyProtocols.html">PyProtocols</a>.<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">provides</span><span class="p">(</span><span class="o">*</span><span class="n">interfaces</span><span class="p">):</span>
<span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     An actual, working, implementation of provides for</span>
<span class="sd">     the current implementation of PyProtocols.  Not</span>
<span class="sd">     particularly important for the PEP text.</span>
<span class="sd">     &quot;&quot;&quot;</span>
     <span class="k">def</span><span class="w"> </span><span class="nf">provides</span><span class="p">(</span><span class="n">typ</span><span class="p">):</span>
         <span class="n">declareImplementation</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">instancesProvide</span><span class="o">=</span><span class="n">interfaces</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">typ</span>
     <span class="k">return</span> <span class="n">provides</span>

<span class="k">class</span><span class="w"> </span><span class="nc">IBar</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="w">     </span><span class="sd">&quot;&quot;&quot;Declare something about IBar here&quot;&quot;&quot;</span>

<span class="nd">@provides</span><span class="p">(</span><span class="n">IBar</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement something here...&quot;&quot;&quot;</span>
</pre></div>
</div>
</li>
</ol>
<p>Of course, all these examples are possible today, though without
syntactic support.</p>
</section>
<section id="no-longer-open-issues">
<h2><a class="toc-backref" href="#no-longer-open-issues" role="doc-backlink">(No longer) Open Issues</a></h2>
<ol class="arabic">
<li>It’s not yet certain that class decorators will be incorporated
into the language at a future point.  Guido expressed skepticism about
the concept, but various people have made some <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2004-March/thread.html">strong arguments</a>
(search for <code class="docutils literal notranslate"><span class="pre">PEP</span> <span class="pre">318</span> <span class="pre">--</span> <span class="pre">posting</span> <span class="pre">draft</span></code>) on their behalf in
<code class="docutils literal notranslate"><span class="pre">python-dev</span></code>.  It’s exceedingly unlikely that class decorators
will be in Python 2.4.<p><a class="pep reference internal" href="../pep-3129/" title="PEP 3129 – Class Decorators">PEP 3129</a> proposes to add class decorators as of Python 2.6.</p>
</li>
<li>The choice of the <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> character will be re-examined before
Python 2.4b1.<p>In the end, the <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> character was kept.</p>
</li>
</ol>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document has been placed in the public domain.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/peps/pep-0318.rst">https://github.com/python/peps/blob/main/peps/pep-0318.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/peps/pep-0318.rst">2025-02-01 08:59:27 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#warningwarningwarning">WarningWarningWarning</a></li>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a><ul>
<li><a class="reference internal" href="#why-is-this-so-hard">Why Is This So Hard?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#on-the-name-decorator">On the name ‘Decorator’</a></li>
<li><a class="reference internal" href="#design-goals">Design Goals</a></li>
<li><a class="reference internal" href="#current-syntax">Current Syntax</a></li>
<li><a class="reference internal" href="#syntax-alternatives">Syntax Alternatives</a><ul>
<li><a class="reference internal" href="#decorator-location">Decorator Location</a></li>
<li><a class="reference internal" href="#syntax-forms">Syntax forms</a></li>
<li><a class="reference internal" href="#why">Why &#64;?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#current-implementation-history">Current Implementation, History</a><ul>
<li><a class="reference internal" href="#community-consensus">Community Consensus</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#no-longer-open-issues">(No longer) Open Issues</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/peps/pep-0318.rst?plain=1">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
    <script src="../_static/sticky_banner.js"></script>
    <script src="https://analytics.python.org/js/script.outbound-links.js"
            data-domain="peps.python.org" defer></script>
</body>
</html>