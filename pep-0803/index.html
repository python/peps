
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 803 – “abi3t”: Stable ABI for Free-Threaded Builds | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0803/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://peps.python.org/peps.rss">
    <meta property="og:title" content='PEP 803 – “abi3t”: Stable ABI for Free-Threaded Builds | peps.python.org'>
    <meta property="og:description" content="Add a new variant of the Stable ABI, called “Stable ABI for Free-Threaded Python” (or abi3t for short), and a corresponding API limitations.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://peps.python.org/pep-0803/">
    <meta property="og:site_name" content="Python Enhancement Proposals (PEPs)">
    <meta property="og:image" content="https://peps.python.org/_static/og-image.png">
    <meta property="og:image:alt" content="Python PEPs">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta name="description" content="Add a new variant of the Stable ABI, called “Stable ABI for Free-Threaded Python” (or abi3t for short), and a corresponding API limitations.">
    <meta name="theme-color" content="#3776ab">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1 data-pagefind-ignore>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 803</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        
        <div id="mobile-search" class="mobile-search-container"></div>
        
        <article data-pagefind-body>
            
            <span data-pagefind-meta="title:PEP 803 – “abi3t”: Stable ABI for Free-Threaded Builds" data-pagefind-weight="10" class="visually-hidden">PEP 803 – “abi3t”: Stable ABI for Free-Threaded Builds</span>
            <section id="pep-content">
<h1 class="page-title">PEP 803 – “abi3t”: Stable ABI for Free-Threaded Builds</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Petr Viktorin &lt;encukou&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-even">Discussions-To<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="https://discuss.python.org/t/106181">Discourse thread</a></dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><abbr title="Proposal under active discussion and revision">Draft</abbr></dd>
<dt class="field-even">Type<span class="colon">:</span></dt>
<dd class="field-even"><abbr title="Normative PEP with a new feature for Python, implementation change for CPython or interoperability standard for the ecosystem">Standards Track</abbr></dd>
<dt class="field-odd">Requires<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="../pep-0703/">703</a>, <a class="reference external" href="../pep-0793/">793</a>, <a class="reference external" href="../pep-0697/">697</a></dd>
<dt class="field-even">Created<span class="colon">:</span></dt>
<dd class="field-even">19-Aug-2025</dd>
<dt class="field-odd">Python-Version<span class="colon">:</span></dt>
<dd class="field-odd">3.15</dd>
<dt class="field-even">Post-History<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="https://discuss.python.org/t/103628" title="Discourse thread">08-Sep-2025</a>,
<a class="reference external" href="https://discuss.python.org/t/104976" title="Discourse thread">20-Nov-2025</a>,
<a class="reference external" href="https://discuss.python.org/t/106181" title="Discourse thread">16-Feb-2026</a></dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#terminology">Terminology</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rationale">Rationale</a><ul>
<li><a class="reference internal" href="#tag-name">Tag name</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#stable-abi-for-free-threaded-builds">Stable ABI for free-threaded builds</a></li>
<li><a class="reference internal" href="#choosing-the-target-abi">Choosing the target ABI</a></li>
<li><a class="reference internal" href="#opaque-pyobject">Opaque PyObject</a><ul>
<li><a class="reference internal" href="#implications">Implications</a></li>
</ul>
</li>
<li><a class="reference internal" href="#runtime-abi-checks">Runtime ABI checks</a><ul>
<li><a class="reference internal" href="#check-for-non-free-threaded-abi-in-free-threading-builds">Check for non-free-threaded ABI in free-threading builds</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-abi3t-wheel-tag">The <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> wheel tag</a><ul>
<li><a class="reference internal" href="#recommendations-for-installers">Recommendations for installers</a></li>
<li><a class="reference internal" href="#recommendations-for-build-tools">Recommendations for build tools</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-api">New API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-and-forwards-compatibility">Backwards and Forwards Compatibility</a><ul>
<li><a class="reference internal" href="#compatibility-overview">Compatibility Overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#make-pyobject-opaque-in-limited-api-3-15">Make <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> opaque in Limited API 3.15</a></li>
<li><a class="reference internal" href="#shims-for-compatibility-with-cpython-3-14">Shims for compatibility with CPython 3.14</a></li>
<li><a class="reference internal" href="#naming-this-abi4">Naming this <code class="docutils literal notranslate"><span class="pre">abi4</span></code></a></li>
<li><a class="reference internal" href="#reusing-py-gil-disabled-to-enable-the-new-abi">Reusing <code class="docutils literal notranslate"><span class="pre">Py_GIL_DISABLED</span></code> to enable the new ABI</a></li>
<li><a class="reference internal" href="#making-the-new-version-of-abi3-compatible-with-free-threading">Making the new version of <code class="docutils literal notranslate"><span class="pre">abi3</span></code> compatible with free-threading</a></li>
</ul>
</li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p>Add a new variant of the Stable ABI, called “Stable ABI for Free-Threaded
Python” (or <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> for short), and a corresponding API limitations.</p>
<p><code class="docutils literal notranslate"><span class="pre">abi3t</span></code> will be based on the existing Stable ABI (<code class="docutils literal notranslate"><span class="pre">abi3</span></code>), but make the
<a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.PyObject" title="(in Python v3.14)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyObject</span></code></a> structure opaque.
This will require users to migrate to new API for common tasks like defining
modules and most classes.</p>
<p>At least initially, extensions built for <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> will be compatible with
the existing Stable ABI (<code class="docutils literal notranslate"><span class="pre">abi3</span></code>).</p>
</section>
<section id="terminology">
<h2><a class="toc-backref" href="#terminology" role="doc-backlink">Terminology</a></h2>
<p>This PEP uses “GIL-enabled build” as an antonym to “free-threaded build”,
that is, an interpreter or extension built without <code class="docutils literal notranslate"><span class="pre">Py_GIL_DISABLED</span></code>.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation" role="doc-backlink">Motivation</a></h2>
<p>The Stable ABI is currently not available for free-threaded builds.
Extensions will fail to build for a both Limited API and
free-threaded Python (that is, when both <a class="reference external" href="https://docs.python.org/3/c-api/stable.html#c.Py_LIMITED_API" title="(in Python v3.14)"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code></a> and
<a class="reference external" href="https://docs.python.org/3.15/using/configure.html#c.Py_GIL_DISABLED" title="(in Python v3.15)"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_GIL_DISABLED</span></code></a> preprocessor macros are defined).
Extensions built for GIL-enabled builds of CPython will fail to load
(or crash) on free-threaded builds.</p>
<p>In its <a class="reference external" href="https://discuss.python.org/t/84319/123">acceptance post</a>
for <a class="pep reference internal" href="../pep-0779/" title="PEP 779 – Criteria for supported status for free-threaded Python">PEP 779</a>, the Steering Council stated that it “expects that Stable ABI
for free-threading should be prepared and defined for Python 3.15”.</p>
<p>This PEP proposes the Stable ABI for free-threading.</p>
<section id="background">
<h3><a class="toc-backref" href="#background" role="doc-backlink">Background</a></h3>
<p>Python’s Stable ABI (<code class="docutils literal notranslate"><span class="pre">abi3</span></code> for short), as defined in <a class="pep reference internal" href="../pep-0384/" title="PEP 384 – Defining a Stable ABI">PEP 384</a> and
<a class="pep reference internal" href="../pep-0652/" title="PEP 652 – Maintaining the Stable ABI">PEP 652</a>, provides a way to compile extension modules that can be loaded
on multiple minor versions of the CPython interpreter.
Several projects use this to limit the number of
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/binary-distribution-format/#binary-distribution-format" title="(in Python Packaging User Guide)"><span class="xref std std-ref">wheels</span></a> (binary artefacts)
that need to be built and distributed for each release, and/or to make it
easier to test with pre-release versions of Python.</p>
<p>With free-threading builds (<a class="pep reference internal" href="../pep-0703/" title="PEP 703 – Making the Global Interpreter Lock Optional in CPython">PEP 703</a>) being on track to eventually become
the default (<a class="pep reference internal" href="../pep-0779/" title="PEP 779 – Criteria for supported status for free-threaded Python">PEP 779</a>), we need a way to make a Stable ABI available
to those builds.</p>
<p>To build against a Stable ABI, the extension must use a <em>Limited API</em>,
that is, only a subset of the functions, structures, etc. that CPython
exposes.
Both the Limited API and the current Stable ABI are versioned, and building
against Stable ABI 3.X requires using only Limited API 3.X, and yields an
extension that is ABI-compatible with CPython 3.X and <em>any</em> later version
(though bugs in CPython sometimes cause incompatibilities in practice).</p>
<p>The Limited API is not “stable”: newer versions may remove API that
were a part of older versions.</p>
<p>This PEP proposes additional API limitations, as required to be compatible
with both GIL-enabled and free-threaded builds of CPython.</p>
</section>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale" role="doc-backlink">Rationale</a></h2>
<p>The design in this PEP uses several constraints:</p>
<dl>
<dt>Separate ABI</dt><dd>The new ABI (<code class="docutils literal notranslate"><span class="pre">abi3t</span></code>) will conceptually be treated as separate from the
existing Stable ABI (<code class="docutils literal notranslate"><span class="pre">abi3</span></code>).<p>However, it will be possible to compile a single extension module that
supports both free-threaded and GIL-enabled builds.
This should involve no additional limitations, at least in the initial
implementation, and so it will be preferred over building
<code class="docutils literal notranslate"><span class="pre">abi3t</span></code>-only extensions.</p>
</dd>
<dt>No backwards compatibility now</dt><dd>The new stable ABI variant will not support CPython 3.14 and below.
Projects that need this support can build separate extensions specifically
for the 3.14 free-threaded interpreter, and for older stable ABI versions.<p>However, we won’t block the possibility of extending compatibility to
CPython 3.14 and below, and we recommend that package installation tools
prepare for such extensions.
See a <a class="reference internal" href="#pep803-no-shim"><span class="std std-ref">rejected idea</span></a> for how this could work.</p>
</dd>
<dt>API changes are OK</dt><dd>The new Limited API variant may require extension authors to make
significant changes to their code.
Projects that cannot do this (yet) can continue using the existing Limited
API, and compile separately for GIL-enabled builds
and for specific versions of free-threaded builds.</dd>
</dl>
<section id="tag-name">
<h3><a class="toc-backref" href="#tag-name" role="doc-backlink">Tag name</a></h3>
<p>The tag <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> is chosen to reflect the fact that this ABI is similar to
<code class="docutils literal notranslate"><span class="pre">abi3</span></code>, with minimal changes necessary to support free-threading (which
uses the letter <code class="docutils literal notranslate"><span class="pre">t</span></code> in existing, version-specific ABI tags like <code class="docutils literal notranslate"><span class="pre">cp314t</span></code>).</p>
</section>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification" role="doc-backlink">Specification</a></h2>
<section id="stable-abi-for-free-threaded-builds">
<h3><a class="toc-backref" href="#stable-abi-for-free-threaded-builds" role="doc-backlink">Stable ABI for free-threaded builds</a></h3>
<p>Python will introduce a new stable ABI, called <em>stable ABI for free-threading
builds</em>, or <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> for short.
As with the current Stable ABI (<code class="docutils literal notranslate"><span class="pre">abi3</span></code>), <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> will be versioned
using major (3) and minor versions of Python interpreter.
Extensions built for <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> <code class="samp docutils literal notranslate"><span class="pre">3.</span><em><span class="pre">x</span></em></code> will be compatible with
CPython <code class="samp docutils literal notranslate"><span class="pre">3.</span><em><span class="pre">x</span></em></code> and above.</p>
<p>To build a C/C++ extension for <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>, the extension will need to only
use <em>limited API for free-threaded builds</em>.
Like the existing Limited API, this will be a subset of the general CPython
C API.
Initially, it will also be a subset of the Limited API.
We will strive to keep it as a subset, but will not guarantee this.</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> and <code class="docutils literal notranslate"><span class="pre">abi3</span></code> will overlap, it will be possible for a single
compiled extension to support both at once, and thus be compatible with
CPython 3.15+ (both free-threaded and GIL-eanbled builds).
Initially, any extension compiled for <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> will be compatible with
<code class="docutils literal notranslate"><span class="pre">abi3</span></code> as well.</p>
</section>
<section id="choosing-the-target-abi">
<h3><a class="toc-backref" href="#choosing-the-target-abi" role="doc-backlink">Choosing the target ABI</a></h3>
<p>Users of the C API – or build tools acting on their behalf, configured by
tool-specific UI – will select the target ABI using the following macros:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API=&lt;version&gt;</span></code> (existing):
Compile for <code class="docutils literal notranslate"><span class="pre">abi3</span></code> of the given version.</li>
<li><code class="docutils literal notranslate"><span class="pre">Py_TARGET_ABI3T=&lt;version&gt;</span></code> (proposed here):
Compile for <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> of the given version.</li>
</ul>
<p>These two macros are functionally very similar.
In hindsight, <code class="docutils literal notranslate"><span class="pre">Py_TARGET_ABI3</span></code> (without the <code class="docutils literal notranslate"><span class="pre">T</span></code>) would be a more fitting
name for <a class="reference external" href="https://docs.python.org/3/c-api/stable.html#c.Py_LIMITED_API" title="(in Python v3.14)"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code></a>.
We keep the existing name for backwards compatibility.</p>
<p>For ease of use and implementation simplicity, respectively, <code class="docutils literal notranslate"><span class="pre">Python.h</span></code> will
set the configuration macros automatically in the following situations:</p>
<ul class="simple">
<li>If <code class="samp docutils literal notranslate"><span class="pre">Py_LIMITED_API=</span><em><span class="pre">v</span></em></code> and <code class="docutils literal notranslate"><span class="pre">Py_GIL_DISABLED</span></code> is set, then
<code class="docutils literal notranslate"><span class="pre">Py_TARGET_ABI3T</span></code> will be defined as <code class="samp docutils literal notranslate"><em><span class="pre">v</span></em></code> by default.
(This allows choosing <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> by defining the pre-existing macro and
compiling with free-threaded CPython headers. Note that in CPython 3.14,
this case results in a compile-time error.)</li>
<li>If <code class="samp docutils literal notranslate"><span class="pre">Py_TARGET_ABI3T=</span><em><span class="pre">v</span></em></code> is set, CPython <em>may</em> define or redefine
<code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code> as <code class="samp docutils literal notranslate"><em><span class="pre">v</span></em></code>.
(This means that CPython can continue to use the <code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code> macro
internally to select which APIs are available.)</li>
</ul>
</section>
<section id="opaque-pyobject">
<h3><a class="toc-backref" href="#opaque-pyobject" role="doc-backlink">Opaque PyObject</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">abi3t</span></code> will initially have a single diffenerce from <code class="docutils literal notranslate"><span class="pre">abi3</span></code>: the
<code class="docutils literal notranslate"><span class="pre">PyObject</span></code> structure and APIs that depend on it are not part of <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>.</p>
<p>Specifically, when building for <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>, the CPython headers will:</p>
<ul class="simple">
<li>make the following structures <em>opaque</em> (or in C terminology, <em>incomplete
types</em>):<ul>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.PyObject" title="(in Python v3.14)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyObject</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.PyVarObject" title="(in Python v3.14)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyVarObject</span></code></a></li>
<li><code class="xref c c-type docutils literal notranslate"><span class="pre">PyModuleDef_Base</span></code></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/module.html#c.PyModuleDef" title="(in Python v3.14)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyModuleDef</span></code></a></li>
</ul>
</li>
<li>no longer include the following macros:<ul>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.PyObject_HEAD" title="(in Python v3.14)"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyObject_HEAD</span></code></a></li>
<li><code class="xref c c-macro docutils literal notranslate"><span class="pre">_PyObject_EXTRA_INIT</span></code></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.PyObject_HEAD_INIT" title="(in Python v3.14)"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyObject_HEAD_INIT</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.PyObject_VAR_HEAD" title="(in Python v3.14)"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyObject_VAR_HEAD</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.Py_SET_TYPE" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_SET_TYPE()</span></code></a></li>
</ul>
</li>
</ul>
<p>In both the regular stable ABI (<code class="docutils literal notranslate"><span class="pre">abit3</span></code> 3.15+) and the new
<code class="docutils literal notranslate"><span class="pre">abi3t</span></code>, the following will be exported functions (exposed in the ABI)
rather than macros:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.Py_SIZE" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_SIZE()</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.Py_SET_SIZE" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_SET_SIZE()</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.Py_IS_TYPE" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_IS_TYPE()</span></code></a></li>
</ul>
<section id="implications">
<h4><a class="toc-backref" href="#implications" role="doc-backlink">Implications</a></h4>
<p>Making the <code class="docutils literal notranslate"><span class="pre">PyObject</span></code>, <code class="docutils literal notranslate"><span class="pre">PyVarObject</span></code> and <code class="docutils literal notranslate"><span class="pre">PyModuleDef</span></code> structures
opaque means:</p>
<ul>
<li>Their fields may not be directly accessed.<p>For example, instead of <code class="docutils literal notranslate"><span class="pre">o-&gt;ob_type</span></code>, extensions must use
<code class="docutils literal notranslate"><span class="pre">Py_TYPE(o)</span></code>.
This usage has been the preferred practice for some time.</p>
</li>
<li>Their size and alignment will not be available.
Expressions such as <code class="docutils literal notranslate"><span class="pre">sizeof(PyObject)</span></code> will no longer work.</li>
<li>They cannot be embedded in other structures.
This mainly affects instance structs of extension-defined types,
which will need to be defined using API added in <a class="pep reference internal" href="../pep-0697/" title="PEP 697 – Limited C API for Extending Opaque Types">PEP 697</a> – that is,
using a <code class="docutils literal notranslate"><span class="pre">struct</span></code> <em>without</em> <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> (or other base class struct) at
the beginning, with <a class="reference external" href="https://docs.python.org/3/c-api/object.html#c.PyObject_GetTypeData" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GetTypeData()</span></code></a> calls needed to access
the memory.</li>
<li>Variables of these types cannot be created.
This mainly affects static <code class="docutils literal notranslate"><span class="pre">PyModuleDef</span></code> variables needed to define
extension modules.
Virtually all extensions will need to switch the new export hook
added in <a class="pep reference internal" href="../pep-0793/" title="PEP 793 – PyModExport: A new entry point for C extension modules">PEP 793</a> (<a class="reference external" href="https://docs.python.org/3.15/c-api/extension-modules.html#c.PyModExport_modulename" title="(in Python v3.15)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModExport_modulename()</span></code></a>) to support <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>.</li>
</ul>
<p>The following functions will become practically unusable in <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>,
since an extension cannot create valid, statically allocated, input
for them.
They will, however, not be removed.</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/c-api/extension-modules.html#c.PyModuleDef_Init" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModuleDef_Init()</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/module.html#c.PyModule_Create" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_Create()</span></code></a>, <a class="reference external" href="https://docs.python.org/3/c-api/module.html#c.PyModule_Create2" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_Create2()</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/module.html#c.PyModule_FromDefAndSpec" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_FromDefAndSpec()</span></code></a>, <a class="reference external" href="https://docs.python.org/3/c-api/module.html#c.PyModule_FromDefAndSpec2" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_FromDefAndSpec2()</span></code></a></li>
</ul>
</section>
</section>
<section id="runtime-abi-checks">
<h3><a class="toc-backref" href="#runtime-abi-checks" role="doc-backlink">Runtime ABI checks</a></h3>
<p>Users – or rather build/install tools acting on users’ behalf –
will continue to be responsible for not putting incompatible extensions on
Python’s import paths.
This decision makes sense since tools typically have much richer metadata than
what CPython can check.
Typically, build tools and installers use <a class="reference external" href="https://packaging.python.org/en/latest/specifications/core-metadata/">PyPA packaging metadata</a> and
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/platform-compatibility-tags/">platform compatibility tags</a> to communicate compatibility details, but other
models are possible.</p>
<p>However, CPython will add a line of defense against outdated or misconfigured
tools, or human mistakes, in the form of a new <em>module slot</em> containing
basic ABI information.
This information will be checked when a module is loaded, and incompatible
extensions will be rejected.
The specifics are left to the C API working group
(see <a class="reference external" href="https://github.com/capi-workgroup/decisions/issues/72">issue 72</a>).</p>
<p>This slot will become <em>mandatory</em> with the new export hook added in
<a class="pep reference internal" href="../pep-0793/" title="PEP 793 – PyModExport: A new entry point for C extension modules">PEP 793</a>.
(That PEP currently says “there are no required slots”; it will be updated.)</p>
<section id="check-for-non-free-threaded-abi-in-free-threading-builds">
<h4><a class="toc-backref" href="#check-for-non-free-threaded-abi-in-free-threading-builds" role="doc-backlink">Check for non-free-threaded ABI in free-threading builds</a></h4>
<p>Additionally, in free-threaded builds, <a class="reference external" href="https://docs.python.org/3/c-api/extension-modules.html#c.PyModuleDef_Init" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModuleDef_Init()</span></code></a> will detect
extensions using the non-free-threading Stable ABI, emit an informative
message when one is loaded, <em>and</em> raise an exception.
(Implementation note: A message will be printed before raising the exception,
because extensions that attempt to handle an exception using incompatible ABI
will likely crash and lose the exception’s message.)</p>
<p>This check for non-free-threading <code class="docutils literal notranslate"><span class="pre">abi3</span></code> relies on internal bit patterns
and may be removed in future CPython versions,
if the internal object layout needs to change.</p>
</section>
</section>
<section id="the-abi3t-wheel-tag">
<h3><a class="toc-backref" href="#the-abi3t-wheel-tag" role="doc-backlink">The <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> wheel tag</a></h3>
<p>Wheels that use a stable ABI compatible with free-threading CPython builds
should use a new <a class="reference external" href="https://packaging.python.org/en/latest/specifications/platform-compatibility-tags/#abi-tag">ABI tag</a>: <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>.</p>
<section id="recommendations-for-installers">
<h4><a class="toc-backref" href="#recommendations-for-installers" role="doc-backlink">Recommendations for installers</a></h4>
<p>Package installers should treat this tag as completely separate from <code class="docutils literal notranslate"><span class="pre">abi3</span></code>.
They should allow <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>-tagged wheels for free-threaded builds wherever
they currently allow <code class="docutils literal notranslate"><span class="pre">abi3</span></code>-tagged ones for (orherwise equal)
non-free-threaded builds.</p>
</section>
<section id="recommendations-for-build-tools">
<h4><a class="toc-backref" href="#recommendations-for-build-tools" role="doc-backlink">Recommendations for build tools</a></h4>
<p>Build tools should give users one or two additional options, in addition to
the existing CPython version-specific ABI (<code class="samp docutils literal notranslate"><span class="pre">cp3</span><em><span class="pre">nn</span></em></code>) and
Stable ABI (<code class="docutils literal notranslate"><span class="pre">abi3</span></code>):</p>
<ul>
<li>Compile extensions compatible with <em>both</em> <code class="docutils literal notranslate"><span class="pre">abi3</span></code> and <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>, by either:<ul class="simple">
<li>defining both <code class="samp docutils literal notranslate"><span class="pre">Py_LIMITED_API=</span><em><span class="pre">v</span></em></code> and <code class="samp docutils literal notranslate"><span class="pre">Py_TARGET_ABI3T=</span><em><span class="pre">v</span></em></code>, or</li>
<li>defining <code class="samp docutils literal notranslate"><span class="pre">Py_LIMITED_API=</span><em><span class="pre">v</span></em></code> and:<ul>
<li>defining <code class="docutils literal notranslate"><span class="pre">Py_GIL_DISABLED</span></code> (on Windows)</li>
<li>building with free-threaded CPython headers (elsewhere)</li>
</ul>
</li>
</ul>
<p>Such extensions should be tagged with the <a class="reference external" href="https://packaging.python.org/en/latest/specifications/platform-compatibility-tags/#compressed-tag-sets">compressed tag set</a>
<code class="docutils literal notranslate"><span class="pre">abi3.abi3t</span></code>.</p>
</li>
<li>Compile extensions compatible with <em>only</em> <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>, by defining only
<code class="samp docutils literal notranslate"><span class="pre">Py_TARGET_ABI3T=</span><em><span class="pre">v</span></em></code> and tagging the result with <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>.
This will initially offer no advantages over the <code class="docutils literal notranslate"><span class="pre">abi3.abi3t</span></code> option
above, but there is a possibility that it will become useful in the future.</li>
</ul>
<p>In the above, <code class="samp docutils literal notranslate"><em><span class="pre">v</span></em></code> stands for a the lowest Python version with which
the extension should be compatible, in <a class="reference external" href="https://docs.python.org/3/c-api/apiabiversion.html#c.Py_PACK_VERSION" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_PACK_VERSION()</span></code></a> format.
In the cases above, this version must be set to 3.15 or higher.</p>
<p>The version of the Stable ABI, both <code class="docutils literal notranslate"><span class="pre">abi3</span></code> and <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>, is indicated by
the <a class="reference external" href="https://packaging.python.org/en/latest/specifications/platform-compatibility-tags/#python-tag">Python wheel tag</a>.
For example, a wheel tagged <code class="docutils literal notranslate"><span class="pre">cp315-abi3.abi3t</span></code> will be compatible with
3.15, 3.16, and later versions;
<code class="docutils literal notranslate"><span class="pre">cp317-abi3.abi3t</span></code> will be compatible with 3.17+.</p>
<p>Note that this PEP does not provide a way to target Stable ABI for
Free-threaded Python 3.14 and below (<code class="docutils literal notranslate"><span class="pre">cp314-abi3t</span></code>).
This may change an the future, or with experimental build tools, so
<em>installers</em> should be prepared for such extensions.</p>
</section>
</section>
<section id="new-api">
<h3><a class="toc-backref" href="#new-api" role="doc-backlink">New API</a></h3>
<p>Implementing this PEP will make it possible to build extensions that
can be successfully loaded on free-threaded Python, but not necessarily ones
that are thread-safe without a GIL.</p>
<p>Limited API to allow thread-safety without a GIL – presumably <code class="docutils literal notranslate"><span class="pre">PyMutex</span></code>,
<code class="docutils literal notranslate"><span class="pre">PyCriticalSection</span></code>, and similar – will be added via the C API working group,
or in a follow-up PEP.</p>
</section>
</section>
<section id="backwards-and-forwards-compatibility">
<h2><a class="toc-backref" href="#backwards-and-forwards-compatibility" role="doc-backlink">Backwards and Forwards Compatibility</a></h2>
<p>Extensions targetting <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> will not be backwards-compatible with older
CPython releases, due to the need to use new <code class="docutils literal notranslate"><span class="pre">PyModExport</span></code> API added
in <a class="pep reference internal" href="../pep-0793/" title="PEP 793 – PyModExport: A new entry point for C extension modules">PEP 793</a>.</p>
<p>Extension authors who cannot switch may continue to use the existing <code class="docutils literal notranslate"><span class="pre">abi3</span></code>,
that is, build on GIL-enabled Python without defining <code class="docutils literal notranslate"><span class="pre">Py_GIL_DISABLED</span></code>.
For compatibility with free-threaded builds, they can compile using
version-specific ABI – that is, compile <code class="docutils literal notranslate"><span class="pre">abi3</span></code>-compatible source
on free-threaded CPython builds without defining <code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code>.</p>
<p>Limited API 3.15 for free-threading is a subset of the existing Limited API,
and as such, it will be forward-compatible with future versions of CPython 3.x.
Older versions of the Limited API (that is, 3.14 and below) will continue
to be forward-compatible with GIL-enabled builds of CPython 3.x, starting with
the version that introduced the given Limited API.</p>
<section id="compatibility-overview">
<h3><a class="toc-backref" href="#compatibility-overview" role="doc-backlink">Compatibility Overview</a></h3>
<p>The following table summarizes compatibility of wheel tags with CPython
interpreters. “GIL” stands for GIL-enabled interpreter; “FT” stands for a
free-threaded one.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Wheel tag</th>
<th class="head">3.14 (GIL)</th>
<th class="head">3.14 (FT)</th>
<th class="head">3.15 (GIL)</th>
<th class="head">3.15 (FT)</th>
<th class="head">3.16+ (GIL)</th>
<th class="head">3.16+ (FT)</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp314-cp314</span></code></td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp314-cp314t</span></code></td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp314-abi3</span></code></td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp314-abi3t</span></code> (*)</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp314-abi3.abi3t</span></code> (*)</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp315-cp315</span></code></td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp315-cp315t</span></code></td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp315-abi3</span></code></td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp315-abi3t</span></code></td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp315-abi3.abi3t</span></code></td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody>
</table>
<p>(*): Wheels with these tags cannot be built; see table below</p>
<p>The following table summarizes which wheel tag should be used for an extension
built with a given interpreter and <code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code> macro:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head">To get the wheel tag…</th>
<th class="head">Compile on…</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code></th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">Py_TARGET_ABI3T</span></code></th>
<th class="head">Note</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp314-cp314</span></code></td>
<td>3.14 (GIL)</td>
<td>—</td>
<td>N/A</td>
<td>existing</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp314-cp314t</span></code></td>
<td>3.14 (FT)</td>
<td>—</td>
<td>N/A</td>
<td>existing</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp314-abi3</span></code></td>
<td>3.14+ (GIL)</td>
<td>3.14</td>
<td>N/A</td>
<td>existing</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp314-abi3t</span></code></td>
<td colspan="3">N/A</td>
<td>reserved</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp314-abi3.abi3t</span></code></td>
<td colspan="3">N/A</td>
<td>reserved</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp315-cp315</span></code></td>
<td>3.15 (GIL)</td>
<td>—</td>
<td>—</td>
<td>continued</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp315-cp315t</span></code></td>
<td>3.15 (FT)</td>
<td>—</td>
<td>—</td>
<td>continued</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp315-abi3</span></code></td>
<td>3.15+ (GIL)</td>
<td>3.15</td>
<td>—</td>
<td>continued</td>
</tr>
<tr class="row-even"><td rowspan="2"><code class="docutils literal notranslate"><span class="pre">cp315-abi3t</span></code></td>
<td>3.15+</td>
<td>—</td>
<td>3.15</td>
<td rowspan="2">new</td>
</tr>
<tr class="row-odd"><td>3.15+ (FT)</td>
<td>3.15</td>
<td>—</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp315-abi3.abi3t</span></code></td>
<td>3.15+</td>
<td>3.15</td>
<td>3.15</td>
<td>new</td>
</tr>
</tbody>
</table>
<p>In the “Compile on” column, <em>FT</em> means that the <a class="reference external" href="https://docs.python.org/3.15/using/configure.html#c.Py_GIL_DISABLED" title="(in Python v3.15)"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_GIL_DISABLED</span></code></a>
macro must be defined – either explicitly or, on non-Windows platforms,
by including CPython headers configured with <a class="reference external" href="https://docs.python.org/3/using/configure.html#cmdoption-disable-gil" title="(in Python v3.14)"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disable-gil</span></code></a>.
<em>GIL</em> means that <a class="reference external" href="https://docs.python.org/3.15/using/configure.html#c.Py_GIL_DISABLED" title="(in Python v3.15)"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_GIL_DISABLED</span></code></a> must <em>not</em> be defined.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code> and <code class="docutils literal notranslate"><span class="pre">Py_TARGET_ABI3T</span></code>, a dash means the macro
must not be defined; a version means the macro must be set to the corresponding
integer in <a class="reference external" href="https://docs.python.org/3/c-api/apiabiversion.html#c.Py_PACK_VERSION" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_PACK_VERSION()</span></code></a> format.</p>
<p>Values in the <em>Note</em> column:</p>
<ul class="simple">
<li><em>existing</em>: The wheel tag is currently in use</li>
<li><em>continued</em>: The wheel tag continues the existing scheme</li>
<li><em>new</em>: Proposed in this PEP.</li>
<li><em>reserved</em>: A mechanism to build a matching extension is not proposed in
this PEP, but may be added in the future.
Installers should be prepared to handle the tag.</li>
</ul>
</section>
</section>
<section id="security-implications">
<h2><a class="toc-backref" href="#security-implications" role="doc-backlink">Security Implications</a></h2>
<p>None known.</p>
</section>
<section id="how-to-teach-this">
<h2><a class="toc-backref" href="#how-to-teach-this" role="doc-backlink">How to Teach This</a></h2>
<p>A porting guide will need to explain how to move to APIs added in
<a class="pep reference internal" href="../pep-0697/" title="PEP 697 – Limited C API for Extending Opaque Types">PEP 697</a> (Limited C API for Extending Opaque Types)
and <a class="pep reference internal" href="../pep-0793/" title="PEP 793 – PyModExport: A new entry point for C extension modules">PEP 793</a> (<code class="docutils literal notranslate"><span class="pre">PyModExport</span></code>).</p>
</section>
<section id="reference-implementation">
<h2><a class="toc-backref" href="#reference-implementation" role="doc-backlink">Reference Implementation</a></h2>
<p>This PEP combines several pieces, implemented individually:</p>
<ul class="simple">
<li>Opaque <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> is available in CPython main branch after defining the
<code class="docutils literal notranslate"><span class="pre">_Py_OPAQUE_PYOBJECT</span></code> macro.
Implemented in GitHub pull request <a class="reference external" href="https://github.com/python/cpython/pull/136505">python/cpython#136505</a>.</li>
<li>For <code class="docutils literal notranslate"><span class="pre">PyModExport</span></code>, see <a class="pep reference internal" href="../pep-0793/" title="PEP 793 – PyModExport: A new entry point for C extension modules">PEP 793</a> and
<a class="reference external" href="https://github.com/python/cpython/issues/140550">GitHub issue #140550</a>.</li>
<li>A version-checking slot was implemented in GitHub pull request
<a class="reference external" href="https://github.com/python/cpython/pull/137212">python/cpython#137212</a>.</li>
<li>A check for older <code class="docutils literal notranslate"><span class="pre">abi3</span></code> was implemented in GitHub pull request
<a class="reference external" href="https://github.com/python/cpython/pull/137957">python/cpython#137957</a>.</li>
<li>For wheel tags, there is no implementation yet.</li>
<li>A porting guide is not yet written.</li>
</ul>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#rejected-ideas" role="doc-backlink">Rejected Ideas</a></h2>
<section id="make-pyobject-opaque-in-limited-api-3-15">
<h3><a class="toc-backref" href="#make-pyobject-opaque-in-limited-api-3-15" role="doc-backlink">Make <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> opaque in Limited API 3.15</a></h3>
<p>It would be possible to make <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> struct opaque in Limited API 3.15
(that is, the new version of the existing Limited API),
rather than introduce a new variant of the Stable ABI and Limited API.</p>
<p>This would mean that extension authors would need to adapt their code to the
new limitations, or abandon Limited API altogether, in order to use any C API
introduced in Python 3.15.</p>
<p>It would also not remove the need for a new wheel tag (<code class="docutils literal notranslate"><span class="pre">abi3t</span></code>),
which would be required to express that an extension
is compatible with both GIL-enabled and free-threaded builds
of CPython 3.14 or lower.</p>
</section>
<section id="shims-for-compatibility-with-cpython-3-14">
<span id="pep803-no-shim"></span><h3><a class="toc-backref" href="#shims-for-compatibility-with-cpython-3-14" role="doc-backlink">Shims for compatibility with CPython 3.14</a></h3>
<p>It’s possible to build a <code class="docutils literal notranslate"><span class="pre">cp314-abi3.abi3t</span></code> extension – one compatible
with 3.14 (both free-threaded build and default).
There are several challenges around this:</p>
<ul class="simple">
<li>making it convenient and safe for general extensions</li>
<li>testing it (as CPython’s test suite doesn’t involve other CPython versions
than the one being tested)</li>
</ul>
<p>So, providing a mechanism to build such extensions is best suited to an
external project (for example, one like <a class="reference external" href="https://github.com/python/pythoncapi-compat">pythoncapi-compat</a>).
It’s out of scope for CPython’s C API, and this PEP.</p>
<p>To sketch how such a mechanism could work:</p>
<p>The main issue that prevents compatibility with Python 3.14 is that with
opaque <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> and <code class="docutils literal notranslate"><span class="pre">PyModuleDef</span></code>, it is not feasible to initialize
an extension module.
The solution, <a class="pep reference internal" href="../pep-0793/" title="PEP 793 – PyModExport: A new entry point for C extension modules">PEP 793</a>, is only being added in Python 3.15.</p>
<p>It is possible to work around this using the fact that the 3.14 ABIs (both
free-threading and GIL-enabled) are “frozen”, so it is possible for an
extension to query the running interpreter, and for 3.14, use
a <code class="docutils literal notranslate"><span class="pre">struct</span></code> definition corresponding to the detected build’s <code class="docutils literal notranslate"><span class="pre">PyModuleDef</span></code>.</p>
</section>
<section id="naming-this-abi4">
<h3><a class="toc-backref" href="#naming-this-abi4" role="doc-backlink">Naming this <code class="docutils literal notranslate"><span class="pre">abi4</span></code></a></h3>
<p>Instead of <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>, we could “bump the version” and use <code class="docutils literal notranslate"><span class="pre">abi4</span></code> instead.
The difference is largely cosmetic.</p>
<p>However, one thing this PEP does not propose is changing the <em>filename</em>
tag: extensions will be named with the extensions like <code class="docutils literal notranslate"><span class="pre">.abi3.so</span></code>.
Changing this while keeping compatibility with GIL-enabled builds would be
an unnecessary technical change.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">abi3.abi4</span></code> in wheel tags but only <code class="docutils literal notranslate"><span class="pre">.abi3</span></code> in filenames would
look more inconsistent than <code class="docutils literal notranslate"><span class="pre">abi3.abi3t</span></code> and <code class="docutils literal notranslate"><span class="pre">.abi3</span></code>.</p>
<p>If we added an <code class="docutils literal notranslate"><span class="pre">abi4</span></code> tag, the <code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code> value would either need to:</p>
<ul class="simple">
<li>change to start with <code class="docutils literal notranslate"><span class="pre">4</span></code> to match <code class="docutils literal notranslate"><span class="pre">abi4</span></code>, but no longer correspond
to <code class="docutils literal notranslate"><span class="pre">PY_VERSION_HEX</span></code> (making it harder to generate and check), or</li>
<li>not change, making it inconsistent with <code class="docutils literal notranslate"><span class="pre">abi4</span></code>.</li>
</ul>
<p>Adding <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> is a smaller change than adding <code class="docutils literal notranslate"><span class="pre">abi4</span></code>, making it work
better as a transitional state before larger changes like <a class="pep reference internal" href="../pep-0809/" title="PEP 809 – Stable ABI for the Future">PEP 809</a>’s
<code class="docutils literal notranslate"><span class="pre">abi2026</span></code>.</p>
</section>
<section id="reusing-py-gil-disabled-to-enable-the-new-abi">
<h3><a class="toc-backref" href="#reusing-py-gil-disabled-to-enable-the-new-abi" role="doc-backlink">Reusing <code class="docutils literal notranslate"><span class="pre">Py_GIL_DISABLED</span></code> to enable the new ABI</a></h3>
<p>It would be possible to select <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> (rather than <code class="docutils literal notranslate"><span class="pre">abi3</span></code>) when the
<code class="docutils literal notranslate"><span class="pre">Py_GIL_DISABLED</span></code> macro is defined together with <code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code>.</p>
<p>This would require annoying fiddling with build flags, and make it
especially cumbersome to target <em>both</em> <code class="docutils literal notranslate"><span class="pre">abi3</span></code> and <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> at the same time.</p>
</section>
<section id="making-the-new-version-of-abi3-compatible-with-free-threading">
<h3><a class="toc-backref" href="#making-the-new-version-of-abi3-compatible-with-free-threading" role="doc-backlink">Making the new version of <code class="docutils literal notranslate"><span class="pre">abi3</span></code> compatible with free-threading</a></h3>
<p>It would be possible to make <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> opaque in Limited API 3.15,
rather than add a new stable ABI.
This would make all extensions built for the Stable ABI 3.15 and above
compatible with both free-threading and GIL-enabled Python.</p>
<p>In the <a class="reference external" href="https://discuss.python.org/t/pep-803-stable-abi-for-free-threaded-builds/103628/56">PEP discussion</a>,
the ability to build for the GIL-only Stable ABI with no source changes
was deemed to be worth an extra configuration macro (<code class="docutils literal notranslate"><span class="pre">Py_TARGET_ABI3T</span></code>).</p>
</section>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document is placed in the public domain or under the
CC0-1.0-Universal license, whichever is more permissive.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/peps/pep-0803.rst">https://github.com/python/peps/blob/main/peps/pep-0803.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/peps/pep-0803.rst">2026-02-16 20:35:30 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <div id="search"></div>
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#terminology">Terminology</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rationale">Rationale</a><ul>
<li><a class="reference internal" href="#tag-name">Tag name</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#stable-abi-for-free-threaded-builds">Stable ABI for free-threaded builds</a></li>
<li><a class="reference internal" href="#choosing-the-target-abi">Choosing the target ABI</a></li>
<li><a class="reference internal" href="#opaque-pyobject">Opaque PyObject</a><ul>
<li><a class="reference internal" href="#implications">Implications</a></li>
</ul>
</li>
<li><a class="reference internal" href="#runtime-abi-checks">Runtime ABI checks</a><ul>
<li><a class="reference internal" href="#check-for-non-free-threaded-abi-in-free-threading-builds">Check for non-free-threaded ABI in free-threading builds</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-abi3t-wheel-tag">The <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> wheel tag</a><ul>
<li><a class="reference internal" href="#recommendations-for-installers">Recommendations for installers</a></li>
<li><a class="reference internal" href="#recommendations-for-build-tools">Recommendations for build tools</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-api">New API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-and-forwards-compatibility">Backwards and Forwards Compatibility</a><ul>
<li><a class="reference internal" href="#compatibility-overview">Compatibility Overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#make-pyobject-opaque-in-limited-api-3-15">Make <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> opaque in Limited API 3.15</a></li>
<li><a class="reference internal" href="#shims-for-compatibility-with-cpython-3-14">Shims for compatibility with CPython 3.14</a></li>
<li><a class="reference internal" href="#naming-this-abi4">Naming this <code class="docutils literal notranslate"><span class="pre">abi4</span></code></a></li>
<li><a class="reference internal" href="#reusing-py-gil-disabled-to-enable-the-new-abi">Reusing <code class="docutils literal notranslate"><span class="pre">Py_GIL_DISABLED</span></code> to enable the new ABI</a></li>
<li><a class="reference internal" href="#making-the-new-version-of-abi3-compatible-with-free-threading">Making the new version of <code class="docutils literal notranslate"><span class="pre">abi3</span></code> compatible with free-threading</a></li>
</ul>
</li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/peps/pep-0803.rst?plain=1">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
    <script src="../_static/sticky_banner.js"></script>
    <script src="https://analytics.python.org/js/script.outbound-links.js"
            data-domain="peps.python.org" defer></script>
    <script src="/pagefind/pagefind-ui.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            // Ranking configuration to boost exact title matches
            const searchOptions = {
                ranking: {
                    termSimilarity: 9.0, // Higher values favor exact matches
                    termFrequency: 0.5, // Lower values reduce penalty for low term frequency
                    pageLength: 0.2, // Lower values reduce the impact of page length
                }
            };

            // Initialize pagefind for either mobile or desktop, not both
            if (window.innerWidth <= 640) {
                new PagefindUI({ element: "#mobile-search", ...searchOptions, showSubResults: false });
            } else {
                new PagefindUI({ element: "#search", ...searchOptions, showSubResults: true });
            }
        });
    </script>
</body>
</html>