
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 803 – Stable ABI for Free-Threaded Builds | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0803/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://peps.python.org/peps.rss">
    <meta property="og:title" content='PEP 803 – Stable ABI for Free-Threaded Builds | peps.python.org'>
    <meta property="og:description" content="Version 3.15 of the Stable ABI will be compatible with both free-threaded and GIL-enabled builds. To allow this, the PyObject internal structure and related APIs will be removed from version 3.15 of the Limited API, requiring migration to new API for co...">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://peps.python.org/pep-0803/">
    <meta property="og:site_name" content="Python Enhancement Proposals (PEPs)">
    <meta property="og:image" content="https://peps.python.org/_static/og-image.png">
    <meta property="og:image:alt" content="Python PEPs">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta name="description" content="Version 3.15 of the Stable ABI will be compatible with both free-threaded and GIL-enabled builds. To allow this, the PyObject internal structure and related APIs will be removed from version 3.15 of the Limited API, requiring migration to new API for co...">
    <meta name="theme-color" content="#3776ab">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 803</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 803 – Stable ABI for Free-Threaded Builds</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Petr Viktorin &lt;encukou&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-even">Discussions-To<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="https://discuss.python.org/t/103628">Discourse thread</a></dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><abbr title="Proposal under active discussion and revision">Draft</abbr></dd>
<dt class="field-even">Type<span class="colon">:</span></dt>
<dd class="field-even"><abbr title="Normative PEP with a new feature for Python, implementation change for CPython or interoperability standard for the ecosystem">Standards Track</abbr></dd>
<dt class="field-odd">Requires<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="../pep-0703/">703</a>, <a class="reference external" href="../pep-0793/">793</a>, <a class="reference external" href="../pep-0697/">697</a></dd>
<dt class="field-even">Created<span class="colon">:</span></dt>
<dd class="field-even">19-Aug-2025</dd>
<dt class="field-odd">Python-Version<span class="colon">:</span></dt>
<dd class="field-odd">3.15</dd>
<dt class="field-even">Post-History<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="https://discuss.python.org/t/103628" title="Discourse thread">08-Sep-2025</a></dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#terminology">Terminology</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#opaque-pyobject">Opaque PyObject</a><ul>
<li><a class="reference internal" href="#implications">Implications</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-export-hook-pep-793">New Export Hook (PEP 793)</a></li>
<li><a class="reference internal" href="#runtime-abi-checks">Runtime ABI checks</a><ul>
<li><a class="reference internal" href="#check-for-older-abi3">Check for older <code class="docutils literal notranslate"><span class="pre">abi3</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-abi3t-wheel-tag">The <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> wheel tag</a></li>
<li><a class="reference internal" href="#new-api">New API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-and-forwards-compatibility">Backwards and Forwards Compatibility</a><ul>
<li><a class="reference internal" href="#compatibility-overview">Compatibility Overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#add-an-alternative-stable-abi-for-free-threading">Add an alternative stable ABI for free-threading</a></li>
<li><a class="reference internal" href="#shims-for-compatibility-with-cpython-3-14">Shims for compatibility with CPython 3.14</a></li>
<li><a class="reference internal" href="#using-the-python-wheel-tag-to-determine-compatibility">Using the Python wheel tag to determine compatibility</a></li>
<li><a class="reference internal" href="#adding-an-abi4-wheel-tag">Adding an <code class="docutils literal notranslate"><span class="pre">abi4</span></code> wheel tag</a></li>
</ul>
</li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p>Version 3.15 of the Stable ABI will be compatible with both free-threaded and
GIL-enabled builds.
To allow this, the <a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.PyObject" title="(in Python v3.14)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyObject</span></code></a> internal structure and related APIs
will be removed from version 3.15 of the Limited API, requiring migration to
new API for common tasks like defining modules and most classes.</p>
<p>Binary distributions (wheels) built with Limited API version 3.15 and above
should use the ABI tag <code class="docutils literal notranslate"><span class="pre">abi3.abi3t</span></code>.</p>
</section>
<section id="terminology">
<h2><a class="toc-backref" href="#terminology" role="doc-backlink">Terminology</a></h2>
<p>This PEP uses “GIL-enabled build” as an antonym to “free-threaded build”,
that is, an interpreter or extension built without <code class="docutils literal notranslate"><span class="pre">Py_GIL_DISABLED</span></code>.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation" role="doc-backlink">Motivation</a></h2>
<p>The Stable ABI is currently not available for free-threaded builds.
Extensions will fail to build when <a class="reference external" href="https://docs.python.org/3/c-api/stable.html#c.Py_LIMITED_API" title="(in Python v3.14)"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code></a> is defined,
and extensions built for GIL-enabled builds of CPython will fail to load
(or crash) on free-threaded builds.</p>
<p>In its <a class="reference external" href="https://discuss.python.org/t/84319/123">acceptance post</a>
for <a class="pep reference internal" href="../pep-0779/" title="PEP 779 – Criteria for supported status for free-threaded Python">PEP 779</a>, the Steering Council stated that it “expects that Stable ABI
for free-threading should be prepared and defined for Python 3.15”.</p>
<p>This PEP proposes the Stable ABI for free-threading.</p>
<section id="background">
<h3><a class="toc-backref" href="#background" role="doc-backlink">Background</a></h3>
<p>Python’s Stable ABI, as defined in <a class="pep reference internal" href="../pep-0384/" title="PEP 384 – Defining a Stable ABI">PEP 384</a> and <a class="pep reference internal" href="../pep-0652/" title="PEP 652 – Maintaining the Stable ABI">PEP 652</a>, provides a way to
compile extension modules that can be loaded on multiple minor versions of the
CPython interpreter.
Several projects use this to limit the number of
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/binary-distribution-format/#binary-distribution-format" title="(in Python Packaging User Guide)"><span class="xref std std-ref">wheels</span></a> (binary artefacts)
that need to be built and distributed for each release, and/or to make it
easier to test with pre-release versions of Python.</p>
<p>With free-threading builds (<a class="pep reference internal" href="../pep-0703/" title="PEP 703 – Making the Global Interpreter Lock Optional in CPython">PEP 703</a>) being on track to eventually become
the default (<a class="pep reference internal" href="../pep-0779/" title="PEP 779 – Criteria for supported status for free-threaded Python">PEP 779</a>), we need a way to make the Stable ABI available
to those builds.</p>
<p>To build against the Stable ABI, the extension must use a <em>Limited API</em>,
that is, only a subset of the functions, structures, etc. that CPython
exposes.
The Limited API is versioned, and building against Limited API 3.X
yields an extension that is ABI-compatible with CPython 3.X and <em>any</em> later
version (though bugs in CPython sometimes cause incompatibilities in practice).
Also, the Limited API is not “stable”: newer versions may remove API that
were a part of older versions.</p>
<p>This PEP proposes the most significant such removal to date.</p>
</section>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale" role="doc-backlink">Rationale</a></h2>
<p>The design in this PEP makes several assumptions:</p>
<dl>
<dt>One ABI</dt><dd>A single compiled extension module should support both
free-threaded and GIL-enabled builds.</dd>
<dt>No backwards compatibility now</dt><dd>The new limited API will not support CPython 3.14 and below.
Projects that need this support can build separate extensions specifically
for the 3.14 free-threaded interpreter, and for older stable ABI versions.<p>However, we won’t block the possibility of extending compatibility to
CPython 3.14 and below.</p>
</dd>
<dt>API changes are OK</dt><dd>The new Limited API may require extension authors to make significant
changes to their code.
Projects that cannot do this (yet) can continue using Limited API 3.14,
which will yield extensions compatible with GIL-enabled builds only.</dd>
<dt>No extra configuration</dt><dd>We do not introduce new “knobs” that influence what API is available
and what the ABI is compatible with.</dd>
</dl>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification" role="doc-backlink">Specification</a></h2>
<section id="opaque-pyobject">
<h3><a class="toc-backref" href="#opaque-pyobject" role="doc-backlink">Opaque PyObject</a></h3>
<p>Version 3.15 of the Limited API will:</p>
<ul class="simple">
<li>make the following structures <em>opaque</em> (or in C terminology, <em>incomplete
types</em>):<ul>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.PyObject" title="(in Python v3.14)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyObject</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.PyVarObject" title="(in Python v3.14)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyVarObject</span></code></a></li>
<li><code class="xref c c-type docutils literal notranslate"><span class="pre">PyModuleDef_Base</span></code></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/module.html#c.PyModuleDef" title="(in Python v3.14)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyModuleDef</span></code></a></li>
</ul>
</li>
<li>no longer include the following macros:<ul>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.PyObject_HEAD" title="(in Python v3.14)"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyObject_HEAD</span></code></a></li>
<li><code class="xref c c-macro docutils literal notranslate"><span class="pre">_PyObject_EXTRA_INIT</span></code></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.PyObject_HEAD_INIT" title="(in Python v3.14)"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyObject_HEAD_INIT</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.PyObject_VAR_HEAD" title="(in Python v3.14)"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyObject_VAR_HEAD</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.Py_SET_TYPE" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_SET_TYPE()</span></code></a></li>
</ul>
</li>
<li>export the following as functions in the ABI, rather than macros:<ul>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.Py_SIZE" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_SIZE()</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.Py_SET_SIZE" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_SET_SIZE()</span></code></a></li>
</ul>
</li>
</ul>
<section id="implications">
<h4><a class="toc-backref" href="#implications" role="doc-backlink">Implications</a></h4>
<p>Making the <code class="docutils literal notranslate"><span class="pre">PyObject</span></code>, <code class="docutils literal notranslate"><span class="pre">PyVarObject</span></code> and <code class="docutils literal notranslate"><span class="pre">PyModuleDef</span></code> structures
opaque means:</p>
<ul>
<li>Their fields may not be directly accessed.<p>For example, instead of <code class="docutils literal notranslate"><span class="pre">o-&gt;ob_type</span></code>, extensions must use
<code class="docutils literal notranslate"><span class="pre">Py_TYPE(o)</span></code>.
This usage has been the preferred practice for some time.</p>
</li>
<li>Their size and alignment will not be available.
Expressions such as <code class="docutils literal notranslate"><span class="pre">sizeof(PyObject)</span></code> will no longer work.</li>
<li>They cannot be embedded in other structures.
This mainly affects instance structs of extension-defined types,
which will need to be defined using API added in <a class="pep reference internal" href="../pep-0697/" title="PEP 697 – Limited C API for Extending Opaque Types">PEP 697</a> – that is,
using a <code class="docutils literal notranslate"><span class="pre">struct</span></code> <em>without</em> <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> (or other base class struct) at
the beginning, with <a class="reference external" href="https://docs.python.org/3/c-api/object.html#c.PyObject_GetTypeData" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GetTypeData()</span></code></a> calls needed to access
the memory.</li>
<li>Variables of these types cannot be created.
This mainly affects static <code class="docutils literal notranslate"><span class="pre">PyModuleDef</span></code> variables needed to define
extension modules.
Extensions will need to switch to API added in <a class="pep reference internal" href="../pep-0793/" title="PEP 793 – PyModExport: A new entry point for C extension modules">PEP 793</a>.</li>
</ul>
<p>The following functions will become unusable in practice (in the new Limited
API), since an extension cannot create valid, statically allocated, input
for them. To ease the transition for extension developers,
they will not yet be removed from the Limited API:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/c-api/extension-modules.html#c.PyModuleDef_Init" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModuleDef_Init()</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/module.html#c.PyModule_Create" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_Create()</span></code></a>, <a class="reference external" href="https://docs.python.org/3/c-api/module.html#c.PyModule_Create2" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_Create2()</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/c-api/module.html#c.PyModule_FromDefAndSpec" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_FromDefAndSpec()</span></code></a>, <a class="reference external" href="https://docs.python.org/3/c-api/module.html#c.PyModule_FromDefAndSpec2" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_FromDefAndSpec2()</span></code></a></li>
</ul>
</section>
</section>
<section id="new-export-hook-pep-793">
<h3><a class="toc-backref" href="#new-export-hook-pep-793" role="doc-backlink">New Export Hook (PEP 793)</a></h3>
<p>Implementation of this PEP requires <a class="pep reference internal" href="../pep-0793/" title="PEP 793 – PyModExport: A new entry point for C extension modules">PEP 793</a> (<code class="docutils literal notranslate"><span class="pre">PyModExport</span></code>):
A new entry  point for C extension modules) to be
accepted, providing a new “export hook” for defining extension modules.
Using the new hook will become mandatory in Limited API 3.15.</p>
</section>
<section id="runtime-abi-checks">
<h3><a class="toc-backref" href="#runtime-abi-checks" role="doc-backlink">Runtime ABI checks</a></h3>
<p>Users – or rather the tools they use for building and installing extensions –
will continue to be responsible for not putting incompatible extensions on
Python’s import paths.
This decision makes sense since tools typically have much richer metadata than
what CPython can check.</p>
<p>However, CPython will add a line of defense against outdated or misconfigured
tools, or human mistakes, in the form of a new <em>module slot</em> containing
basic ABI information.
This information will be checked when a module is loaded, and incompatible
extensions will be rejected.
The specifics are left to the C API working group
(see <a class="reference external" href="https://github.com/capi-workgroup/decisions/issues/72">issue 72</a>).</p>
<p>This slot will become <em>mandatory</em> with the new export hook added in
<a class="pep reference internal" href="../pep-0793/" title="PEP 793 – PyModExport: A new entry point for C extension modules">PEP 793</a>.
(That PEP currently says “there are no required slots”; it will be updated.)</p>
<section id="check-for-older-abi3">
<h4><a class="toc-backref" href="#check-for-older-abi3" role="doc-backlink">Check for older <code class="docutils literal notranslate"><span class="pre">abi3</span></code></a></h4>
<p>Additionally, in free-threaded builds, <a class="reference external" href="https://docs.python.org/3/c-api/extension-modules.html#c.PyModuleDef_Init" title="(in Python v3.14)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModuleDef_Init()</span></code></a> will detect
extensions using the pre-free-threading Stable ABI, emit an informative
message when one is loaded, <em>and</em> raise an exception.
(Implementation note: A message will be printed before raising the exception,
because extensions that attempt to handle an exception using incompatible ABI
will likely crash and lose the exception’s message.)</p>
<p>This check for older <code class="docutils literal notranslate"><span class="pre">abi3</span></code> relies on internal bit patterns and may be
removed in future CPython versions, if the internal object layout needs
to change.</p>
</section>
</section>
<section id="the-abi3t-wheel-tag">
<h3><a class="toc-backref" href="#the-abi3t-wheel-tag" role="doc-backlink">The <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> wheel tag</a></h3>
<p>Wheels that use a stable ABI compatible with free-threading CPython builds
should use a new ABI tag: <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>.
The name is chosen to reflect the fact that this ABI is similar to <code class="docutils literal notranslate"><span class="pre">abi3</span></code>,
except changes necessary to support free-threading (which uses the letter <code class="docutils literal notranslate"><span class="pre">t</span></code>
in existing, version-specific ABI tags like <code class="docutils literal notranslate"><span class="pre">cp314t</span></code>).</p>
<p>Since wheels built using Limited API 3.15 will be compatible with both
GIL-enabled builds and free-threaded ones, they should use the
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/platform-compatibility-tags/#compressed-tag-sets">compressed ABI tag set</a>
<code class="docutils literal notranslate"><span class="pre">abi3.abi3t</span></code>.</p>
</section>
<section id="new-api">
<h3><a class="toc-backref" href="#new-api" role="doc-backlink">New API</a></h3>
<p>Implementing this PEP will make it possible to build extensions that
can be successfully loaded on free-threaded Python, but not necessarily ones
that are thread-safe without a GIL.</p>
<p>Limited API to allow thread-safety without a GIL – presumably <code class="docutils literal notranslate"><span class="pre">PyMutex</span></code>, <code class="docutils literal notranslate"><span class="pre">PyCriticalSection</span></code>, and
similar – will be added via the C API working group, or in a follow-up PEP.</p>
</section>
</section>
<section id="backwards-and-forwards-compatibility">
<h2><a class="toc-backref" href="#backwards-and-forwards-compatibility" role="doc-backlink">Backwards and Forwards Compatibility</a></h2>
<p>Limited API 3.15 will not be backwards-compatible with older CPython releases,
due to the need to use new <code class="docutils literal notranslate"><span class="pre">PyModExport</span></code> API added in <a class="pep reference internal" href="../pep-0793/" title="PEP 793 – PyModExport: A new entry point for C extension modules">PEP 793</a>.</p>
<p>Extension authors who cannot switch may continue to use Limited API 3.14
and below.
For compatibility with free-threaded builds, they can compile using
version-specific ABI – for example, compile on CPython 3.15 without defining
<code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code>.</p>
<p>Limited API 3.15 will be forward-compatible with future versions of CPython 3.x.
Older versions of the Limited API (that is, 3.14 and below) will continue
to be forward-compatible with GIL-enabled builds of CPython 3.x, starting with
the version that introduced the given Limited API.</p>
<section id="compatibility-overview">
<h3><a class="toc-backref" href="#compatibility-overview" role="doc-backlink">Compatibility Overview</a></h3>
<p>The following table summarizes compatibility of wheel tags with CPython
interpreters. “GIL” stands for GIL-enabled interpreter; “FT” stands for a
free-threaded one.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Wheel tag</th>
<th class="head">3.14 (GIL)</th>
<th class="head">3.14 (FT)</th>
<th class="head">3.15 (GIL)</th>
<th class="head">3.15 (FT)</th>
<th class="head">3.16+ (GIL)</th>
<th class="head">3.16+ (FT)</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp314-cp314</span></code></td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp314-cp314t</span></code></td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp314-abi3</span></code></td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp315-cp315</span></code></td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp315-cp315t</span></code></td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp315-abi3</span></code></td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp315-abi3.abi3t</span></code></td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody>
</table>
<p>The following table summarizes which wheel tag should be used for an extension
built with a given interpreter and <code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code> macro:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head">To get the wheel tag…</th>
<th class="head">Compile on…</th>
<th class="head">with <code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code> set to…</th>
<th class="head">Note</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp314-cp314</span></code></td>
<td>3.14 (GIL)</td>
<td>(unset)</td>
<td>existing</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp314-cp314t</span></code></td>
<td>3.14 (FT)</td>
<td>(unset)</td>
<td>existing</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp314-abi3</span></code></td>
<td>3.14+ (GIL)</td>
<td><code class="docutils literal notranslate"><span class="pre">PY_PACK_VERSION(3,</span> <span class="pre">14)</span></code></td>
<td>existing</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp315-cp315</span></code></td>
<td>3.15 (GIL)</td>
<td>(unset)</td>
<td>continued</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp315-cp315t</span></code></td>
<td>3.15 (FT)</td>
<td>(unset)</td>
<td>continued</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cp315-abi3</span></code></td>
<td>3.15+ (GIL)</td>
<td><code class="docutils literal notranslate"><span class="pre">PY_PACK_VERSION(3,</span> <span class="pre">15)</span></code></td>
<td>discontinued</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cp315-abi3.abi3t</span></code></td>
<td>3.15+ (any)</td>
<td><code class="docutils literal notranslate"><span class="pre">PY_PACK_VERSION(3,</span> <span class="pre">15)</span></code></td>
<td>new</td>
</tr>
</tbody>
</table>
<p>Values in the <em>Note</em> column:</p>
<ul class="simple">
<li><em>existing</em>: The wheel tag is currently in use</li>
<li><em>continued</em>: The wheel tag continues the existing scheme</li>
<li><em>discontinued</em>: The wheel tag continues the existing scheme, but it will
be discouraged. Older tools may still generate it.</li>
<li><em>new</em>: Proposed in this PEP.</li>
</ul>
</section>
</section>
<section id="security-implications">
<h2><a class="toc-backref" href="#security-implications" role="doc-backlink">Security Implications</a></h2>
<p>None known.</p>
</section>
<section id="how-to-teach-this">
<h2><a class="toc-backref" href="#how-to-teach-this" role="doc-backlink">How to Teach This</a></h2>
<p>A porting guide will need to explain how to move to APIs added in
<a class="pep reference internal" href="../pep-0697/" title="PEP 697 – Limited C API for Extending Opaque Types">PEP 697</a> (Limited C API for Extending Opaque Types)
and <a class="pep reference internal" href="../pep-0793/" title="PEP 793 – PyModExport: A new entry point for C extension modules">PEP 793</a> (<code class="docutils literal notranslate"><span class="pre">PyModExport</span></code>).</p>
</section>
<section id="reference-implementation">
<h2><a class="toc-backref" href="#reference-implementation" role="doc-backlink">Reference Implementation</a></h2>
<p>This PEP combines several pieces, implemented individually:</p>
<ul class="simple">
<li>Opaque <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> is available in CPython main branch after defining the
<code class="docutils literal notranslate"><span class="pre">_Py_OPAQUE_PYOBJECT</span></code> macro.
Implemented in GitHub pull request <a class="reference external" href="https://github.com/python/cpython/pull/136505">python/cpython#136505</a>.</li>
<li>For <code class="docutils literal notranslate"><span class="pre">PyModExport</span></code>, see <a class="pep reference internal" href="../pep-0793/" title="PEP 793 – PyModExport: A new entry point for C extension modules">PEP 793</a>.</li>
<li>A version-checking slot was implemented in GitHub pull request
<a class="reference external" href="https://github.com/python/cpython/pull/137212">python/cpython#137212</a>.</li>
<li>A check for older <code class="docutils literal notranslate"><span class="pre">abi3</span></code> was implemented in GitHub pull request
<a class="reference external" href="https://github.com/python/cpython/pull/137957">python/cpython#137957</a>.</li>
<li>For wheel tags, there is no implementation yet.</li>
<li>A porting guide is not yet written.</li>
</ul>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#rejected-ideas" role="doc-backlink">Rejected Ideas</a></h2>
<section id="add-an-alternative-stable-abi-for-free-threading">
<h3><a class="toc-backref" href="#add-an-alternative-stable-abi-for-free-threading" role="doc-backlink">Add an alternative stable ABI for free-threading</a></h3>
<p>It would be possible to:</p>
<ul class="simple">
<li>Add a new stable ABI (“<code class="docutils literal notranslate"><span class="pre">abi3t</span></code>”) specifically for free-threading,
which would be incompatible with the existing <code class="docutils literal notranslate"><span class="pre">abi3</span></code>.
Extensions would need no code changes to target <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> and builds would be
compatible with free-threaded CPython (3.14 and above).</li>
<li>Define an additional macro (“<code class="docutils literal notranslate"><span class="pre">Py_OPAQUE_PYOBJECT</span></code>”), which would make
<code class="docutils literal notranslate"><span class="pre">PyObject</span></code> opaque as in this PEP. Extensions would need code changes as in
this PEP, and as in this PEP, compiled extensions (“<code class="docutils literal notranslate"><span class="pre">abi3.abi3t</span></code>”) would
be compatible with all builds of CPython 3.15+.</li>
</ul>
<p>This scheme was rejected as too complex.
It would also make the free-threading memory layout of <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> part
of the stable ABI, preventing future adjustments.</p>
</section>
<section id="shims-for-compatibility-with-cpython-3-14">
<h3><a class="toc-backref" href="#shims-for-compatibility-with-cpython-3-14" role="doc-backlink">Shims for compatibility with CPython 3.14</a></h3>
<p>The main issue that prevents compatibility with Python 3.14 is that with
opaque <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> and <code class="docutils literal notranslate"><span class="pre">PyModuleDef</span></code>, it is not feasible to initialize
an extension module.
The solution, <a class="pep reference internal" href="../pep-0793/" title="PEP 793 – PyModExport: A new entry point for C extension modules">PEP 793</a>, is only being added in Python 3.15.</p>
<p>It is possible to work around this using the fact that the 3.14 ABIs (both
free-threading and GIL-enabled) are “frozen”, so it is possible for an
extension to query the running interpreter, and for 3.14, use
a <code class="docutils literal notranslate"><span class="pre">struct</span></code> definition corresponding to the detected build’s <code class="docutils literal notranslate"><span class="pre">PyModuleDef</span></code>.</p>
<p>This is too onerous to support and test in CPython’s Limited API at this point,
but it may be allowed in the future.</p>
</section>
<section id="using-the-python-wheel-tag-to-determine-compatibility">
<h3><a class="toc-backref" href="#using-the-python-wheel-tag-to-determine-compatibility" role="doc-backlink">Using the Python wheel tag to determine compatibility</a></h3>
<p>A previous version of this PEP avoided adding a new wheel tag (<code class="docutils literal notranslate"><span class="pre">abi3t</span></code>),
and specified that wheels tagged <code class="docutils literal notranslate"><span class="pre">abi3</span></code> would be compatible with
free-threading if the <em>Python tag</em> is <code class="docutils literal notranslate"><span class="pre">cp315</span></code> or higher.</p>
<p>Such a scheme would work for this PEP, but it cannot express that an extension
is compatible with both GIL-enabled and free-threaded builds
of CPython 3.14 or lower.
Adding a new explicit tag means that <em>if</em> we allow building such wheels in the
future, packaging tools should not need additional changes to support them.
They would be tagged <code class="docutils literal notranslate"><span class="pre">cp314-abi3.abi3t</span></code>.</p>
</section>
<section id="adding-an-abi4-wheel-tag">
<h3><a class="toc-backref" href="#adding-an-abi4-wheel-tag" role="doc-backlink">Adding an <code class="docutils literal notranslate"><span class="pre">abi4</span></code> wheel tag</a></h3>
<p>Instead of <code class="docutils literal notranslate"><span class="pre">abi3t</span></code>, we could “bump the version” and use <code class="docutils literal notranslate"><span class="pre">abi4</span></code> instead
as the wheel ABI tag.
In the wheel tag, the difference is largely cosmetic.</p>
<p>However, one thing this PEP does not propose is changing the <em>filename</em>
tag: extensions will be named with the extensions like <code class="docutils literal notranslate"><span class="pre">.abi3.so</span></code>.
Changing this while keeping compatibility with GIL-enabled builds would be
an unnecessary technical change.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">abi3.abi4</span></code> in wheel tags but only <code class="docutils literal notranslate"><span class="pre">.abi3</span></code> in filenames would
look more inconsistent than <code class="docutils literal notranslate"><span class="pre">abi3.abi3t</span></code> and <code class="docutils literal notranslate"><span class="pre">.abi3</span></code>.</p>
</section>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document is placed in the public domain or under the
CC0-1.0-Universal license, whichever is more permissive.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/peps/pep-0803.rst">https://github.com/python/peps/blob/main/peps/pep-0803.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/peps/pep-0803.rst">2025-09-19 13:35:24 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#terminology">Terminology</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#opaque-pyobject">Opaque PyObject</a><ul>
<li><a class="reference internal" href="#implications">Implications</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-export-hook-pep-793">New Export Hook (PEP 793)</a></li>
<li><a class="reference internal" href="#runtime-abi-checks">Runtime ABI checks</a><ul>
<li><a class="reference internal" href="#check-for-older-abi3">Check for older <code class="docutils literal notranslate"><span class="pre">abi3</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-abi3t-wheel-tag">The <code class="docutils literal notranslate"><span class="pre">abi3t</span></code> wheel tag</a></li>
<li><a class="reference internal" href="#new-api">New API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-and-forwards-compatibility">Backwards and Forwards Compatibility</a><ul>
<li><a class="reference internal" href="#compatibility-overview">Compatibility Overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#add-an-alternative-stable-abi-for-free-threading">Add an alternative stable ABI for free-threading</a></li>
<li><a class="reference internal" href="#shims-for-compatibility-with-cpython-3-14">Shims for compatibility with CPython 3.14</a></li>
<li><a class="reference internal" href="#using-the-python-wheel-tag-to-determine-compatibility">Using the Python wheel tag to determine compatibility</a></li>
<li><a class="reference internal" href="#adding-an-abi4-wheel-tag">Adding an <code class="docutils literal notranslate"><span class="pre">abi4</span></code> wheel tag</a></li>
</ul>
</li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/peps/pep-0803.rst?plain=1">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
    <script src="../_static/sticky_banner.js"></script>
    <script src="https://analytics.python.org/js/script.outbound-links.js"
            data-domain="peps.python.org" defer></script>
</body>
</html>