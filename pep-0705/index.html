
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 705 – TypedDict: Read-only items | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0705/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://peps.python.org/peps.rss">
    <meta property="og:title" content='PEP 705 – TypedDict: Read-only items | peps.python.org'>
    <meta property="og:description" content="PEP 589 defines the structural type TypedDict for dictionaries with a fixed set of keys. As TypedDict is a mutable type, it is difficult to correctly annotate methods which accept read-only parameters in a way that doesn’t prevent valid inputs.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://peps.python.org/pep-0705/">
    <meta property="og:site_name" content="Python Enhancement Proposals (PEPs)">
    <meta property="og:image" content="https://peps.python.org/_static/og-image.png">
    <meta property="og:image:alt" content="Python PEPs">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta name="description" content="PEP 589 defines the structural type TypedDict for dictionaries with a fixed set of keys. As TypedDict is a mutable type, it is difficult to correctly annotate methods which accept read-only parameters in a way that doesn’t prevent valid inputs.">
    <meta name="theme-color" content="#3776ab">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1 data-pagefind-ignore>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 705</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        
        <div id="mobile-search" class="mobile-search-container"></div>
        
        <article data-pagefind-body>
            
            <span data-pagefind-meta="title:PEP 705 – TypedDict: Read-only items" data-pagefind-weight="10" class="visually-hidden">PEP 705 – TypedDict: Read-only items</span>
            <section id="pep-content">
<h1 class="page-title">PEP 705 – TypedDict: Read-only items</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Alice Purcell &lt;alicederyn&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-even">Sponsor<span class="colon">:</span></dt>
<dd class="field-even">Pablo Galindo Salgado &lt;pablogsal&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-odd">Discussions-To<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="https://discuss.python.org/t/pep-705-read-only-typeddict-items/37867">Discourse thread</a></dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><abbr title="Accepted and implementation complete, or no longer active">Final</abbr></dd>
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><abbr title="Normative PEP with a new feature for Python, implementation change for CPython or interoperability standard for the ecosystem">Standards Track</abbr></dd>
<dt class="field-even">Topic<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="../topic/typing/">Typing</a></dd>
<dt class="field-odd">Created<span class="colon">:</span></dt>
<dd class="field-odd">07-Nov-2022</dd>
<dt class="field-even">Python-Version<span class="colon">:</span></dt>
<dd class="field-even">3.13</dd>
<dt class="field-odd">Post-History<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="https://mail.python.org/archives/list/typing-sig&#64;python.org/thread/6FR6RKNUZU4UY6B6RXC2H4IAHKBU3UKV/" title="Typing-SIG thread">30-Sep-2022</a>,
<a class="reference external" href="https://mail.python.org/archives/list/python-dev&#64;python.org/thread/2P26R4VH2ZCNNNOQCBZWEM4RNF35OXOW/" title="Python-Dev thread">02-Nov-2022</a>,
<a class="reference external" href="https://discuss.python.org/t/pep-705-typedmapping/24827" title="Discourse thread">14-Mar-2023</a>,
<a class="reference external" href="https://discuss.python.org/t/pep-705-typeddict-read-only-and-other-keys/36457" title="Discourse thread">17-Oct-2023</a>,
<a class="reference external" href="https://discuss.python.org/t/pep-705-read-only-typeddict-items/37867" title="Discourse thread">04-Nov-2023</a></dd>
<dt class="field-even">Resolution<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="https://discuss.python.org/t/pep-705-read-only-typeddict-items/37867/39">29-Feb-2024</a></dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a><ul>
<li><a class="reference internal" href="#pure-functions">Pure functions</a></li>
<li><a class="reference internal" href="#updating-nested-dicts">Updating nested dicts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#typing-readonly-type-qualifier"><code class="docutils literal notranslate"><span class="pre">typing.ReadOnly</span></code> type qualifier</a></li>
<li><a class="reference internal" href="#alternative-functional-syntax">Alternative functional syntax</a></li>
<li><a class="reference internal" href="#interaction-with-other-special-types">Interaction with other special types</a></li>
<li><a class="reference internal" href="#inheritance">Inheritance</a></li>
<li><a class="reference internal" href="#type-consistency">Type consistency</a></li>
<li><a class="reference internal" href="#update-method">Update method</a></li>
<li><a class="reference internal" href="#keyword-argument-typing">Keyword argument typing</a></li>
<li><a class="reference internal" href="#runtime-behavior">Runtime behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards compatibility</a></li>
<li><a class="reference internal" href="#security-implications">Security implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to teach this</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference implementation</a></li>
<li><a class="reference internal" href="#rejected-alternatives">Rejected alternatives</a><ul>
<li><a class="reference internal" href="#a-typedmapping-protocol-type">A TypedMapping protocol type</a></li>
<li><a class="reference internal" href="#a-higher-order-readonly-type">A higher-order ReadOnly type</a></li>
<li><a class="reference internal" href="#calling-the-type-readonly">Calling the type <code class="docutils literal notranslate"><span class="pre">Readonly</span></code></a></li>
<li><a class="reference internal" href="#reusing-the-final-annotation">Reusing the <code class="docutils literal notranslate"><span class="pre">Final</span></code> annotation</a></li>
<li><a class="reference internal" href="#a-readonly-flag">A readonly flag</a></li>
<li><a class="reference internal" href="#supporting-type-checked-removal-of-read-only-qualifier-via-copy-and-other-methods">Supporting type-checked removal of read-only qualifier via copy and other methods</a></li>
<li><a class="reference internal" href="#preventing-unspecified-keys-in-typeddicts">Preventing unspecified keys in TypedDicts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<div class="pep-banner canonical-typing-spec sticky-banner admonition important">
<p class="admonition-title">Important</p>
<p>This PEP is a historical document: see <a class="reference external" href="https://typing.python.org/en/latest/spec/typeddict.html#readonly" title="(in typing)"><span>readonly</span></a> and
<a class="reference external" href="https://docs.python.org/3.13/library/typing.html#typing.ReadOnly" title="(in Python v3.13)"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.ReadOnly</span></code></a> for up-to-date specs and documentation. Canonical typing specs are maintained at the <a class="reference external" href="https://typing.python.org/en/latest/spec/">typing specs site</a>; runtime typing behaviour is described in the CPython documentation.</p>
<p class="close-button">×</p>
<p>See the <a class="reference external" href="https://typing.python.org/en/latest/spec/meta.html">typing specification update process</a> for how to propose changes to the typing spec.</p>
</div>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p><a class="pep reference internal" href="../pep-0589/" title="PEP 589 – TypedDict: Type Hints for Dictionaries with a Fixed Set of Keys">PEP 589</a> defines the structural type <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.TypedDict" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypedDict</span></code></a> for dictionaries with a fixed set of keys.
As <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> is a mutable type, it is difficult to correctly annotate methods which accept read-only parameters in a way that doesn’t prevent valid inputs.</p>
<p>This PEP proposes a new type qualifier, <code class="docutils literal notranslate"><span class="pre">typing.ReadOnly</span></code>, to support these usages. It makes no Python grammar changes. Correct usage of read-only keys of TypedDicts is intended to be enforced only by static type checkers, and will not be enforced by Python itself at runtime.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation" role="doc-backlink">Motivation</a></h2>
<p>Representing structured data using (potentially nested) dictionaries with string keys is a common pattern in Python programs. <a class="pep reference internal" href="../pep-0589/" title="PEP 589 – TypedDict: Type Hints for Dictionaries with a Fixed Set of Keys">PEP 589</a> allows these values to be type checked when the exact type is known up-front, but it is hard to write read-only code that accepts more specific variants: for instance, where values may be subtypes or restrict a union of possible types. This is an especially common issue when writing APIs for services, which may support a wide range of input structures, and typically do not need to modify their input.</p>
<section id="pure-functions">
<h3><a class="toc-backref" href="#pure-functions" role="doc-backlink">Pure functions</a></h3>
<p>Consider trying to add type hints to a function <code class="docutils literal notranslate"><span class="pre">movie_string</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">movie_string</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span> <span class="n">Movie</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">movie</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">movie</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">movie</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">movie</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span>
</pre></div>
</div>
<p>We could define this <code class="docutils literal notranslate"><span class="pre">Movie</span></code> type using a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NotRequired</span><span class="p">,</span> <span class="n">TypedDict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Movie</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
</pre></div>
</div>
<p>But suppose we have another type where year is required:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MovieRecord</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>Attempting to pass a <code class="docutils literal notranslate"><span class="pre">MovieRecord</span></code> into <code class="docutils literal notranslate"><span class="pre">movie_string</span></code> results in the error (using mypy):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Argument 1 to &quot;movie_string&quot; has incompatible type &quot;MovieRecord&quot;; expected &quot;Movie&quot;
</pre></div>
</div>
<p>This particular use case should be type-safe, but the type checker correctly stops the
user from passing a <code class="docutils literal notranslate"><span class="pre">MovieRecord</span></code> into a <code class="docutils literal notranslate"><span class="pre">Movie</span></code> parameter in the general case, because
the <code class="docutils literal notranslate"><span class="pre">Movie</span></code> class has mutator methods that could potentially allow the function to break
the type constraints in <code class="docutils literal notranslate"><span class="pre">MovieRecord</span></code> (e.g. with <code class="docutils literal notranslate"><span class="pre">movie[&quot;year&quot;]</span> <span class="pre">=</span> <span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">movie[&quot;year&quot;]</span></code>).
The problem disappears if we don’t have mutator methods in <code class="docutils literal notranslate"><span class="pre">Movie</span></code>. This could be achieved by defining an immutable interface using a <a class="pep reference internal" href="../pep-0544/" title="PEP 544 – Protocols: Structural subtyping (static duck typing)">PEP 544</a> <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Protocol" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Protocol</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">overload</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Movie</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="nd">@overload</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
<p>This is very repetitive, easy to get wrong, and is still missing important method definitions like <code class="docutils literal notranslate"><span class="pre">__contains__()</span></code> and <code class="docutils literal notranslate"><span class="pre">keys()</span></code>.</p>
</section>
<section id="updating-nested-dicts">
<h3><a class="toc-backref" href="#updating-nested-dicts" role="doc-backlink">Updating nested dicts</a></h3>
<p>The structural typing of <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> is supposed to permit writing update functions that only constrain the types of items they modify:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">HasTimestamp</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Logs</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">loglines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">update_timestamp</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">HasTimestamp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">add_logline</span><span class="p">(</span><span class="n">logs</span><span class="p">:</span> <span class="n">Logs</span><span class="p">,</span> <span class="n">logline</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">logs</span><span class="p">[</span><span class="s2">&quot;loglines&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">logline</span><span class="p">)</span>
    <span class="n">update_timestamp</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span>  <span class="c1"># Accepted by type checker</span>
</pre></div>
</div>
<p>However, this no longer works once you start nesting dictionaries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">HasTimestampedMetadata</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">HasTimestamp</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserAudit</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Logs</span>

<span class="k">def</span><span class="w"> </span><span class="nf">update_metadata_timestamp</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">HasTimestampedMetadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">rename_user</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">UserAudit</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">update_metadata_timestamp</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>  <span class="c1"># Type check error: &quot;metadata&quot; is not of type HasTimestamp</span>
</pre></div>
</div>
<p>This looks like an error, but is simply due to the (unwanted) ability to overwrite the <code class="docutils literal notranslate"><span class="pre">metadata</span></code> item held by the <code class="docutils literal notranslate"><span class="pre">HasTimestampedMetadata</span></code> instance with a different <code class="docutils literal notranslate"><span class="pre">HasTimestamp</span></code> instance, that may no longer be a <code class="docutils literal notranslate"><span class="pre">Logs</span></code> instance.</p>
<p>It is possible to work around this issue with generics (as of Python 3.11), but it is very complicated, requiring a type parameter for every nested dict.</p>
</section>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale" role="doc-backlink">Rationale</a></h2>
<p>These problems can be resolved by removing the ability to update one or more of the items in a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>. This does not mean the items are immutable: a reference to the underlying dictionary could still exist with a different but compatible type in which those items have mutator operations. These items are “read-only”, and we introduce a new <code class="docutils literal notranslate"><span class="pre">typing.ReadOnly</span></code> type qualifier for this purpose.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">movie_string</span></code> function in the first motivating example can then be typed as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NotRequired</span><span class="p">,</span> <span class="n">ReadOnly</span><span class="p">,</span> <span class="n">TypedDict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Movie</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="n">NotRequired</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">movie_string</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span> <span class="n">Movie</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">movie</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">movie</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">movie</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">movie</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span>
</pre></div>
</div>
<p>A mixture of read-only and non-read-only items is permitted, allowing the second motivating example to be correctly annotated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">HasTimestamp</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>

<span class="k">class</span><span class="w"> </span><span class="nc">HasTimestampedMetadata</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="n">HasTimestamp</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">update_metadata_timestamp</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">HasTimestampedMetadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Logs</span><span class="p">(</span><span class="n">HasTimestamp</span><span class="p">):</span>
    <span class="n">loglines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserAudit</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Logs</span>

<span class="k">def</span><span class="w"> </span><span class="nf">rename_user</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">UserAudit</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">update_metadata_timestamp</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>  <span class="c1"># Now OK</span>
</pre></div>
</div>
<p>In addition to these benefits, by flagging arguments of a function as read-only (by using a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> like <code class="docutils literal notranslate"><span class="pre">Movie</span></code> with read-only items), it makes explicit not just to typecheckers but also to users that the function is not going to modify its inputs, which is usually a desirable property of a function interface.</p>
<p>This PEP proposes making <code class="docutils literal notranslate"><span class="pre">ReadOnly</span></code> valid only in a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>. A possible future extension would be to support it in additional contexts, such as in protocols.</p>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification" role="doc-backlink">Specification</a></h2>
<p>A new <code class="docutils literal notranslate"><span class="pre">typing.ReadOnly</span></code> type qualifier is added.</p>
<section id="typing-readonly-type-qualifier">
<h3><a class="toc-backref" href="#typing-readonly-type-qualifier" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">typing.ReadOnly</span></code> type qualifier</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">typing.ReadOnly</span></code> type qualifier is used to indicate that an item declared in a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> definition may not be mutated (added, modified, or removed):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReadOnly</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Band</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">members</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>

<span class="n">blur</span><span class="p">:</span> <span class="n">Band</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;blur&quot;</span><span class="p">,</span> <span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[]}</span>
<span class="n">blur</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Blur&quot;</span>  <span class="c1"># OK: &quot;name&quot; is not read-only</span>
<span class="n">blur</span><span class="p">[</span><span class="s2">&quot;members&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Damon Albarn&quot;</span><span class="p">]</span>  <span class="c1"># Type check error: &quot;members&quot; is read-only</span>
<span class="n">blur</span><span class="p">[</span><span class="s2">&quot;members&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Damon Albarn&quot;</span><span class="p">)</span>  <span class="c1"># OK: list is mutable</span>
</pre></div>
</div>
</section>
<section id="alternative-functional-syntax">
<h3><a class="toc-backref" href="#alternative-functional-syntax" role="doc-backlink">Alternative functional syntax</a></h3>
<p>The <a class="pep reference internal" href="../pep-0589/#alternative-syntax" title="PEP 589 – TypedDict: Type Hints for Dictionaries with a Fixed Set of Keys § Alternative Syntax">alternative functional syntax</a> for TypedDict also supports the new type qualifier:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Band</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s2">&quot;Band&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]})</span>
</pre></div>
</div>
</section>
<section id="interaction-with-other-special-types">
<h3><a class="toc-backref" href="#interaction-with-other-special-types" role="doc-backlink">Interaction with other special types</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ReadOnly[]</span></code> can be used with <code class="docutils literal notranslate"><span class="pre">Required[]</span></code>, <code class="docutils literal notranslate"><span class="pre">NotRequired[]</span></code> and <code class="docutils literal notranslate"><span class="pre">Annotated[]</span></code>, in any nesting order:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Movie</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="n">Required</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>  <span class="c1"># OK</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="n">NotRequired</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="mi">9999</span><span class="p">)]]]</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Movie</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="n">ReadOnly</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>  <span class="c1"># OK</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">NotRequired</span><span class="p">[</span><span class="n">ReadOnly</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">ValueRange</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="mi">9999</span><span class="p">)]</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<p>This is consistent with the behavior introduced in <a class="pep reference internal" href="../pep-0655/" title="PEP 655 – Marking individual TypedDict items as required or potentially-missing">PEP 655</a>.</p>
</section>
<section id="inheritance">
<h3><a class="toc-backref" href="#inheritance" role="doc-backlink">Inheritance</a></h3>
<p>Subclasses can redeclare read-only items as non-read-only, allowing them to be mutated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NamedDict</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Album</span><span class="p">(</span><span class="n">NamedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">album</span><span class="p">:</span> <span class="n">Album</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Flood&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1990</span> <span class="p">}</span>
<span class="n">album</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1973</span>
<span class="n">album</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Dark Side Of The Moon&quot;</span>  <span class="c1"># OK: &quot;name&quot; is not read-only in Album</span>
</pre></div>
</div>
<p>If a read-only item is not redeclared, it remains read-only:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Album</span><span class="p">(</span><span class="n">NamedDict</span><span class="p">):</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">album</span><span class="p">:</span> <span class="n">Album</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Flood&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1990</span> <span class="p">}</span>
<span class="n">album</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Dark Side Of The Moon&quot;</span>  <span class="c1"># Type check error: &quot;name&quot; is read-only in Album</span>
</pre></div>
</div>
<p>Subclasses can narrow value types of read-only items:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AlbumCollection</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">albums</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="n">Album</span><span class="p">]]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RecordShop</span><span class="p">(</span><span class="n">AlbumCollection</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">albums</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Album</span><span class="p">]]</span>  <span class="c1"># OK: &quot;albums&quot; is read-only in AlbumCollection</span>
</pre></div>
</div>
<p>Subclasses can require items that are read-only but not required in the superclass:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OptionalName</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RequiredName</span><span class="p">(</span><span class="n">OptionalName</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="n">Required</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>

<span class="n">d</span><span class="p">:</span> <span class="n">RequiredName</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Type check error: &quot;name&quot; required</span>
</pre></div>
</div>
<p>Subclasses can combine these rules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OptionalIdent</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">ident</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">OptionalIdent</span><span class="p">):</span>
    <span class="n">ident</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Required, mutable, and not an int</span>
</pre></div>
</div>
<p>Note that these are just consequences of structural typing, but they are highlighted here as the behavior now differs from the rules specified in <a class="pep reference internal" href="../pep-0589/" title="PEP 589 – TypedDict: Type Hints for Dictionaries with a Fixed Set of Keys">PEP 589</a>.</p>
</section>
<section id="type-consistency">
<h3><a class="toc-backref" href="#type-consistency" role="doc-backlink">Type consistency</a></h3>
<p><em>This section updates the type consistency rules introduced in</em> <a class="pep reference internal" href="../pep-0589/" title="PEP 589 – TypedDict: Type Hints for Dictionaries with a Fixed Set of Keys">PEP 589</a> <em>to cover the new feature in this PEP. In particular, any pair of types that do not use the new feature will be consistent under these new rules if (and only if) they were already consistent.</em></p>
<p>A TypedDict type <code class="docutils literal notranslate"><span class="pre">A</span></code> is consistent with TypedDict <code class="docutils literal notranslate"><span class="pre">B</span></code> if <code class="docutils literal notranslate"><span class="pre">A</span></code> is structurally compatible with <code class="docutils literal notranslate"><span class="pre">B</span></code>. This is true if and only if all of the following are satisfied:</p>
<ul class="simple">
<li>For each item in <code class="docutils literal notranslate"><span class="pre">B</span></code>, <code class="docutils literal notranslate"><span class="pre">A</span></code> has the corresponding key, unless the item in <code class="docutils literal notranslate"><span class="pre">B</span></code> is read-only, not required, and of top value type (<code class="docutils literal notranslate"><span class="pre">ReadOnly[NotRequired[object]]</span></code>).</li>
<li>For each item in <code class="docutils literal notranslate"><span class="pre">B</span></code>, if <code class="docutils literal notranslate"><span class="pre">A</span></code> has the corresponding key, the corresponding value type in <code class="docutils literal notranslate"><span class="pre">A</span></code> is consistent with the value type in <code class="docutils literal notranslate"><span class="pre">B</span></code>.</li>
<li>For each non-read-only item in <code class="docutils literal notranslate"><span class="pre">B</span></code>, its value type is consistent with the corresponding value type in <code class="docutils literal notranslate"><span class="pre">A</span></code>.</li>
<li>For each required key in <code class="docutils literal notranslate"><span class="pre">B</span></code>, the corresponding key is required in <code class="docutils literal notranslate"><span class="pre">A</span></code>.</li>
<li>For each non-required key in <code class="docutils literal notranslate"><span class="pre">B</span></code>, if the item is not read-only in <code class="docutils literal notranslate"><span class="pre">B</span></code>, the corresponding key is not required in <code class="docutils literal notranslate"><span class="pre">A</span></code>.</li>
</ul>
<p>Discussion:</p>
<ul>
<li>All non-specified items in a TypedDict implicitly have value type <code class="docutils literal notranslate"><span class="pre">ReadOnly[NotRequired[object]]</span></code>.</li>
<li>Read-only items behave covariantly, as they cannot be mutated. This is similar to container types such as <code class="docutils literal notranslate"><span class="pre">Sequence</span></code>, and different from non-read-only items, which behave invariantly. Example:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">b</span><span class="p">:</span> <span class="n">B</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># Accepted by type checker</span>
</pre></div>
</div>
</li>
<li>A TypedDict type <code class="docutils literal notranslate"><span class="pre">A</span></code> with no explicit key <code class="docutils literal notranslate"><span class="pre">'x'</span></code> is not consistent with a TypedDict type <code class="docutils literal notranslate"><span class="pre">B</span></code> with a non-required key <code class="docutils literal notranslate"><span class="pre">'x'</span></code>, since at runtime the key <code class="docutils literal notranslate"><span class="pre">'x'</span></code> could be present and have an incompatible type (which may not be visible through <code class="docutils literal notranslate"><span class="pre">A</span></code> due to structural subtyping). The only exception to this rule is if the item in <code class="docutils literal notranslate"><span class="pre">B</span></code> is read-only, and the value type is of top type (<code class="docutils literal notranslate"><span class="pre">object</span></code>). For example:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="n">NotRequired</span><span class="p">[</span><span class="nb">object</span><span class="p">]]</span>

<span class="n">a</span><span class="p">:</span> <span class="n">A</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="n">b</span><span class="p">:</span> <span class="n">B</span> <span class="o">=</span> <span class="n">a</span>  <span class="c1"># Accepted by type checker</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="update-method">
<h3><a class="toc-backref" href="#update-method" role="doc-backlink">Update method</a></h3>
<p>In addition to existing type checking rules, type checkers should error if a TypedDict with a read-only item is updated with another TypedDict that declares that key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">a1</span><span class="p">:</span> <span class="n">A</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="p">}</span>
<span class="n">a2</span><span class="p">:</span> <span class="n">A</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">4</span> <span class="p">}</span>
<span class="n">a1</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>  <span class="c1"># Type check error: &quot;x&quot; is read-only in A</span>
</pre></div>
</div>
<p>Unless the declared value is of bottom type (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Never" title="(in Python v3.14)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Never</span></code></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Never</span><span class="p">]</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">update_a</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">a</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># Accepted by type checker: &quot;x&quot; cannot be set on b</span>
</pre></div>
</div>
<p>Note: Nothing will ever match the <code class="docutils literal notranslate"><span class="pre">Never</span></code> type, so an item annotated with it must be absent.</p>
</section>
<section id="keyword-argument-typing">
<h3><a class="toc-backref" href="#keyword-argument-typing" role="doc-backlink">Keyword argument typing</a></h3>
<p><a class="pep reference internal" href="../pep-0692/" title="PEP 692 – Using TypedDict for more precise **kwargs typing">PEP 692</a> introduced <code class="docutils literal notranslate"><span class="pre">Unpack</span></code> to annotate <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> with a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>. Marking one or more of the items of a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> used in this way as read-only will have no effect on the type signature of the method. However, it <em>will</em> prevent the item from being modified in the body of the function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Args</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">key1</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">key2</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ReadOnlyArgs</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">key1</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">key2</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Function</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">Args</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">impl</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">ReadOnlyArgs</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;key1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Type check error: key1 is readonly</span>

<span class="n">fn</span><span class="p">:</span> <span class="n">Function</span> <span class="o">=</span> <span class="n">impl</span>  <span class="c1"># Accepted by type checker: function signatures are identical</span>
</pre></div>
</div>
</section>
<section id="runtime-behavior">
<h3><a class="toc-backref" href="#runtime-behavior" role="doc-backlink">Runtime behavior</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> types will gain two new attributes, <code class="docutils literal notranslate"><span class="pre">__readonly_keys__</span></code> and <code class="docutils literal notranslate"><span class="pre">__mutable_keys__</span></code>, which will be frozensets containing all read-only and non-read-only keys, respectively:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Example</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">c</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">d</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">Example</span><span class="o">.</span><span class="n">__readonly_keys__</span> <span class="o">==</span> <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">Example</span><span class="o">.</span><span class="n">__mutable_keys__</span> <span class="o">==</span> <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">typing.get_type_hints</span></code> will strip out any <code class="docutils literal notranslate"><span class="pre">ReadOnly</span></code> type qualifiers, unless <code class="docutils literal notranslate"><span class="pre">include_extras</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">get_type_hints</span><span class="p">(</span><span class="n">Example</span><span class="p">)[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span>
<span class="k">assert</span> <span class="n">get_type_hints</span><span class="p">(</span><span class="n">Example</span><span class="p">,</span> <span class="n">include_extras</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">typing.get_origin</span></code> and <code class="docutils literal notranslate"><span class="pre">typing.get_args</span></code> will be updated to recognize <code class="docutils literal notranslate"><span class="pre">ReadOnly</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">get_origin</span><span class="p">(</span><span class="n">ReadOnly</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="ow">is</span> <span class="n">ReadOnly</span>
<span class="k">assert</span> <span class="n">get_args</span><span class="p">(</span><span class="n">ReadOnly</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">==</span> <span class="p">(</span><span class="nb">int</span><span class="p">,)</span>
</pre></div>
</div>
</section>
</section>
<section id="backwards-compatibility">
<h2><a class="toc-backref" href="#backwards-compatibility" role="doc-backlink">Backwards compatibility</a></h2>
<p>This PEP adds a new feature to <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>, so code that inspects <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> types will have to change to support types using it. This is expected to mainly affect type-checkers.</p>
</section>
<section id="security-implications">
<h2><a class="toc-backref" href="#security-implications" role="doc-backlink">Security implications</a></h2>
<p>There are no known security consequences arising from this PEP.</p>
</section>
<section id="how-to-teach-this">
<h2><a class="toc-backref" href="#how-to-teach-this" role="doc-backlink">How to teach this</a></h2>
<p>Suggested changes to the <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> module documentation, in line with current practice:</p>
<ul class="simple">
<li>Add this PEP to the others listed.</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">typing.ReadOnly</span></code>, linked to TypedDict and this PEP.</li>
<li>Add the following text to the TypedDict entry:</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">ReadOnly</span></code> type qualifier indicates that an item declared in a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> definition may be read but not mutated (added, modified or removed). This is useful when the exact type of the value is not known yet, and so modifying it would break structural subtypes. <em>insert example</em></p>
</section>
<section id="reference-implementation">
<h2><a class="toc-backref" href="#reference-implementation" role="doc-backlink">Reference implementation</a></h2>
<p><a class="reference external" href="https://github.com/microsoft/pyright/releases/tag/1.1.333">pyright 1.1.333 fully implements this proposal</a>.</p>
</section>
<section id="rejected-alternatives">
<h2><a class="toc-backref" href="#rejected-alternatives" role="doc-backlink">Rejected alternatives</a></h2>
<section id="a-typedmapping-protocol-type">
<h3><a class="toc-backref" href="#a-typedmapping-protocol-type" role="doc-backlink">A TypedMapping protocol type</a></h3>
<p>An earlier version of this PEP proposed a <code class="docutils literal notranslate"><span class="pre">TypedMapping</span></code> protocol type, behaving much like a read-only TypedDict but without the constraint that the runtime type be a <code class="docutils literal notranslate"><span class="pre">dict</span></code>. The behavior described in the current version of this PEP could then be obtained by inheriting a TypedDict from a TypedMapping. This has been set aside for now as more complex, without a strong use-case motivating the additional complexity.</p>
</section>
<section id="a-higher-order-readonly-type">
<h3><a class="toc-backref" href="#a-higher-order-readonly-type" role="doc-backlink">A higher-order ReadOnly type</a></h3>
<p>A generalized higher-order type could be added that removes mutator methods from its parameter, e.g. <code class="docutils literal notranslate"><span class="pre">ReadOnly[MovieRecord]</span></code>. For a TypedDict, this would be like adding <code class="docutils literal notranslate"><span class="pre">ReadOnly</span></code> to every item, including those declared in superclasses. This would naturally want to be defined for a wider set of types than just TypedDict subclasses, and also raises questions about whether and how it applies to nested types. We decided to keep the scope of this PEP narrower.</p>
</section>
<section id="calling-the-type-readonly">
<h3><a class="toc-backref" href="#calling-the-type-readonly" role="doc-backlink">Calling the type <code class="docutils literal notranslate"><span class="pre">Readonly</span></code></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Read-only</span></code> is generally hyphenated, and it appears to be common convention to put initial caps onto words separated by a dash when converting to CamelCase. This appears consistent with the definition of CamelCase on Wikipedia: CamelCase uppercases the first letter of each word. That said, Python examples or counter-examples, ideally from the core Python libraries, or better explicit guidance on the convention, would be greatly appreciated.</p>
</section>
<section id="reusing-the-final-annotation">
<h3><a class="toc-backref" href="#reusing-the-final-annotation" role="doc-backlink">Reusing the <code class="docutils literal notranslate"><span class="pre">Final</span></code> annotation</a></h3>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Final</span></code> annotation prevents an attribute from being modified, like the proposed <code class="docutils literal notranslate"><span class="pre">ReadOnly</span></code> qualifier does for <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> items. However, it is also documented as preventing redefinition in subclasses too; from <a class="pep reference internal" href="../pep-0591/" title="PEP 591 – Adding a final qualifier to typing">PEP 591</a>:</p>
<blockquote>
<div>The <code class="docutils literal notranslate"><span class="pre">typing.Final</span></code> type qualifier is used to indicate that a variable or attribute should not be reassigned, redefined, or overridden.</div></blockquote>
<p>This does not fit with the intended use of <code class="docutils literal notranslate"><span class="pre">ReadOnly</span></code>. Rather than introduce confusion by having <code class="docutils literal notranslate"><span class="pre">Final</span></code> behave differently in different contexts, we chose to introduce a new qualifier.</p>
</section>
<section id="a-readonly-flag">
<h3><a class="toc-backref" href="#a-readonly-flag" role="doc-backlink">A readonly flag</a></h3>
<p>Earlier versions of this PEP introduced a boolean flag that would ensure all items in a TypedDict were read-only:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Movie</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>

<span class="n">movie</span><span class="p">:</span> <span class="n">Movie</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;A Clockwork Orange&quot;</span> <span class="p">}</span>
<span class="n">movie</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1971</span>  <span class="c1"># Type check error: &quot;year&quot; is read-only</span>
</pre></div>
</div>
<p>However, this led to confusion when inheritance was introduced:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">key1</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">TypedDict</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">key2</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">b</span><span class="p">:</span> <span class="n">B</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="p">}</span>
<span class="n">b</span><span class="p">[</span><span class="s2">&quot;key1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Accepted by type checker: &quot;key1&quot; is not read-only</span>
</pre></div>
</div>
<p>It would be reasonable for someone familiar with <code class="docutils literal notranslate"><span class="pre">frozen</span></code> (from <a class="reference external" href="https://docs.python.org/3/library/dataclasses.html#module-dataclasses" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">dataclasses</span></code></a>), on seeing just the definition of B, to assume that the whole type was read-only. On the other hand, it would be reasonable for someone familiar with <code class="docutils literal notranslate"><span class="pre">total</span></code> to assume that read-only only applies to the current type.</p>
<p>The original proposal attempted to eliminate this ambiguity by making it both a type check and a runtime error to define <code class="docutils literal notranslate"><span class="pre">B</span></code> in this way. This was still a source of surprise to people expecting it to work like <code class="docutils literal notranslate"><span class="pre">total</span></code>.</p>
<p>Given that no extra types could be expressed with the <code class="docutils literal notranslate"><span class="pre">readonly</span></code> flag, it has been removed from the proposal to avoid ambiguity and surprise.</p>
</section>
<section id="supporting-type-checked-removal-of-read-only-qualifier-via-copy-and-other-methods">
<h3><a class="toc-backref" href="#supporting-type-checked-removal-of-read-only-qualifier-via-copy-and-other-methods" role="doc-backlink">Supporting type-checked removal of read-only qualifier via copy and other methods</a></h3>
<p>An earlier version of this PEP mandated that code like the following be supported by type-checkers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">C</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span>

<span class="k">def</span><span class="w"> </span><span class="nf">copy_and_modify</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">:</span>
    <span class="n">c</span><span class="p">:</span> <span class="n">C</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]:</span>
        <span class="n">c</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>
    <span class="k">return</span> <span class="n">c</span>

<span class="k">def</span><span class="w"> </span><span class="nf">merge_and_modify</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">:</span>
    <span class="n">c</span><span class="p">:</span> <span class="n">C</span> <span class="o">=</span> <span class="n">a</span> <span class="o">|</span> <span class="n">b</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]:</span>
        <span class="n">c</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>
    <span class="k">return</span> <span class="n">c</span>
</pre></div>
</div>
<p>However, there is currently no way to express this in the typeshed, meaning type-checkers would be forced to special-case these functions. There is already a way to code these operations that mypy and pyright do support, though arguably this is less readable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">copied</span><span class="p">:</span> <span class="n">C</span> <span class="o">=</span> <span class="p">{</span> <span class="o">**</span><span class="n">a</span> <span class="p">}</span>
<span class="n">merged</span><span class="p">:</span> <span class="n">C</span> <span class="o">=</span> <span class="p">{</span> <span class="o">**</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">b</span> <span class="p">}</span>
</pre></div>
</div>
<p>While not as flexible as would be ideal, the current typeshed stubs are sound, and remain so if this PEP is accepted. Updating the typeshed would require new typing features, like a type constructor to express the type resulting from merging two or more dicts, and a type qualifier to indicate a returned value is not shared (so may have type constraints like read-only and invariance of generics loosened in specific ways), plus details of how type-checkers would be expected to interpret these features. These could be valuable additions to the language, but are outside the scope of this PEP.</p>
<p>Given this, we have deferred any update of the typeshed stubs.</p>
</section>
<section id="preventing-unspecified-keys-in-typeddicts">
<h3><a class="toc-backref" href="#preventing-unspecified-keys-in-typeddicts" role="doc-backlink">Preventing unspecified keys in TypedDicts</a></h3>
<p>Consider the following “type discrimination” code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
  <span class="n">foo</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
  <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_field</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">A</span> <span class="o">|</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
  <span class="k">if</span> <span class="s2">&quot;foo&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]</span>  <span class="c1"># !!!</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>This is a common idiom, and other languages like Typescript allow it. Technically, however, this code is unsound: <code class="docutils literal notranslate"><span class="pre">B</span></code> does not declare <code class="docutils literal notranslate"><span class="pre">foo</span></code>, but instances of <code class="docutils literal notranslate"><span class="pre">B</span></code> may still have the key present, and the associated value may be of any type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">C</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
  <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span>
  <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">c</span><span class="p">:</span> <span class="n">C</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;hi&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span> <span class="mi">3</span> <span class="p">}</span>
<span class="n">b</span><span class="p">:</span> <span class="n">B</span> <span class="o">=</span> <span class="n">c</span>  <span class="c1"># OK: C is structurally compatible with B</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">get_field</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># Returns a string at runtime, not an int!</span>
</pre></div>
</div>
<p>mypy rejects the definition of <code class="docutils literal notranslate"><span class="pre">get_field</span></code> on the marked line with the error <code class="docutils literal notranslate"><span class="pre">TypedDict</span> <span class="pre">&quot;B&quot;</span> <span class="pre">has</span> <span class="pre">no</span> <span class="pre">key</span> <span class="pre">&quot;foo&quot;</span></code>, which is a rather confusing error message, but is caused by this unsoundness.</p>
<p>One option for correcting this would be to explicitly prevent <code class="docutils literal notranslate"><span class="pre">B</span></code> from holding a <code class="docutils literal notranslate"><span class="pre">foo</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
  <span class="n">foo</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="n">Never</span><span class="p">]</span>
  <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">b</span><span class="p">:</span> <span class="n">B</span> <span class="o">=</span> <span class="n">c</span>  <span class="c1"># Type check error: key &quot;foo&quot; not allowed in B</span>
</pre></div>
</div>
<p>However, this requires every possible key that might be used to discriminate on to be explicitly declared in every type, which is not generally feasible. A better option would be to have a way of preventing all unspecified keys from being included in <code class="docutils literal notranslate"><span class="pre">B</span></code>. mypy supports this using the <code class="docutils literal notranslate"><span class="pre">&#64;final</span></code> decorator from <a class="pep reference internal" href="../pep-0591/" title="PEP 591 – Adding a final qualifier to typing">PEP 591</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@final</span>
<span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
  <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>The reasoning here is that this prevents <code class="docutils literal notranslate"><span class="pre">C</span></code> or any other type from being considered a “subclass” of <code class="docutils literal notranslate"><span class="pre">B</span></code>, so instances of <code class="docutils literal notranslate"><span class="pre">B</span></code> can now be relied on to never hold the key <code class="docutils literal notranslate"><span class="pre">foo</span></code>, even though it is not explicitly declared to be of bottom type.</p>
<p>With the introduction of read-only items, however, this reasoning would imply type-checkers should ban the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@final</span>
<span class="k">class</span><span class="w"> </span><span class="nc">D</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
  <span class="n">field</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>

<span class="nd">@final</span>
<span class="k">class</span><span class="w"> </span><span class="nc">E</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
  <span class="n">field</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="n">e</span><span class="p">:</span> <span class="n">E</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="s2">&quot;value2&quot;</span><span class="p">]</span> <span class="p">}</span>
<span class="n">d</span><span class="p">:</span> <span class="n">D</span> <span class="o">=</span> <span class="n">e</span>  <span class="c1"># Error?</span>
</pre></div>
</div>
<p>The conceptual problem here is that TypedDicts are structural types: they cannot really be subclassed. As such, using <code class="docutils literal notranslate"><span class="pre">&#64;final</span></code> on them is not well-defined; it is certainly not mentioned in <a class="pep reference internal" href="../pep-0591/" title="PEP 591 – Adding a final qualifier to typing">PEP 591</a>.</p>
<p>An earlier version of this PEP proposed resolving this by adding a new flag to <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> that would explicitly prevent other keys from being used, but not other kinds of structural compatibility:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">,</span> <span class="n">other_keys</span><span class="o">=</span><span class="n">Never</span><span class="p">):</span>
  <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">b</span><span class="p">:</span> <span class="n">B</span> <span class="o">=</span> <span class="n">c</span>  <span class="c1"># Type check error: key &quot;foo&quot; not allowed in B</span>
</pre></div>
</div>
<p>However, during the process of drafting, the situation changed:</p>
<ul class="simple">
<li>pyright, which previously worked similarly to mypy in this type discrimination case, <a class="reference external" href="https://github.com/microsoft/pyright/commit/6a25a7bf0b5cb3721a06d0e0d6245b2ebfbf053b">changed to allow the original example without error</a>, despite the unsoundness, due to it being a common idiom</li>
<li>mypy has <a class="reference external" href="https://github.com/python/mypy/issues/15697">an open issue</a> to follow the lead of pyright and Typescript and permit the idiom as well</li>
<li>a <a class="reference external" href="https://github.com/python/peps/pull/3441">draft of PEP-728</a> was created that is a superset of the <code class="docutils literal notranslate"><span class="pre">other_keys</span></code> functionality</li>
</ul>
<p>As such, there is less urgency to address this issue in this PEP, and it has been deferred to PEP-728.</p>
</section>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document is placed in the public domain or under the
CC0-1.0-Universal license, whichever is more permissive.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/peps/pep-0705.rst">https://github.com/python/peps/blob/main/peps/pep-0705.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/peps/pep-0705.rst">2025-11-07 04:32:09 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <div id="search"></div>
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a><ul>
<li><a class="reference internal" href="#pure-functions">Pure functions</a></li>
<li><a class="reference internal" href="#updating-nested-dicts">Updating nested dicts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#typing-readonly-type-qualifier"><code class="docutils literal notranslate"><span class="pre">typing.ReadOnly</span></code> type qualifier</a></li>
<li><a class="reference internal" href="#alternative-functional-syntax">Alternative functional syntax</a></li>
<li><a class="reference internal" href="#interaction-with-other-special-types">Interaction with other special types</a></li>
<li><a class="reference internal" href="#inheritance">Inheritance</a></li>
<li><a class="reference internal" href="#type-consistency">Type consistency</a></li>
<li><a class="reference internal" href="#update-method">Update method</a></li>
<li><a class="reference internal" href="#keyword-argument-typing">Keyword argument typing</a></li>
<li><a class="reference internal" href="#runtime-behavior">Runtime behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards compatibility</a></li>
<li><a class="reference internal" href="#security-implications">Security implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to teach this</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference implementation</a></li>
<li><a class="reference internal" href="#rejected-alternatives">Rejected alternatives</a><ul>
<li><a class="reference internal" href="#a-typedmapping-protocol-type">A TypedMapping protocol type</a></li>
<li><a class="reference internal" href="#a-higher-order-readonly-type">A higher-order ReadOnly type</a></li>
<li><a class="reference internal" href="#calling-the-type-readonly">Calling the type <code class="docutils literal notranslate"><span class="pre">Readonly</span></code></a></li>
<li><a class="reference internal" href="#reusing-the-final-annotation">Reusing the <code class="docutils literal notranslate"><span class="pre">Final</span></code> annotation</a></li>
<li><a class="reference internal" href="#a-readonly-flag">A readonly flag</a></li>
<li><a class="reference internal" href="#supporting-type-checked-removal-of-read-only-qualifier-via-copy-and-other-methods">Supporting type-checked removal of read-only qualifier via copy and other methods</a></li>
<li><a class="reference internal" href="#preventing-unspecified-keys-in-typeddicts">Preventing unspecified keys in TypedDicts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/peps/pep-0705.rst?plain=1">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
    <script src="../_static/sticky_banner.js"></script>
    <script src="https://analytics.python.org/js/script.outbound-links.js"
            data-domain="peps.python.org" defer></script>
    <script src="/pagefind/pagefind-ui.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            // Ranking configuration to boost exact title matches
            const searchOptions = {
                ranking: {
                    termSimilarity: 9.0, // Higher values favor exact matches
                    termFrequency: 0.5, // Lower values reduce penalty for low term frequency
                    pageLength: 0.2, // Lower values reduce the impact of page length
                }
            };

            // Initialize pagefind for either mobile or desktop, not both
            if (window.innerWidth <= 640) {
                new PagefindUI({ element: "#mobile-search", ...searchOptions, showSubResults: false });
            } else {
                new PagefindUI({ element: "#search", ...searchOptions, showSubResults: true });
            }
        });
    </script>
</body>
</html>