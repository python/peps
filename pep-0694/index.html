
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 694 – Upload 2.0 API for Python Package Indexes | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0694/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://peps.python.org/peps.rss">
    <meta property="og:title" content='PEP 694 – Upload 2.0 API for Python Package Indexes | peps.python.org'>
    <meta property="og:description" content="This PEP proposes an extensible API for uploading files to a Python package index such as PyPI. Along with standardization, the upload API provides additional useful features such as support for:">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://peps.python.org/pep-0694/">
    <meta property="og:site_name" content="Python Enhancement Proposals (PEPs)">
    <meta property="og:image" content="https://peps.python.org/_static/og-image.png">
    <meta property="og:image:alt" content="Python PEPs">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta name="description" content="This PEP proposes an extensible API for uploading files to a Python package index such as PyPI. Along with standardization, the upload API provides additional useful features such as support for:">
    <meta name="theme-color" content="#3776ab">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1 data-pagefind-ignore>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 694</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        
        <div id="mobile-search" class="mobile-search-container"></div>
        
        <article data-pagefind-body>
            
            <span data-pagefind-meta="title:PEP 694 – Upload 2.0 API for Python Package Indexes" data-pagefind-weight="10" class="visually-hidden">PEP 694 – Upload 2.0 API for Python Package Indexes</span>
            <section id="pep-content">
<h1 class="page-title">PEP 694 – Upload 2.0 API for Python Package Indexes</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Barry Warsaw &lt;barry&#32;&#97;t&#32;python.org&gt;, Donald Stufft &lt;donald&#32;&#97;t&#32;stufft.io&gt;, Ee Durbin &lt;ee&#32;&#97;t&#32;python.org&gt;</dd>
<dt class="field-even">PEP-Delegate<span class="colon">:</span></dt>
<dd class="field-even">Dustin Ingram &lt;di&#32;&#97;t&#32;python.org&gt;</dd>
<dt class="field-odd">Discussions-To<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="https://discuss.python.org/t/pep-694-pypi-upload-api-2-0-round-2/101483">Discourse thread</a></dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><abbr title="Proposal under active discussion and revision">Draft</abbr></dd>
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><abbr title="Normative PEP with a new feature for Python, implementation change for CPython or interoperability standard for the ecosystem">Standards Track</abbr></dd>
<dt class="field-even">Topic<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="../topic/packaging/">Packaging</a></dd>
<dt class="field-odd">Created<span class="colon">:</span></dt>
<dd class="field-odd">11-Jun-2022</dd>
<dt class="field-even">Post-History<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="https://discuss.python.org/t/pep-694-upload-2-0-api-for-python-package-repositories/16879" title="Discourse thread">27-Jun-2022</a>,
<a class="reference external" href="https://discuss.python.org/t/pep-694-pypi-upload-api-2-0/76316" title="Discourse thread">06-Jan-2025</a>
<a class="reference external" href="https://discuss.python.org/t/pep-694-pypi-upload-api-2-0/76316/9" title="Discourse message">14-Apr-2025</a>
<a class="reference external" href="https://discuss.python.org/t/pep-694-pypi-upload-api-2-0-round-2/101483" title="Discourse thread">06-Aug-2025</a>
<a class="reference external" href="https://discuss.python.org/t/pep-694-pypi-upload-api-2-0-round-2/101483/31" title="Discourse message">27-Sep-2025</a>
<a class="reference external" href="https://discuss.python.org/t/pep-694-pypi-upload-api-2-0-round-2/101483/35" title="Discourse message">07-Dec-2025</a></dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#legacy-api">Legacy API</a><ul>
<li><a class="reference internal" href="#endpoint">Endpoint</a></li>
<li><a class="reference internal" href="#encoding">Encoding</a></li>
<li><a class="reference internal" href="#content">Content</a></li>
<li><a class="reference internal" href="#authentication">Authentication</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upload-2-0-api-specification">Upload 2.0 API Specification</a><ul>
<li><a class="reference internal" href="#versioning">Versioning</a></li>
<li><a class="reference internal" href="#content-types">Content Types</a></li>
<li><a class="reference internal" href="#root-endpoint">Root Endpoint</a></li>
<li><a class="reference internal" href="#authentication-for-upload-2-0-api">Authentication for Upload 2.0 API</a></li>
<li><a class="reference internal" href="#errors">Errors</a></li>
<li><a class="reference internal" href="#publishing-session">Publishing Session</a><ul>
<li><a class="reference internal" href="#create-a-publishing-session">Create a Publishing Session</a></li>
<li><a class="reference internal" href="#optional-index-specific-metadata">Optional Index-specific Metadata</a><ul>
<li><a class="reference internal" href="#response-body">Response Body</a></li>
<li><a class="reference internal" href="#multiple-session-creation-requests">Multiple Session Creation Requests</a></li>
<li><a class="reference internal" href="#publishing-session-links">Publishing Session Links</a></li>
<li><a class="reference internal" href="#publishing-session-files">Publishing Session Files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complete-a-publishing-session">Complete a Publishing Session</a></li>
<li><a class="reference internal" href="#publishing-session-cancellation">Publishing Session Cancellation</a></li>
<li><a class="reference internal" href="#publishing-session-status">Publishing Session Status</a></li>
<li><a class="reference internal" href="#publishing-session-extension">Publishing Session Extension</a></li>
<li><a class="reference internal" href="#publishing-session-token">Publishing Session Token</a></li>
</ul>
</li>
<li><a class="reference internal" href="#file-upload-session">File Upload Session</a><ul>
<li><a class="reference internal" href="#create-a-file-upload-session">Create a File Upload Session</a><ul>
<li><a class="reference internal" href="#file-upload-session-response">Response Body</a></li>
<li><a class="reference internal" href="#file-upload-session-links">File Upload Session Links</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complete-a-file-upload-session">Complete a File Upload Session</a></li>
<li><a class="reference internal" href="#cancellation-and-deletion">Cancellation and Deletion</a></li>
<li><a class="reference internal" href="#replacing-a-partially-or-fully-uploaded-file">Replacing a Partially or Fully Uploaded File</a></li>
<li><a class="reference internal" href="#file-upload-session-status">File Upload Session Status</a></li>
<li><a class="reference internal" href="#file-upload-session-extension">File Upload Session Extension</a></li>
</ul>
</li>
<li><a class="reference internal" href="#stage-previews">Stage Previews</a></li>
<li><a class="reference internal" href="#file-upload-mechanisms">File Upload Mechanisms</a><ul>
<li><a class="reference internal" href="#required-file-upload-mechanisms">Required File Upload Mechanisms</a><ul>
<li><a class="reference internal" href="#http-post-bytes"><code class="docutils literal notranslate"><span class="pre">http-post-bytes</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#server-specific-file-upload-mechanisms">Server Specific File Upload Mechanisms</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#faq">FAQ</a><ul>
<li><a class="reference internal" href="#does-this-mean-pypi-is-planning-to-drop-support-for-the-existing-upload-api">Does this mean PyPI is planning to drop support for the existing upload API?</a></li>
<li><a class="reference internal" href="#can-i-use-the-upload-2-0-api-to-reserve-a-project-name">Can I use the upload 2.0 API to reserve a project name?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#open-questions">Open Questions</a><ul>
<li><a class="reference internal" href="#extensions-to-the-upload-2-0-protocol">Extensions to the Upload 2.0 Protocol</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-history">Change History</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p>This PEP proposes an extensible API for uploading files to a Python package index such as PyPI.
Along with standardization, the upload API provides additional useful features such as support for:</p>
<ul class="simple">
<li>a publishing session, which can be used to simultaneously publish
all wheels in a package release;</li>
<li>“staging” a release, which can be used to test uploads before publicly publishing them,
without the need for <a class="reference external" href="https://test.pypi.org/">test.pypi.org</a>;</li>
<li>artifacts which can be overwritten and replaced, until a session is published;</li>
<li>detailed status on the state of artifact uploads;</li>
<li>new project creation without requiring the uploading of an artifact.</li>
<li>a protocol to extend the supported upload mechanisms in the future without requiring a full PEP;
these can be standardized and recommended for all indexes, or be index-specific;</li>
</ul>
<p>Once this new upload API is adopted, the existing legacy API can be deprecated, however this PEP
does not propose a deprecation schedule for the legacy API.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale" role="doc-backlink">Rationale</a></h2>
<p>There is currently no standardized API for uploading files to a Python package index such as
PyPI. Instead, everyone has been forced to reverse engineer the existing <a class="reference external" href="https://docs.pypi.org/api/upload/">“legacy”</a> API.</p>
<p>The legacy API, while functional, leaks implementation details of the original PyPI code base,
which has been faithfully replicated in the new code base and alternative implementations.</p>
<p>In addition, there are a number of major issues with the legacy API:</p>
<ul class="simple">
<li>It is fully synchronous, which forces requests to be held open both for the upload itself, and
while the index processes the uploaded file to determine success or failure.</li>
<li>It does not support any mechanism for parallelizing or resuming an upload. With the largest
default file size on PyPI being around 1GB in size, requiring the entire upload to complete
successfully means bandwidth is wasted when such uploads experience a network interruption while
the request is in progress.</li>
<li>The atomic unit of operation is a single file.  This is problematic when a release logically
includes an sdist and multiple binary wheels, leading to race conditions where consumers get
different versions of the package if they are unlucky enough to require a package before their
platform’s wheel has completely uploaded. If the release uploads its sdist first, this may also
manifest in some consumers seeing only the sdist, triggering a local build from source.</li>
<li>Status reporting is very limited.  There’s no support for reporting multiple errors, warnings,
deprecations, etc.  Status is limited to the HTTP status code and reason phrase, of which the
reason phrase has been deprecated since HTTP/2 (<span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7540.html#section-8.1.2.4"><strong>RFC 7540</strong></a>).</li>
<li>Metadata for a release is submitted alongside the file. However, as this metadata is famously
unreliable, most installers instead choose to download the entire file and read the metadata from
there.</li>
<li>There is no mechanism for allowing an index to do any sort of sanity checks before bandwidth gets
expended on an upload.  Many cases of invalid metadata or incorrect permissions could be checked
prior to uploading files.</li>
<li>There is no support for “staging” a release prior to publishing it to the index.</li>
<li>Creation of new projects requires the uploading of at least one file, leading to “stub” uploads
to claim a project namespace.</li>
</ul>
<p>The new upload API proposed in this PEP provides ways to solve all of these problems, either directly or
through an extensible approach, allowing servers to implement features such as resumable and parallel uploads.
This upload API this PEP proposes provides better and more standardized error reporting, a more robust release
testing experience, and atomic and simultaneous publishing of all release artifacts.</p>
</section>
<section id="legacy-api">
<h2><a class="toc-backref" href="#legacy-api" role="doc-backlink">Legacy API</a></h2>
<p>The following is an overview of the legacy API.  For the detailed description, consult the
<a class="reference external" href="https://docs.pypi.org/api/upload/">PyPI user guide documentation</a>.</p>
<section id="endpoint">
<h3><a class="toc-backref" href="#endpoint" role="doc-backlink">Endpoint</a></h3>
<p>The existing upload API lives at a base URL.  For PyPI, that URL is currently
<code class="docutils literal notranslate"><span class="pre">https://upload.pypi.org/legacy/</span></code>.  Clients performing uploads specify the API they want to call
by adding an <code class="docutils literal notranslate"><span class="pre">:action</span></code> URL parameter with a value of <code class="docutils literal notranslate"><span class="pre">file_upload</span></code>. <a class="footnote-reference brackets" href="#fn-action" id="id1">[1]</a></p>
<p>The legacy API also has a <code class="docutils literal notranslate"><span class="pre">protocol_version</span></code> parameter,
in theory allowing new versions of the API to be defined.
In practice this has never happened, and the value is always <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>Thus, the effective upload API on PyPI is:
<code class="docutils literal notranslate"><span class="pre">https://upload.pypi.org/legacy/?:action=file_upload&amp;protocol_version=1</span></code>.</p>
</section>
<section id="encoding">
<h3><a class="toc-backref" href="#encoding" role="doc-backlink">Encoding</a></h3>
<p>The data to be submitted is submitted as a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request with the content type of
<code class="docutils literal notranslate"><span class="pre">multipart/form-data</span></code>.  This reflects the legacy API’s historical nature, which was originally
designed not as an API, but rather as a web form on the initial PyPI implementation,
with client code written to programmatically submit that form.</p>
</section>
<section id="content">
<h3><a class="toc-backref" href="#content" role="doc-backlink">Content</a></h3>
<p>Roughly speaking, the metadata contained within the package is submitted as parts where the content
disposition is <code class="docutils literal notranslate"><span class="pre">form-data</span></code>, and the metadata key is the name of the field. The names of these
various pieces of metadata are not documented, and they sometimes, but not always match the names
used in the <code class="docutils literal notranslate"><span class="pre">METADATA</span></code> files for package artifacts.
The case rarely matches, and the <code class="docutils literal notranslate"><span class="pre">form-data</span></code> to <code class="docutils literal notranslate"><span class="pre">METADATA</span></code> conversion is inconsistent.</p>
<p>The upload artifact file itself is sent as a <code class="docutils literal notranslate"><span class="pre">application/octet-stream</span></code> part with the name of
<code class="docutils literal notranslate"><span class="pre">content</span></code>, and if there is a PGP signature attached, then it will be included as a
<code class="docutils literal notranslate"><span class="pre">application/octet-stream</span></code> part with the name of <code class="docutils literal notranslate"><span class="pre">gpg_signature</span></code>.</p>
</section>
<section id="authentication">
<h3><a class="toc-backref" href="#authentication" role="doc-backlink">Authentication</a></h3>
<p>Upload authentication is also not standardized.</p>
<p>PyPI uses HTTP Basic Authentication
with <a class="reference external" href="https://pypi.org/help/#apitoken">API tokens</a> as the password
and the username <code class="docutils literal notranslate"><span class="pre">__token__</span></code>.
<a class="reference external" href="https://docs.pypi.org/trusted-publishers/">Trusted Publishers</a>
authenticate via OpenID Connect and receive short-lived API tokens
that are used in the same way.</p>
</section>
</section>
<section id="upload-2-0-api-specification">
<span id="spec"></span><h2><a class="toc-backref" href="#upload-2-0-api-specification" role="doc-backlink">Upload 2.0 API Specification</a></h2>
<p>This PEP traces the root cause of most of the issues with the existing API to be roughly two things:</p>
<ul class="simple">
<li>The metadata is submitted alongside the file, rather than being parsed from the
file itself. <a class="footnote-reference brackets" href="#fn-metadata" id="id2">[2]</a></li>
<li>It supports only a single request, using only form data, that either succeeds or fails, and all
actions are atomic within that single request.</li>
</ul>
<p>To address these issues, this PEP proposes a multi-request workflow, which at a high level involves
these steps:</p>
<ol class="arabic simple">
<li>Initiate a <a class="reference internal" href="#publishing-session"><span class="std std-ref">publishing session</span></a>, creating a release stage.</li>
<li>Initiate <a class="reference internal" href="#id11"><span class="std std-ref">file upload session(s)</span></a> to that stage
as part of the publishing session.</li>
<li>Negotiate the specific <a class="reference internal" href="#file-upload-mechanisms"><span class="std std-ref">file upload mechanism</span></a> to use
between client and server.</li>
<li>Execute the file upload mechanism for the file upload session(s) using the negotiated mechanism(s).</li>
<li>Complete the file upload session(s), marking them as completed or canceled.</li>
<li>Complete the publishing session, publishing or discarding the stage.</li>
<li>Optionally check the status of a publishing session.</li>
</ol>
<section id="versioning">
<span id="id3"></span><h3><a class="toc-backref" href="#versioning" role="doc-backlink">Versioning</a></h3>
<p>This PEP uses the same <code class="docutils literal notranslate"><span class="pre">MAJOR.MINOR</span></code> versioning system as used in <a class="pep reference internal" href="../pep-0691/" title="PEP 691 – JSON-based Simple API for Python Package Indexes">PEP 691</a>,
but it is otherwise independently versioned.
The legacy API is considered by this PEP to be version <code class="docutils literal notranslate"><span class="pre">1.0</span></code>,
but this PEP does not modify the legacy API in any way.</p>
<p>The API proposed in this PEP therefore has the version number <code class="docutils literal notranslate"><span class="pre">2.0</span></code>.</p>
<p>Both major and minor version numbers of the Upload API
<strong>MUST</strong> only be changed through the PEP process.
Index operators and implementers <strong>MUST NOT</strong> advertise or implement
new API versions without an approved PEP.
This ensures consistency across all implementations
and prevents fragmentation of the ecosystem.</p>
</section>
<section id="content-types">
<h3><a class="toc-backref" href="#content-types" role="doc-backlink">Content Types</a></h3>
<p>Like <a class="pep reference internal" href="../pep-0691/" title="PEP 691 – JSON-based Simple API for Python Package Indexes">PEP 691</a>, this PEP proposes that all requests and responses from this upload API will have a
standard content type that describes what the content is, what version of the API it represents,
and what serialization format has been used.</p>
<p>This standard request content type applies to all requests <em>except</em> for requests to execute
a file upload mechanism, which will be specified by the documentation for that mechanism.</p>
<p>The structure of the <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> header for all other requests is:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>application/vnd.pypi.upload.$version+$format
</pre></div>
</div>
<p>Since minor API version differences should never be disruptive, only the major version is included
in the content type; the version number is prefixed with a <code class="docutils literal notranslate"><span class="pre">v</span></code>.</p>
<p>The major API version specified in the <code class="docutils literal notranslate"><span class="pre">.meta.api-version</span></code> JSON key of client requests
<strong>MUST</strong> match the <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> header for major version.</p>
<p>Unlike <a class="pep reference internal" href="../pep-0691/" title="PEP 691 – JSON-based Simple API for Python Package Indexes">PEP 691</a>, this PEP does not change the existing <em>legacy</em> <code class="docutils literal notranslate"><span class="pre">1.0</span></code> upload API in any way,
so servers are required to host the new API described in this PEP at a different endpoint than the
existing upload API.</p>
<p>Since JSON is the only defined request format defined in this PEP, all non-file-upload requests
defined in this PEP <strong>MUST</strong> include a <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> header value of:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">application/vnd.pypi.upload.v2+json</span></code>.</li>
</ul>
<p>Similar to <a class="pep reference internal" href="../pep-0691/" title="PEP 691 – JSON-based Simple API for Python Package Indexes">PEP 691</a>, this PEP also standardizes on using server-driven content negotiation to
allow clients to request different versions or serialization formats,
which includes the <code class="docutils literal notranslate"><span class="pre">format</span></code> part of the content type.
However, since this PEP expects the existing legacy <code class="docutils literal notranslate"><span class="pre">1.0</span></code> upload API
to exist at a different endpoint,
and this PEP currently only provides for JSON serialization,
this mechanism is not particularly useful.
Clients only have a single version and serialization they can request.
However clients <strong>SHOULD</strong> be prepared to handle content negotiation gracefully
in the case that additional formats or versions are added in the future.</p>
<p>Servers <strong>MUST NOT</strong> advertise support for API versions beyond those defined in approved PEPs.
Any new versions or formats require standardization through a new PEP.</p>
<p>Unless otherwise specified, all HTTP requests and responses in this document are assumed to include
the HTTP header:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Content-Type: application/vnd.pypi.upload.v2+json
</pre></div>
</div>
</section>
<section id="root-endpoint">
<h3><a class="toc-backref" href="#root-endpoint" role="doc-backlink">Root Endpoint</a></h3>
<p>All URLs described here are relative to the “root endpoint”, which may be located anywhere within
the url structure of a domain. For example, the root endpoint could be
<code class="docutils literal notranslate"><span class="pre">https://upload.example.com/</span></code>, or <code class="docutils literal notranslate"><span class="pre">https://example.com/upload/</span></code>.</p>
<p>The choice of the root endpoint is left up to the index operator.</p>
</section>
<section id="authentication-for-upload-2-0-api">
<h3><a class="toc-backref" href="#authentication-for-upload-2-0-api" role="doc-backlink">Authentication for Upload 2.0 API</a></h3>
<p>All endpoints in this specification <strong>MUST</strong> use standard HTTP authentication
mechanisms as defined in <span class="target" id="index-1"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7235.html"><strong>RFC 7235</strong></a>.</p>
<p>Authentication follows the standard HTTP pattern:</p>
<ul class="simple">
<li>Servers use the <code class="docutils literal notranslate"><span class="pre">WWW-Authenticate</span></code> response header when authentication is required</li>
<li>Clients provide credentials via the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> request header</li>
<li><code class="docutils literal notranslate"><span class="pre">401</span> <span class="pre">Unauthorized</span></code> indicates missing or invalid authentication</li>
<li><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code> indicates insufficient permissions</li>
</ul>
<p>The specific authentication schemes (e.g., Bearer, Basic, Digest)
are determined by the index operator.</p>
</section>
<section id="errors">
<span id="session-errors"></span><h3><a class="toc-backref" href="#errors" role="doc-backlink">Errors</a></h3>
<p>Unless otherwise specified, all error (4xx and 5xx) responses from the server <strong>MUST</strong> use the <span class="target" id="index-2"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9457.html"><strong>RFC 9457</strong></a>
(Problem Details for HTTP APIs) format.  In particular, the server <strong>MUST</strong> use the “Problem Details JSON
Object” defined in <span class="target" id="index-3"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9457.html#section-3"><strong>Section 3</strong></a> and <strong>SHOULD</strong> use the <code class="docutils literal notranslate"><span class="pre">application/problem+json</span></code> media
type in its responses.</p>
<p>Clients in general should be prepared to handle <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status">HTTP response error status codes</a> which <strong>SHOULD</strong> contain payloads like
the following, although note that the details are index-specific, as long as they conform to RFC 9457.  By way
of example, PyPI could return the following error body:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://docs.pypi.org/api/errors/error-types#invalid-filename&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The artifact used an invalid wheel file name format&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;details&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;See https://packaging.python.org/en/latest/specifications/binary-distribution-format/&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;api-version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>RFC 9457 defines <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">status</span></code>, <code class="docutils literal notranslate"><span class="pre">title</span></code>, and <code class="docutils literal notranslate"><span class="pre">details</span></code>.  The <code class="docutils literal notranslate"><span class="pre">meta</span></code> and <code class="docutils literal notranslate"><span class="pre">errors</span></code> keys are
“extension members”, defined in <span class="target" id="index-4"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9457.html#section-3.2"><strong>Section 3.2</strong></a>.  The index <strong>SHOULD</strong> include these
extension members.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">meta</span></code></dt><dd>The same request/response metadata structure as defined in the <a class="reference internal" href="#publishing-session"><span class="std std-ref">Publishing Session</span></a> description.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">errors</span></code></dt><dd>An array of specific errors, each of which contains a <code class="docutils literal notranslate"><span class="pre">source</span></code> key, which is a string that
indicates what the source of the error is, and a <code class="docutils literal notranslate"><span class="pre">message</span></code> key for that specific error.</dd>
</dl>
<p>The <code class="docutils literal notranslate"><span class="pre">message</span></code> and <code class="docutils literal notranslate"><span class="pre">source</span></code> strings do not have any specific meaning, and are intended for human
interpretation to aid in diagnosing underlying issue.</p>
<p>Some responses may return more specific HTTP status codes as described in the text below.</p>
</section>
<section id="publishing-session">
<span id="id4"></span><h3><a class="toc-backref" href="#publishing-session" role="doc-backlink">Publishing Session</a></h3>
<section id="create-a-publishing-session">
<span id="publishing-session-create"></span><h4><a class="toc-backref" href="#create-a-publishing-session" role="doc-backlink">Create a Publishing Session</a></h4>
<p>A release starts by creating a new publishing session.  To create the session, a client submits a
<code class="docutils literal notranslate"><span class="pre">POST</span></code> request to the root URL like:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;api-version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The request includes the following top-level keys:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">meta</span></code> (<strong>required</strong>)</dt><dd>Describes information about the payload itself.  Currently, the only defined sub-key is
<code class="docutils literal notranslate"><span class="pre">api-version</span></code> the value of which must be the string <code class="docutils literal notranslate"><span class="pre">&quot;2.0&quot;</span></code>.  Optional sub-keys can define
<a class="reference internal" href="#index-specific-metadata"><span class="std std-ref">index-specific behavior</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code> (<strong>required</strong>)</dt><dd>The name of the project that this session is attempting to release a new version of.  The name
<strong>MUST</strong> conform to the <a class="reference external" href="https://packaging.python.org/en/latest/specifications/name-normalization/#name-normalization">standard package name format</a>
and the server <strong>MUST</strong> normalize the name.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">version</span></code> (<strong>required</strong>)</dt><dd>The version of the project that this session is attempting to add files to.  The version string
<strong>MUST</strong> conform to the <a class="reference external" href="https://packaging.python.org/en/latest/specifications/version-specifiers/">packaging version</a> specification.</dd>
</dl>
<p>Upon successful session creation, the server returns a <code class="docutils literal notranslate"><span class="pre">201</span> <span class="pre">Created</span></code> response.  The response <strong>MUST</strong> also
include a <code class="docutils literal notranslate"><span class="pre">Location</span></code> header containing the same URL as the <a class="reference internal" href="#publishing-session-links"><span class="std std-ref">links.session</span></a>
key in the <a class="reference internal" href="#publishing-session-response"><span class="std std-ref">response body</span></a>.</p>
<p>If a session is created for a project which has no previous release,
then the index <strong>MAY</strong> reserve the project name before the session is published,
however it <strong>MUST NOT</strong> be possible to navigate to that project using
the “regular” (i.e. <a class="reference internal" href="#staged-preview"><span class="std std-ref">unstaged</span></a>) access protocols,
<em>until</em> the stage is published.
If this first-release stage gets canceled,
then the index <strong>SHOULD</strong> delete the project record, as if it were never uploaded.</p>
<p>The session is owned by the user that created it,
and all subsequent requests <strong>MUST</strong> be performed with the same credentials,
otherwise a <code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code> will be returned on those subsequent requests.</p>
</section>
<section id="optional-index-specific-metadata">
<span id="index-specific-metadata"></span><h4><a class="toc-backref" href="#optional-index-specific-metadata" role="doc-backlink">Optional Index-specific Metadata</a></h4>
<p>Index can optionally define their own metadata for index-specific behavior.  The metadata key
<strong>MUST</strong> begin with an underscore, with the following value easily and uniquely identifying the
index.  For example, PyPI could allow for projects to be created in an <a class="reference external" href="https://docs.pypi.org/organization-accounts/">organization account</a> of which the publisher is a member by using the
following index-specific metadata section:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;api-version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;_pypi.org&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;organization&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-main-org&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is only an example.  This PEP does not define or reserve any index-specific keys or metadata;
that is left up to the index to specify and document.  The semantics (e.g. whether bogus keys or
values result in an error or are ignored) of the index-specific metadata is also undefined here.</p>
<section id="response-body">
<span id="publishing-session-response"></span><h5><a class="toc-backref" href="#response-body" role="doc-backlink">Response Body</a></h5>
<p>The successful response includes the following content:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;api-version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;links&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;stage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;upload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;session&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;mechanisms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;http-post-bytes&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;session-token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;token-string&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;expires-at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-08-01T12:00:00Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pending&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;files&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">  </span><span class="nt">&quot;notices&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;a notice to display to the user&quot;</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Besides the <code class="docutils literal notranslate"><span class="pre">meta</span></code> key, which has the same format as the request JSON, the success response has
the following keys:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">links</span></code></dt><dd>A dictionary mapping <a class="reference internal" href="#publishing-session-links"><span class="std std-ref">keys to URLs</span></a> related to this session,
the details of which are provided below.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mechanisms</span></code></dt><dd>A list of file-upload mechanisms supported by the server, sorted in server-preferred order.
At least one value is required.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">session-token</span></code></dt><dd>If the index supports <a class="reference internal" href="#staged-preview"><span class="std std-ref">previewing staged releases</span></a>, this key will contain the unique
<a class="reference internal" href="#publishing-session-token"><span class="std std-ref">“session token”</span></a> that can be provided to installers in order to preview
the staged release before it’s published.  This token <strong>MUST</strong> be cryptographically unguessable.  If the
index does <em>not</em> support stage previewing, this key <strong>MUST</strong> be omitted.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">expires-at</span></code></dt><dd>An <span class="target" id="index-5"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3339.html"><strong>RFC 3339</strong></a> formatted timestamp string; this string <strong>MUST</strong> represent a UTC timestamp using the
“Zulu” (i.e. <code class="docutils literal notranslate"><span class="pre">Z</span></code>) marker, and use only whole seconds (i.e. no fractional seconds).  This
timestamp represents when the server will expire this session, and thus all of its content,
including any uploaded files and the URL links related to the session. The session <strong>SHOULD</strong>
remain active until at least this time unless the client itself has canceled or published the
session. Servers <strong>MAY</strong> choose to extend this expiration time, but should never move it
earlier.  Clients can query the <a class="reference internal" href="#publishing-session-status"><span class="std std-ref">session status</span></a> to get the current
expiration time of the session.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">status</span></code></dt><dd>A string that contains one of <code class="docutils literal notranslate"><span class="pre">pending</span></code>, <code class="docutils literal notranslate"><span class="pre">published</span></code>, <code class="docutils literal notranslate"><span class="pre">error</span></code>, or <code class="docutils literal notranslate"><span class="pre">canceled</span></code>,
representing the overall <a class="reference internal" href="#publishing-session-status"><span class="std std-ref">status of the session</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">files</span></code></dt><dd>A mapping containing the filenames that have been uploaded to this session, to a mapping
containing details about each <a class="reference internal" href="#publishing-session-files"><span class="std std-ref">file referenced in this session</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">notices</span></code></dt><dd>An optional key that points to an array of human-readable informational notices that the server
wishes to communicate to the end user.  These notices are specific to the overall session, not
to any particular file in the session.</dd>
</dl>
</section>
<section id="multiple-session-creation-requests">
<span id="publishing-session-multiple"></span><h5><a class="toc-backref" href="#multiple-session-creation-requests" role="doc-backlink">Multiple Session Creation Requests</a></h5>
<p>If a second attempt to create a session is received for the same name-version pair while a session for that
pair is in the <code class="docutils literal notranslate"><span class="pre">pending</span></code>, <code class="docutils literal notranslate"><span class="pre">processing</span></code>, or <code class="docutils literal notranslate"><span class="pre">complete</span></code> state, then a new session is <em>not</em> created.
Instead, the server <strong>MUST</strong> respond with a <code class="docutils literal notranslate"><span class="pre">409</span> <span class="pre">Conflict</span></code> and <strong>MUST</strong> include a <code class="docutils literal notranslate"><span class="pre">Location</span></code> header that
points to the <a class="reference internal" href="#publishing-session-status"><span class="std std-ref">session status URL</span></a>.</p>
<p>For sessions in the <code class="docutils literal notranslate"><span class="pre">error</span></code> or <code class="docutils literal notranslate"><span class="pre">canceled</span></code> state, a new session is created with same <code class="docutils literal notranslate"><span class="pre">201</span> <span class="pre">Created</span></code>
response and payload, except that the <a class="reference internal" href="#publishing-session-status"><span class="std std-ref">publishing session status URL</span></a>,
<code class="docutils literal notranslate"><span class="pre">session-token</span></code>, and <code class="docutils literal notranslate"><span class="pre">links.stage</span></code> values <strong>MUST</strong> be different.</p>
</section>
<section id="publishing-session-links">
<span id="id5"></span><h5><a class="toc-backref" href="#publishing-session-links" role="doc-backlink">Publishing Session Links</a></h5>
<p>For the <code class="docutils literal notranslate"><span class="pre">links</span></code> key in the success JSON, the following sub-keys are valid:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">session</span></code></dt><dd>The endpoint where actions for this session can be performed,
including <a class="reference internal" href="#publishing-session-completion"><span class="std std-ref">publishing this session</span></a>,
<a class="reference internal" href="#publishing-session-cancellation"><span class="std std-ref">canceling and discarding the session</span></a>,
<a class="reference internal" href="#publishing-session-status"><span class="std std-ref">querying the current session status</span></a>,
and <a class="reference internal" href="#publishing-session-extension"><span class="std std-ref">requesting an extension of the session lifetime</span></a>
(<em>if</em> the server supports it).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">upload</span></code></dt><dd>The endpoint session clients will use to initiate a <a class="reference internal" href="#id11"><span class="std std-ref">file upload session</span></a>
for each file to be included in this session.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">stage</span></code></dt><dd>The endpoint where this staged release can be <a class="reference internal" href="#staged-preview"><span class="std std-ref">previewed</span></a> prior to publishing the
session.  This can be used to download and verify the not-yet-public files.  This URL <strong>MUST</strong> be
cryptographically unguessable and <strong>MUST</strong> use the above <code class="docutils literal notranslate"><span class="pre">session-token</span></code> to accomplish this.  This
<code class="docutils literal notranslate"><span class="pre">stage</span></code> URL should be easily calculated using the <code class="docutils literal notranslate"><span class="pre">session-token</span></code>, but the exact format of that URL is
index specific.  If the index does not support previewing staged releases, this key <strong>MUST</strong> be omitted.</dd>
</dl>
</section>
<section id="publishing-session-files">
<span id="id6"></span><h5><a class="toc-backref" href="#publishing-session-files" role="doc-backlink">Publishing Session Files</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">files</span></code> key contains a mapping from the names of the files uploaded in this session to a
sub-mapping with the following keys:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">status</span></code></dt><dd>A string with valid values
<code class="docutils literal notranslate"><span class="pre">pending</span></code>, <code class="docutils literal notranslate"><span class="pre">processing</span></code>, <code class="docutils literal notranslate"><span class="pre">complete</span></code>, <code class="docutils literal notranslate"><span class="pre">error</span></code>, and <code class="docutils literal notranslate"><span class="pre">canceled</span></code>.
If there was an error during upload,
then clients should not assume the file is in any usable state,
<code class="docutils literal notranslate"><span class="pre">error</span></code> will be returned and it’s best to
<a class="reference internal" href="#file-upload-session-cancellation"><span class="std std-ref">cancel or delete</span></a> the file and start over.
This action would remove the file name from the <code class="docutils literal notranslate"><span class="pre">files</span></code> key of the
<a class="reference internal" href="#publishing-session-response"><span class="std std-ref">session status response body</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">link</span></code></dt><dd>The <em>absolute</em> URL that the client should use to reference this specific file.  This URL is used to
retrieve, replace, or delete the <a class="reference internal" href="#id11"><span class="std std-ref">referenced file</span></a>.  If a <a class="reference internal" href="#staged-preview"><span class="std std-ref">preview stages</span></a> are supported, this URL <strong>MUST</strong> be cryptographically unguessable, and <strong>MUST</strong> use
the same <a class="reference internal" href="#publishing-session-token"><span class="std std-ref">publishing session token</span></a> to do ensure this constraint.  The
exact format of the URL is left to the index, but <strong>SHOULD</strong> be documented.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">notices</span></code></dt><dd>An optional key with similar format and semantics as the <code class="docutils literal notranslate"><span class="pre">notices</span></code> session key, except that
these notices are specific to the referenced file.</dd>
</dl>
</section>
</section>
<section id="complete-a-publishing-session">
<span id="publishing-session-completion"></span><h4><a class="toc-backref" href="#complete-a-publishing-session" role="doc-backlink">Complete a Publishing Session</a></h4>
<p>To complete a session and publish the files that have been included in it, a client issues a
<code class="docutils literal notranslate"><span class="pre">POST</span></code> request to the <code class="docutils literal notranslate"><span class="pre">session</span></code> <a class="reference internal" href="#publishing-session-links"><span class="std std-ref">link</span></a>
given in the <a class="reference internal" href="#publishing-session-response"><span class="std std-ref">session creation response body</span></a>.</p>
<p>The request looks like:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;api-version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;publish&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the server is able to immediately complete the publishing session, it may do so and return a
<code class="docutils literal notranslate"><span class="pre">201</span> <span class="pre">Created</span></code> response. If it is unable to immediately complete the publishing session
(for instance, if it needs to do validation that may take longer than reasonable in a single HTTP
request), then it may return a <code class="docutils literal notranslate"><span class="pre">202</span> <span class="pre">Accepted</span></code> response.</p>
<p>The server <strong>MUST</strong> include a <code class="docutils literal notranslate"><span class="pre">Location</span></code> header in the response pointing back to the <a class="reference internal" href="#publishing-session-status"><span class="std std-ref">Publishing
Session status</span></a> URL, which can be used to query the current session status.  If the server
returned a <code class="docutils literal notranslate"><span class="pre">202</span> <span class="pre">Accepted</span></code>, polling that URL can be used to watch for session status changes.</p>
</section>
<section id="publishing-session-cancellation">
<span id="id7"></span><h4><a class="toc-backref" href="#publishing-session-cancellation" role="doc-backlink">Publishing Session Cancellation</a></h4>
<p>To cancel a publishing session, a client issues a <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> request to
the <code class="docutils literal notranslate"><span class="pre">session</span></code> <a class="reference internal" href="#publishing-session-links"><span class="std std-ref">link</span></a>
given in the <a class="reference internal" href="#publishing-session-response"><span class="std std-ref">session creation response body</span></a>.
The server then marks the session as canceled, and <strong>SHOULD</strong> purge any data that was uploaded
as part of that session.
Future attempts to access that session URL or any of the publishing session URLs
<strong>MUST</strong> return a <code class="docutils literal notranslate"><span class="pre">404</span> <span class="pre">Not</span> <span class="pre">Found</span></code>.</p>
<p>To prevent dangling sessions, servers may also choose to cancel timed-out sessions on their own
accord. It is recommended that servers expunge their sessions after no less than a week, but each
server may choose their own schedule.  Servers <strong>MAY</strong> support client-directed <a class="reference internal" href="#publishing-session-extension"><span class="std std-ref">session
extensions</span></a>.</p>
</section>
<section id="publishing-session-status">
<span id="id8"></span><h4><a class="toc-backref" href="#publishing-session-status" role="doc-backlink">Publishing Session Status</a></h4>
<p>At any time, a client can query the status of a session by issuing a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request to the URL given in the
<a class="reference internal" href="#publishing-session-links"><span class="std std-ref">links.session</span></a> URL (also provided in the <a class="reference internal" href="#publishing-session-response"><span class="std std-ref">session creation response’s</span></a> <code class="docutils literal notranslate"><span class="pre">Location</span></code> header).</p>
<p>The server will respond to this <code class="docutils literal notranslate"><span class="pre">GET</span></code> request with the same <a class="reference internal" href="#publishing-session-response"><span class="std std-ref">publishing session creation response</span></a>, that they got when they initially created the publishing session, except with
any changes to <code class="docutils literal notranslate"><span class="pre">status</span></code>, <code class="docutils literal notranslate"><span class="pre">expires-at</span></code>, or <code class="docutils literal notranslate"><span class="pre">files</span></code> reflected.</p>
</section>
<section id="publishing-session-extension">
<span id="id9"></span><h4><a class="toc-backref" href="#publishing-session-extension" role="doc-backlink">Publishing Session Extension</a></h4>
<p>Servers <strong>MAY</strong> allow clients to extend sessions, but the overall lifetime and number of extensions
allowed is left to the server.  To extend a session, a client issues a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request to the
<a class="reference internal" href="#publishing-session-links"><span class="std std-ref">links.session</span></a> URL (same as above, also the <code class="docutils literal notranslate"><span class="pre">Location</span></code> header).</p>
<p>The request looks like:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;api-version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;extend&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;extend-for&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The number of seconds specified is just a suggestion to the server for the number of additional seconds to
extend the current session.  For example, if the client wants to extend the current session for another hour,
<code class="docutils literal notranslate"><span class="pre">extend-for</span></code> would be <code class="docutils literal notranslate"><span class="pre">3600</span></code>.  Upon successful extension, the server will respond with the same
<a class="reference internal" href="#publishing-session-response"><span class="std std-ref">publishing session creation response body</span></a> that they got when they
initially created the publishing session, except with any changes to <code class="docutils literal notranslate"><span class="pre">status</span></code>, <code class="docutils literal notranslate"><span class="pre">expires-at</span></code>, or <code class="docutils literal notranslate"><span class="pre">files</span></code>
reflected.</p>
<p>If the server refuses to extend the session for the requested number of seconds, it <strong>MUST</strong> still return a
success response, and the <code class="docutils literal notranslate"><span class="pre">expires-at</span></code> key will simply reflect the current expiration time of the session.</p>
</section>
<section id="publishing-session-token">
<span id="id10"></span><h4><a class="toc-backref" href="#publishing-session-token" role="doc-backlink">Publishing Session Token</a></h4>
<p>Indexes <strong>SHOULD</strong> support <a class="reference internal" href="#staged-preview"><span class="std std-ref">preview stages</span></a> so that uploaded files can be live tested
before publishing.  E.g. a CI client could perform installation tests using pre-published wheels to ensure
that their new release works as expected before they publish the release publicly.</p>
<p>Indexes advertise their support for staged previews by returning two key pieces of information in their
<a class="reference internal" href="#publishing-session-response"><span class="std std-ref">response to publishing session creation</span></a>.  Indexes which don’t support
staged previews <strong>MUST NOT</strong> include these in their responses.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">session-token</span></code> is a short token which could be used as a convenience for installation tool UX, if they
want to support staged previews via a command line switch, e.g. <code class="docutils literal notranslate"><span class="pre">$TOOL</span> <span class="pre">install</span> <span class="pre">--staging</span> <span class="pre">$SESSION_TOKEN</span></code>.
The <code class="docutils literal notranslate"><span class="pre">links.stage</span></code> key gives the full URL to the stage, which could be used in the CLI, e.g. <code class="docutils literal notranslate"><span class="pre">pip</span>
<span class="pre">install</span> <span class="pre">--extra-index-url</span> <span class="pre">$STAGE_URL</span></code>.  Both the session token and URL <strong>MUST</strong> be cryptographically
unguessable, but the algorithm for generating the token is left to the index.  The stage URL <strong>MUST</strong> be
calculable from the session token, using a format documented by the index, but the exact format of the URL is
also left to the index.</p>
</section>
</section>
<section id="file-upload-session">
<h3><a class="toc-backref" href="#file-upload-session" role="doc-backlink">File Upload Session</a></h3>
<section id="create-a-file-upload-session">
<span id="id11"></span><h4><a class="toc-backref" href="#create-a-file-upload-session" role="doc-backlink">Create a File Upload Session</a></h4>
<p>After creating a publishing session, the <code class="docutils literal notranslate"><span class="pre">upload</span></code> endpoint from the response’s <a class="reference internal" href="#publishing-session-links"><span class="std std-ref">session links</span></a> mapping is used to begin the upload of new files into that session.  Clients
<strong>MUST</strong> use the provided <code class="docutils literal notranslate"><span class="pre">upload</span></code> URL and <strong>MUST NOT</strong> assume there is any pattern or commonality to those
URLs from one session to the next.</p>
<p>To initiate a file upload, a client first sends a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request to the <code class="docutils literal notranslate"><span class="pre">upload</span></code> URL.
The request looks like:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;api-version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;filename&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo-1.0.tar.gz&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hashes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;sha256&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;blake2b&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;mechanism&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http-post-bytes&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Besides the standard <code class="docutils literal notranslate"><span class="pre">meta</span></code> key, the request JSON has the following additional keys:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">filename</span></code> (<strong>required</strong>)</dt><dd>The name of the file being uploaded.  The filename <strong>MUST</strong> conform to either the <a class="reference external" href="https://packaging.python.org/en/latest/specifications/source-distribution-format/#source-distribution-file-name">source distribution
file name specification</a>
or the <a class="reference external" href="https://packaging.python.org/en/latest/specifications/binary-distribution-format/#file-name-convention">binary distribution file name convention</a>.
Indexes <strong>SHOULD</strong> validate these file names at the time of the request, returning a <code class="docutils literal notranslate"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></code>
error code and an RFC 9457 style error body, as described in the <a class="reference internal" href="#session-errors"><span class="std std-ref">Errors</span></a> section when the
file names do not conform.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code> (<strong>required</strong>)</dt><dd>The size in bytes of the file being uploaded.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hashes</span></code> (<strong>required</strong>)</dt><dd>A mapping of hash names to hex-encoded digests.  Each of these digests are the checksums of the
file being uploaded when hashed by the algorithm identified in the name.<p>By default, any hash algorithm available in <a class="reference external" href="https://docs.python.org/3/library/hashlib.html">hashlib</a> can be used as a key for the hashes
dictionary <a class="footnote-reference brackets" href="#fn-hash" id="id12">[3]</a>. At least one secure algorithm from <code class="docutils literal notranslate"><span class="pre">hashlib.algorithms_guaranteed</span></code>
<strong>MUST</strong> always be included. This PEP specifically recommends <code class="docutils literal notranslate"><span class="pre">sha256</span></code>.</p>
<p>Multiple hashes may be passed at a time, but all hashes provided <strong>MUST</strong> be valid for the file.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mechanism</span></code> (<strong>required</strong>)</dt><dd>The file-upload mechanisms the client intends to use for this file.
This mechanism <strong>SHOULD</strong> be chosen from the list of mechanisms advertised in the
<a class="reference internal" href="#publishing-session-response"><span class="std std-ref">publishing session creation response body</span></a>.
A client <strong>MAY</strong> send a mechanism that is not advertised in cases where server operators have
documented a new or upcoming mechanism that is available for use on a “pre-release” basis.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">metadata</span></code> (<strong>optional</strong>)</dt><dd>If given, this is a string value containing the file’s <a class="reference external" href="https://packaging.python.org/en/latest/specifications/core-metadata/">core metadata</a>.</dd>
</dl>
<p>Servers <strong>MAY</strong> use the data provided in this request to do some sanity checking prior to allowing
the file to be uploaded.  These checks may include, but are not limited to:</p>
<ul class="simple">
<li>checking if the <code class="docutils literal notranslate"><span class="pre">filename</span></code> already exists in a published release;</li>
<li>checking if the <code class="docutils literal notranslate"><span class="pre">size</span></code> would exceed any project or file quota;</li>
<li>checking if the contents of the <code class="docutils literal notranslate"><span class="pre">metadata</span></code>, if provided, are valid.</li>
</ul>
<p>If the server determines that upload should proceed, it will return a <code class="docutils literal notranslate"><span class="pre">202</span> <span class="pre">Accepted</span></code> response, with the
response body below.  The <a class="reference internal" href="#publishing-session-status"><span class="std std-ref">status</span></a> of the publishing session will also
include the filename in the <code class="docutils literal notranslate"><span class="pre">files</span></code> mapping.  If the server cannot proceed with an upload because the
<code class="docutils literal notranslate"><span class="pre">mechanism</span></code> supplied by the client is not supported it <strong>MUST</strong> return a <code class="docutils literal notranslate"><span class="pre">422</span> <span class="pre">Unprocessable</span> <span class="pre">Content</span></code>.  The
server <strong>MAY</strong> allow parallel uploads of files, but is not required to. If the server determines the upload
cannot proceed, it <strong>MUST</strong> return a <code class="docutils literal notranslate"><span class="pre">409</span> <span class="pre">Conflict</span></code>.</p>
<section id="file-upload-session-response">
<span id="id13"></span><h5><a class="toc-backref" href="#file-upload-session-response" role="doc-backlink">Response Body</a></h5>
<p>The successful response includes the following:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;api-version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;links&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;file-upload-session&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pending&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;expires-at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-08-01T13:00:00Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;mechanism&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;identifier&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http-post-bytes&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;file_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;attestations_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">Retry-After</span></code> response header <strong>MUST</strong> be present to indicate to clients when they should next poll for an
updated status.</p>
<p>Besides the <code class="docutils literal notranslate"><span class="pre">meta</span></code> key, which has the same format as the request JSON, the success response has
the following keys:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">links</span></code></dt><dd>A dictionary mapping <a class="reference internal" href="#file-upload-session-links"><span class="std std-ref">keys to URLs</span></a> related to this session,
the details of which are provided below.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">status</span></code></dt><dd>A string with valid values <code class="docutils literal notranslate"><span class="pre">pending</span></code>, <code class="docutils literal notranslate"><span class="pre">processing</span></code>, <code class="docutils literal notranslate"><span class="pre">complete</span></code>, <code class="docutils literal notranslate"><span class="pre">error</span></code>, and <code class="docutils literal notranslate"><span class="pre">canceled</span></code>
indicating the current state of the file upload session.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">expires-at</span></code></dt><dd>An <span class="target" id="index-6"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3339.html"><strong>RFC 3339</strong></a> formatted timestamp string representing when the server will expire this file upload
session.  This string <strong>MUST</strong> represent a UTC timestamp using the “Zulu” (i.e. <code class="docutils literal notranslate"><span class="pre">Z</span></code>) marker,
and use only whole seconds (i.e. no fractional seconds).  The session <strong>SHOULD</strong> remain active
until at least this time unless the client cancels or completes it. Servers <strong>MAY</strong> choose to
extend this expiration time, but should never move it earlier.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mechanism</span></code></dt><dd>A mapping containing the necessary details for the supported mechanism as negotiated by the client and
server.  This mapping <strong>MUST</strong> contain a key <code class="docutils literal notranslate"><span class="pre">identifier</span></code> which maps to the identifier string for the
chosen file upload mechanism.</dd>
</dl>
</section>
<section id="file-upload-session-links">
<span id="id14"></span><h5><a class="toc-backref" href="#file-upload-session-links" role="doc-backlink">File Upload Session Links</a></h5>
<p>For the <code class="docutils literal notranslate"><span class="pre">links</span></code> key in the response payload, the following sub-keys are valid:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">file-upload-session</span></code></dt><dd>The endpoint where actions for this file-upload-session can be performed.  including <a class="reference internal" href="#file-upload-session-completion"><span class="std std-ref">completing a
file upload session</span></a>, <a class="reference internal" href="#file-upload-session-cancellation"><span class="std std-ref">canceling and discarding the file upload
session</span></a>, <a class="reference internal" href="#file-upload-session-status"><span class="std std-ref">querying the current file upload session status</span></a>, and <a class="reference internal" href="#file-upload-session-extension"><span class="std std-ref">requesting an extension of the file upload session lifetime</span></a> (<em>if</em> the server supports it).</dd>
</dl>
</section>
</section>
<section id="complete-a-file-upload-session">
<span id="file-upload-session-completion"></span><h4><a class="toc-backref" href="#complete-a-file-upload-session" role="doc-backlink">Complete a File Upload Session</a></h4>
<p>To complete a file upload session, which indicates that the file upload mechanism has been executed
and did not produce an error, a client issues a <code class="docutils literal notranslate"><span class="pre">POST</span></code> to the <code class="docutils literal notranslate"><span class="pre">file-upload-session</span></code> link in the
file upload session creation response body.</p>
<p>The requests looks like:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;api-version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;complete&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the server is able to immediately complete the file upload session, it may do so and return a <code class="docutils literal notranslate"><span class="pre">201</span>
<span class="pre">Created</span></code> response and set the status of the file upload session to <code class="docutils literal notranslate"><span class="pre">complete</span></code>.  If it is unable to
immediately complete the file upload session (for instance, if it needs to do validation that may take longer
than reasonable in a single HTTP request), then it may return a <code class="docutils literal notranslate"><span class="pre">202</span> <span class="pre">Accepted</span></code> response and set the status
of the file upload session to <code class="docutils literal notranslate"><span class="pre">processing</span></code>.</p>
<p>In either case, the server should include a <code class="docutils literal notranslate"><span class="pre">Location</span></code> header pointing back to the <a class="reference internal" href="#file-upload-session-status"><span class="std std-ref">file upload session
status</span></a> URL.</p>
<p>Servers <strong>MUST</strong> allow clients to poll the file upload session status URL to watch for the status to change.
If the server responds with a <code class="docutils literal notranslate"><span class="pre">202</span> <span class="pre">Accepted</span></code>, clients may poll the file upload session status URL to watch
for the status to change.  Clients <strong>SHOULD</strong> respect the <code class="docutils literal notranslate"><span class="pre">Retry-After</span></code> header value of the file upload
session status response.</p>
</section>
<section id="cancellation-and-deletion">
<span id="file-upload-session-cancellation"></span><h4><a class="toc-backref" href="#cancellation-and-deletion" role="doc-backlink">Cancellation and Deletion</a></h4>
<p>A client can cancel an in-progress file upload session, or delete a file that has been completely uploaded.
In both cases, the client performs this by issuing a <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> request to the <code class="docutils literal notranslate"><span class="pre">links.file-upload-session</span></code>
URL from the <a class="reference internal" href="#file-upload-session-response"><span class="std std-ref">file upload session creation response</span></a> of the file they want
to delete.</p>
<p>A successful deletion request <strong>MUST</strong> respond with a <code class="docutils literal notranslate"><span class="pre">204</span> <span class="pre">No</span> <span class="pre">Content</span></code>.</p>
<p>Once canceled or deleted, a client <strong>MUST NOT</strong> assume that the previous file upload session resource or
associated file upload mechanisms can be reused.</p>
</section>
<section id="replacing-a-partially-or-fully-uploaded-file">
<h4><a class="toc-backref" href="#replacing-a-partially-or-fully-uploaded-file" role="doc-backlink">Replacing a Partially or Fully Uploaded File</a></h4>
<p>To replace a session file, the file upload <strong>MUST</strong> have been previously completed, canceled, or
deleted.  It is not possible to replace a file if the upload for that file is in-progress.</p>
<p>To replace a session file, clients should <a class="reference internal" href="#file-upload-session-cancellation"><span class="std std-ref">cancel and delete the in-progress upload</span></a> first.  After this, the new file upload can be initiated by beginning the
entire <a class="reference internal" href="#id11"><span class="std std-ref">file upload</span></a> sequence over again.  This means providing the metadata
request again to retrieve a new upload resource URL.  Clients <strong>MUST NOT</strong> assume that the previous upload
resource URL can be reused after deletion.</p>
</section>
<section id="file-upload-session-status">
<span id="id15"></span><h4><a class="toc-backref" href="#file-upload-session-status" role="doc-backlink">File Upload Session Status</a></h4>
<p>The client can query status of the file upload session by issuing a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request to the
<code class="docutils literal notranslate"><span class="pre">links.file-upload-session</span></code> URL from the <a class="reference internal" href="#file-upload-session-response"><span class="std std-ref">file upload session creation response</span></a>.  The server responds to this request with the same payload as the file upload
session creation response, except with any changes <code class="docutils literal notranslate"><span class="pre">status</span></code> and <code class="docutils literal notranslate"><span class="pre">expires-at</span></code> reflected.</p>
</section>
<section id="file-upload-session-extension">
<span id="id16"></span><h4><a class="toc-backref" href="#file-upload-session-extension" role="doc-backlink">File Upload Session Extension</a></h4>
<p>Servers <strong>MAY</strong> allow clients to extend file upload sessions, but the overall lifetime and number of
extensions allowed is left to the server.  To extend a file upload session, a client issues a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request
to the <code class="docutils literal notranslate"><span class="pre">links.file-upload-session</span></code> URL from the <a class="reference internal" href="#file-upload-session-response"><span class="std std-ref">file upload session creation response</span></a>.</p>
<p>The request looks like:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;api-version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;extend&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;extend-for&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The number of seconds specified is just a suggestion to the server for the number of additional seconds to
extend the current file upload session.  For example, if the client wants to extend session for another hour,
<code class="docutils literal notranslate"><span class="pre">extend-for</span></code> would be <code class="docutils literal notranslate"><span class="pre">3600</span></code>.  Upon successful extension, the server will respond with the same <a class="reference internal" href="#file-upload-session-response"><span class="std std-ref">file
upload session creation response body</span></a> that they got when they initially
created the publishing session, except with any changes to <code class="docutils literal notranslate"><span class="pre">status</span></code> or <code class="docutils literal notranslate"><span class="pre">expires-at</span></code> reflected.</p>
<p>If the server refuses to extend the session for the requested number of seconds, it <strong>MUST</strong> still return a
success response, and the <code class="docutils literal notranslate"><span class="pre">expires-at</span></code> key will simply reflect the current expiration time of the session.</p>
</section>
</section>
<section id="stage-previews">
<span id="staged-preview"></span><h3><a class="toc-backref" href="#stage-previews" role="doc-backlink">Stage Previews</a></h3>
<p>The ability to preview staged releases before they are published is an important feature of this PEP, enabling
an additional level of last-mile testing before the release is available to the public.  Indexes <strong>MAY</strong>
provide this functionality through the URL provided in the <code class="docutils literal notranslate"><span class="pre">stage</span></code> sub-key of the <a class="reference internal" href="#publishing-session-links"><span class="std std-ref">links key</span></a> returned when the publishing session is created.  The <code class="docutils literal notranslate"><span class="pre">stage</span></code> URL can be passed
to installers such as <code class="docutils literal notranslate"><span class="pre">pip</span></code> by setting the <a class="reference external" href="https://pip.pypa.io/en/stable/cli/pip_install/#cmdoption-extra-index-url">–extra-index-url</a> flag to this value.  Multiple
stages can even be previewed by repeating this flag with multiple values.</p>
<p>If supported, the index will return views that expose the staged releases to the installer tool,
making them available to download and install into virtual environments built for that last-mile
testing.  This option allows existing installers to preview staged releases with no
changes to the installer tool required.
The details of this user experience are left to installer tool maintainers.</p>
</section>
<section id="file-upload-mechanisms">
<span id="id17"></span><h3><a class="toc-backref" href="#file-upload-mechanisms" role="doc-backlink">File Upload Mechanisms</a></h3>
<p>Servers <strong>MUST</strong> implement <a class="reference internal" href="#required-file-upload-mechanisms"><span class="std std-ref">required file upload mechanisms</span></a>.
Such mechanisms serve as a fallback if no server specific implementations exist.</p>
<p>Each major version of the Upload API <strong>MUST</strong> specify at least one required file upload mechanism.</p>
<p>New required mechanisms <strong>MUST NOT</strong> be added
and existing required mechanisms <strong>MUST NOT</strong> be removed
without an update to the <a class="reference internal" href="#versioning"><span class="std std-ref">major version</span></a>.
Any server-specific or experimental mechanisms added or removed
<strong>MUST NOT</strong> change the major or minor version number of this specification.</p>
<section id="required-file-upload-mechanisms">
<span id="id18"></span><h4><a class="toc-backref" href="#required-file-upload-mechanisms" role="doc-backlink">Required File Upload Mechanisms</a></h4>
<section id="http-post-bytes">
<h5><a class="toc-backref" href="#http-post-bytes" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">http-post-bytes</span></code></a></h5>
<p>Upload API version 2.0 compliant servers <strong>MUST</strong> support the <code class="docutils literal notranslate"><span class="pre">http-post-bytes</span></code> mechanism.</p>
<p>This mechanism <strong>MUST</strong> use the same authentication scheme as
the rest of the Upload 2.0 protocol endpoints.</p>
<p>A client executes this mechanism by submitting a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request to the <code class="docutils literal notranslate"><span class="pre">file_url</span></code>
returned in the <code class="docutils literal notranslate"><span class="pre">http-post-bytes</span></code> map of the <code class="docutils literal notranslate"><span class="pre">mechanism</span></code> map of the
<a class="reference internal" href="#file-upload-session-response"><span class="std std-ref">file upload session creation response body</span></a> like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Content-Type: application/octet-stream

&lt;binary contents of the file to upload&gt;
</pre></div>
</div>
<p>Servers <strong>MAY</strong> support uploading of digital attestations for files (see <a class="pep reference internal" href="../pep-0740/" title="PEP 740 – Index support for digital attestations">PEP 740</a>).
This support will be indicated by inclusion of an <code class="docutils literal notranslate"><span class="pre">attestations_url</span></code> key in the
<code class="docutils literal notranslate"><span class="pre">http-post-bytes</span></code> map of the <code class="docutils literal notranslate"><span class="pre">mechanism</span></code> map of the
<a class="reference internal" href="#file-upload-session-response"><span class="std std-ref">file upload session creation response body</span></a>.
Attestations <strong>MUST</strong> be uploaded to the <code class="docutils literal notranslate"><span class="pre">attestations_url</span></code> before
<a class="reference internal" href="#file-upload-session-completion"><span class="std std-ref">file upload session completion</span></a>.</p>
<p>To upload an attestation, a client submits a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request to the <code class="docutils literal notranslate"><span class="pre">attestations_url</span></code>
containing a JSON array of <a class="pep reference internal" href="../pep-0740/#attestation-objects" title="PEP 740 – Index support for digital attestations § Attestation objects">attestation objects</a> like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Content-Type: application/json

[{&quot;version&quot;: 1, &quot;verification_material&quot;: {...}, &quot;envelope&quot;: {...}},...]
</pre></div>
</div>
</section>
</section>
<section id="server-specific-file-upload-mechanisms">
<span id="id19"></span><h4><a class="toc-backref" href="#server-specific-file-upload-mechanisms" role="doc-backlink">Server Specific File Upload Mechanisms</a></h4>
<p>A given server <strong>MAY</strong> implement an arbitrary number of server specific mechanisms
and is responsible for documenting their usage.</p>
<p>A server specific implementation file upload mechanism identifier has three parts:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;prefix&gt;-&lt;operator identifier&gt;-&lt;implementation identifier&gt;
</pre></div>
</div>
<p>Server specific implementations <strong>MUST</strong> use <code class="docutils literal notranslate"><span class="pre">vnd</span></code> as their <code class="docutils literal notranslate"><span class="pre">prefix</span></code>.
The <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">identifier</span></code> <strong>SHOULD</strong> clearly identify the server operator,
be unique from other well known indexes,
and contain only alphanumeric characters <code class="docutils literal notranslate"><span class="pre">[a-z0-9]</span></code>.
The <code class="docutils literal notranslate"><span class="pre">implementation</span> <span class="pre">identifier</span></code> <strong>SHOULD</strong> concisely describe the underlying implementation
and contain only alphanumeric characters <code class="docutils literal notranslate"><span class="pre">[a-z0-9]</span></code> and <code class="docutils literal notranslate"><span class="pre">-</span></code>.</p>
<p>When server operators need to make breaking changes to their upload mechanisms,
they <strong>SHOULD</strong> create a new mechanism identifier rather than modifying the existing one.
The recommended pattern is to append a version suffix like <code class="docutils literal notranslate"><span class="pre">-v1</span></code>, <code class="docutils literal notranslate"><span class="pre">-v2</span></code>, etc.
to the implementation identifier.
This allows clients to explicitly opt into new versions while maintaining
backward compatibility with existing clients.</p>
<p>For example:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head">File Upload Mechanism string</th>
<th class="head">Server Operator</th>
<th class="head">Mechanism description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">vnd-pypi-s3multipart-presigned</span></code></td>
<td>PyPI</td>
<td>S3 multipart upload via pre-signed URL</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">vnd-pypi-s3multipart-presigned-v2</span></code></td>
<td>PyPI</td>
<td>S3 multipart upload via pre-signed URL version 2</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">vnd-pypi-http-fetch</span></code></td>
<td>PyPI</td>
<td>File delivered by instructing server to fetch from a URL via HTTP request</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">vnd-acmecorp-http-fetch</span></code></td>
<td>Acme Corp</td>
<td>File delivered by instructing server to fetch from a URL via HTTP request</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">vnd-acmecorp-postal</span></code></td>
<td>Acme Corp</td>
<td>File delivered via postal mail</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">vnd-widgetinc-stream-v1</span></code></td>
<td>Widget Inc.</td>
<td>Streaming upload protocol version 1</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">vnd-widgetinc-stream-v2</span></code></td>
<td>Widget Inc.</td>
<td>Streaming upload protocol version 2</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">vnd-madscience-quantumentanglement</span></code></td>
<td>Mad Science Labs</td>
<td>Upload via quantum entanglement</td>
</tr>
</tbody>
</table>
<p>If a server intends to precisely match the behavior of another server’s implementation, it <strong>MAY</strong> respond
with that implementation’s file upload mechanism name.</p>
</section>
</section>
</section>
<section id="faq">
<h2><a class="toc-backref" href="#faq" role="doc-backlink">FAQ</a></h2>
<section id="does-this-mean-pypi-is-planning-to-drop-support-for-the-existing-upload-api">
<h3><a class="toc-backref" href="#does-this-mean-pypi-is-planning-to-drop-support-for-the-existing-upload-api" role="doc-backlink">Does this mean PyPI is planning to drop support for the existing upload API?</a></h3>
<p>At this time PyPI does not have any specific plans to drop support for the existing upload API.</p>
<p>Unlike with <a class="pep reference internal" href="../pep-0691/" title="PEP 691 – JSON-based Simple API for Python Package Indexes">PEP 691</a> there are significant benefits to doing so, so it is likely that support for
the legacy upload API to be (responsibly) deprecated and removed at some point in the future.
Such future deprecation planning is explicitly out of scope for <em>this</em> PEP.</p>
</section>
<section id="can-i-use-the-upload-2-0-api-to-reserve-a-project-name">
<h3><a class="toc-backref" href="#can-i-use-the-upload-2-0-api-to-reserve-a-project-name" role="doc-backlink">Can I use the upload 2.0 API to reserve a project name?</a></h3>
<p>Yes!  If you’re not ready to upload files to make a release, you can still reserve a project
name (assuming of course that the name doesn’t already exist).</p>
<p>To do this, <a class="reference internal" href="#publishing-session-create"><span class="std std-ref">create a new publishing session</span></a>, then <a class="reference internal" href="#publishing-session-completion"><span class="std std-ref">publish the session</span></a> without uploading any files.  While the <code class="docutils literal notranslate"><span class="pre">version</span></code> key is required in the
JSON body of the create session request, you can simply use a placeholder version number such as
<code class="docutils literal notranslate"><span class="pre">&quot;0.0.0a0&quot;</span></code>.  The version is ignored if no artifacts are uploaded.</p>
<p>Generally the user that created the session will become the owner of the new project, however the
index could define <a class="reference internal" href="#index-specific-metadata"><span class="std std-ref">index-specific metadata</span></a> to, for example, allow
an organization of which the publisher is a member, to own the new project.</p>
</section>
</section>
<section id="open-questions">
<h2><a class="toc-backref" href="#open-questions" role="doc-backlink">Open Questions</a></h2>
<section id="extensions-to-the-upload-2-0-protocol">
<h3><a class="toc-backref" href="#extensions-to-the-upload-2-0-protocol" role="doc-backlink">Extensions to the Upload 2.0 Protocol</a></h3>
<p>Features such as asynchronous webhook notifications for completion of upload processing
were discussed during review of this PEP.
The concept of a capabilities extension for the upload protocol was discussed,
which would allow implementers to advertise support for optional features
such as asynchronous notifications or webhooks.</p>
<p>This idea was left open due to the complexity that would arise in designing
such an extension protocol and ensuring that it did not cause excessive
fracturing of the ecosystem as Upload 2.0 is rolled out.</p>
<p>Future revisions to the upload protocol should explore such extensions
as experience is gained operating Upload 2.0.</p>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-action" role="doc-footnote">
<dt class="label" id="fn-action">[<a href="#id1">1</a>]</dt>
<dd>Obsolete <code class="docutils literal notranslate"><span class="pre">:action</span></code> values <code class="docutils literal notranslate"><span class="pre">submit</span></code>, <code class="docutils literal notranslate"><span class="pre">submit_pkg_info</span></code>, and <code class="docutils literal notranslate"><span class="pre">doc_upload</span></code> are
no longer supported</aside>
<aside class="footnote brackets" id="fn-metadata" role="doc-footnote">
<dt class="label" id="fn-metadata">[<a href="#id2">2</a>]</dt>
<dd>This would be fine if used as a pre-check, but the parallel metadata should be
validated against the actual <code class="docutils literal notranslate"><span class="pre">METADATA</span></code> or similar files within the
distribution.</aside>
<aside class="footnote brackets" id="fn-hash" role="doc-footnote">
<dt class="label" id="fn-hash">[<a href="#id12">3</a>]</dt>
<dd>Specifically any hash algorithm name that <a class="reference external" href="https://docs.python.org/3/library/hashlib.html#hashlib.new">can be passed to</a> <code class="docutils literal notranslate"><span class="pre">hashlib.new()</span></code> and
which does not require additional parameters.</aside>
<aside class="footnote brackets" id="fn-immutable" role="doc-footnote">
<dt class="label" id="fn-immutable">[4]</dt>
<dd>Published files may still be yanked (i.e. <a class="pep reference internal" href="../pep-0592/" title="PEP 592 – Adding “Yank” Support to the Simple API">PEP 592</a>) or <a class="reference external" href="https://pypi.org/help/#file-name-reuse">deleted</a> as normal.</aside>
</aside>
</section>
</section>
<section id="change-history">
<h2><a class="toc-backref" href="#change-history" role="doc-backlink">Change History</a></h2>
<ul class="simple">
<li><a class="reference external" href="TBD">06-Dec-2025</a><ul>
<li>Error responses conform to the <span class="target" id="index-7"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9457.html"><strong>RFC 9457</strong></a> format.</li>
</ul>
</li>
<li><a class="reference external" href="https://discuss.python.org/t/pep-694-pypi-upload-api-2-0-round-2/101483/31">23-Sep-2025</a><ul>
<li>Remove the <code class="docutils literal notranslate"><span class="pre">nonce</span></code> and <code class="docutils literal notranslate"><span class="pre">gentoken()</span></code> algorithm.  Indexes are now responsible for generating
an cryptographically secure session token and obfuscated stage URL (but only if they support
staged previews).</li>
<li>Clarify the semantics when multiple session creation requests are received.</li>
<li>Clarify publishing session steps such as status polling and session extension.</li>
<li>Require that <code class="docutils literal notranslate"><span class="pre">name</span></code> conform to the normalization rules, and include a link.</li>
<li>Require that <code class="docutils literal notranslate"><span class="pre">version</span></code> conform to the version specs, and include a link.</li>
<li>Require <code class="docutils literal notranslate"><span class="pre">filename</span></code> to conform to either the source or binary distribution file name convention, and include links.</li>
<li>Reference RFC 3399 instead of ISO 8601 as the timestamp spec. The RFC is a simpler format that
subsets the ISO standard, and is more appropriate to our use case.</li>
<li>Other protocol clarifications.</li>
<li>Add optional index-specific metadata keys.</li>
</ul>
</li>
<li><a class="reference external" href="https://discuss.python.org/t/pep-694-pypi-upload-api-2-0-round-2/101483">06-Aug-2025</a><ul>
<li>Add Dustin as the PEP Delegate.</li>
</ul>
</li>
<li><a class="reference external" href="https://discuss.python.org/t/pep-694-pypi-upload-api-2-0/76316/9">14-Apr-2025</a><ul>
<li>Updates based on PyCon US discussions.</li>
<li>Added some error return code descriptions where they were underspecified.</li>
<li>Combine the canceling and deleting of upload files sections.</li>
<li>Simplify the rules for replacing a staged but not yet published file.</li>
<li>Add open question about deferring stage previews.</li>
<li>Fix some misspellings and poorly worded text.</li>
</ul>
</li>
<li><a class="reference external" href="https://discuss.python.org/t/pep-694-pypi-upload-api-2-0/76316">06-Jan-2025</a><ul>
<li>Resurrect and update the PEP.</li>
<li>Added Barry as co-author.</li>
<li>Standardize terminology on “stage” rather than “draft”.</li>
<li>Proposed the root URL for PyPI to be <a class="reference external" href="https://upload.pypi.org/2.0">https://upload.pypi.org/2.0</a></li>
<li>Added an optional <code class="docutils literal notranslate"><span class="pre">nonce</span></code> key for session obfuscation.</li>
<li>Standardize JSON keys and made consistent with terminology.</li>
<li>Added and modified several APIs, filling gaps and elaborating on details.</li>
<li>Align the upload protocol with draft Internet Standard.</li>
</ul>
</li>
</ul>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document is placed in the public domain or under the
CC0-1.0-Universal license, whichever is more permissive.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/peps/pep-0694.rst">https://github.com/python/peps/blob/main/peps/pep-0694.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/peps/pep-0694.rst">2025-12-07 20:33:46 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <div id="search"></div>
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#legacy-api">Legacy API</a><ul>
<li><a class="reference internal" href="#endpoint">Endpoint</a></li>
<li><a class="reference internal" href="#encoding">Encoding</a></li>
<li><a class="reference internal" href="#content">Content</a></li>
<li><a class="reference internal" href="#authentication">Authentication</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upload-2-0-api-specification">Upload 2.0 API Specification</a><ul>
<li><a class="reference internal" href="#versioning">Versioning</a></li>
<li><a class="reference internal" href="#content-types">Content Types</a></li>
<li><a class="reference internal" href="#root-endpoint">Root Endpoint</a></li>
<li><a class="reference internal" href="#authentication-for-upload-2-0-api">Authentication for Upload 2.0 API</a></li>
<li><a class="reference internal" href="#errors">Errors</a></li>
<li><a class="reference internal" href="#publishing-session">Publishing Session</a><ul>
<li><a class="reference internal" href="#create-a-publishing-session">Create a Publishing Session</a></li>
<li><a class="reference internal" href="#optional-index-specific-metadata">Optional Index-specific Metadata</a><ul>
<li><a class="reference internal" href="#response-body">Response Body</a></li>
<li><a class="reference internal" href="#multiple-session-creation-requests">Multiple Session Creation Requests</a></li>
<li><a class="reference internal" href="#publishing-session-links">Publishing Session Links</a></li>
<li><a class="reference internal" href="#publishing-session-files">Publishing Session Files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complete-a-publishing-session">Complete a Publishing Session</a></li>
<li><a class="reference internal" href="#publishing-session-cancellation">Publishing Session Cancellation</a></li>
<li><a class="reference internal" href="#publishing-session-status">Publishing Session Status</a></li>
<li><a class="reference internal" href="#publishing-session-extension">Publishing Session Extension</a></li>
<li><a class="reference internal" href="#publishing-session-token">Publishing Session Token</a></li>
</ul>
</li>
<li><a class="reference internal" href="#file-upload-session">File Upload Session</a><ul>
<li><a class="reference internal" href="#create-a-file-upload-session">Create a File Upload Session</a><ul>
<li><a class="reference internal" href="#file-upload-session-response">Response Body</a></li>
<li><a class="reference internal" href="#file-upload-session-links">File Upload Session Links</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complete-a-file-upload-session">Complete a File Upload Session</a></li>
<li><a class="reference internal" href="#cancellation-and-deletion">Cancellation and Deletion</a></li>
<li><a class="reference internal" href="#replacing-a-partially-or-fully-uploaded-file">Replacing a Partially or Fully Uploaded File</a></li>
<li><a class="reference internal" href="#file-upload-session-status">File Upload Session Status</a></li>
<li><a class="reference internal" href="#file-upload-session-extension">File Upload Session Extension</a></li>
</ul>
</li>
<li><a class="reference internal" href="#stage-previews">Stage Previews</a></li>
<li><a class="reference internal" href="#file-upload-mechanisms">File Upload Mechanisms</a><ul>
<li><a class="reference internal" href="#required-file-upload-mechanisms">Required File Upload Mechanisms</a><ul>
<li><a class="reference internal" href="#http-post-bytes"><code class="docutils literal notranslate"><span class="pre">http-post-bytes</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#server-specific-file-upload-mechanisms">Server Specific File Upload Mechanisms</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#faq">FAQ</a><ul>
<li><a class="reference internal" href="#does-this-mean-pypi-is-planning-to-drop-support-for-the-existing-upload-api">Does this mean PyPI is planning to drop support for the existing upload API?</a></li>
<li><a class="reference internal" href="#can-i-use-the-upload-2-0-api-to-reserve-a-project-name">Can I use the upload 2.0 API to reserve a project name?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#open-questions">Open Questions</a><ul>
<li><a class="reference internal" href="#extensions-to-the-upload-2-0-protocol">Extensions to the Upload 2.0 Protocol</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-history">Change History</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/peps/pep-0694.rst?plain=1">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
    <script src="../_static/sticky_banner.js"></script>
    <script src="https://analytics.python.org/js/script.outbound-links.js"
            data-domain="peps.python.org" defer></script>
    <script src="/pagefind/pagefind-ui.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            // Ranking configuration to boost exact title matches
            const searchOptions = {
                ranking: {
                    termSimilarity: 9.0, // Higher values favor exact matches
                    termFrequency: 0.5, // Lower values reduce penalty for low term frequency
                    pageLength: 0.2, // Lower values reduce the impact of page length
                }
            };

            // Initialize pagefind for either mobile or desktop, not both
            if (window.innerWidth <= 640) {
                new PagefindUI({ element: "#mobile-search", ...searchOptions, showSubResults: false });
            } else {
                new PagefindUI({ element: "#search", ...searchOptions, showSubResults: true });
            }
        });
    </script>
</body>
</html>