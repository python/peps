
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 762 – REPL-acing the default REPL | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0762/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://peps.python.org/peps.rss">
    <meta property="og:title" content='PEP 762 – REPL-acing the default REPL | peps.python.org'>
    <meta property="og:description" content="One of Python’s core strengths is its interactive mode, also known as the Read-Eval-Print Loop (REPL), or the Python console, or the Python shell. This PEP describes the new implementation of this functionality written in Python. The new REPL released i...">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://peps.python.org/pep-0762/">
    <meta property="og:site_name" content="Python Enhancement Proposals (PEPs)">
    <meta property="og:image" content="https://peps.python.org/_static/og-image.png">
    <meta property="og:image:alt" content="Python PEPs">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta name="description" content="One of Python’s core strengths is its interactive mode, also known as the Read-Eval-Print Loop (REPL), or the Python console, or the Python shell. This PEP describes the new implementation of this functionality written in Python. The new REPL released i...">
    <meta name="theme-color" content="#3776ab">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 762</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 762 – REPL-acing the default REPL</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Pablo Galindo Salgado &lt;pablogsal&#32;&#97;t&#32;python.org&gt;, Łukasz Langa &lt;lukasz&#32;&#97;t&#32;python.org&gt;, Lysandros Nikolaou &lt;lisandrosnik&#32;&#97;t&#32;gmail.com&gt;, Emily Morehouse-Valcarcel &lt;emily&#32;&#97;t&#32;python.org&gt;</dd>
<dt class="field-even">Sponsor<span class="colon">:</span></dt>
<dd class="field-even">Pablo Galindo Salgado</dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><abbr title="Accepted and implementation complete, or no longer active">Final</abbr></dd>
<dt class="field-even">Type<span class="colon">:</span></dt>
<dd class="field-even"><abbr title="Non-normative PEP containing background, guidelines or other information relevant to the Python ecosystem">Informational</abbr></dd>
<dt class="field-odd">Created<span class="colon">:</span></dt>
<dd class="field-odd">11-Oct-2024</dd>
<dt class="field-even">Python-Version<span class="colon">:</span></dt>
<dd class="field-even">3.13</dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#specification">Specification</a></li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a></li>
<li><a class="reference internal" href="#acknowledgments">Acknowledgments</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p>One of Python’s core strengths is its interactive mode, also known as the
Read-Eval-Print Loop (REPL), or the Python console, or the Python shell. This
PEP describes the new implementation of this functionality written in Python.
The new REPL released in Python 3.13 aims to provide modern features expected by
today’s users, such as multi-line editing, syntax highlighting, custom commands,
and an overall improved interactive experience.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation" role="doc-backlink">Motivation</a></h2>
<p>Up to Python 3.12, the interactive shell of CPython was written in C as a
special mode of the parser. It was therefore difficult to maintain and extend.
It relied on the existence of GNU readline (or an equivalent) for basic
functionality like cursor movement and history tracking. Python compiled without
this library provided an interactive mode of very limited capability. On the
other hand, Python compiled with readline outsourced decisions and configuration
around user input in ways that made extending it difficult.</p>
<p>This complexity has deterred contributions and has made it challenging to
implement new features. As a result, the CPython interactive shell has seen
minimal changes, falling behind user expectations for modern equivalents.</p>
<p>Many features that users have come to expect from modern REPLs were absent in
the previous version. Some examples of these features include multi-line editing
and history, custom commands, syntax highlighting, or ergonomic handling of copy
and paste. The lack of these features greatly impacts the user experience of
many groups of users of CPython, in particular in environments where users don’t
control dependencies and cannot install their own packages. This is especially
common for users learning the language and educators.</p>
<p>Addressing such issues with the C implementation would require complex
workarounds, such as AST matching of commands, which would add prohibitive
complexity to the codebase.</p>
<p>With the new REPL written in Python, we are addressing these limitations while
also bringing CPython’s interactive experience more in line with modern
expectations and capabilities.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale" role="doc-backlink">Rationale</a></h2>
<p>Implementing the new REPL in Python, rather than C, has significantly lowered
the barrier to entry for contributors. This change has made it easier to test,
validate, and modify the REPL, leading to increased community involvement and
faster feature development. The improved accessibility of the codebase is
expected to result in a more rapidly evolving and user-responsive REPL.</p>
<p>Instead of writing a Python REPL from scratch, we decided to base the
implementation of the new REPL on <a class="reference external" href="https://github.com/pypy/pypy/tree/d102094b863ce49b7af030dcb0cecaac515d97c6/lib_pypy/pyrepl">PyREPL</a>.
This decision was driven by several key factors. First and foremost,
developing a terminal application that works consistently across different
operating systems and terminal emulators is a complex undertaking.
By adopting PyREPL, which has been battle-tested in the PyPy project,
we can leverage existing, proven code rather than starting from scratch.</p>
<p>Sharing a codebase with PyPy for the REPL implementation offers mutual benefits
to both projects. It allows for shared maintenance efforts, faster bug fixes,
and feature improvements that can benefit users of both CPython and PyPy. This
collaboration can lead to a more robust and feature-rich REPL for the entire
Python ecosystem.</p>
<p>The previous REPL written in C leveraged the “readline” or “editline” libraries
as a backend to allow certain features such as navigation, history preservation
and recall, autocompletion, and configurable keyboard behavior. PyREPL does not
use those libraries, implementing most of the other functionality directly as
part of the shell. The main missing functionality (configurability of input) is
outweighed by the benefits of the new architecture. The configuration files for
these libraries (e.g. inputrc) are complex and include features that PyREPL
doesn’t plan to implement, making it infeasible to transparently add support for
them in the new shell. Using “readline” or “editline” in PyREPL would be
prohibitively complex due to multi-line editing handling and multiplatform
support.</p>
<p>Although this means that existing readline/editline configurations will not be
compatible with the PyREPL, we believe the enhanced features and improved
extensibility are an overall win. See “Backwards Compatibility” for discussion
of continued support for customized workflows.</p>
<p>The previous REPL made it challenging to properly implement custom commands,
which is a very common feature of interactive shells. For instance, the <code class="docutils literal notranslate"><span class="pre">exit</span></code>
command was implemented as a method call of a custom object injected in the
global namespace, leading to unintuitive behavior that often confuses users when
they simply type <code class="docutils literal notranslate"><span class="pre">exit</span></code>, as the interpreter prompts them to the supposedly
correct usage <code class="docutils literal notranslate"><span class="pre">exit()</span></code>.</p>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification" role="doc-backlink">Specification</a></h2>
<p>PyREPL is implemented as a new private Python module called <code class="xref py py-mod docutils literal notranslate"><span class="pre">_pyrepl</span></code>, existing
alongside the current C implementation. In its first implementation, it
introduces the following key features:</p>
<ol class="arabic">
<li>Multi-line History and Editing: Users are able to navigate and edit their
command history across multiple lines, improving the ability to refine and reuse
complex blocks of code.<p>Editing multi-line blocks provides automatic indentation using four spaces, which
is consistent with <a class="pep reference internal" href="../pep-0008/" title="PEP 8 – Style Guide for Python Code">PEP 8</a> recommendations. When a line ending with a colon is
encountered, the following line is automatically indented utilizing the
indentation pattern that is inferred from the first line that contains
indentation. Lines are indented with four spaces, and tabs are converted into
spaces.</p>
<p>Users can access history of commands by using <kbd class="kbd docutils literal notranslate">up</kbd> and <kbd class="kbd docutils literal notranslate">down</kbd> arrows. Within
a multi-line entry, the arrow keys navigate line-by-line within the block before
moving to the next history entry. The <kbd class="kbd docutils literal notranslate">down</kbd> arrow works in reverse, navigating
from older entries to the most recent.</p>
<p>History can be searched forward (using <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd>+<kbd class="kbd docutils literal notranslate">S</kbd></kbd>) and in reverse (using <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd>+<kbd class="kbd docutils literal notranslate">R</kbd></kbd>)
using a custom-specified substring query. It can also be searched with a prefix
query by entering the prefix into a shell line and using PageUp and PageDown
keys.</p>
</li>
<li>Copying and Pasting: in supported terminal emulators, bracketed pasting
capability is discovered and used by PyREPL. This allows for transparent pasting
of blocks of code without immediate execution or invalid automatic indentation.<p>For terminal emulators that don’t support this mode, a dedicated paste mode is
implemented to allow for easy insertion of multi-line code snippets without
triggering immediate execution or indentation issues.</p>
<p>Users enter manual paste mode by hitting the <kbd class="kbd docutils literal notranslate">F3</kbd> key. The prompt changes from
<code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span></code> to <code class="docutils literal notranslate"><span class="pre">(paste)</span></code> where users can paste contents from their clipboard or
manually type as desired. Once the content is ready, hitting <kbd class="kbd docutils literal notranslate">F3</kbd> exits paste
mode. Then, pressing Enter executes the block.</p>
<p>Users can enter multiple commands on a single input when using paste mode, which
will help paste code from other sources.</p>
<p>To copy blocks of code without the leading command prompts and without the
output of the commands, users can enter the history view via the <kbd class="kbd docutils literal notranslate">F2</kbd> key. This
mode uses a pager to display history of executed commands without the prompts
and output.</p>
</li>
<li>Help via <kbd class="kbd docutils literal notranslate">F1</kbd>.<p>Access to the standard Help module is accessible via a Custom Command <code class="docutils literal notranslate"><span class="pre">help</span></code>
(see below) or via the <kbd class="kbd docutils literal notranslate">F1</kbd> key. Hit <kbd class="kbd docutils literal notranslate">F1</kbd> to enter help mode. When you’re done, hit
<kbd class="kbd docutils literal notranslate">F1</kbd> or a standard command (<code class="docutils literal notranslate"><span class="pre">q</span></code>, <code class="docutils literal notranslate"><span class="pre">quit</span></code> or <code class="docutils literal notranslate"><span class="pre">exit</span></code>) to exit.</p>
<p>Browsing interactive help does not retain command history.</p>
</li>
<li>Custom Commands: The REPL supports the implementation of custom commands,
such as <code class="docutils literal notranslate"><span class="pre">exit</span></code>, in a more natural and user-friendly manner, avoiding the current
function call workaround.<p>The initial list of custom commands includes:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">exit</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">quit</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">copyright</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">help</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">clear</span></code></li>
</ul>
<p>Commands are available as long as there is no name conflict with a variable in a
reachable scope. For example, after assigning <code class="docutils literal notranslate"><span class="pre">exit</span> <span class="pre">=</span> <span class="pre">1</span></code>, the variable will
take precedence over PyREPL commands. <code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">exit</span></code> in this case will remove the
conflict and the command will function again.</p>
</li>
<li>Colors: the prompts as well as certain elements of the output, like exception
tracebacks, are now colored. Colors can be disabled using the standard
<code class="docutils literal notranslate"><span class="pre">NO_COLOR</span></code> environment variable, or forced by using the standard
<code class="docutils literal notranslate"><span class="pre">FORCE_COLOR</span></code> environment variable. A Python-specific environment variable is
also available called <code class="docutils literal notranslate"><span class="pre">PYTHON_COLORS</span></code>. The initial implementation in Python
3.13 does not offer customization of the color theme.</li>
</ol>
<p>These features are significantly enhancing the interactive Python experience,
bringing it more in line with modern development environments and user
expectations. The implementation is in Python, offering several advantages:</p>
<ol class="arabic simple">
<li>Easier Testing and Validation: Writing tests for Python code is dramatically
simpler and more straightforward than for C code, allowing for more
comprehensive test coverage of all existing and old features.</li>
<li>Lower Contribution Barrier: Python’s accessibility compared to C has been
encouraging more community contributions, leading to faster feature development
and bug fixes.</li>
<li>Flexibility: A Python implementation is easier to extend and modify,
improving developer velocity on new features and improvements by core developers
and contributors alike.</li>
</ol>
</section>
<section id="backwards-compatibility">
<h2><a class="toc-backref" href="#backwards-compatibility" role="doc-backlink">Backwards Compatibility</a></h2>
<p>The PyREPL implementation is designed to maintain full backward compatibility
with existing Python code as the old basic REPL will be preserved as a fallback
and is available on demand, in case custom workflows require it. It will also be
used in cases where the new REPL cannot be used due to environmental constraints
or other issues.  Users have the option to explicitly choose the old basic REPL
by setting the environment variable <code class="docutils literal notranslate"><span class="pre">PYTHON_BASIC_REPL</span></code> to 1. This ensures
that users can continue using the familiar interface and capabilities if they
prefer, or if they encounter any issues with the new implementation.</p>
<p>It’s important to emphasize that the introduction of PyREPL does not remove any
existing functionality. Any functionality of the old basic REPL unavailable in
PyREPL is preserved and maintained in the old basic REPL that can be used by
users as a fallback.</p>
<p>In particular, users wanting to continue using their custom input configuration
in <code class="docutils literal notranslate"><span class="pre">inputrc</span></code> or <code class="docutils literal notranslate"><span class="pre">editrc</span></code> files can continue using the old basic REPL.</p>
<p>The authors do not expect any PyREPL functionality to be ported to the old basic
REPL. Similarly, <code class="docutils literal notranslate"><span class="pre">inputrc</span></code> and <code class="docutils literal notranslate"><span class="pre">editrc</span></code> support is explicitly not planned in
PyREPL. Those configuration files are provided by and parsed by “readline” and
“editline” libraries, and their functional scope does not match the
functionality PyREPL is targeting.</p>
<p>To facilitate a smooth transition, <a class="reference external" href="https://docs.python.org/3.13/tutorial/appendix.html#interactive-mode">clear documentation</a>
is provided on how to switch between PyREPL and the old basic REPL.</p>
<p>This approach ensures that while we’re introducing significant improvements with
the new REPL, we’re not forcing any immediate changes on users who rely on the
current implementation. The fallback mechanism and user choice option provide a
safety net that allows for gradual adoption of the new REPL while maintaining
all existing functionality.</p>
</section>
<section id="security-implications">
<h2><a class="toc-backref" href="#security-implications" role="doc-backlink">Security Implications</a></h2>
<p>There are no security implications derived from this proposal.</p>
</section>
<section id="how-to-teach-this">
<h2><a class="toc-backref" href="#how-to-teach-this" role="doc-backlink">How to Teach This</a></h2>
<p>The introduction of PyREPL is accompanied by documentation and tutorials. Key
areas of focus for education will include:</p>
<ol class="arabic simple">
<li>Detailed explanations on using multi-line editing, paste mode, and other new
features.</li>
<li>Custom commands (existing and new).</li>
<li>How to switch to the new REPL, including any
differences from the previous readline/editline-based configuration.</li>
</ol>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#rejected-ideas" role="doc-backlink">Rejected Ideas</a></h2>
<p>Several alternative approaches were considered and ultimately rejected:</p>
<ol class="arabic simple">
<li>Extending the current C implementation: While this would maintain maximum
backwards compatibility, it was deemed too complex and would not address the
fundamental limitations described ut supra.</li>
<li>Developing a new REPL from scratch: This approach was rejected due to the
complexity of creating a cross-platform terminal application and the desire to
leverage existing, proven code.</li>
<li>Using other existing REPL implementations: The authors looked at several
alternatives like <a class="reference external" href="https://ipython.org/">IPython</a>,
<a class="reference external" href="https://bpython-interpreter.org/">bpython</a>,
<a class="reference external" href="https://github.com/prompt-toolkit/ptpython">ptpython</a>, and
<a class="reference external" href="https://xon.sh/">xonsh</a>.  While all the above are impressive projects,
in the end PyREPL was chosen for its combination of maturity, feature set,
and lack of additional dependencies.  Another key factor was the alignment
with PyPy’s implementation.</li>
</ol>
</section>
<section id="acknowledgments">
<h2><a class="toc-backref" href="#acknowledgments" role="doc-backlink">Acknowledgments</a></h2>
<p>Thanks to Diego Russo for providing feedback on drafts of this PEP.</p>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document is placed in the public domain or under the CC0-1.0-Universal
license, whichever is more permissive.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/peps/pep-0762.rst">https://github.com/python/peps/blob/main/peps/pep-0762.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/peps/pep-0762.rst">2025-02-01 07:28:42 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#specification">Specification</a></li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a></li>
<li><a class="reference internal" href="#acknowledgments">Acknowledgments</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/peps/pep-0762.rst?plain=1">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
    <script src="../_static/sticky_banner.js"></script>
    <script src="https://analytics.python.org/js/script.outbound-links.js"
            data-domain="peps.python.org" defer></script>
</body>
</html>