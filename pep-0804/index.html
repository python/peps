
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 804 – An external dependency registry and name mapping mechanism | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0804/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://peps.python.org/peps.rss">
    <meta property="og:title" content='PEP 804 – An external dependency registry and name mapping mechanism | peps.python.org'>
    <meta property="og:description" content="This PEP specifies a name mapping mechanism that allows packaging tools to map external dependency identifiers (as introduced in PEP 725) to their counterparts in other package repositories.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://peps.python.org/pep-0804/">
    <meta property="og:site_name" content="Python Enhancement Proposals (PEPs)">
    <meta property="og:image" content="https://peps.python.org/_static/og-image.png">
    <meta property="og:image:alt" content="Python PEPs">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta name="description" content="This PEP specifies a name mapping mechanism that allows packaging tools to map external dependency identifiers (as introduced in PEP 725) to their counterparts in other package repositories.">
    <meta name="theme-color" content="#3776ab">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1 data-pagefind-ignore>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 804</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        
        <div id="mobile-search" class="mobile-search-container"></div>
        
        <article data-pagefind-body>
            
            <span data-pagefind-meta="title:PEP 804 – An external dependency registry and name mapping mechanism" data-pagefind-weight="10" class="visually-hidden">PEP 804 – An external dependency registry and name mapping mechanism</span>
            <section id="pep-content">
<h1 class="page-title">PEP 804 – An external dependency registry and name mapping mechanism</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Pradyun Gedam &lt;pradyunsg&#32;&#97;t&#32;gmail.com&gt;,
Ralf Gommers &lt;ralf.gommers&#32;&#97;t&#32;gmail.com&gt;,
Michał Górny &lt;mgorny&#32;&#97;t&#32;quansight.com&gt;,
Jaime Rodríguez-Guerra &lt;jaime.rogue&#32;&#97;t&#32;gmail.com&gt;,
Michael Sarahan &lt;msarahan&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-even">Discussions-To<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="https://discuss.python.org/t/103891">Discourse thread</a></dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><abbr title="Proposal under active discussion and revision">Draft</abbr></dd>
<dt class="field-even">Type<span class="colon">:</span></dt>
<dd class="field-even"><abbr title="Normative PEP with a new feature for Python, implementation change for CPython or interoperability standard for the ecosystem">Standards Track</abbr></dd>
<dt class="field-odd">Topic<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="../topic/packaging/">Packaging</a></dd>
<dt class="field-even">Requires<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="../pep-0725/">725</a></dd>
<dt class="field-odd">Created<span class="colon">:</span></dt>
<dd class="field-odd">03-Sep-2025</dd>
<dt class="field-even">Post-History<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="https://discuss.python.org/t/103891" title="Discourse thread">22-Sep-2025</a></dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a><ul>
<li><a class="reference internal" href="#prior-art">Prior art</a></li>
<li><a class="reference internal" href="#governance-and-maintenance-costs-of-name-mappings">Governance and maintenance costs of name mappings</a></li>
<li><a class="reference internal" href="#generating-package-manager-specific-install-commands">Generating package manager-specific install commands</a></li>
<li><a class="reference internal" href="#registry-design">Registry design</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#central-registry">Central registry</a></li>
<li><a class="reference internal" href="#mappings">Mappings</a></li>
<li><a class="reference internal" href="#known-ecosystems">Known ecosystems</a></li>
<li><a class="reference internal" href="#schema-details">Schema details</a><ul>
<li><a class="reference internal" href="#central-registry-schema">Central registry schema</a><ul>
<li><a class="reference internal" href="#schema"><code class="docutils literal notranslate"><span class="pre">$schema</span></code></a></li>
<li><a class="reference internal" href="#schema-version"><code class="docutils literal notranslate"><span class="pre">schema_version</span></code></a></li>
<li><a class="reference internal" href="#definitions"><code class="docutils literal notranslate"><span class="pre">definitions</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#known-ecosystems-schema">Known ecosystems schema</a><ul>
<li><a class="reference internal" href="#id1"><code class="docutils literal notranslate"><span class="pre">$schema</span></code></a></li>
<li><a class="reference internal" href="#id2"><code class="docutils literal notranslate"><span class="pre">schema_version</span></code></a></li>
<li><a class="reference internal" href="#ecosystems"><code class="docutils literal notranslate"><span class="pre">ecosystems</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mappings-schema">Mappings schema</a><ul>
<li><a class="reference internal" href="#id3"><code class="docutils literal notranslate"><span class="pre">$schema</span></code></a></li>
<li><a class="reference internal" href="#id4"><code class="docutils literal notranslate"><span class="pre">schema_version</span></code></a></li>
<li><a class="reference internal" href="#name"><code class="docutils literal notranslate"><span class="pre">name</span></code></a></li>
<li><a class="reference internal" href="#description"><code class="docutils literal notranslate"><span class="pre">description</span></code></a></li>
<li><a class="reference internal" href="#id5"><code class="docutils literal notranslate"><span class="pre">mappings</span></code></a></li>
<li><a class="reference internal" href="#package-managers"><code class="docutils literal notranslate"><span class="pre">package_managers</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#registry-known-ecosystems-and-mappings">Registry, known ecosystems and mappings</a></li>
<li><a class="reference internal" href="#pyproject-external-cli">pyproject-external CLI</a></li>
<li><a class="reference internal" href="#pyproject-external-api">pyproject-external API</a></li>
<li><a class="reference internal" href="#grayskull">Grayskull</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a><ul>
<li><a class="reference internal" href="#central-depurl-registry-maintainers">Central DepURL registry maintainers</a></li>
<li><a class="reference internal" href="#package-ecosystem-maintainers-usage">Package ecosystem maintainers usage</a></li>
<li><a class="reference internal" href="#maintainers-of-python-projects">Maintainers of Python projects</a></li>
<li><a class="reference internal" href="#end-user-package-consumers">End user package consumers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#centralized-mappings-governed-by-the-same-body">Centralized mappings governed by the same body</a></li>
<li><a class="reference internal" href="#allowing-ecosystem-specific-variants-of-packages">Allowing ecosystem-specific variants of packages</a></li>
<li><a class="reference internal" href="#adding-more-package-metadata-to-the-central-registry">Adding more package metadata to the central registry</a></li>
<li><a class="reference internal" href="#mapping-pypi-projects-to-repackaged-counterparts-in-target-ecosystems">Mapping PyPI projects to repackaged counterparts in target ecosystems</a></li>
<li><a class="reference internal" href="#strict-validation-of-identifiers">Strict validation of identifiers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#open-issues">Open Issues</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#appendix-a-operational-suggestions">Appendix A: Operational suggestions</a></li>
<li><a class="reference internal" href="#appendix-b-virtual-versioning-proposal">Appendix B: Virtual versioning proposal</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p>This PEP specifies a name mapping mechanism that allows packaging tools to map
external dependency identifiers (as introduced in <a class="pep reference internal" href="../pep-0725/" title="PEP 725 – Specifying external dependencies in pyproject.toml">PEP 725</a>) to their
counterparts in other package repositories.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation" role="doc-backlink">Motivation</a></h2>
<p>Packages on PyPI often require build-time and runtime dependencies that are not
present on PyPI. <a class="pep reference internal" href="../pep-0725/" title="PEP 725 – Specifying external dependencies in pyproject.toml">PEP 725</a> introduced metadata to express
such dependencies. Using concrete external dependency metadata for
a Python package requires mapping the given dependency identifiers to the specifiers
used in other ecosystems, which would allow to:</p>
<ul class="simple">
<li>Enabling tools to automatically map external dependencies to packages in other
packaging repositories/ecosystems,</li>
<li>Including the needed external dependencies <em>with the package
names used by the relevant system package manager on the user’s system</em> in
error messages emitted by Python package installers and build frontends,
as well as allowing the user to query for those names directly to obtain install
instructions.</li>
</ul>
<p>Packaging ecosystems like Linux distros, conda, Homebrew, Spack, and Nix need
full sets of dependencies for Python packages, and have tools like <a class="reference external" href="https://github.com/fedora-python/pyp2rpm">pyp2rpm</a>
(Fedora), <a class="reference external" href="https://github.com/conda/grayskull">Grayskull</a> (conda), and <a class="reference external" href="https://www.debian.org/doc/packaging-manuals/python-policy/index.html#dh-python">dh_python</a> (Debian) which attempt to
automatically generate dependency information from the metadata available in
upstream Python packages. Before PEP 725, external dependencies were handled manually,
because there was no metadata for this in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> or any other
standard metadata file. Enabling its automatic conversion is a key benefit of
this PEP, making Python packaging easier and more reliable. In addition, the
authors envision other types of tools making use of this information; e.g.,
dependency analysis tools like <a class="reference external" href="https://repology.org/">Repology</a>, <a class="reference external" href="https://github.com/dependabot">Dependabot</a> and <a class="reference external" href="https://libraries.io/">libraries.io</a>.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale" role="doc-backlink">Rationale</a></h2>
<section id="prior-art">
<h3><a class="toc-backref" href="#prior-art" role="doc-backlink">Prior art</a></h3>
<p>The R language has a <a class="reference external" href="https://github.com/rstudio/r-system-requirements">System Requirements for R packages</a> with a central
registry that knows how to translate external dependency metadata to install
commands for package managers like <code class="docutils literal notranslate"><span class="pre">apt-get</span></code>. This registry centralises the
mappings for a series of Linux distributions, and also Windows. macOS is not
present. The <a class="reference external" href="https://github.com/rstudio/r-system-requirements/blob/7314012a48d38854c19f439e1c2d2e4b383fe7ea/README.md#rule-coverage">“Rule Coverage” of its README</a>
used to show that this system improves the chance of success of building packages
from CRAN from source. Across all CRAN packages,
Ubuntu 18 improved from 78.1% to 95.8%, CentOS 7 from 77.8% to 93.7% and openSUSE
15.0 from 78.2% to 89.7%. The chance of success depends on how well the registry
is maintained, but the gain is significant: ~4x fewer packages fail to build on
Ubuntu and CentOS in a Docker container.</p>
<p>RPM-based distributions, like Fedora, can use a <a class="reference external" href="https://discuss.python.org/t/wanting-a-singular-packaging-tool-vision/21141/117">rule-based implementation</a>
(<code class="docutils literal notranslate"><span class="pre">NameConvertor</span></code>) in <a class="reference external" href="https://github.com/fedora-python/pyp2rpm">pyp2rpm</a>. The main rule is that the RPM name for a PyPI package is
<code class="docutils literal notranslate"><span class="pre">f&quot;python-{pypi_package_name}&quot;</span></code>. This seems to work quite well; there are a
few variants like Python version specific names, where the prefix contains the
Python major and minor version numbers (e.g. <code class="docutils literal notranslate"><span class="pre">python311-</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">python-</span></code>).</p>
<p>Gentoo follows a similar approach to naming Python packages, using the <code class="docutils literal notranslate"><span class="pre">dev-python/</span></code>
category and some <a class="reference external" href="https://projects.gentoo.org/python/guide/package-maintenance.html">well-specified rules</a>.</p>
<p>Conda-forge has a more explicit name mapping, because the base names are the
same in conda-forge as on PyPI (e.g., <code class="docutils literal notranslate"><span class="pre">numpy</span></code> maps to <code class="docutils literal notranslate"><span class="pre">numpy</span></code>), but there
are many exceptions because of both name collisions and renames (e.g., the PyPI
name for PyTorch is <code class="docutils literal notranslate"><span class="pre">torch</span></code> while in conda-forge it’s <code class="docutils literal notranslate"><span class="pre">pytorch</span></code>). There are
several name mappings efforts maintained by different teams. Conda-forge’s infrastructure
generates one in <a class="reference external" href="https://github.com/regro/cf-graph-countyfair/tree/master/mappings/pypi">regro/cf-graph-countyfair</a>.
Grayskull maintains <a class="reference external" href="https://github.com/conda/grayskull/blob/main/grayskull/strategy/config.yaml">its own curated mapping</a>.
Prefix.dev created the <a class="reference external" href="https://github.com/prefix-dev/parselmouth">parselmouth mappings</a>
to support conda and PyPI integrations in their tooling. A more complete overview of
their approaches, strengths and weaknesses can be found in
<a class="reference external" href="https://github.com/conda/grayskull/issues/564">conda/grayskull#564</a>.</p>
<p>The <a class="reference external" href="https://www.openstack.org/">OpenStack</a> ecosystem also needs to deal with
some mapping efforts. All of them focus on Linux distributions, exclusively.
<a class="reference external" href="https://docs.openstack.org/diskimage-builder/latest/elements/pkg-map/README.html">pkg-map</a>
accompanies <code class="docutils literal notranslate"><span class="pre">diskimage-builder</span></code> and provides a file format where the user defines
arbitrary variable names and their corresponding names in the target distro
(Red Hat, Debian, OpenSUSE, etc). See <a class="reference external" href="https://github.com/stbenjam/diskimage-builder/blob/5bc5f8aff3b40b1918ce72660f1dba38c3c4f27a/diskimage_builder/elements/svc-map/pkg-map#L4">example for PyYAML</a>.
<a class="reference external" href="https://opendev.org/opendev/bindep">bindep</a> defines a file <code class="docutils literal notranslate"><span class="pre">bindep.txt</span></code>
(see <a class="reference external" href="https://opendev.org/opendev/bindep/src/branch/master/bindep/tests/bindep.txt">example</a>)
where users can write down dependencies that are not installable from PyPI. The format is
line-based, with each line containing a dependency as found in the Debian ecosystem.
For other distributions, it offers a “filters” syntax between square brackets where users
can indicate other target platforms, optional dependencies and extras.</p>
<p>The need for mappings is also found in other ecosystems like <a class="reference external" href="https://github.com/sagemath/sage/issues/36356">SageMath</a>,
but also by end-users themselves who want to install PyPI packages with their system
package manager of choice (<a class="reference external" href="https://unix.stackexchange.com/q/761371">example StackOverflow question</a>).</p>
</section>
<section id="governance-and-maintenance-costs-of-name-mappings">
<h3><a class="toc-backref" href="#governance-and-maintenance-costs-of-name-mappings" role="doc-backlink">Governance and maintenance costs of name mappings</a></h3>
<p>The maintenance cost of external dependency mappings to a large number of packaging
ecosystems is potentially high. We choose to define the registry in such
a way that:</p>
<ul class="simple">
<li>A central authority maintains the list of recognized DepURLs and the
known ecosystem mappings.</li>
<li>The mappings themselves are maintained by the target packaging ecosystems.</li>
</ul>
<p>Hence this system is opt-in for a given ecosystem, and the associated
maintenance costs are distributed.</p>
</section>
<section id="generating-package-manager-specific-install-commands">
<h3><a class="toc-backref" href="#generating-package-manager-specific-install-commands" role="doc-backlink">Generating package manager-specific install commands</a></h3>
<p>Python package authors with external dependencies usually have installation
instructions for those external dependencies in their documentation. These
instructions are difficult to write and keep up-to-date, and are usually only
covering one or at most a handful of platforms. As an example, here are SciPy’s
instructions for its external build dependencies (C/C++/Fortran compilers,
OpenBLAS, pkg-config):</p>
<ul class="simple">
<li>Debian/Ubuntu: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">gcc</span> <span class="pre">g++</span> <span class="pre">gfortran</span> <span class="pre">libopenblas-dev</span> <span class="pre">liblapack-dev</span> <span class="pre">pkg-config</span> <span class="pre">python3-pip</span> <span class="pre">python3-dev</span></code></li>
<li>Fedora: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">dnf</span> <span class="pre">install</span> <span class="pre">gcc-gfortran</span> <span class="pre">python3-devel</span> <span class="pre">openblas-devel</span> <span class="pre">lapack-devel</span> <span class="pre">pkgconfig</span></code></li>
<li>CentOS/RHEL: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">yum</span> <span class="pre">install</span> <span class="pre">gcc-gfortran</span> <span class="pre">python3-devel</span> <span class="pre">openblas-devel</span> <span class="pre">lapack-devel</span> <span class="pre">pkgconfig</span></code></li>
<li>Arch Linux: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">pacman</span> <span class="pre">-S</span> <span class="pre">gcc-fortran</span> <span class="pre">openblas</span> <span class="pre">pkgconf</span></code></li>
<li>Homebrew on macOS: <code class="docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">gfortran</span> <span class="pre">openblas</span> <span class="pre">pkg-config</span></code></li>
</ul>
<p>The package names vary a lot, and there are differences like some distros
splitting off headers and other build-time dependencies in a separate
<code class="docutils literal notranslate"><span class="pre">-dev</span></code>/<code class="docutils literal notranslate"><span class="pre">-devel</span></code> package while others do not. With the registry in this PEP,
this could be made both more comprehensive and easier to maintain through a tool
command with semantics of <em>“show this ecosystem’s preferred package manager
install command for all external dependencies”</em>. This may be done as a
standalone tool, or as a new subcommand in any Python development workflow tool
(e.g., Pip, Poetry, Hatch, PDM, uv).</p>
<p>To this end, each ecosystem mapping can provide a list of package managers
known to be compatible, with templated instructions on how to install and query
packages. The provided install command templates are paired with query command templates
so those tools can check whether the needed packages are already present without
having to attempt an install operation (which might be expensive and have unintended
side effects like version upgrades).</p>
</section>
<section id="registry-design">
<h3><a class="toc-backref" href="#registry-design" role="doc-backlink">Registry design</a></h3>
<p>The mapping infrastructure has been designed to present the following components and properties:</p>
<ul class="simple">
<li>A central registry of PEP 725 identifiers (DepURLs), including at least the
well-known generic and virtual identifiers considered canonical.</li>
<li>A list of known ecosystems, where ecosystem maintainers can register their name mapping(s).</li>
<li>A standardized schema that defines how mappings should be structured. Each mapping can
also provide programmatic details about how their supported package manager(s) work.</li>
</ul>
<p>The above documents are provided as JSON files validated by accompanying JSON schemas.
A Python library and CLI is provided to query and utilize these resources. The user can
configure which system package manager they prefer to use for the default package mappings
and command generation (e.g. a user on Ubuntu may prefer <code class="docutils literal notranslate"><span class="pre">conda</span></code>, <code class="docutils literal notranslate"><span class="pre">brew</span></code> or <code class="docutils literal notranslate"><span class="pre">spack</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">apt</span></code>  as their package manager of choice to provide external dependencies).</p>
</section>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification" role="doc-backlink">Specification</a></h2>
<p>Three schemas are proposed:</p>
<ol class="arabic simple">
<li>A central registry of known DepURLs, as introduced in PEP 725.</li>
<li>A list of known ecosystems and the canonical URL for their mappings.</li>
<li>The ecosystem-specific mappings of DepURLs to their
corresponding ecosystem specifiers, plus details of their package manager(s).</li>
</ol>
<section id="central-registry">
<h3><a class="toc-backref" href="#central-registry" role="doc-backlink">Central registry</a></h3>
<p>The central registry defines which identifiers are recognized as canonical,
plus known aliases. Each entry MUST provide a valid DepURL in the
field <code class="docutils literal notranslate"><span class="pre">id</span></code>, with an optional free form <code class="docutils literal notranslate"><span class="pre">description</span></code> text. Additionally
an entry MAY refer to another entry via its <code class="docutils literal notranslate"><span class="pre">provides</span></code> field, which takes
a string or a list of strings already defined as <code class="docutils literal notranslate"><span class="pre">id</span></code> in the registry. This is useful
for both aliases (e.g. <code class="docutils literal notranslate"><span class="pre">dep:generic/arrow</span></code> and <code class="docutils literal notranslate"><span class="pre">dep:github/apache/arrow</span></code>) and
concrete implementations of a <code class="docutils literal notranslate"><span class="pre">dep:virtual/</span></code> entry (e.g. <code class="docutils literal notranslate"><span class="pre">dep:generic/gcc</span></code>
would provide <code class="docutils literal notranslate"><span class="pre">dep:virtual/compiler/c</span></code>). Entries without <code class="docutils literal notranslate"><span class="pre">provides</span></code> content
or, if populated, only with <code class="docutils literal notranslate"><span class="pre">dep:virtual/</span></code> identifiers, are considered
canonical. The <code class="docutils literal notranslate"><span class="pre">provides</span></code> field MUST NOT be present in <code class="docutils literal notranslate"><span class="pre">dep:virtual/</span></code> definitions.</p>
<p>Having a central registry enables the validation of the <code class="docutils literal notranslate"><span class="pre">[external]</span></code> table.
All involved tools MUST check that the provided identifiers are well formed.
Additionally, some tools MAY check whether the identifiers in use are recognized as
canonical. More specifically:</p>
<ul class="simple">
<li>Build backends, build frontends, and installers SHOULD NOT do any validation
of identifiers being canonical by default.</li>
<li>Uploaders like <code class="docutils literal notranslate"><span class="pre">twine</span></code> SHOULD validate if the identifiers are canonical
and warn or report an error to the user, with opt-out mechanisms. They
SHOULD suggest a canonical replacement, if available.</li>
<li>Index servers like PyPI MAY perform the same validation as the uploaders and
reject the artifact if necessary.</li>
</ul>
<p>This registry SHOULD also centralize authoritative decisions about its
contents, such as which entry of a collection of aliases is preferred as
canonical, or which versioning scheme applies to virtual DepURLs (see Appendix
B). The corresponding answers are not given in this PEP; instead we delegate
that responsibility to the central registry maintainers.</p>
</section>
<section id="mappings">
<h3><a class="toc-backref" href="#mappings" role="doc-backlink">Mappings</a></h3>
<p>The mappings specify which ecosystem-specific identifiers provide the canonical
entries available in the central registry. A mapping mainly consists of a list
of dictionaries, in which each entry consists of:</p>
<ul class="simple">
<li>an <code class="docutils literal notranslate"><span class="pre">id</span></code> field with the canonical DepURL.</li>
<li>an optional free form <code class="docutils literal notranslate"><span class="pre">description</span></code> text.</li>
<li>a <code class="docutils literal notranslate"><span class="pre">specs</span></code> field whose value MUST be one of:<ul>
<li>a dictionary with three keys (<code class="docutils literal notranslate"><span class="pre">build</span></code>, <code class="docutils literal notranslate"><span class="pre">host</span></code>, <code class="docutils literal notranslate"><span class="pre">run</span></code>). The values
MUST be a string or list of strings representing the ecosystem-specific package
identifiers as needed as build-, host- and runtime dependencies (see PEP 725 for
details on these definitions).</li>
<li>for convenience, a string or a list of strings are also accepted as a
shorthand form. In this case, the identifier(s) will be used to populate
the three categories mentioned in the item above.</li>
<li>an empty list, which is understood as the ecosystem not having packages to
provide such dependency.</li>
</ul>
</li>
<li>a <code class="docutils literal notranslate"><span class="pre">specs_from</span></code> field whose value is a DepURL from which the <code class="docutils literal notranslate"><span class="pre">specs</span></code>
field will be imported. Either <code class="docutils literal notranslate"><span class="pre">specs</span></code> or <code class="docutils literal notranslate"><span class="pre">specs_from</span></code> MUST be present.</li>
<li>an optional <code class="docutils literal notranslate"><span class="pre">urls</span></code> field whose value MUST be a URL, a list of URLs, or a
dictionary that maps a string to a URL. This is useful to link to external
resources that provide more information about the mapped packages.</li>
</ul>
<p>The mappings SHOULD also specify another section <code class="docutils literal notranslate"><span class="pre">package_managers</span></code>, reporting
which package managers are available in the ecosystem and how to use them. This field MUST
take a list of dictionaries, with each of them reporting the following fields:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> (string), unique identifier for this package manager. Usually, the executable name.</li>
<li><code class="docutils literal notranslate"><span class="pre">commands</span></code> (list of dictionaries), the commands to run to install the mapped package(s) and
check whether they are already installed.</li>
<li><code class="docutils literal notranslate"><span class="pre">specifier_syntax</span></code>: instructions on how to map a subset of PEP 440 specifiers to
the target package manager. Three levels of support are offered: name-only, exact-version-only,
and version-range compatibility (with per-operator translations).</li>
</ul>
<p>Each mapping MUST have a canonical URL for online retrieval. These mappings
MAY also be packaged for offline distribution in each platform. The authors
recommend placing in the standard location for data artifacts in each operating
system; e.g. <code class="docutils literal notranslate"><span class="pre">$XDG_DATA_DIRS</span></code> on Linux and others, <code class="docutils literal notranslate"><span class="pre">~/Library/Application</span> <span class="pre">Support</span></code> on
macOS, and <code class="docutils literal notranslate"><span class="pre">%LOCALAPPDATA%</span></code> for Windows. The subdirectory identifier MUST
be <code class="docutils literal notranslate"><span class="pre">external-packaging-metadata-mappings</span></code>. This data directory SHOULD only
contain mapping documents named <code class="docutils literal notranslate"><span class="pre">{ecosystem-identifier}.mapping.json</span></code>. The central
registry and known ecosystem documents MAY also be distributed in this directory,
as <code class="docutils literal notranslate"><span class="pre">registry.json</span></code> and <code class="docutils literal notranslate"><span class="pre">known-ecosystems.json</span></code>, respectively.</p>
</section>
<section id="known-ecosystems">
<h3><a class="toc-backref" href="#known-ecosystems" role="doc-backlink">Known ecosystems</a></h3>
<p>The list of known ecosystems has two roles:</p>
<ol class="arabic simple">
<li>Reporting the canonical URL for its mapping.</li>
<li>Assigning a short identifier to each ecosystem. This is the identifier
that MUST be used in the mapping filenames mentioned above so they can be
found in the local filesystem.</li>
</ol>
<p>For ecosystems corresponding to Linux distributions, the identifier MUST be the
one reported by their <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/latest/os-release.html">os-release</a>
<code class="docutils literal notranslate"><span class="pre">ID</span></code> parameter. For other ecosystems, it MUST be decided during the submission to
the list of known ecosystems document. It MUST only use the characters allowed in
<code class="docutils literal notranslate"><span class="pre">os-release</span></code>’s <code class="docutils literal notranslate"><span class="pre">ID</span></code> field, as per this regex <code class="docutils literal notranslate"><span class="pre">[a-z0-9\-_.]+</span></code>.</p>
</section>
<section id="schema-details">
<h3><a class="toc-backref" href="#schema-details" role="doc-backlink">Schema details</a></h3>
<p>Three JSON Schema documents are provided to fully standardize the registries and mappings.</p>
<section id="central-registry-schema">
<h4><a class="toc-backref" href="#central-registry-schema" role="doc-backlink">Central registry schema</a></h4>
<p>The central registry is specified by the following
<a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/schemas/central-registry.schema.json">JSON schema</a>:</p>
<section id="schema">
<h5><a class="toc-backref" href="#schema" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">$schema</span></code></a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td>Type</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
</tr>
<tr class="row-even"><td>Description</td>
<td>URL of the definition list schema in use for the document.</td>
</tr>
<tr class="row-odd"><td>Required</td>
<td>False</td>
</tr>
</tbody>
</table>
</section>
<section id="schema-version">
<h5><a class="toc-backref" href="#schema-version" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">schema_version</span></code></a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td>Type</td>
<td><code class="docutils literal notranslate"><span class="pre">integer</span></code></td>
</tr>
<tr class="row-even"><td>Required</td>
<td>False</td>
</tr>
</tbody>
</table>
</section>
<section id="definitions">
<h5><a class="toc-backref" href="#definitions" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">definitions</span></code></a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td>Type</td>
<td><code class="docutils literal notranslate"><span class="pre">array</span></code></td>
</tr>
<tr class="row-even"><td>Description</td>
<td>List of DepURLs currently recognized.</td>
</tr>
<tr class="row-odd"><td>Required</td>
<td>True</td>
</tr>
</tbody>
</table>
<p>Each entry in this list is defined as:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 25.0%" />
<col style="width: 40.0%" />
<col style="width: 15.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Type</th>
<th class="head">Description</th>
<th class="head">Required</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">id</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">DepURLField</span></code> (<code class="docutils literal notranslate"><span class="pre">string</span></code> matching regex <code class="docutils literal notranslate"><span class="pre">^dep:.+$</span></code>)</td>
<td>DepURL</td>
<td>True</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">description</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td>Free-form field to add some details about the package. Allows Markdown.</td>
<td>False</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">provides</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">DepURLField</span> <span class="pre">|</span> <span class="pre">list[DepURLField]</span></code></td>
<td>List of identifiers this entry connects to.
Useful to annotate aliases or virtual package implementations.</td>
<td>False</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">urls</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">AnyUrl</span> <span class="pre">|</span> <span class="pre">list[AnyUrl]</span> <span class="pre">|</span> <span class="pre">dict[NonEmptyString,</span> <span class="pre">AnyUrl]</span></code></td>
<td>Hyperlinks to web locations that provide more information about the definition.</td>
<td>False</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="known-ecosystems-schema">
<h4><a class="toc-backref" href="#known-ecosystems-schema" role="doc-backlink">Known ecosystems schema</a></h4>
<p>The known ecosystems list is specified by the following
<a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/schemas/known-ecosystems.schema.json">JSON Schema</a>:</p>
<section id="id1">
<h5><a class="toc-backref" href="#id1" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">$schema</span></code></a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td>Type</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
</tr>
<tr class="row-even"><td>Description</td>
<td>URL of the mappings schema in use for the document.</td>
</tr>
<tr class="row-odd"><td>Required</td>
<td>False</td>
</tr>
</tbody>
</table>
</section>
<section id="id2">
<h5><a class="toc-backref" href="#id2" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">schema_version</span></code></a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td>Type</td>
<td><code class="docutils literal notranslate"><span class="pre">integer</span></code></td>
</tr>
<tr class="row-even"><td>Required</td>
<td>False</td>
</tr>
</tbody>
</table>
</section>
<section id="ecosystems">
<h5><a class="toc-backref" href="#ecosystems" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">ecosystems</span></code></a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td>Type</td>
<td><code class="docutils literal notranslate"><span class="pre">dict</span></code></td>
</tr>
<tr class="row-even"><td>Description</td>
<td>Ecosystems names and their corresponding details.</td>
</tr>
<tr class="row-odd"><td>Required</td>
<td>True</td>
</tr>
</tbody>
</table>
<p>This dictionary maps non-empty string keys referring to the ecosystem identifiers
to a sub-dictionary defined as:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 25.0%" />
<col style="width: 40.0%" />
<col style="width: 15.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Value type</th>
<th class="head">Value description</th>
<th class="head">Required</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">Literal['mapping']</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">AnyURL</span></code></td>
<td>URL to the mapping for this ecosystem</td>
<td>True</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="mappings-schema">
<h4><a class="toc-backref" href="#mappings-schema" role="doc-backlink">Mappings schema</a></h4>
<p>The mappings are specified by the following
<a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/schemas/external-mapping.schema.json">JSON Schema</a>:</p>
<section id="id3">
<h5><a class="toc-backref" href="#id3" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">$schema</span></code></a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td>Type</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
</tr>
<tr class="row-even"><td>Description</td>
<td>URL of the mappings schema in use for the document.</td>
</tr>
<tr class="row-odd"><td>Required</td>
<td>False</td>
</tr>
</tbody>
</table>
</section>
<section id="id4">
<h5><a class="toc-backref" href="#id4" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">schema_version</span></code></a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td>Type</td>
<td><code class="docutils literal notranslate"><span class="pre">integer</span></code></td>
</tr>
<tr class="row-even"><td>Required</td>
<td>False</td>
</tr>
</tbody>
</table>
</section>
<section id="name">
<h5><a class="toc-backref" href="#name" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">name</span></code></a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td>Type</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
</tr>
<tr class="row-even"><td>Description</td>
<td>Name of the schema</td>
</tr>
<tr class="row-odd"><td>Required</td>
<td>True</td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h5><a class="toc-backref" href="#description" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">description</span></code></a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td>Type</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span> <span class="pre">|</span> <span class="pre">None</span></code></td>
</tr>
<tr class="row-even"><td>Description</td>
<td>Free-form field to add information this mapping. Allows
Markdown.</td>
</tr>
<tr class="row-odd"><td>Required</td>
<td>False</td>
</tr>
</tbody>
</table>
</section>
<section id="id5">
<h5><a class="toc-backref" href="#id5" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">mappings</span></code></a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td>Type</td>
<td><code class="docutils literal notranslate"><span class="pre">array</span></code></td>
</tr>
<tr class="row-even"><td>Description</td>
<td>List of DepURL-to-specs mappings.</td>
</tr>
<tr class="row-odd"><td>Required</td>
<td>True</td>
</tr>
</tbody>
</table>
<p>Each entry in this list is defined as:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 25.0%" />
<col style="width: 40.0%" />
<col style="width: 15.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Type</th>
<th class="head">Description</th>
<th class="head">Required</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">id</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">DepURLField</span></code> (<code class="docutils literal notranslate"><span class="pre">string</span></code> matching regex <code class="docutils literal notranslate"><span class="pre">^dep:.+$</span></code>)</td>
<td>DepURL, as provided in the central registry</td>
<td>True</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">description</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td>Free-form field to add some details about the package. Allows Markdown.</td>
<td>False</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">urls</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">AnyUrl</span> <span class="pre">|</span> <span class="pre">list[AnyUrl]</span> <span class="pre">|</span> <span class="pre">dict[NonEmptyString,</span> <span class="pre">AnyUrl]</span></code></td>
<td>Hyperlinks to web locations that provide more information about the definition.</td>
<td>False</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">specs</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">string</span> <span class="pre">|</span> <span class="pre">list[string]</span> <span class="pre">|</span> <span class="pre">dict[Literal['build',</span> <span class="pre">'host',</span> <span class="pre">'run'],</span> <span class="pre">string</span> <span class="pre">|</span> <span class="pre">list[string]]</span></code></td>
<td>Ecosystem-specific identifiers for this package. The full form is a dictionary
that maps the categories <code class="docutils literal notranslate"><span class="pre">build</span></code>, <code class="docutils literal notranslate"><span class="pre">host</span></code> and <code class="docutils literal notranslate"><span class="pre">run</span></code> to their corresponding
package identifiers. As a shorthand, a single string or a list of strings can be
provided, in which case will be used to populate the three categories identically.</td>
<td>Either <code class="docutils literal notranslate"><span class="pre">specs</span></code> or <code class="docutils literal notranslate"><span class="pre">specs_from</span></code> MUST be present.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">specs_from</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">DepURLField</span></code> (<code class="docutils literal notranslate"><span class="pre">string</span></code> matching regex <code class="docutils literal notranslate"><span class="pre">^dep:.+$</span></code>)</td>
<td>Take specs from another mapping entry.</td>
<td>Either <code class="docutils literal notranslate"><span class="pre">specs</span></code> or <code class="docutils literal notranslate"><span class="pre">specs_from</span></code> MUST be present.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">extra_metadata</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">dict[NonEmptyString,</span> <span class="pre">Any]</span></code></td>
<td>Free-form key-value store for arbitrary metadata.</td>
<td>False</td>
</tr>
</tbody>
</table>
</section>
<section id="package-managers">
<h5><a class="toc-backref" href="#package-managers" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">package_managers</span></code></a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td>Type</td>
<td><code class="docutils literal notranslate"><span class="pre">array</span></code></td>
</tr>
<tr class="row-even"><td>Description</td>
<td>List of tools that can be used to install packages in this
ecosystem.</td>
</tr>
<tr class="row-odd"><td>Required</td>
<td>True</td>
</tr>
</tbody>
</table>
<p>Each entry in this list is defined as a dictionary with these fields:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 25.0%" />
<col style="width: 40.0%" />
<col style="width: 15.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Type</th>
<th class="head">Description</th>
<th class="head">Required</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">name</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td>Short identifier for this package manager (usually the command name)</td>
<td>True</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">commands</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">dict[Literal['install',</span> <span class="pre">'query'],</span> <span class="pre">dict[Literal['command',</span> <span class="pre">'requires_elevation',</span> <span class="pre">'multiple_specifiers'],</span> <span class="pre">list[str]</span> <span class="pre">|</span> <span class="pre">bool</span> <span class="pre">|</span> <span class="pre">Literal['always',</span> <span class="pre">'name-only',</span> <span class="pre">'never']]]</span></code></td>
<td>Commands used to install or query the given package(s). Only two keys
are allowed: <code class="docutils literal notranslate"><span class="pre">install</span></code> and <code class="docutils literal notranslate"><span class="pre">query</span></code>. Their value is a dictionary
with:<ul>
<li>a required key <code class="docutils literal notranslate"><span class="pre">command</span></code> that takes a list of strings
(as expected by <code class="docutils literal notranslate"><span class="pre">subprocess.run</span></code>).</li>
<li>an optional <code class="docutils literal notranslate"><span class="pre">requires_elevation</span></code> boolean (<code class="docutils literal notranslate"><span class="pre">False</span></code> by default)
to indicate whether the command must run with elevated permissions
(e.g. administrator on Windows, superuser on Linux and macOS).</li>
<li>an enum <code class="docutils literal notranslate"><span class="pre">multiple_specifiers</span></code> that determines whether the command
accepts multiple package specifiers at the same time, accepting one of:<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">always</span></code>, default in <code class="docutils literal notranslate"><span class="pre">install</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">name-only</span></code>, the command only accepts multiple specifiers if they do
not contain version constraints.</li>
<li><code class="docutils literal notranslate"><span class="pre">never</span></code>, default in <code class="docutils literal notranslate"><span class="pre">query</span></code>.</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Exactly one of the <code class="docutils literal notranslate"><span class="pre">command</span></code> items MUST include a <code class="docutils literal notranslate"><span class="pre">{}</span></code> placeholder,
which will be replaced by the mapped package identifier(s). The
<code class="docutils literal notranslate"><span class="pre">install</span></code> command SHOULD support the placeholder being replaced by
multiple identifiers, <code class="docutils literal notranslate"><span class="pre">query</span></code> MUST only receive a single identifier
per command.</p>
</td>
<td>True</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">specifier_syntax</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">dict[Literal['name_only',</span> <span class="pre">'exact_version',</span> <span class="pre">'version_ranges'],</span> <span class="pre">None</span> <span class="pre">|</span> <span class="pre">list[str]</span> <span class="pre">|</span> <span class="pre">dict[Literal['and',</span> <span class="pre">'equal',</span> <span class="pre">'greater_than',</span> <span class="pre">'greater_than_equal',</span> <span class="pre">'less_than',</span> <span class="pre">'less_than_equal',</span> <span class="pre">'not_equal',</span> <span class="pre">'syntax'],</span> <span class="pre">None</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">list[str]]</span></code></td>
<td>Mapping of allowed PEP440 version specifiers to the syntax used in this
package manager. Three top-level keys are expected and required:<ul>
<li><code class="docutils literal notranslate"><span class="pre">name_only</span></code> MUST take a list of strings as the syntax used for specifiers
that do not contain any version information; it MUST include the placeholder
<code class="docutils literal notranslate"><span class="pre">{name}</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">exact_version</span></code> MUST be <code class="docutils literal notranslate"><span class="pre">None</span></code> or a list of strings that describe
the syntax used for specifiers that only express exact version
constraints; in the latter case, the placeholders <code class="docutils literal notranslate"><span class="pre">{name}</span></code>
and <code class="docutils literal notranslate"><span class="pre">{version}</span></code> MUST be present in at least one of the strings
(although not necessary the same string for both).</li>
<li><code class="docutils literal notranslate"><span class="pre">version_ranges</span></code> MUST be <code class="docutils literal notranslate"><span class="pre">None</span></code> or a dictionary with the
following required keys:<ul class="simple">
<li>the key <code class="docutils literal notranslate"><span class="pre">syntax</span></code> takes a list of strings where at least one MUST
include the <code class="docutils literal notranslate"><span class="pre">{ranges}</span></code> placeholder (to be replaced by the
maybe-joined version constraints, as determined by the value of
<code class="docutils literal notranslate"><span class="pre">and</span></code>). They MAY also include the <code class="docutils literal notranslate"><span class="pre">{name}</span></code> placeholder.</li>
<li>the keys <code class="docutils literal notranslate"><span class="pre">equal</span></code>, <code class="docutils literal notranslate"><span class="pre">greater_than</span></code>, <code class="docutils literal notranslate"><span class="pre">greater_than_equal</span></code>,
<code class="docutils literal notranslate"><span class="pre">less_than</span></code>, <code class="docutils literal notranslate"><span class="pre">less_than_equal</span></code>, and <code class="docutils literal notranslate"><span class="pre">not_equal</span></code> take a string
if the operator is supported, <code class="docutils literal notranslate"><span class="pre">None</span></code> otherwise. In the former case,
the value MUST include the <code class="docutils literal notranslate"><span class="pre">{version}</span></code> placeholder, and MAY include
<code class="docutils literal notranslate"><span class="pre">{name}</span></code>.</li>
<li>the key <code class="docutils literal notranslate"><span class="pre">{and}</span></code> takes a string used to join multiple version
constraints in a single token, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if only a single
constraint can be used per token. In the latter case, the different
constraints will be “exploded” into several tokens using the
<code class="docutils literal notranslate"><span class="pre">syntax</span></code> template.</li>
</ul>
<p>When <code class="docutils literal notranslate"><span class="pre">exact_version</span></code> or <code class="docutils literal notranslate"><span class="pre">version_ranges</span></code> are set to <code class="docutils literal notranslate"><span class="pre">None</span></code>, it
indicates that the respective types of specifiers are not supported
by the package manager.</p>
</li>
</ul>
</td>
<td>True</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="examples">
<h3><a class="toc-backref" href="#examples" role="doc-backlink">Examples</a></h3>
<section id="registry-known-ecosystems-and-mappings">
<h4><a class="toc-backref" href="#registry-known-ecosystems-and-mappings" role="doc-backlink">Registry, known ecosystems and mappings</a></h4>
<p>A simplified registry would look like this:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;$schema&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://raw.githubusercontent.com/jaimergp/external-metadata-mappings/main/schemas/central-registry.schema.json&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;schema_version&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;definitions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;dep:generic/zlib&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;A Massively Spiffy Yet Delicately Unobtrusive Compression Library&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;dep:generic/libwebp&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;WebP codec is a library to encode and decode images in WebP format. This package contains the library that can be used in other programs to add WebP support&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;dep:generic/clang&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Language front-end and tooling infrastructure for languages in the C language family for the LLVM project.&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A minimal list of known ecosystems with a single entry would look like this:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;$schema&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://raw.githubusercontent.com/jaimergp/external-metadata-mappings/main/schemas/known-ecosystems.schema.json&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;schema_version&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;ecosystems&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;conda-forge&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;mapping&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://raw.githubusercontent.com/jaimergp/external-metadata-mappings/refs/heads/main/data/conda-forge.mapping.json&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>That hypothetical conda-forge mapping (<code class="docutils literal notranslate"><span class="pre">conda-forge.mapping.json</span></code>), with only a couple entries
for brevity, could look like:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;schema_version&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;conda-forge&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Mapping for the conda-forge ecosystem&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;mappings&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;dep:generic/zlib&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;zlib data compression library for the next generation systems. From zlib-ng/zlib-ng.&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;specs&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;zlib-ng&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// Simplest form</span>
<span class="w">      </span><span class="s2">&quot;urls&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;feedstock&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://github.com/conda-forge/zlib-ng-feedstock&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;dep:generic/libwebp&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;WebP image library. libwebp-base ships libraries; libwebp ships the binaries.&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;specs&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// expanded form with single spec per category</span>
<span class="w">        </span><span class="s2">&quot;build&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;libwebp&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;host&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;libwebp-base&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;run&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;libwebp&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="s2">&quot;urls&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;feedstock&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://github.com/conda-forge/libwebp-feedstock&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;dep:generic/clang&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Development headers and libraries for Clang&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;specs&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// expanded form with specs list</span>
<span class="w">        </span><span class="s2">&quot;build&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;clang&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;clangxx&quot;</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="s2">&quot;host&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;clangdev&quot;</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="s2">&quot;run&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;clang&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;clangxx&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;clang-format&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;clang-tools&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="s2">&quot;urls&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;feedstock&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://github.com/conda-forge/clangdev-feedstock&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="s2">&quot;package_managers&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;conda&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;commands&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;install&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;command&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;conda&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;install&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;{}&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="s2">&quot;multiple_specifiers&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;always&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;requires_elevation&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;command&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;conda&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;list&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;-f&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;{}&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="s2">&quot;multiple_specifiers&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;never&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;requires_elevation&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="s2">&quot;specifier_syntax&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;exact_version&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;{name}=={version}&quot;</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="s2">&quot;name_only&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;{name}&quot;</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="s2">&quot;version_ranges&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;and&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;equal&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;={version}&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;greater_than&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&gt;{version}&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;greater_than_equal&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&gt;={version}&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;less_than&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&lt;{version}&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;less_than_equal&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&lt;={version}&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;not_equal&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;!={version}&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;syntax&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;{name}{ranges}&quot;</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following repository provides examples of how these schemas <em>could</em> look like in real cases.
They are not meant to be prescriptive, but just illustrative of how to apply these schemas:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/registry.json">Central registry</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/known-ecosystems.json">Known ecosystems</a>.</li>
<li>Mappings:<ul>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/arch.mapping.json">Arch-linux</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/chocolatey.mapping.json">Chocolatey</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/conan.mapping.json">Conan</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/conda-forge.mapping.json">Conda-forge</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/fedora.mapping.json">Fedora</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/gentoo.mapping.json">Gentoo</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/homebrew.mapping.json">Homebrew</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/nix.mapping.json">Nix</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/pypi.mapping.json">PyPI</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/scoop.mapping.json">Scoop</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/spack.mapping.json">Spack</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/ubuntu.mapping.json">Ubuntu</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/vcpkg.mapping.json">Vcpkg</a>.</li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/winget.mapping.json">Winget</a>.</li>
</ul>
</li>
</ul>
</section>
<section id="pyproject-external-cli">
<h4><a class="toc-backref" href="#pyproject-external-cli" role="doc-backlink">pyproject-external CLI</a></h4>
<p>The following examples illustrate how the name mapping mechanism may be used.
They use the CLI implemented as part of the <code class="docutils literal notranslate"><span class="pre">pyproject-external</span></code> package.</p>
<p>Say we have cloned the source of a Python package named <code class="docutils literal notranslate"><span class="pre">my-cxx-pkg</span></code> with a
single extension module, implemented in C++, linking to <code class="docutils literal notranslate"><span class="pre">zlib</span></code>, using <code class="docutils literal notranslate"><span class="pre">pybind11</span></code>,
plus <code class="docutils literal notranslate"><span class="pre">meson-python</span></code> as the build backend:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[build-system]</span>
<span class="n">build-backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;mesonpy&#39;</span>
<span class="n">requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="s2">&quot;meson-python&gt;=0.13.1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;pybind11&gt;=2.10.4&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">[external]</span>
<span class="n">build-requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="s2">&quot;dep:virtual/compiler/cxx&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">host-requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="s2">&quot;dep:generic/zlib&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>With complete name mappings for <code class="docutils literal notranslate"><span class="pre">apt</span></code> on Ubuntu, this may then show the
following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># show all external dependencies as DepURLs</span>
$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pyproject_external<span class="w"> </span>show<span class="w"> </span>.
<span class="o">[</span>external<span class="o">]</span>
build-requires<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="s2">&quot;dep:virtual/compiler/cxx&quot;</span>,
<span class="o">]</span>
host-requires<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="s2">&quot;dep:generic/zlib&quot;</span>,
<span class="o">]</span>

<span class="c1"># show all external dependencies, but mapped to the autodetected ecosystem</span>
$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pyproject_external<span class="w"> </span>show<span class="w"> </span>--output<span class="o">=</span>mapped<span class="w"> </span>.
<span class="o">[</span>external<span class="o">]</span>
<span class="nv">build_requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="s2">&quot;g++&quot;</span>,
<span class="w">    </span><span class="s2">&quot;python3&quot;</span>,
<span class="o">]</span>
<span class="nv">host_requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="s2">&quot;zlib1g&quot;</span>,
<span class="w">    </span><span class="s2">&quot;zlib1g-dev&quot;</span>,
<span class="o">]</span>

<span class="c1"># show how to install external dependencies</span>
$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pyproject_external<span class="w"> </span>show<span class="w"> </span>--output<span class="o">=</span><span class="nb">command</span><span class="w"> </span>.
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>--yes<span class="w"> </span>g++<span class="w"> </span>zlib1g<span class="w"> </span>zlib1g-dev<span class="w"> </span>python3
</pre></div>
</div>
<p>We have not yet run those install commands, so the external dependency may be
missing. If we get a build failure, the output may look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install .
...
× Encountered error while generating package metadata.
╰─&gt; See above for output.

note: This is an issue with the package mentioned above, not pip.

This package has the following external dependencies, if those are missing
on your system they are likely to be the cause of this build failure:

  dep:virtual/compiler/cxx
  dep:generic/zlib
</pre></div>
</div>
<p>If Pip has implemented support for querying the name mapping registry, the end
of that message could improve to:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>The<span class="w"> </span>following<span class="w"> </span>external<span class="w"> </span>dependencies<span class="w"> </span>are<span class="w"> </span>needed<span class="w"> </span>to<span class="w"> </span>install<span class="w"> </span>the<span class="w"> </span>package
mentioned<span class="w"> </span>above.<span class="w"> </span>You<span class="w"> </span>may<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>install<span class="w"> </span>them<span class="w"> </span>with<span class="w"> </span><span class="sb">`</span>apt<span class="sb">`</span>:

<span class="w">  </span>g++
<span class="w">  </span>zlib1g
<span class="w">  </span>zlib1g-dev
</pre></div>
</div>
<p>If the user wants to use conda packages and the <code class="docutils literal notranslate"><span class="pre">mamba</span></code> package manager to
install external dependencies, they may specify that in their
<code class="docutils literal notranslate"><span class="pre">~/.config/pyproject-external/config.toml</span></code> (or equivalent) file:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="n">preferred_package_manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mamba&quot;</span>
</pre></div>
</div>
<p>This will then change the output of <code class="docutils literal notranslate"><span class="pre">pyproject-external</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pyproject_external<span class="w"> </span>show<span class="w"> </span>--output<span class="w"> </span><span class="nb">command</span><span class="w"> </span>.
mamba<span class="w"> </span>install<span class="w"> </span>--yes<span class="w"> </span>--channel<span class="o">=</span>conda-forge<span class="w"> </span>--channel-priority<span class="o">=</span>strict<span class="w"> </span>cxx-compiler<span class="w"> </span>zlib<span class="w"> </span>python
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">pyproject-external</span></code> CLI also provides a simple way to perform
<code class="docutils literal notranslate"><span class="pre">[external]</span></code> table validation against the central registry to check
whether the identifiers are considered canonical or not:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pyproject_external<span class="w"> </span>show<span class="w"> </span>--validate<span class="w"> </span>grpcio-1.71.0.tar.gz
WARNING<span class="w">  </span>Dep<span class="w"> </span>URL<span class="w"> </span><span class="s1">&#39;dep:virtual/compiler/cpp&#39;</span><span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>recognized<span class="w"> </span><span class="k">in</span><span class="w"> </span>the
central<span class="w"> </span>registry.<span class="w"> </span>Did<span class="w"> </span>you<span class="w"> </span>mean<span class="w"> </span>any<span class="w"> </span>of<span class="w"> </span><span class="o">[</span><span class="s1">&#39;dep:virtual/compiler/c&#39;</span>,
<span class="s1">&#39;dep:virtual/compiler/cxx&#39;</span>,<span class="w"> </span><span class="s1">&#39;dep:virtual/compiler/cuda&#39;</span>,
<span class="s1">&#39;dep:virtual/compiler/go&#39;</span>,<span class="w"> </span><span class="s1">&#39;dep:virtual/compiler/c-sharp&#39;</span><span class="o">]</span>?
<span class="o">[</span>external<span class="o">]</span>
build-requires<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="s2">&quot;dep:virtual/compiler/c&quot;</span>,
<span class="w">    </span><span class="s2">&quot;dep:virtual/compiler/cpp&quot;</span>,
<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="pyproject-external-api">
<h4><a class="toc-backref" href="#pyproject-external-api" role="doc-backlink">pyproject-external API</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">pyproject-external</span></code> Python API also allows users to do these operations programmatically:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pyproject_external</span><span class="w"> </span><span class="kn">import</span> <span class="n">External</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">external</span> <span class="o">=</span> <span class="n">External</span><span class="o">.</span><span class="n">from_pyproject_data</span><span class="p">(</span>
<span class="go">      {</span>
<span class="go">        &quot;external&quot;: {</span>
<span class="go">          &quot;build-requires&quot;: [</span>
<span class="go">            &quot;dep:virtual/compiler/c&quot;,</span>
<span class="go">            &quot;dep:virtual/compiler/cpp&quot;,</span>
<span class="go">          ]</span>
<span class="go">        }</span>
<span class="go">      }</span>
<span class="go">    )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">external</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="go">Dep URL &#39;dep:virtual/compiler/cpp&#39; is not recognized in the central registry. Did you</span>
<span class="go">mean any of [&#39;dep:virtual/compiler/c&#39;, &#39;dep:virtual/compiler/cxx&#39;,</span>
<span class="go">&#39;dep:virtual/compiler/cuda&#39;, &#39;dep:virtual/compiler/go&#39;, &#39;dep:virtual/compiler/c-sharp&#39;]?</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">external</span> <span class="o">=</span> <span class="n">External</span><span class="o">.</span><span class="n">from_pyproject_data</span><span class="p">(</span>
<span class="go">      {</span>
<span class="go">        &quot;external&quot;: {</span>
<span class="go">          &quot;build-requires&quot;: [</span>
<span class="go">            &quot;dep:virtual/compiler/c&quot;,</span>
<span class="go">            &quot;dep:virtual/compiler/cxx&quot;,  # fixed</span>
<span class="go">          ]</span>
<span class="go">        }</span>
<span class="go">      }</span>
<span class="go">    )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">external</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">external</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="go">{&#39;external&#39;: {&#39;build_requires&#39;: [&#39;dep:virtual/compiler/c&#39;, &#39;dep:virtual/compiler/cxx&#39;]}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pyproject_external</span><span class="w"> </span><span class="kn">import</span> <span class="n">detect_ecosystem_and_package_manager</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ecosystem</span><span class="p">,</span> <span class="n">package_manager</span> <span class="o">=</span> <span class="n">detect_ecosystem_and_package_manager</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ecosystem</span>
<span class="go">&#39;conda-forge&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">package_manager</span>
<span class="go">&#39;pixi&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">external</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">mapped_for</span><span class="o">=</span><span class="n">ecosystem</span><span class="p">,</span> <span class="n">package_manager</span><span class="o">=</span><span class="n">package_manager</span><span class="p">)</span>
<span class="go">{&#39;external&#39;: {&#39;build_requires&#39;: [&#39;c-compiler&#39;, &#39;cxx-compiler&#39;, &#39;python&#39;]}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">external</span><span class="o">.</span><span class="n">install_command</span><span class="p">(</span><span class="n">ecosystem</span><span class="p">,</span> <span class="n">package_manager</span><span class="o">=</span><span class="n">package_manager</span><span class="p">)</span>
<span class="go"># {&quot;command&quot;: [&quot;pixi&quot;, &quot;add&quot;, &quot;{}&quot;]}</span>
<span class="go">[&#39;pixi&#39;, &#39;add&#39;, &#39;c-compiler&#39;, &#39;cxx-compiler&#39;, &#39;python&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">external</span><span class="o">.</span><span class="n">query_commands</span><span class="p">(</span><span class="n">ecosystem</span><span class="p">,</span> <span class="n">package_manager</span><span class="o">=</span><span class="n">package_manager</span><span class="p">)</span>
<span class="go"># {&quot;command&quot;: [&quot;pixi&quot;, &quot;list&quot;, &quot;{}&quot;]}</span>
<span class="go">[</span>
<span class="go">  [&#39;pixi&#39;, &#39;list&#39;, &#39;c-compiler&#39;],</span>
<span class="go">  [&#39;pixi&#39;, &#39;list&#39;, &#39;cxx-compiler&#39;],</span>
<span class="go">  [&#39;pixi&#39;, &#39;list&#39;, &#39;python&#39;],</span>
<span class="go">]</span>
</pre></div>
</div>
</section>
<section id="grayskull">
<h4><a class="toc-backref" href="#grayskull" role="doc-backlink">Grayskull</a></h4>
<p>A prototype proof of concept implementation was contributed to Grayskull, a conda recipe generator for
Python packages, via <a class="reference external" href="https://github.com/conda/grayskull/pull/518">conda/grayskull#518</a>.</p>
<p>In order to use the name mappings for the recipe generator of our package, we
can now run <a class="reference external" href="https://github.com/conda/grayskull">Grayskull</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ grayskull pypi my-cxx-pkg
#### Initializing recipe for my-cxx-pkg (pypi) ####

Recovering metadata from pypi...
Starting the download of the sdist package my-cxx-pkg
my-cxx-pkg 100% Time:  0:00:10   5.3 MiB/s|###########|
Checking for pyproject.toml
...

Build requirements:
  - python                                 # [build_platform != target_platform]
  - cross-python_{{ target_platform }}     # [build_platform != target_platform]
  - meson-python &gt;= 0.13.1                 # [build_platform != target_platform]
  - pybind11 &gt;= 2.10.4                     # [build_platform != target_platform]
  - ninja                                  # [build_platform != target_platform]
  - libboost-devel                         # [build_platform != target_platform]
  - {{ compiler(&#39;cxx&#39;) }}
Host requirements:
  - python
  - meson-python &gt;=0.13.1
  - pybind11 &gt;=2.10.4
  - ninja
  - libboost-devel
Run requirements:
  - python

#### Recipe generated on /path/to/recipe/dir for my-cxx-pkg ####
</pre></div>
</div>
</section>
</section>
</section>
<section id="backwards-compatibility">
<h2><a class="toc-backref" href="#backwards-compatibility" role="doc-backlink">Backwards Compatibility</a></h2>
<p>There is no impact on backwards compatibility.</p>
</section>
<section id="security-implications">
<h2><a class="toc-backref" href="#security-implications" role="doc-backlink">Security Implications</a></h2>
<p>This proposal does not impose any security implications on existing projects.
The proposed schemas, registries and mappings are available resources for downstream
tooling to use at their own will, in whatever way they find suitable.</p>
<p>We do have some recommendations for future implementors. The mapping schema
proposes fields to encode instructions for command execution
(<code class="docutils literal notranslate"><span class="pre">package_managers[].commands</span></code>). A tampered mapping may change these
instructions into something else. Hence, tools should not rely on internet
connectivity to fetch the mappings from their online sources. Instead:</p>
<ul class="simple">
<li>they should vendor the relevant documents in the distributed packages,</li>
<li>or depend on prepackaged, offline distributions of these documents,</li>
<li>or implement best-practices for authenticity verification of the fetched documents.</li>
</ul>
<p>The install commands have the potential to modify the system configuration of the user.
When available, tools should prefer creating ephemeral, isolated environments for the
installation of external dependencies. If the ecosystem lacks that feature natively,
other solutions like containerization may be used. At the very least, informative messaging
of the impact of the operation should be provided.</p>
</section>
<section id="how-to-teach-this">
<h2><a class="toc-backref" href="#how-to-teach-this" role="doc-backlink">How to Teach This</a></h2>
<p>There are at least four audiences that may need to get familiar with the contents of this PEP:</p>
<ol class="arabic simple">
<li>Central registry maintainers, who are responsible for curating the list of
well-known DepURLs and mapped ecosystems.</li>
<li>Packaging ecosystem maintainers, who are responsible for keeping the
mapping for their ecosystem up-to-date.</li>
<li>Maintainers of Python projects that require external dependencies.</li>
<li>End users of packages that have external dependency metadata.</li>
</ol>
<section id="central-depurl-registry-maintainers">
<h3><a class="toc-backref" href="#central-depurl-registry-maintainers" role="doc-backlink">Central DepURL registry maintainers</a></h3>
<p>Central DepURL registry maintainers curate the collection of DepURLs and the
known ecosystems. These contributors need to be able to refer to clearly
defined rules for when a new DepURL can be defined. It is undesirable to be
loose with canonical DepURL definitions, because each definition added increases
maintenance effort in the mappings in the target ecosystems.</p>
<p>The central registry maintainers should agree on the ground rules and write them
down as part of the repository documentation, perhaps supported by additional
affordances like issue and pull request templates, or linting tools.</p>
</section>
<section id="package-ecosystem-maintainers-usage">
<h3><a class="toc-backref" href="#package-ecosystem-maintainers-usage" role="doc-backlink">Package ecosystem maintainers usage</a></h3>
<p>Missing mapping entries will result in the absence tailored error messages and
other UX affordances for end users of the impacted ecosystems. It is thus
recommended that each package ecosystem keeps their mappings up-to-date with
the central registry. The key to this will be automation, like linting scripts
(see example at <a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/scripts/lint-mapping-entries.py">external-metadata-mappings</a>),
or periodic notifications via issues or draft submissions.</p>
<p>Establishing the initial mapping is likely to involve a lot of work, but ideally the maintenance on an ongoing basis effort should require smaller effort.</p>
<p>As best practices are discovered and agreed on, they should get documented
in the central registry repository as learning materials for the mapping
maintainers.</p>
</section>
<section id="maintainers-of-python-projects">
<h3><a class="toc-backref" href="#maintainers-of-python-projects" role="doc-backlink">Maintainers of Python projects</a></h3>
<p>A package maintainer’s responsibility is to decide the DepURL that best
represents the external dependency that their package needs. This is covered
in <a class="pep reference internal" href="../pep-0725/" title="PEP 725 – Specifying external dependencies in pyproject.toml">PEP 725</a>; the interactive mappings browser demo located at
<a class="reference external" href="https://external-metadata-mappings.streamlit.app/">external-metadata-mappings.streamlit.app</a>
may come handy. The central registry documentation may include examples and
frequently asked questions to guide newcomers with their decisions.</p>
<p>If no suitable DepURL is available for a given dependency, maintainers may
consider submitting a request in the central registry. Instructions on how to do
this should be provided as part of the central registry documentation.</p>
</section>
<section id="end-user-package-consumers">
<h3><a class="toc-backref" href="#end-user-package-consumers" role="doc-backlink">End user package consumers</a></h3>
<p>There will be no change in the user experience by default. This is particularly
true if the user only relies on wheels, since the only impact will be driven by
external runtime dependencies (expected to be rare), and even in those cases
they need to opt-in by installing a compatible tool.</p>
<p>Users that do opt-in may find missing entries in for their target ecosystems, for
which they should obtain informative error messages that point to the relevant
documentation sections. This will allow them to get acquainted with the nature
of the issue and its potential solutions.</p>
<p>We hope that this results in a subset of them reporting the missing entries,
submitting a fix to the affected mapping or, if totally absent, even deciding
to maintain a new one on their own. To that end, they should get familiar with
the responsibilties of mapping maintainers (discussed above).</p>
</section>
</section>
<section id="reference-implementation">
<h2><a class="toc-backref" href="#reference-implementation" role="doc-backlink">Reference Implementation</a></h2>
<p>A reference implementation should include three components:</p>
<ol class="arabic simple">
<li>A central registry that captures at a minimum a DepURL and its description. This registry MUST
NOT contain specifics of package ecosystem mappings.</li>
<li>A standard specification for a collection of mappings. JSON Schema is widely used for schema
in many text editors, and would be a natural choice for expression of the standard specification.</li>
<li>An implementation of (2), providing mappings from the contents of the central
registry to the ecosystem-specific package names.</li>
</ol>
<p>For (1), the JSON Schema is defined at <a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/schemas/central-registry.schema.json">central-registry.schema.json</a>.
An example registry can be found at <a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/registry.json">registry.json</a>.
For (2), the JSON Schema is defined at <a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/schemas/external-mapping.schema.json">external-mapping.schema.json</a>.
A collection of example mappings for a sample of packages can be found at <a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/tree/main/data">external-metadata-mappings</a>.
For (3), the JSON Schema is defined at <a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/schemas/known-ecosystems.schema.json">known-ecosystems.schema.json</a>.
An example list can be found at <a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/data/known-ecosystems.json">known-ecosystems.json</a>.
The JSON Schemas are created with <a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings/blob/main/schemas/schema.py">these Pydantic models</a>.</p>
<p>The reference CLI and Python API to consume the different JSON documents and <code class="docutils literal notranslate"><span class="pre">[external]</span></code> tables
can be found in <a class="reference external" href="https://github.com/jaimergp/pyproject-external">pyproject-external</a>.</p>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#rejected-ideas" role="doc-backlink">Rejected Ideas</a></h2>
<section id="centralized-mappings-governed-by-the-same-body">
<h3><a class="toc-backref" href="#centralized-mappings-governed-by-the-same-body" role="doc-backlink">Centralized mappings governed by the same body</a></h3>
<p>While a central authority for the registry is useful, the maintenance burden
of handling the mappings for multiple ecosystems is unfeasible at the scale of PyPI.
Hence, we propose that the central authority only governs the central registry and
the list of known ecosystems, while the maintenance of the mappings themselves is handled
by the target ecosystems.</p>
</section>
<section id="allowing-ecosystem-specific-variants-of-packages">
<h3><a class="toc-backref" href="#allowing-ecosystem-specific-variants-of-packages" role="doc-backlink">Allowing ecosystem-specific variants of packages</a></h3>
<p>Some ecosystems have their own variants of known packages; e.g. Debian’s
<code class="docutils literal notranslate"><span class="pre">libsymspg2-dev</span></code>. While an identifier such as <code class="docutils literal notranslate"><span class="pre">dep:debian/libsymspg2-dev</span></code>
is syntactically valid, the central registry should not recognize it as a
well-known identifier, preferring its <code class="docutils literal notranslate"><span class="pre">generic</span></code> counterpart instead. Users
may still choose to use it, but tools may warn about it and suggest using the
generic one. This is meant to encourage ecosystem-agnostic metadata whenever
possible to facilitate adoption across platforms and operating systems.</p>
</section>
<section id="adding-more-package-metadata-to-the-central-registry">
<h3><a class="toc-backref" href="#adding-more-package-metadata-to-the-central-registry" role="doc-backlink">Adding more package metadata to the central registry</a></h3>
<p>A central registry should only contain a list of DepURLs and a
minimal set of metadata fields to facilitate its identification (a free-form
text description, and one or more URLs to relevant locations).</p>
<p>We have chosen to leave additional details out of the central registry, and instead
suggest external contributors to maintain their own mappings where they can
annotate the identifiers with extra metadata via the free-form <code class="docutils literal notranslate"><span class="pre">extra_metadata</span></code> field.</p>
<p>The reasons include:</p>
<ul class="simple">
<li>The existing fields should be sufficient to identify the project home,
where that extra metadata can be obtained (e.g. the repository at the URL will likely
include details about authorship and licensing).</li>
<li>These details can also be obtained from the actual target ecosystems. In some
cases this might even be preferable; e.g., for licenses, where downstream packaging
can actually affect it by unvendoring dependencies or adjusting optional bits.</li>
<li>Those details may change over the lifetime of the project, and keeping them
up-to-date would increase the maintenance burden on the governance body.</li>
<li>Centralizing additional metadata would hence introduce ambiguities and
discrepancies across target ecosystems, where different versions may be
available or required.</li>
</ul>
</section>
<section id="mapping-pypi-projects-to-repackaged-counterparts-in-target-ecosystems">
<h3><a class="toc-backref" href="#mapping-pypi-projects-to-repackaged-counterparts-in-target-ecosystems" role="doc-backlink">Mapping PyPI projects to repackaged counterparts in target ecosystems</a></h3>
<p>It is common that other ecosystems redistribute Python projects with their own
packaging system. While this is required for packages with compiled extensions, it
is theoretically unnecessary for pure Python wheels; the only need for this seems to
be metadata translation. See  <a class="reference external" href="https://discuss.python.org/t/wanting-a-singular-packaging-tool-vision/21141/68">Wanting a singular packaging tool/vision #68</a>,
<a class="reference external" href="https://discuss.python.org/t/wanting-a-singular-packaging-tool-vision/21141/103">Wanting a singular packaging tool/vision #103</a>,
and <a class="reference external" href="https://github.com/spack/spack/issues/28282#issuecomment-1562178367">spack/spack#28282</a>
for examples of discussions in this direction.</p>
<p>The proposals in this PEP do not consider PyPI -&gt; <em>ecosystem</em> mappings, but
the same schemas can be repurposed to that end. After all, it is trivial to build a PURL or
DepURL from a PyPI name (e.g. <code class="docutils literal notranslate"><span class="pre">numpy</span></code> becomes <code class="docutils literal notranslate"><span class="pre">pkg:pypi/numpy</span></code>). A hypothetical
mapping maintainer could annotate their repackaging efforts with the source PURL identifier,
and then use that metadata to generate compatible mappings, such as:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;$schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://raw.githubusercontent.com/jaimergp/external-metadata-mappings/main/schemas/external-mapping.schema.json&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;schema_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PyPI packages in Ubuntu 24.04&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PyPI mapping for the Ubuntu 24.04 LTS (Noble) distro&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;mappings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dep:pypi/numpy&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The fundamental package for scientific computing with Python&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;specs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python3-numpy&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;urls&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;home&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://numpy.org/&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Such a mapping would allow downstream redistribution efforts to focus on the
compiled packages and instead delegate pure wheels to Python packaging
solutions directly.</p>
</section>
<section id="strict-validation-of-identifiers">
<h3><a class="toc-backref" href="#strict-validation-of-identifiers" role="doc-backlink">Strict validation of identifiers</a></h3>
<p>The central registry provides a list of canonical identifiers, which may tempt
implementors into ensuring that all supplied identifiers are indeed canonical. We
have decided to only <em>recommend</em> this practice for some tool categories, but in no
case <em>require</em> such checks.</p>
<p>It is expected that as the <code class="docutils literal notranslate"><span class="pre">[external]</span></code> metadata tables are adopted by the
packaging community, the <em>canonical</em> identifier list grows to accommodate the
requirements found in different projects. For example, a new C++ library or a
new language compiler are introduced.</p>
<p>If validation is made too strict and rejects unknown identifiers, this would
introduce unnecessary friction in the external metadata adoption, and require
human interaction to review and accept the newly requested identifiers in
a time-critical manner, potentially blocking publication of the package
that needs a new identifier added to the central registry.</p>
<p>We suggest simply checking that the provided identifiers are well-formed. Future
work may choose to also enforce that the identifiers are recognized as canonical,
once the central registry has matured with significant adoption.</p>
</section>
</section>
<section id="open-issues">
<h2><a class="toc-backref" href="#open-issues" role="doc-backlink">Open Issues</a></h2>
<p>None at this time.</p>
</section>
<section id="references">
<h2><a class="toc-backref" href="#references" role="doc-backlink">References</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://github.com/jaimergp/pyproject-external">https://github.com/jaimergp/pyproject-external</a></li>
<li><a class="reference external" href="https://github.com/rgommers/external-deps-build">https://github.com/rgommers/external-deps-build</a></li>
<li><a class="reference external" href="https://github.com/jaimergp/external-metadata-mappings">https://github.com/jaimergp/external-metadata-mappings</a></li>
<li><a class="reference external" href="https://github.com/conda/grayskull/pull/518">https://github.com/conda/grayskull/pull/518</a></li>
</ul>
</section>
<section id="appendix-a-operational-suggestions">
<h2><a class="toc-backref" href="#appendix-a-operational-suggestions" role="doc-backlink">Appendix A: Operational suggestions</a></h2>
<p>In contrast with the ecosystem mappings, the central registry and the list of known
ecosystems need to be maintained by a central authority. The authors propose to:</p>
<ul class="simple">
<li>Host the <code class="docutils literal notranslate"><span class="pre">external-metadata-mappings</span></code> and <code class="docutils literal notranslate"><span class="pre">pyproject-external</span></code> repositories under the <a class="reference external" href="https://github.com/pypa">PyPA</a>
GitHub organization (or equivalent as per <a class="pep reference internal" href="../pep-0772/" title="PEP 772 – Packaging Council governance process">PEP 772</a>).</li>
<li>Create a maintainers team for these two repositories, seeded with the authors of this PEP and
regulated as per <a class="pep reference internal" href="../pep-0772/" title="PEP 772 – Packaging Council governance process">PEP 772</a>.</li>
</ul>
</section>
<section id="appendix-b-virtual-versioning-proposal">
<h2><a class="toc-backref" href="#appendix-b-virtual-versioning-proposal" role="doc-backlink">Appendix B: Virtual versioning proposal</a></h2>
<p>While virtual dependencies can be versioned with the same syntax as non-virtual
dependencies, its meaning can be ambiguous (e.g. there can be multiple
implementations, and virtual interfaces may not be unambiguously versioned).
Below we provide some suggestions for the central registry maintainers to
consider when standardizing such meaning:</p>
<ul class="simple">
<li>OpenMP: has regular <code class="docutils literal notranslate"><span class="pre">MAJOR.MINOR</span></code> versions of its standard, so would look
like <code class="docutils literal notranslate"><span class="pre">&gt;=4.5</span></code>.</li>
<li>BLAS/LAPACK: should use the versioning used by <a class="reference external" href="https://github.com/Reference-LAPACK/lapack">Reference LAPACK</a>, which
defines what the standard APIs are. Uses <code class="docutils literal notranslate"><span class="pre">MAJOR.MINOR.MICRO</span></code>, so would look
like <code class="docutils literal notranslate"><span class="pre">&gt;=3.10.0</span></code>.</li>
<li>Compilers: these implement language standards. For C, C++ and Fortran these
are versioned by year. In order for versions to sort correctly, we recommend
using the full year (four digits). So “at least C99” would be <code class="docutils literal notranslate"><span class="pre">&gt;=1999</span></code>, and
selecting C++14 or Fortran 77 would be <code class="docutils literal notranslate"><span class="pre">==2014</span></code> or <code class="docutils literal notranslate"><span class="pre">==1977</span></code> respectively.
Other languages may use different versioning schemes. These should be
described somewhere before they are used in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>.</li>
</ul>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document is placed in the public domain or under the
CC0-1.0-Universal license, whichever is more permissive.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/peps/pep-0804.rst">https://github.com/python/peps/blob/main/peps/pep-0804.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/peps/pep-0804.rst">2025-09-29 13:54:43 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <div id="search"></div>
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a><ul>
<li><a class="reference internal" href="#prior-art">Prior art</a></li>
<li><a class="reference internal" href="#governance-and-maintenance-costs-of-name-mappings">Governance and maintenance costs of name mappings</a></li>
<li><a class="reference internal" href="#generating-package-manager-specific-install-commands">Generating package manager-specific install commands</a></li>
<li><a class="reference internal" href="#registry-design">Registry design</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#central-registry">Central registry</a></li>
<li><a class="reference internal" href="#mappings">Mappings</a></li>
<li><a class="reference internal" href="#known-ecosystems">Known ecosystems</a></li>
<li><a class="reference internal" href="#schema-details">Schema details</a><ul>
<li><a class="reference internal" href="#central-registry-schema">Central registry schema</a><ul>
<li><a class="reference internal" href="#schema"><code class="docutils literal notranslate"><span class="pre">$schema</span></code></a></li>
<li><a class="reference internal" href="#schema-version"><code class="docutils literal notranslate"><span class="pre">schema_version</span></code></a></li>
<li><a class="reference internal" href="#definitions"><code class="docutils literal notranslate"><span class="pre">definitions</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#known-ecosystems-schema">Known ecosystems schema</a><ul>
<li><a class="reference internal" href="#id1"><code class="docutils literal notranslate"><span class="pre">$schema</span></code></a></li>
<li><a class="reference internal" href="#id2"><code class="docutils literal notranslate"><span class="pre">schema_version</span></code></a></li>
<li><a class="reference internal" href="#ecosystems"><code class="docutils literal notranslate"><span class="pre">ecosystems</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mappings-schema">Mappings schema</a><ul>
<li><a class="reference internal" href="#id3"><code class="docutils literal notranslate"><span class="pre">$schema</span></code></a></li>
<li><a class="reference internal" href="#id4"><code class="docutils literal notranslate"><span class="pre">schema_version</span></code></a></li>
<li><a class="reference internal" href="#name"><code class="docutils literal notranslate"><span class="pre">name</span></code></a></li>
<li><a class="reference internal" href="#description"><code class="docutils literal notranslate"><span class="pre">description</span></code></a></li>
<li><a class="reference internal" href="#id5"><code class="docutils literal notranslate"><span class="pre">mappings</span></code></a></li>
<li><a class="reference internal" href="#package-managers"><code class="docutils literal notranslate"><span class="pre">package_managers</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#registry-known-ecosystems-and-mappings">Registry, known ecosystems and mappings</a></li>
<li><a class="reference internal" href="#pyproject-external-cli">pyproject-external CLI</a></li>
<li><a class="reference internal" href="#pyproject-external-api">pyproject-external API</a></li>
<li><a class="reference internal" href="#grayskull">Grayskull</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a><ul>
<li><a class="reference internal" href="#central-depurl-registry-maintainers">Central DepURL registry maintainers</a></li>
<li><a class="reference internal" href="#package-ecosystem-maintainers-usage">Package ecosystem maintainers usage</a></li>
<li><a class="reference internal" href="#maintainers-of-python-projects">Maintainers of Python projects</a></li>
<li><a class="reference internal" href="#end-user-package-consumers">End user package consumers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#centralized-mappings-governed-by-the-same-body">Centralized mappings governed by the same body</a></li>
<li><a class="reference internal" href="#allowing-ecosystem-specific-variants-of-packages">Allowing ecosystem-specific variants of packages</a></li>
<li><a class="reference internal" href="#adding-more-package-metadata-to-the-central-registry">Adding more package metadata to the central registry</a></li>
<li><a class="reference internal" href="#mapping-pypi-projects-to-repackaged-counterparts-in-target-ecosystems">Mapping PyPI projects to repackaged counterparts in target ecosystems</a></li>
<li><a class="reference internal" href="#strict-validation-of-identifiers">Strict validation of identifiers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#open-issues">Open Issues</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#appendix-a-operational-suggestions">Appendix A: Operational suggestions</a></li>
<li><a class="reference internal" href="#appendix-b-virtual-versioning-proposal">Appendix B: Virtual versioning proposal</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/peps/pep-0804.rst?plain=1">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
    <script src="../_static/sticky_banner.js"></script>
    <script src="https://analytics.python.org/js/script.outbound-links.js"
            data-domain="peps.python.org" defer></script>
    <script src="/pagefind/pagefind-ui.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            // Ranking configuration to boost exact title matches
            const searchOptions = {
                ranking: {
                    termSimilarity: 9.0, // Higher values favor exact matches
                    termFrequency: 0.5, // Lower values reduce penalty for low term frequency
                    pageLength: 0.2, // Lower values reduce the impact of page length
                }
            };

            // Initialize pagefind for either mobile or desktop, not both
            if (window.innerWidth <= 640) {
                new PagefindUI({ element: "#mobile-search", ...searchOptions, showSubResults: false });
            } else {
                new PagefindUI({ element: "#search", ...searchOptions, showSubResults: true });
            }
        });
    </script>
</body>
</html>