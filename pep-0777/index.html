
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 777 – How to Re-invent the Wheel | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0777/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://peps.python.org/peps.rss">
    <meta property="og:title" content='PEP 777 – How to Re-invent the Wheel | peps.python.org'>
    <meta property="og:description" content="The current wheel 1.0 specification was written over a decade ago, and has been extremely robust to changes in the Python packaging ecosystem. Previous efforts to improve the wheel specification were deferred to focus on other packaging specifications. ...">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://peps.python.org/pep-0777/">
    <meta property="og:site_name" content="Python Enhancement Proposals (PEPs)">
    <meta property="og:image" content="https://peps.python.org/_static/og-image.png">
    <meta property="og:image:alt" content="Python PEPs">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta name="description" content="The current wheel 1.0 specification was written over a decade ago, and has been extremely robust to changes in the Python packaging ecosystem. Previous efforts to improve the wheel specification were deferred to focus on other packaging specifications. ...">
    <meta name="theme-color" content="#3776ab">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1 data-pagefind-ignore>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 777</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        
        <div id="mobile-search" class="mobile-search-container"></div>
        
        <article data-pagefind-body>
            
            <span data-pagefind-meta="title:PEP 777 – How to Re-invent the Wheel" data-pagefind-weight="10" class="visually-hidden">PEP 777 – How to Re-invent the Wheel</span>
            <section id="pep-content">
<h1 class="page-title">PEP 777 – How to Re-invent the Wheel</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Emma Harper Smith &lt;emma&#32;&#97;t&#32;python.org&gt;</dd>
<dt class="field-even">Sponsor<span class="colon">:</span></dt>
<dd class="field-even">Barry Warsaw &lt;barry&#32;&#97;t&#32;python.org&gt;</dd>
<dt class="field-odd">PEP-Delegate<span class="colon">:</span></dt>
<dd class="field-odd">Paul Moore &lt;p.f.moore&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-even">Discussions-To<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="https://discuss.python.org/t/pep-777-how-to-re-invent-the-wheel/67484">Discourse thread</a></dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><abbr title="Proposal under active discussion and revision">Draft</abbr></dd>
<dt class="field-even">Type<span class="colon">:</span></dt>
<dd class="field-even"><abbr title="Normative PEP with a new feature for Python, implementation change for CPython or interoperability standard for the ecosystem">Standards Track</abbr></dd>
<dt class="field-odd">Topic<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="../topic/packaging/">Packaging</a></dd>
<dt class="field-even">Created<span class="colon">:</span></dt>
<dd class="field-even">09-Oct-2024</dd>
<dt class="field-odd">Post-History<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="https://discuss.python.org/t/pep-777-how-to-re-invent-the-wheel/67484" title="Discourse thread">10-Oct-2024</a></dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#add-wheel-version-metadata-field-to-core-metadata">Add Wheel-Version Metadata Field to Core Metadata</a></li>
<li><a class="reference internal" href="#resolver-behavior-regarding-wheel-version">Resolver Behavior Regarding <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code></a></li>
<li><a class="reference internal" href="#first-major-version-bump-must-change-file-extension">First Major Version Bump Must Change File Extension</a></li>
<li><a class="reference internal" href="#recommended-build-backend-behavior-with-new-wheel-formats">Recommended Build Backend Behavior with New Wheel Formats</a></li>
<li><a class="reference internal" href="#limitations-on-future-wheel-revisions">Limitations on Future Wheel Revisions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#the-wheel-format-is-perfect-and-does-not-need-to-be-changed">The Wheel Format is Perfect and Does not Need to be Changed</a></li>
<li><a class="reference internal" href="#wheel-format-changes-should-be-tied-to-cpython-releases">Wheel Format Changes Should be Tied to CPython Releases</a></li>
<li><a class="reference internal" href="#keep-using-whl-as-the-file-extension">Keep Using <code class="docutils literal notranslate"><span class="pre">.whl</span></code> as the File Extension</a></li>
<li><a class="reference internal" href="#store-the-wheel-major-version-in-the-file-extension-whl2">Store the Wheel Major Version in the File Extension (<code class="docutils literal notranslate"><span class="pre">.whl2</span></code>)</a></li>
<li><a class="reference internal" href="#wheel-2-0-should-change-the-outer-container-format">Wheel 2.0 Should Change the Outer Container Format</a></li>
<li><a class="reference internal" href="#why-not-specify-wheel-2-0-in-this-pep">Why not Specify Wheel 2.0 In This PEP?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#discussion-topics">Discussion Topics</a><ul>
<li><a class="reference internal" href="#should-indices-support-dual-publishing-for-the-first-migration">Should Indices Support Dual-publishing for the First Migration?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#acknowledgements">Acknowledgements</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p>The current <a class="pep reference internal" href="../pep-0427/" title="PEP 427 – The Wheel Binary Package Format 1.0">wheel 1.0 specification</a> was written over a decade ago,
and has been extremely robust to changes in the Python packaging ecosystem.
Previous efforts to improve the wheel specification
<a class="pep reference internal" href="../pep-0491/#pep-deferral" title="PEP 491 – The Wheel Binary Package Format 1.9 § PEP Deferral">were deferred</a> to focus on other packaging
specifications. Meanwhile, the use of wheels has changed dramatically in the
last decade. There have been many requests for new wheel features over the
years; however, a fundamental obstacle to evolving the wheel specification has
been that there is no defined process for how to handle adding
backwards-incompatible features to wheels. Therefore, to enable other PEPs to
describe new enhancements to the wheel specification, <strong>this PEP prescribes</strong>
<strong>compatibility requirements on future wheel revisions</strong>. This PEP does <em>not</em>
specify a new wheel revision. The specification of a new wheel format
(“Wheel 2.0”) is left to a future PEP.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale" role="doc-backlink">Rationale</a></h2>
<p>Currently, wheel specification changes that require new installer behavior are backwards incompatible and require a major version increase in
the wheel metadata format. An increase of the wheel major version has yet to
happen, partially because such a change has the potential to be
catastrophically disruptive. Per
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/binary-distribution-format/#installing-a-wheel-distribution-1-0-py32-none-any-whl">the wheel specification</a>,
any installer that does not support the new major version must abort at install
time. This means that if the major version were to be incremented without
further planning, many users would see installation failures as older installers reject new wheels
uploaded to public package indices like the Python Package Index (PyPI). It is
critically important to carefully plan the interactions between build tools,
package indices, and package installers to avoid incompatibility issues,
especially considering the long tail of users who are slow to update their
installers.</p>
<p>The backward compatibility concerns have prevented valuable improvements
to the wheel file format, such as
<a class="reference external" href="https://discuss.python.org/t/improving-wheel-compression-by-nesting-data-as-a-second-zip/1747">better compression</a>,
<a class="reference external" href="https://discuss.python.org/t/should-there-be-a-new-standard-for-installing-arbitrary-data-files/7853/7">wheel data format improvements</a>,
<a class="reference external" href="https://discuss.python.org/t/record-the-top-level-names-of-a-wheel-in-metadata/29494">better information about what is included in a wheel</a>,
and <a class="reference external" href="https://discuss.python.org/t/is-was-there-a-goal-with-pep-566s-json-encoding-section/12324/3">JSON formatted metadata in the “.dist-info” folder</a>.</p>
<p>This PEP describes constraints and behavior for new wheel revisions to preserve
stability for existing tools that do not support a new major version of the wheel format.
This ensures that backwards incompatible changes to the wheel specification
will only affect users and tools that are properly set up to use the newer
wheels. With a clear path for evolving the wheel specification, future PEPs
will be able to improve the wheel format without needing to re-define a
completely new compatibility story.</p>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification" role="doc-backlink">Specification</a></h2>
<section id="add-wheel-version-metadata-field-to-core-metadata">
<h3><a class="toc-backref" href="#add-wheel-version-metadata-field-to-core-metadata" role="doc-backlink">Add Wheel-Version Metadata Field to Core Metadata</a></h3>
<p>Currently, the <a class="pep reference internal" href="../pep-0427/" title="PEP 427 – The Wheel Binary Package Format 1.0">wheel 1.0 PEP</a>, PEP 427, specifies that wheel files
must contain a <code class="docutils literal notranslate"><span class="pre">WHEEL</span></code> metadata file that contains the version of the wheel
specification that the file conforms to. PEP 427 stipulates that installers
MUST warn on installation of a wheel with a minor version greater than supported,
and MUST abort on installation of wheels with a major version that is greater than
what the installer supports. This ensures that users do not get invalid
installations from wheels that installers cannot properly install.</p>
<p>However, resolvers do not currently exclude wheels with an incompatible wheel
version. There is also currently no way for a resolver to check a wheel’s
version without downloading the wheel directly. To make wheel version filtering
easy for resolvers, the wheel version <strong>MUST</strong> be included in the relevant
metadata file (currently <code class="docutils literal notranslate"><span class="pre">METADATA</span></code>). This will allow resolvers to
efficiently check the wheel version using the <a class="pep reference internal" href="../pep-0658/" title="PEP 658 – Serve Distribution Metadata in the Simple Repository API">PEP 658</a> metadata API without
needing to download and inspect the <code class="docutils literal notranslate"><span class="pre">.dist-info/WHEEL</span></code> file.</p>
<p>To accomplish this, a new field, <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code>, will be added to the
<a class="reference external" href="https://packaging.python.org/specifications/core-metadata/">Core Metadata Specification</a>.
This field is single use, and must contain the exact same version specified as
the <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code> entry in the <code class="docutils literal notranslate"><span class="pre">WHEEL</span></code> file, or any future replacement
file defining metadata about the wheel file. If <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code> is absent
from the metadata file, then tools <strong>MUST</strong> infer the wheel file major
version as 1.</p>
<p><code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code> <strong>MUST NOT</strong> be included in source distribution metadata
(<code class="docutils literal notranslate"><span class="pre">PKG-INFO</span></code>) files. If a tool encounters <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code> inside of a source
distribution metadata file, it <strong>SHOULD</strong> raise an error.</p>
<p><code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code> <strong>MAY</strong> be included in the metadata file for wheels of
version 1, but for wheels of version 2 or higher, the metadata file <strong>MUST</strong>
include <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code>. This enforces that future revisions of the wheel
specification can rely on resolvers skipping incompatible wheels by checking
the <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code> field. Build backends are encouraged to include
<code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code> in all wheels that they generate, regardless of version.</p>
<p>Installers <strong>SHOULD</strong> copy the metadata file in a wheel unmodified during
installation. This prevents the need to update the <code class="docutils literal notranslate"><span class="pre">RECORD</span></code> file, which is
an error prone process. Tools reading installed core metadata <strong>SHOULD NOT</strong>
assume that the field is present, as other installation formats may omit it.</p>
<p>When installing a wheel, installers <strong>MUST</strong> take the following steps:</p>
<ol class="arabic simple">
<li>Check that the values of <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code> in both the core metadata file
and wheel metadata file match. If they do not match, installers <strong>MUST</strong>
abort installation. Neither value takes precedence.</li>
<li>Check that the installer is compatible with <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code>. If
<code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code> is absent, assume the version is 1.0. Warn if minor
version is greater, abort if major version is greater. This procedure is
identital to that in <a class="pep reference internal" href="../pep-0427/" title="PEP 427 – The Wheel Binary Package Format 1.0">PEP 427</a>.</li>
<li>Proceed with installation as specified in the
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/binary-distribution-format/#binary-distribution-format">Binary Distribution Format</a>
specification.</li>
</ol>
</section>
<section id="resolver-behavior-regarding-wheel-version">
<h3><a class="toc-backref" href="#resolver-behavior-regarding-wheel-version" role="doc-backlink">Resolver Behavior Regarding <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code></a></h3>
<p>Resolvers, in the process of selecting a wheel to install, <strong>MUST</strong> check a
candidate wheel’s <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code>, and ignore incompatible wheel files.
Without ignoring these files, older installers might select a wheel that uses
an unsupported wheel version for that installer, and force the installer to
abort per <a class="pep reference internal" href="../pep-0427/" title="PEP 427 – The Wheel Binary Package Format 1.0">PEP 427</a>. By skipping incompatible wheel files, users will not see
installation errors when a project adopts a new wheel major version. As already
specified in PEP 427, installers <strong>MUST</strong> abort if a user tries to directly
install a wheel that is incompatible. If, in the process of resolving packages
found in multiple indices, a resolver comes across two wheels of the same
distribution and version, resolvers should prioritize the wheel of the highest
compatible version.</p>
<p>While the above protects users from unexpected breakages, users may miss a new
release of a distribution if their installer does not support the wheel version
used in the release. Imagine in the future that a package publishes 3.0 wheel
files. Downstream users won’t see that there is a new release available if
their installers only support 2.x wheels. Therefore, installers <strong>SHOULD</strong> emit
a warning if, in the process of resolving packages, they come across an incompatible wheel
and skip it.</p>
</section>
<section id="first-major-version-bump-must-change-file-extension">
<h3><a class="toc-backref" href="#first-major-version-bump-must-change-file-extension" role="doc-backlink">First Major Version Bump Must Change File Extension</a></h3>
<p>Unfortunately, existing resolvers do not check the compatibility of wheels
before selecting them as installation candidates. Until a majority of users
update to installers that properly check for wheel compatibility, it is unsafe
to allow publishing wheels of a new major version that existing resolvers might
select. It could take upwards of four years before the majority of users are on
updated resolvers, based on current data about PyPI installer usage (See the
<a class="reference internal" href="appendix-pypi-download-analysis/#pypi-download-analysis"><span class="std std-ref">Appendix: Analysis of Installer Usage on PyPI</span></a>, for
details). To allow for experimentation and faster adoption of 2.0 wheels,
this PEP proposes a change to the file extension of the
wheel file format, from <code class="docutils literal notranslate"><span class="pre">.whl</span></code> to <code class="docutils literal notranslate"><span class="pre">.whlx</span></code> for all future wheel versions.
Note that <code class="docutils literal notranslate"><span class="pre">x</span></code> in <code class="docutils literal notranslate"><span class="pre">whlx</span></code> is the letter “x” and does not specify the wheel
major version. The change to extension name resolves the initial transition
issue of 2.0 wheels breaking users on existing installers that do not implement
<code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code> checks. By using a different file extension, 2.0 wheels can
immediately be uploaded to PyPI, and users will be able to experiment with the
new features right away. Users on older installers will simply ignore these new
files.</p>
<p>One rejected alternative would be to keep the <code class="docutils literal notranslate"><span class="pre">.whl</span></code> extension, but delay the
publishing of wheel 2.0 to PyPI. For more on that, please see Rejected Ideas.</p>
</section>
<section id="recommended-build-backend-behavior-with-new-wheel-formats">
<h3><a class="toc-backref" href="#recommended-build-backend-behavior-with-new-wheel-formats" role="doc-backlink">Recommended Build Backend Behavior with New Wheel Formats</a></h3>
<p>Build backends are recommended to generate the most compatible wheel based on
features a project uses. For example, if a wheel does not use symbolic links,
and such a feature was introduced in wheel 5.0, the build backend could
generate a wheel of version 4.0. On the other hand, some features will want to
be adopted by default. For example, if wheel 3.0 introduces better compression,
the build backend may wish to enable this feature by default to improve the
wheel size and download performance.</p>
</section>
<section id="limitations-on-future-wheel-revisions">
<h3><a class="toc-backref" href="#limitations-on-future-wheel-revisions" role="doc-backlink">Limitations on Future Wheel Revisions</a></h3>
<p>While it is difficult to know what future features may be planned for the wheel
format, it is important that certain compatibility promises are maintained.</p>
<p>Wheel files, when installed, <strong>MUST</strong> stay compatible with the Python standard
library’s <code class="docutils literal notranslate"><span class="pre">importlib.metadata</span></code> for all supported CPython versions.  For
example, replacing <code class="docutils literal notranslate"><span class="pre">.dist-info/METADATA</span></code> with a JSON formatted metadata file
MUST be a multi-major version migration with one version introducing the new
JSON file alongside the existing email header format, and another future
version removing the email header format metadata file. The version to remove
<code class="docutils literal notranslate"><span class="pre">.dist-info/METADATA</span></code> also <strong>MUST</strong> be adopted only after the last CPython
release that lacked support for the new file reaches end of life. This ensures
that code using <code class="docutils literal notranslate"><span class="pre">importlib.metadata</span></code> will not break with wheel major version
revisions.</p>
<p>Wheel files <strong>MUST</strong> remain ZIP format files as the outer container format.
Additionally, the <code class="docutils literal notranslate"><span class="pre">.dist-info</span></code> metadata directory <strong>MUST</strong> be placed at the
root of the archive without any compression, so that unpacking the wheel file
produces a normal <code class="docutils literal notranslate"><span class="pre">.dist-info</span></code> directory holding any metadata for the wheel.
Future wheel revisions <strong>MAY</strong> modify the layout, compression, and other
attributes about non-metadata components of a wheel such as data and code. This
assures that future wheel revisions remain compatible with tools operating on
package metadata, while allowing for improvements to code storage in the wheel,
such as adopting compression.</p>
<p>Package tooling <strong>MUST NOT</strong> assume that the contents and format of the wheel
file will remain the same for future wheel major versions beyond the
limitations above about metadata folder contents and outer container format.
For example, newer wheel major versions may add or remove filename components,
such as the build tag or the platform tag. Therefore it is incumbent upon
tooling to check the metadata for the <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code> before attempting to
install a wheel.</p>
<p>Finally, future wheel revisions <strong>MUST NOT</strong> use any compression formats not in
the CPython standard library of at least the latest release. Wheels generated
using any new compression format should be tagged as requiring at least the
first released version of CPython to support the new compression format,
regardless of the Python API compatibility of the code within the wheel.</p>
</section>
</section>
<section id="backwards-compatibility">
<h2><a class="toc-backref" href="#backwards-compatibility" role="doc-backlink">Backwards Compatibility</a></h2>
<p>Backwards compatibility is an incredibly important issue for evolving the wheel
format. If adopting a new wheel revision is painful for downstream users,
package creators will hesitate to adopt the new standards, and users will be
stuck with failed CI pipelines and other installation woes.</p>
<p>Several choices in the above specification are made so that the adoption of a
new feature is less painful. For example, today wheels of an incompatible major
version are still selected by pip as installation candidates, which causes
installer failures if a project starts publishing 2.0 wheels. To avoid this
issue, this PEP requires resolvers to filter out wheels with major versions or
features incompatible with the installer.</p>
<p>This PEP also defines constraints on future wheel revisions, with the goal of
maintaining compatibility with CPython, but allowing evolution of wheel
contents. Wheel revisions shouldn’t cause package installations to break on
older CPython revisions, as not only would it be frustrating, it would be
incredibly hard to debug for users.</p>
<p>This PEP relies on resolvers being able to efficiently acquire package
metadata, usually through <a class="pep reference internal" href="../pep-0658/" title="PEP 658 – Serve Distribution Metadata in the Simple Repository API">PEP 658</a>. This might present a problem for users of
package indices that do not serve <a class="pep reference internal" href="../pep-0658/" title="PEP 658 – Serve Distribution Metadata in the Simple Repository API">PEP 658</a> metadata. However, today most
installers fall back on using HTTP range requests to efficiently acquire only
the part of a wheel needed to read the metadata, a feature most storage
providers and servers include. Furthermore, future improvements to wheels
such as compression will make up performance losses due to inspecting files
in the wheel.</p>
<p>The main compatibility limitation of this PEP is for projects that start
publishing solely new wheels alongside a source distribution. If a user on an
older installer tries to install the package, it will fall back to the source
distribution, because the resolver will skip all newer wheels. Users are often
poorly set up to build projects from source, so this could lead to some failed
builds users would not see otherwise. There are several approaches to resolving
this issue, such as allowing dual-publishing for the initial migration, or
marking source distributions as not intended to be built.</p>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#rejected-ideas" role="doc-backlink">Rejected Ideas</a></h2>
<section id="the-wheel-format-is-perfect-and-does-not-need-to-be-changed">
<h3><a class="toc-backref" href="#the-wheel-format-is-perfect-and-does-not-need-to-be-changed" role="doc-backlink">The Wheel Format is Perfect and Does not Need to be Changed</a></h3>
<p>The wheel format has been around for over 10 years, and in that time, Python
packages have changed a lot. It is much more common for packages to include
Rust or C extension modules, increasing the size of packages. Better
compression, such as lzma or zstd, could save a lot of time and bandwidth for
PyPI and its users. Compatibility tags cannot express the wide variety of
hardware used to accelerate Python code today, nor encode shared library
compatibility information. In order to address these issues, evolution of the
wheel package format is necessary.</p>
</section>
<section id="wheel-format-changes-should-be-tied-to-cpython-releases">
<h3><a class="toc-backref" href="#wheel-format-changes-should-be-tied-to-cpython-releases" role="doc-backlink">Wheel Format Changes Should be Tied to CPython Releases</a></h3>
<p>I do not believe that tying wheel revisions to CPython
releases is beneficial. The main benefit of doing so is to make adoption of new
wheels predictable - users with the latest CPython get the latest package
format! This choice has several issues however. First, tying the new format
to the latest CPython makes adoption much slower. Users on LTS versions of
Linux with older Python installations are free to update their pip in a virtual
environment, but cannot update the version of Python as easily.  While some
changes to the wheel format must be tied to CPython changes necessarily, such
as adding new compression formats or changing the metadata format, many changes
do not need to be tied to the Python version, such as symlinks, enhanced
compatibility tags, and new formats that use existing compression formats in
the standard library. Additionally, wheels are used across multiple different
language implementations, which lag behind the CPython version. It seems unfair
to prevent their users from using a feature due to the Python version. Lastly,
while this PEP does not suggest tying the wheel version to CPython releases, a
future PEP may still do so at any time, so this choice does not need to be made
in this PEP.</p>
</section>
<section id="keep-using-whl-as-the-file-extension">
<h3><a class="toc-backref" href="#keep-using-whl-as-the-file-extension" role="doc-backlink">Keep Using <code class="docutils literal notranslate"><span class="pre">.whl</span></code> as the File Extension</a></h3>
<p>While keeping the extension <code class="docutils literal notranslate"><span class="pre">.whl</span></code> is appealing for many reasons, it presents
several problems that are difficult to surmount.  First, current installers
would still pick a new wheel and fail to install the package. Furthermore,
the file name of a wheel would not be able to change without breaking existing
installers that expect a set wheel file name format. While the current filename
specification for wheels is sufficient for current usage, the optional
build tag in the middle of the file name makes any extensions ambiguous (i.e.
<code class="docutils literal notranslate"><span class="pre">foo-0.3-py3-none-any-fancy_new_tag.whl</span></code> would parse as the build tag being
<code class="docutils literal notranslate"><span class="pre">py3</span></code>). This limits changes to information stored in the wheel file name.</p>
</section>
<section id="store-the-wheel-major-version-in-the-file-extension-whl2">
<h3><a class="toc-backref" href="#store-the-wheel-major-version-in-the-file-extension-whl2" role="doc-backlink">Store the Wheel Major Version in the File Extension (<code class="docutils literal notranslate"><span class="pre">.whl2</span></code>)</a></h3>
<p>Storing the wheel major version in the file extension has several nice
advantages. For one, there is no need to introduce the <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code>
metadata field, since installers could simply filter based on file extension.
This would also allow future side-by-side packages. However, changing the
extension for wheels each major version has some downsides. First, the version
stored in the <code class="docutils literal notranslate"><span class="pre">WHEEL</span></code> file must match the file extension, and this would need
to be verified by installers. Additionally, many systems associate file type by
file extension (e.g. executable associations, various web caching software),
and these would need to be updated every version that is released. Furthermore,
part of the brittleness of the current wheel specification is that so much
metadata is stored in the filename. Filenames are not well suited to store
structured data. Moving away from encoding information in the filename should
be a goal of future wheel revisions.</p>
<p>Another possibility is to use the file extension to encode the outer container
format (i.e. a ZIP file containing <code class="docutils literal notranslate"><span class="pre">.dist-info</span></code>) separate from the inner
wheel version. However, this could lead to confusion if the file extension and
inner <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code> diverge. If an installer raises an error due to an
incompatible wheel 3.0 as obtained from the wheel metadata, some users will
be confused by the difference from the file extension <code class="docutils literal notranslate"><span class="pre">.whl2</span></code>.</p>
</section>
<section id="wheel-2-0-should-change-the-outer-container-format">
<h3><a class="toc-backref" href="#wheel-2-0-should-change-the-outer-container-format" role="doc-backlink">Wheel 2.0 Should Change the Outer Container Format</a></h3>
<p>Since wheel 2.0 will change the extension of wheel files, it is the best
opportunity to modify the outer container format. Compatibility does not need
to be kept with a different file extension that tools will need to opt-in to
reading. The main use-case for a different exterior compression format would
be better compression. For example, the outer container could be changed into
a <a class="reference external" href="https://facebook.github.io/zstd/">Zstandard</a> tarfile, <code class="docutils literal notranslate"><span class="pre">.tar.zst</span></code>, which
would decompress faster and produce smaller wheels. However, there are several
practical issues with this. First, Zstandard is not part of the Python standard
library, so pure-Python packaging tools would need to ship an extension to
unpack these wheels. This could cause some compatibility issues for several
platforms where extension modules are not easy to install. Furthermore, a
future wheel revision could always introduce a new layout of non-metadata files
that uses a <code class="docutils literal notranslate"><span class="pre">.tar.zst</span></code> inside the existing ZIP-based format.</p>
<p>Finally, it is not a good idea to change the wheel file format too much at
once. The goal of this PEP is to make evolving the specification easier, and
part of the rationale behind making wheel evolution easier is to avoid “all
at once” changes. Changing the outer file format for wheels would require
re-writing how package metadata is not only discovered, but also installed.</p>
</section>
<section id="why-not-specify-wheel-2-0-in-this-pep">
<h3><a class="toc-backref" href="#why-not-specify-wheel-2-0-in-this-pep" role="doc-backlink">Why not Specify Wheel 2.0 In This PEP?</a></h3>
<p>There are <em>many</em> features that could be included as part of wheel 2.0, but this
PEP does not cover them. The goal of this PEP is to define a compatibility
story for the wheel file format. Changes that do not pertain to compatibility
for wheel versions do not need to be in this PEP, and should be introducted
in follow-up PEPs defining new wheel features.</p>
</section>
</section>
<section id="discussion-topics">
<h2><a class="toc-backref" href="#discussion-topics" role="doc-backlink">Discussion Topics</a></h2>
<section id="should-indices-support-dual-publishing-for-the-first-migration">
<h3><a class="toc-backref" href="#should-indices-support-dual-publishing-for-the-first-migration" role="doc-backlink">Should Indices Support Dual-publishing for the First Migration?</a></h3>
<p>Since <code class="docutils literal notranslate"><span class="pre">.whl</span></code> and <code class="docutils literal notranslate"><span class="pre">.whlx</span></code> will look different in file name, they could be
uploaded side-by-side to package indices like PyPI. This has some nice
benefits, like dual-support for older and newer installers, so users who can
get the latest features, while users who don’t upgrade still can install the
latest version of a package.</p>
<p>There are many complications however. Should we allow wheel 2 uploads to
existing wheel 1-only releases? Should we put any requirements on the
side-by-side wheels, such as:</p>
<div class="admonition-constraints-on-dual-published-wheels admonition">
<p class="admonition-title">Constraints on dual-published wheels</p>
<p>A given index may contain identical-content wheels with different wheel
versions, and installers should prefer the newest-available wheel format,
with all other factors held constant.</p>
</div>
<p>Should we only allow uploading both with <a class="pep reference internal" href="../pep-0694/" title="PEP 694 – Upload 2.0 API for Python Package Indexes">PEP 694</a> allowing “atomic”
dual-publishing?</p>
</section>
</section>
<section id="acknowledgements">
<h2><a class="toc-backref" href="#acknowledgements" role="doc-backlink">Acknowledgements</a></h2>
<p>The author of this PEP is greatly indebted to the incredibly valuable review,
advice, and feedback of Barry Warsaw and Michael Sarahan.</p>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document is placed in the public domain or under the
CC0-1.0-Universal license, whichever is more permissive.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/peps/pep-0777.rst">https://github.com/python/peps/blob/main/peps/pep-0777.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/peps/pep-0777.rst">2025-02-01 07:28:42 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <div id="search"></div>
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#add-wheel-version-metadata-field-to-core-metadata">Add Wheel-Version Metadata Field to Core Metadata</a></li>
<li><a class="reference internal" href="#resolver-behavior-regarding-wheel-version">Resolver Behavior Regarding <code class="docutils literal notranslate"><span class="pre">Wheel-Version</span></code></a></li>
<li><a class="reference internal" href="#first-major-version-bump-must-change-file-extension">First Major Version Bump Must Change File Extension</a></li>
<li><a class="reference internal" href="#recommended-build-backend-behavior-with-new-wheel-formats">Recommended Build Backend Behavior with New Wheel Formats</a></li>
<li><a class="reference internal" href="#limitations-on-future-wheel-revisions">Limitations on Future Wheel Revisions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#the-wheel-format-is-perfect-and-does-not-need-to-be-changed">The Wheel Format is Perfect and Does not Need to be Changed</a></li>
<li><a class="reference internal" href="#wheel-format-changes-should-be-tied-to-cpython-releases">Wheel Format Changes Should be Tied to CPython Releases</a></li>
<li><a class="reference internal" href="#keep-using-whl-as-the-file-extension">Keep Using <code class="docutils literal notranslate"><span class="pre">.whl</span></code> as the File Extension</a></li>
<li><a class="reference internal" href="#store-the-wheel-major-version-in-the-file-extension-whl2">Store the Wheel Major Version in the File Extension (<code class="docutils literal notranslate"><span class="pre">.whl2</span></code>)</a></li>
<li><a class="reference internal" href="#wheel-2-0-should-change-the-outer-container-format">Wheel 2.0 Should Change the Outer Container Format</a></li>
<li><a class="reference internal" href="#why-not-specify-wheel-2-0-in-this-pep">Why not Specify Wheel 2.0 In This PEP?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#discussion-topics">Discussion Topics</a><ul>
<li><a class="reference internal" href="#should-indices-support-dual-publishing-for-the-first-migration">Should Indices Support Dual-publishing for the First Migration?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#acknowledgements">Acknowledgements</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/peps/pep-0777.rst?plain=1">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
    <script src="../_static/sticky_banner.js"></script>
    <script src="https://analytics.python.org/js/script.outbound-links.js"
            data-domain="peps.python.org" defer></script>
    <script src="/pagefind/pagefind-ui.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            // Ranking configuration to boost exact title matches
            const searchOptions = {
                ranking: {
                    termSimilarity: 9.0, // Higher values favor exact matches
                    termFrequency: 0.5, // Lower values reduce penalty for low term frequency
                    pageLength: 0.2, // Lower values reduce the impact of page length
                }
            };

            // Initialize pagefind for either mobile or desktop, not both
            if (window.innerWidth <= 640) {
                new PagefindUI({ element: "#mobile-search", ...searchOptions, showSubResults: false });
            } else {
                new PagefindUI({ element: "#search", ...searchOptions, showSubResults: true });
            }
        });
    </script>
</body>
</html>