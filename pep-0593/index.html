
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 593 – Flexible function and variable annotations | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0593/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://peps.python.org/peps.rss">
    <meta property="og:title" content='PEP 593 – Flexible function and variable annotations | peps.python.org'>
    <meta property="og:description" content="This PEP introduces a mechanism to extend the type annotations from PEP 484 with arbitrary metadata.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://peps.python.org/pep-0593/">
    <meta property="og:site_name" content="Python Enhancement Proposals (PEPs)">
    <meta property="og:image" content="https://peps.python.org/_static/og-image.png">
    <meta property="og:image:alt" content="Python PEPs">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta name="description" content="This PEP introduces a mechanism to extend the type annotations from PEP 484 with arbitrary metadata.">
    <meta name="theme-color" content="#3776ab">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 593</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 593 – Flexible function and variable annotations</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Till Varoquaux &lt;till&#32;&#97;t&#32;fb.com&gt;, Konstantin Kashin &lt;kkashin&#32;&#97;t&#32;fb.com&gt;</dd>
<dt class="field-even">Sponsor<span class="colon">:</span></dt>
<dd class="field-even">Ivan Levkivskyi &lt;levkivskyi&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-odd">Discussions-To<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="https://mail.python.org/archives/list/typing-sig&#64;python.org/">Typing-SIG list</a></dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><abbr title="Accepted and implementation complete, or no longer active">Final</abbr></dd>
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><abbr title="Normative PEP with a new feature for Python, implementation change for CPython or interoperability standard for the ecosystem">Standards Track</abbr></dd>
<dt class="field-even">Topic<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="../topic/typing/">Typing</a></dd>
<dt class="field-odd">Created<span class="colon">:</span></dt>
<dd class="field-odd">26-Apr-2019</dd>
<dt class="field-even">Python-Version<span class="colon">:</span></dt>
<dd class="field-even">3.9</dd>
<dt class="field-odd">Post-History<span class="colon">:</span></dt>
<dd class="field-odd">20-May-2019</dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#motivating-examples">Motivating examples</a><ul>
<li><a class="reference internal" href="#combining-runtime-and-static-uses-of-annotations">Combining runtime and static uses of annotations</a></li>
<li><a class="reference internal" href="#lowering-barriers-to-developing-new-typing-constructs">Lowering barriers to developing new typing constructs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a></li>
<li><a class="reference internal" href="#consuming-annotations">Consuming annotations</a></li>
<li><a class="reference internal" href="#interaction-with-get-type-hints">Interaction with <code class="docutils literal notranslate"><span class="pre">get_type_hints()</span></code></a></li>
<li><a class="reference internal" href="#aliases-concerns-over-verbosity">Aliases &amp; Concerns over verbosity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rejected-ideas">Rejected ideas</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<div class="pep-banner canonical-typing-spec sticky-banner admonition important">
<p class="admonition-title">Important</p>
<p>This PEP is a historical document: see <a class="reference external" href="https://typing.python.org/en/latest/spec/qualifiers.html#annotated" title="(in typing)"><span>Annotated</span></a> and
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Annotated" title="(in Python v3.14)"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Annotated</span></code></a> for up-to-date specs and documentation. Canonical typing specs are maintained at the <a class="reference external" href="https://typing.python.org/en/latest/spec/">typing specs site</a>; runtime typing behaviour is described in the CPython documentation.</p>
<p class="close-button">×</p>
<p>See the <a class="reference external" href="https://typing.python.org/en/latest/spec/meta.html">typing specification update process</a> for how to propose changes to the typing spec.</p>
</div>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p>This PEP introduces a mechanism to extend the type annotations from PEP
484 with arbitrary metadata.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation" role="doc-backlink">Motivation</a></h2>
<p><a class="pep reference internal" href="../pep-0484/" title="PEP 484 – Type Hints">PEP 484</a> provides a standard semantic for the annotations introduced in
<a class="pep reference internal" href="../pep-3107/" title="PEP 3107 – Function Annotations">PEP 3107</a>. <a class="pep reference internal" href="../pep-0484/" title="PEP 484 – Type Hints">PEP 484</a> is prescriptive but it is the de facto standard
for most of the consumers of annotations; in many statically checked
code bases, where type annotations are widely used, they have
effectively crowded out any other form of annotation. Some of the use
cases for annotations described in <a class="pep reference internal" href="../pep-3107/" title="PEP 3107 – Function Annotations">PEP 3107</a> (database mapping,
foreign languages bridge) are not currently realistic given the
prevalence of type annotations. Furthermore, the standardisation of type
annotations rules out advanced features only supported by specific type
checkers.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale" role="doc-backlink">Rationale</a></h2>
<p>This PEP adds an <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> type to the typing module to decorate
existing types with context-specific metadata. Specifically, a type
<code class="docutils literal notranslate"><span class="pre">T</span></code> can be annotated with metadata <code class="docutils literal notranslate"><span class="pre">x</span></code> via the typehint
<code class="docutils literal notranslate"><span class="pre">Annotated[T,</span> <span class="pre">x]</span></code>. This metadata can be used for either static
analysis or at runtime. If a library (or tool) encounters a typehint
<code class="docutils literal notranslate"><span class="pre">Annotated[T,</span> <span class="pre">x]</span></code> and has no special logic for metadata <code class="docutils literal notranslate"><span class="pre">x</span></code>, it
should ignore it and simply treat the type as <code class="docutils literal notranslate"><span class="pre">T</span></code>. Unlike the
<code class="docutils literal notranslate"><span class="pre">no_type_check</span></code> functionality that currently exists in the <code class="docutils literal notranslate"><span class="pre">typing</span></code>
module which completely disables typechecking annotations on a function
or a class, the <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> type allows for both static typechecking
of <code class="docutils literal notranslate"><span class="pre">T</span></code> (e.g., via <a class="reference external" href="http://www.mypy-lang.org/">mypy</a> or <a class="reference external" href="https://pyre-check.org/">Pyre</a>,
which can safely ignore <code class="docutils literal notranslate"><span class="pre">x</span></code>)
together with runtime access to <code class="docutils literal notranslate"><span class="pre">x</span></code> within a specific application. The
introduction of this type would address a diverse set of use cases of interest
to the broader Python community.</p>
<p>This was originally brought up as <a class="reference external" href="https://github.com/python/typing/issues/600">issue 600</a> in the typing github
and then discussed in <a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2019-January/054908.html">Python ideas</a>.</p>
</section>
<section id="motivating-examples">
<h2><a class="toc-backref" href="#motivating-examples" role="doc-backlink">Motivating examples</a></h2>
<section id="combining-runtime-and-static-uses-of-annotations">
<h3><a class="toc-backref" href="#combining-runtime-and-static-uses-of-annotations" role="doc-backlink">Combining runtime and static uses of annotations</a></h3>
<p>There’s an emerging trend of libraries leveraging the typing annotations at
runtime (e.g.: dataclasses); having the ability to extend the typing annotations
with external data would be a great boon for those libraries.</p>
<p>Here’s an example of how a hypothetical module could leverage annotations to
read c structs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UnsignedShort</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">struct2</span><span class="o">.</span><span class="n">ctype</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">)]</span>
<span class="n">SignedChar</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">struct2</span><span class="o">.</span><span class="n">ctype</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Student</span><span class="p">(</span><span class="n">struct2</span><span class="o">.</span><span class="n">Packed</span><span class="p">):</span>
    <span class="c1"># mypy typechecks &#39;name&#39; field as &#39;str&#39;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">struct2</span><span class="o">.</span><span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;&lt;10s&quot;</span><span class="p">)]</span>
    <span class="n">serialnum</span><span class="p">:</span> <span class="n">UnsignedShort</span>
    <span class="n">school</span><span class="p">:</span> <span class="n">SignedChar</span>

<span class="c1"># &#39;unpack&#39; only uses the metadata within the type annotations</span>
<span class="n">Student</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
<span class="c1"># Student(name=b&#39;raymond   &#39;, serialnum=4658, school=264)</span>
</pre></div>
</div>
</section>
<section id="lowering-barriers-to-developing-new-typing-constructs">
<h3><a class="toc-backref" href="#lowering-barriers-to-developing-new-typing-constructs" role="doc-backlink">Lowering barriers to developing new typing constructs</a></h3>
<p>Typically when adding a new type, a developer need to upstream that type to the
typing module and change mypy, <a class="reference external" href="https://www.jetbrains.com/pycharm/">PyCharm</a>, Pyre, <a class="reference external" href="https://github.com/google/pytype">pytype</a>,
etc…
This is particularly important when working on open-source code that
makes use of these types, seeing as the code would not be immediately
transportable to other developers’ tools without additional logic. As a result,
there is a high cost to developing and trying out new types in a codebase.
Ideally, authors should be able to introduce new types in a manner that allows
for graceful degradation (e.g.: when clients do not have a custom <a class="reference external" href="https://github.com/python/mypy_extensions">mypy plugin</a>), which would lower the barrier to development and ensure some
degree of backward compatibility.</p>
<p>For example, suppose that an author wanted to add support for <a class="reference external" href="https://en.wikipedia.org/wiki/Tagged_union">tagged unions</a> to Python. One way to accomplish would be to <a class="reference external" href="https://mypy.readthedocs.io/en/latest/more_types.html#typeddict">annotate</a> <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> in Python such that only one field is allowed
to be set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Currency</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="n">TypedDict</span><span class="p">(</span><span class="s1">&#39;Currency&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;dollars&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;pounds&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">},</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">TaggedUnion</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This is a somewhat cumbersome syntax but it allows us to iterate on this
proof-of-concept and have people with type checkers (or other tools) that don’t
yet support this feature work in a codebase with tagged unions. The author could
easily test this proposal and iron out the kinks before trying to upstream tagged
union to <code class="docutils literal notranslate"><span class="pre">typing</span></code>, mypy, etc. Moreover, tools that do not have support for
parsing the <code class="docutils literal notranslate"><span class="pre">TaggedUnion</span></code> annotation would still be able to treat <code class="docutils literal notranslate"><span class="pre">Currency</span></code>
as a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>, which is still a close approximation (slightly less strict).</p>
</section>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification" role="doc-backlink">Specification</a></h2>
<section id="syntax">
<h3><a class="toc-backref" href="#syntax" role="doc-backlink">Syntax</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Annotated</span></code> is parameterized with a type and an arbitrary list of
Python values that represent the annotations. Here are the specific
details of the syntax:</p>
<ul>
<li>The first argument to <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> must be a valid type</li>
<li>Multiple type annotations are supported (<code class="docutils literal notranslate"><span class="pre">Annotated</span></code> supports variadic
arguments):<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;char&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</li>
<li><code class="docutils literal notranslate"><span class="pre">Annotated</span></code> must be called with at least two arguments (
<code class="docutils literal notranslate"><span class="pre">Annotated[int]</span></code> is not valid)</li>
<li>The order of the annotations is preserved and matters for equality
checks:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;char&quot;</span><span class="p">)]</span> <span class="o">!=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="nb">int</span><span class="p">,</span> <span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;char&quot;</span><span class="p">),</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li>Nested <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> types are flattened, with metadata ordered
starting with the innermost annotation:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Annotated</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)],</span> <span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;char&quot;</span><span class="p">)]</span> <span class="o">==</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;char&quot;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li>Duplicated annotations are not removed:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span> <span class="o">!=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><code class="docutils literal notranslate"><span class="pre">Annotated</span></code> can be used with nested and generic aliases:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Typevar</span> <span class="n">T</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">Vec</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">]],</span> <span class="n">MaxLen</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">Vec</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="n">V</span> <span class="o">==</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MaxLen</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="consuming-annotations">
<h3><a class="toc-backref" href="#consuming-annotations" role="doc-backlink">Consuming annotations</a></h3>
<p>Ultimately, the responsibility of how to interpret the annotations (if
at all) is the responsibility of the tool or library encountering the
<code class="docutils literal notranslate"><span class="pre">Annotated</span></code> type. A tool or library encountering an <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> type
can scan through the annotations to determine if they are of interest
(e.g., using <code class="docutils literal notranslate"><span class="pre">isinstance()</span></code>).</p>
<p><strong>Unknown annotations:</strong> When a tool or a library does not support
annotations or encounters an unknown annotation it should just ignore it
and treat annotated type as the underlying type. For example, when encountering
an annotation that is not an instance of <code class="docutils literal notranslate"><span class="pre">struct2.ctype</span></code> to the annotations
for name (e.g., <code class="docutils literal notranslate"><span class="pre">Annotated[str,</span> <span class="pre">'foo',</span> <span class="pre">struct2.ctype(&quot;&lt;10s&quot;)]</span></code>), the unpack
method should ignore it.</p>
<p><strong>Namespacing annotations:</strong> Namespaces are not needed for annotations since
the class used by the annotations acts as a namespace.</p>
<p><strong>Multiple annotations:</strong> It’s up to the tool consuming the annotations
to decide whether the client is allowed to have several annotations on
one type and how to merge those annotations.</p>
<p>Since the <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> type allows you to put several annotations of
the same (or different) type(s) on any node, the tools or libraries
consuming those annotations are in charge of dealing with potential
duplicates. For example, if you are doing value range analysis you might
allow this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">T1</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
<span class="n">T2</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">T1</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
</pre></div>
</div>
<p>Flattening nested annotations, this translates to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">T2</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ValueRange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="interaction-with-get-type-hints">
<h3><a class="toc-backref" href="#interaction-with-get-type-hints" role="doc-backlink">Interaction with <code class="docutils literal notranslate"><span class="pre">get_type_hints()</span></code></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">typing.get_type_hints()</span></code> will take a new argument <code class="docutils literal notranslate"><span class="pre">include_extras</span></code> that
defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code> to preserve backward compatibility. When
<code class="docutils literal notranslate"><span class="pre">include_extras</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>, the extra annotations will be stripped
out of the returned value. Otherwise, the annotations will be returned
unchanged:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@struct2</span><span class="o">.</span><span class="n">packed</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Student</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;&lt;10s&quot;</span><span class="p">)]</span>

<span class="n">get_type_hints</span><span class="p">(</span><span class="n">Student</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">}</span>
<span class="n">get_type_hints</span><span class="p">(</span><span class="n">Student</span><span class="p">,</span> <span class="n">include_extras</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">}</span>
<span class="n">get_type_hints</span><span class="p">(</span><span class="n">Student</span><span class="p">,</span> <span class="n">include_extras</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;&lt;10s&quot;</span><span class="p">)]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="aliases-concerns-over-verbosity">
<h3><a class="toc-backref" href="#aliases-concerns-over-verbosity" role="doc-backlink">Aliases &amp; Concerns over verbosity</a></h3>
<p>Writing <code class="docutils literal notranslate"><span class="pre">typing.Annotated</span></code> everywhere can be quite verbose;
fortunately, the ability to alias annotations means that in practice we
don’t expect clients to have to write lots of boilerplate code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="n">Const</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">my_annotations</span><span class="o">.</span><span class="n">CONST</span><span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">C</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">const_method</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Const</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
</section>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#rejected-ideas" role="doc-backlink">Rejected ideas</a></h2>
<p>Some of the proposed ideas were rejected from this PEP because they would
cause <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> to not integrate cleanly with the other typing annotations:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Annotated</span></code> cannot infer the decorated type. You could imagine that
<code class="docutils literal notranslate"><span class="pre">Annotated[...,</span> <span class="pre">Immutable]</span></code> could be used to mark a value as immutable
while still inferring its type. Typing does not support using the
inferred type <a class="reference external" href="https://github.com/python/typing/issues/276">anywhere else</a>; it’s best to not add this as a
special case.</li>
<li>Using <code class="docutils literal notranslate"><span class="pre">(Type,</span> <span class="pre">Ann1,</span> <span class="pre">Ann2,</span> <span class="pre">...)</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">Annotated[Type,</span> <span class="pre">Ann1,</span> <span class="pre">Ann2,</span> <span class="pre">...]</span></code>. This would cause confusion when
annotations appear in nested positions (<code class="docutils literal notranslate"><span class="pre">Callable[[A,</span> <span class="pre">B],</span> <span class="pre">C]</span></code> is too similar
to <code class="docutils literal notranslate"><span class="pre">Callable[[(A,</span> <span class="pre">B)],</span> <span class="pre">C]</span></code>) and would make it impossible for constructors to
be passthrough (<code class="docutils literal notranslate"><span class="pre">T(5)</span> <span class="pre">==</span> <span class="pre">C(5)</span></code> when <code class="docutils literal notranslate"><span class="pre">C</span> <span class="pre">=</span> <span class="pre">Annotation[T,</span> <span class="pre">Ann]</span></code>).</li>
</ul>
<p>This feature was left out to keep the design simple:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Annotated</span></code> cannot be called with a single argument. Annotated could support
returning the underlying value when called with a single argument (e.g.:
<code class="docutils literal notranslate"><span class="pre">Annotated[int]</span> <span class="pre">==</span> <span class="pre">int</span></code>). This complicates the specifications and adds
little benefit.</li>
</ul>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document has been placed in the public domain.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/peps/pep-0593.rst">https://github.com/python/peps/blob/main/peps/pep-0593.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/peps/pep-0593.rst">2024-06-11 22:12:09 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#motivating-examples">Motivating examples</a><ul>
<li><a class="reference internal" href="#combining-runtime-and-static-uses-of-annotations">Combining runtime and static uses of annotations</a></li>
<li><a class="reference internal" href="#lowering-barriers-to-developing-new-typing-constructs">Lowering barriers to developing new typing constructs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a></li>
<li><a class="reference internal" href="#consuming-annotations">Consuming annotations</a></li>
<li><a class="reference internal" href="#interaction-with-get-type-hints">Interaction with <code class="docutils literal notranslate"><span class="pre">get_type_hints()</span></code></a></li>
<li><a class="reference internal" href="#aliases-concerns-over-verbosity">Aliases &amp; Concerns over verbosity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rejected-ideas">Rejected ideas</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/peps/pep-0593.rst?plain=1">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
    <script src="../_static/sticky_banner.js"></script>
    <script src="https://analytics.python.org/js/script.outbound-links.js"
            data-domain="peps.python.org" defer></script>
</body>
</html>